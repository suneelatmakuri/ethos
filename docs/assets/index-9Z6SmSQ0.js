(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function Ir(){const n=window.location.hash||"#/welcome",[e,t]=n.split("?"),r=new URLSearchParams(t||"");return{path:e,query:r,raw:n}}function J(n){window.location.hash=n}function qf(n){window.addEventListener("hashchange",n)}const jf=4e3,zf=6e3,Hf=7e3,Wf=1,Kf="/ethos/assets/welcome-ambient.mp4";function Gf(n){const e=()=>{try{const t=Math.max(0,(n.duration||0)-.04);n.currentTime=t,n.pause()}catch{}};n.addEventListener("ended",e),n.addEventListener("pause",()=>{}),n.addEventListener("timeupdate",()=>{n.duration&&n.currentTime>=n.duration-.08&&e()})}function Eu(){document.body.classList.add("welcome-mode"),document.body.style.setProperty("--welcomeTitleScale",String(Wf));const n=document.getElementById("app");n.innerHTML=`
    <div class="welcomeStage">
      <video
        class="welcomeVideo"
        id="welcomeVideo"
        autoplay
        muted
        playsinline
        preload="auto"
      >
        <source src="${Kf}" type="video/mp4" />
      </video>

      <div class="welcomeOverlay">
        <div class="welcomeTitle" id="welcomeTitle">Ethos</div>
        <div class="welcomeSubtitle" id="welcomeSubtitle">a way of being</div>

        <button class="welcomeLogin" id="welcomeLogin" type="button">
          Login
        </button>
      </div>
    </div>
  `;const e=document.getElementById("welcomeVideo"),t=document.getElementById("welcomeTitle"),r=document.getElementById("welcomeSubtitle"),s=document.getElementById("welcomeLogin");t.classList.remove("is-in"),r.classList.remove("is-in"),s.classList.remove("is-in"),Gf(e),e.play?.().catch(()=>{});const i=setTimeout(()=>t.classList.add("is-in"),jf),a=setTimeout(()=>r.classList.add("is-in"),zf),l=setTimeout(()=>s.classList.add("is-in"),Hf);s.onclick=()=>J("#/auth"),window.__ethosWelcomeTimers&&window.__ethosWelcomeTimers.forEach(clearTimeout),window.__ethosWelcomeTimers=[i,a,l]}const Qf=()=>{};var Lc={};const Tu=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Xf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},wu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,h=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let y=(l&15)<<2|h>>6,g=h&63;u||(g=64,a||(y=64)),r.push(t[f],t[m],t[y],t[g])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Tu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Xf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||h==null||m==null)throw new Yf;const y=i<<2|l>>4;if(r.push(y),h!==64){const g=l<<4&240|h>>2;if(r.push(g),m!==64){const S=h<<6&192|m;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Yf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Jf=function(n){const e=Tu(n);return wu.encodeByteArray(e,!0)},Ms=function(n){return Jf(n).replace(/\./g,"")},Iu=function(n){try{return wu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Zf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ep=()=>Zf().__FIREBASE_DEFAULTS__,tp=()=>{if(typeof process>"u"||typeof Lc>"u")return;const n=Lc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},np=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Iu(n[1]);return e&&JSON.parse(e)},ti=()=>{try{return Qf()||ep()||tp()||np()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Au=n=>ti()?.emulatorHosts?.[n],rp=n=>{const e=Au(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},bu=()=>ti()?.config,Su=n=>ti()?.[`_${n}`];class sp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Mn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ru(n){return(await fetch(n,{credentials:"include"})).ok}function ip(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ms(JSON.stringify(t)),Ms(JSON.stringify(a)),""].join(".")}const pr={};function op(){const n={prod:[],emulator:[]};for(const e of Object.keys(pr))pr[e]?n.emulator.push(e):n.prod.push(e);return n}function ap(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xc=!1;function Cu(n,e){if(typeof window>"u"||typeof document>"u"||!Mn(window.location.host)||pr[n]===e||pr[n]||xc)return;pr[n]=e;function t(y){return`__firebase__banner__${y}`}const r="__firebase__banner",i=op().prod.length>0;function a(){const y=document.getElementById(r);y&&y.remove()}function l(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,g){y.setAttribute("width","24"),y.setAttribute("id",g),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{xc=!0,a()},y}function f(y,g){y.setAttribute("id",g),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){const y=ap(r),g=t("text"),S=document.getElementById(g)||document.createElement("span"),C=t("learnmore"),P=document.getElementById(C)||document.createElement("a"),M=t("preprendIcon"),N=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const V=y.element;l(V),f(P,C);const U=h();u(N,M),V.append(N,S,P,U),document.body.appendChild(V)}i?(S.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Pe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function cp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Pe())}function lp(){const n=ti()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function up(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function hp(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function dp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fp(){const n=Pe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function pp(){return!lp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function mp(){try{return typeof indexedDB=="object"}catch{return!1}}function gp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const yp="FirebaseError";class mt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=yp,Object.setPrototypeOf(this,mt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ur.prototype.create)}}class Ur{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?_p(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new mt(s,l,r)}}function _p(n,e){return n.replace(vp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const vp=/\{\$([^}]+)}/g;function Ep(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Uc(i)&&Uc(a)){if(!nn(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Uc(n){return n!==null&&typeof n=="object"}function Fr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function cr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function lr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Tp(n,e){const t=new wp(n,e);return t.subscribe.bind(t)}class wp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ip(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Xi),s.error===void 0&&(s.error=Xi),s.complete===void 0&&(s.complete=Xi);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ip(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Xi(){}function de(n){return n&&n._delegate?n._delegate:n}class rn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Jt="[DEFAULT]";class Ap{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new sp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Sp(e))try{this.getOrInitializeService({instanceIdentifier:Jt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Jt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jt){return this.instances.has(e)}getOptions(e=Jt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:bp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jt){return this.component?this.component.multipleInstances?e:Jt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function bp(n){return n===Jt?void 0:n}function Sp(n){return n.instantiationMode==="EAGER"}class Rp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ap(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var K;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(K||(K={}));const Cp={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},Pp=K.INFO,kp={[K.DEBUG]:"log",[K.VERBOSE]:"log",[K.INFO]:"info",[K.WARN]:"warn",[K.ERROR]:"error"},Np=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=kp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Uo{constructor(e){this.name=e,this._logLevel=Pp,this._logHandler=Np,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in K))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Cp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,K.DEBUG,...e),this._logHandler(this,K.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,K.VERBOSE,...e),this._logHandler(this,K.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,K.INFO,...e),this._logHandler(this,K.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,K.WARN,...e),this._logHandler(this,K.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,K.ERROR,...e),this._logHandler(this,K.ERROR,...e)}}const Dp=(n,e)=>e.some(t=>n instanceof t);let Fc,Bc;function Vp(){return Fc||(Fc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Op(){return Bc||(Bc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pu=new WeakMap,fo=new WeakMap,ku=new WeakMap,Yi=new WeakMap,Fo=new WeakMap;function Mp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Vt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Pu.set(t,n)}).catch(()=>{}),Fo.set(e,n),e}function Lp(n){if(fo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});fo.set(n,e)}let po={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return fo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ku.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Vt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function xp(n){po=n(po)}function Up(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ji(this),e,...t);return ku.set(r,e.sort?e.sort():[e]),Vt(r)}:Op().includes(n)?function(...e){return n.apply(Ji(this),e),Vt(Pu.get(this))}:function(...e){return Vt(n.apply(Ji(this),e))}}function Fp(n){return typeof n=="function"?Up(n):(n instanceof IDBTransaction&&Lp(n),Dp(n,Vp())?new Proxy(n,po):n)}function Vt(n){if(n instanceof IDBRequest)return Mp(n);if(Yi.has(n))return Yi.get(n);const e=Fp(n);return e!==n&&(Yi.set(n,e),Fo.set(e,n)),e}const Ji=n=>Fo.get(n);function Bp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=Vt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Vt(a.result),u.oldVersion,u.newVersion,Vt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const $p=["get","getKey","getAll","getAllKeys","count"],qp=["put","add","delete","clear"],Zi=new Map;function $c(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Zi.get(e))return Zi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=qp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||$p.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),s&&u.done]))[0]};return Zi.set(e,i),i}xp(n=>({...n,get:(e,t,r)=>$c(e,t)||n.get(e,t,r),has:(e,t)=>!!$c(e,t)||n.has(e,t)}));class jp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(zp(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function zp(n){return n.getComponent()?.type==="VERSION"}const mo="@firebase/app",qc="0.14.6";const ht=new Uo("@firebase/app"),Hp="@firebase/app-compat",Wp="@firebase/analytics-compat",Kp="@firebase/analytics",Gp="@firebase/app-check-compat",Qp="@firebase/app-check",Xp="@firebase/auth",Yp="@firebase/auth-compat",Jp="@firebase/database",Zp="@firebase/data-connect",em="@firebase/database-compat",tm="@firebase/functions",nm="@firebase/functions-compat",rm="@firebase/installations",sm="@firebase/installations-compat",im="@firebase/messaging",om="@firebase/messaging-compat",am="@firebase/performance",cm="@firebase/performance-compat",lm="@firebase/remote-config",um="@firebase/remote-config-compat",hm="@firebase/storage",dm="@firebase/storage-compat",fm="@firebase/firestore",pm="@firebase/ai",mm="@firebase/firestore-compat",gm="firebase",ym="12.6.0";const go="[DEFAULT]",_m={[mo]:"fire-core",[Hp]:"fire-core-compat",[Kp]:"fire-analytics",[Wp]:"fire-analytics-compat",[Qp]:"fire-app-check",[Gp]:"fire-app-check-compat",[Xp]:"fire-auth",[Yp]:"fire-auth-compat",[Jp]:"fire-rtdb",[Zp]:"fire-data-connect",[em]:"fire-rtdb-compat",[tm]:"fire-fn",[nm]:"fire-fn-compat",[rm]:"fire-iid",[sm]:"fire-iid-compat",[im]:"fire-fcm",[om]:"fire-fcm-compat",[am]:"fire-perf",[cm]:"fire-perf-compat",[lm]:"fire-rc",[um]:"fire-rc-compat",[hm]:"fire-gcs",[dm]:"fire-gcs-compat",[fm]:"fire-fst",[mm]:"fire-fst-compat",[pm]:"fire-vertex","fire-js":"fire-js",[gm]:"fire-js-all"};const Ls=new Map,vm=new Map,yo=new Map;function jc(n,e){try{n.container.addComponent(e)}catch(t){ht.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Cn(n){const e=n.name;if(yo.has(e))return ht.debug(`There were multiple attempts to register component ${e}.`),!1;yo.set(e,n);for(const t of Ls.values())jc(t,n);for(const t of vm.values())jc(t,n);return!0}function Bo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Fe(n){return n==null?!1:n.settings!==void 0}const Em={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ot=new Ur("app","Firebase",Em);class Tm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new rn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ot.create("app-deleted",{appName:this._name})}}const Ln=ym;function Nu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:go,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ot.create("bad-app-name",{appName:String(s)});if(t||(t=bu()),!t)throw Ot.create("no-options");const i=Ls.get(s);if(i){if(nn(t,i.options)&&nn(r,i.config))return i;throw Ot.create("duplicate-app",{appName:s})}const a=new Rp(s);for(const u of yo.values())a.addComponent(u);const l=new Tm(t,r,a);return Ls.set(s,l),l}function Du(n=go){const e=Ls.get(n);if(!e&&n===go&&bu())return Nu();if(!e)throw Ot.create("no-app",{appName:n});return e}function Mt(n,e,t){let r=_m[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ht.warn(a.join(" "));return}Cn(new rn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const wm="firebase-heartbeat-database",Im=1,Ar="firebase-heartbeat-store";let eo=null;function Vu(){return eo||(eo=Bp(wm,Im,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ar)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ot.create("idb-open",{originalErrorMessage:n.message})})),eo}async function Am(n){try{const t=(await Vu()).transaction(Ar),r=await t.objectStore(Ar).get(Ou(n));return await t.done,r}catch(e){if(e instanceof mt)ht.warn(e.message);else{const t=Ot.create("idb-get",{originalErrorMessage:e?.message});ht.warn(t.message)}}}async function zc(n,e){try{const r=(await Vu()).transaction(Ar,"readwrite");await r.objectStore(Ar).put(e,Ou(n)),await r.done}catch(t){if(t instanceof mt)ht.warn(t.message);else{const r=Ot.create("idb-set",{originalErrorMessage:t?.message});ht.warn(r.message)}}}function Ou(n){return`${n.name}!${n.options.appId}`}const bm=1024,Sm=30;class Rm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Hc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Sm){const s=km(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ht.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Hc(),{heartbeatsToSend:t,unsentEntries:r}=Cm(this._heartbeatsCache.heartbeats),s=Ms(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ht.warn(e),""}}}function Hc(){return new Date().toISOString().substring(0,10)}function Cm(n,e=bm){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Wc(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Wc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Pm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return mp()?gp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Am(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return zc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return zc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Wc(n){return Ms(JSON.stringify({version:2,heartbeats:n})).length}function km(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Nm(n){Cn(new rn("platform-logger",e=>new jp(e),"PRIVATE")),Cn(new rn("heartbeat",e=>new Rm(e),"PRIVATE")),Mt(mo,qc,n),Mt(mo,qc,"esm2020"),Mt("fire-js","")}Nm("");function Mu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Dm=Mu,Lu=new Ur("auth","Firebase",Mu());const xs=new Uo("@firebase/auth");function Vm(n,...e){xs.logLevel<=K.WARN&&xs.warn(`Auth (${Ln}): ${n}`,...e)}function Is(n,...e){xs.logLevel<=K.ERROR&&xs.error(`Auth (${Ln}): ${n}`,...e)}function qe(n,...e){throw qo(n,...e)}function He(n,...e){return qo(n,...e)}function $o(n,e,t){const r={...Dm(),[e]:t};return new Ur("auth","Firebase",r).create(e,{appName:n.name})}function lt(n){return $o(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Om(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&qe(n,"argument-error"),$o(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function qo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Lu.create(n,...e)}function $(n,e,...t){if(!n)throw qo(e,...t)}function at(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Is(e),new Error(e)}function dt(n,e){n||at(e)}function _o(){return typeof self<"u"&&self.location?.href||""}function Mm(){return Kc()==="http:"||Kc()==="https:"}function Kc(){return typeof self<"u"&&self.location?.protocol||null}function Lm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mm()||hp()||"connection"in navigator)?navigator.onLine:!0}function xm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Br{constructor(e,t){this.shortDelay=e,this.longDelay=t,dt(t>e,"Short delay should be less than long delay!"),this.isMobile=cp()||dp()}get(){return Lm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function jo(n,e){dt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class xu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;at("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;at("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;at("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Um={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Fm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Bm=new Br(3e4,6e4);function gt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function yt(n,e,t,r,s={}){return Uu(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Fr({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:u,...i};return up()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Mn(n.emulatorConfig.host)&&(h.credentials="include"),xu.fetch()(await Fu(n,n.config.apiHost,t,l),h)})}async function Uu(n,e,t){n._canInitEmulator=!1;const r={...Um,...e};try{const s=new qm(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw ms(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,h]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ms(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw ms(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw ms(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw $o(n,f,h);qe(n,f)}}catch(s){if(s instanceof mt)throw s;qe(n,"network-request-failed",{message:String(s)})}}async function $r(n,e,t,r,s={}){const i=await yt(n,e,t,r,s);return"mfaPendingCredential"in i&&qe(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Fu(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?jo(n.config,s):`${n.config.apiScheme}://${s}`;return Fm.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function $m(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(He(this.auth,"network-request-failed")),Bm.get())})}}function ms(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=He(n,e,r);return s.customData._tokenResponse=t,s}function Gc(n){return n!==void 0&&n.enterprise!==void 0}class jm{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return $m(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function zm(n,e){return yt(n,"GET","/v2/recaptchaConfig",gt(n,e))}async function Hm(n,e){return yt(n,"POST","/v1/accounts:delete",e)}async function Us(n,e){return yt(n,"POST","/v1/accounts:lookup",e)}function mr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wm(n,e=!1){const t=de(n),r=await t.getIdToken(e),s=zo(r);$(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:mr(to(s.auth_time)),issuedAtTime:mr(to(s.iat)),expirationTime:mr(to(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function to(n){return Number(n)*1e3}function zo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Is("JWT malformed, contained fewer than 3 sections"),null;try{const s=Iu(t);return s?JSON.parse(s):(Is("Failed to decode base64 JWT payload"),null)}catch(s){return Is("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Qc(n){const e=zo(n);return $(e,"internal-error"),$(typeof e.exp<"u","internal-error"),$(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function br(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof mt&&Km(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Km({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Gm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class vo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=mr(this.lastLoginAt),this.creationTime=mr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Fs(n){const e=n.auth,t=await n.getIdToken(),r=await br(n,Us(e,{idToken:t}));$(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Bu(s.providerUserInfo):[],a=Xm(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,h=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new vo(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function Qm(n){const e=de(n);await Fs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Xm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Bu(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Ym(n,e){const t=await Uu(n,{},async()=>{const r=Fr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Fu(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&Mn(n.emulatorConfig.host)&&(u.credentials="include"),xu.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Jm(n,e){return yt(n,"POST","/v2/accounts:revokeToken",gt(n,e))}class In{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$(e.idToken,"internal-error"),$(typeof e.idToken<"u","internal-error"),$(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Qc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$(e.length!==0,"internal-error");const t=Qc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Ym(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new In;return r&&($(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&($(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&($(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new In,this.toJSON())}_performRefresh(){return at("not implemented")}}function St(n,e){$(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ze{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Gm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new vo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await br(this,this.stsTokenManager.getToken(this.auth,e));return $(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Wm(this,e)}reload(){return Qm(this)}_assign(e){this!==e&&($(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ze({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Fs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fe(this.auth.app))return Promise.reject(lt(this.auth));const e=await this.getIdToken();return await br(this,Hm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:y,isAnonymous:g,providerData:S,stsTokenManager:C}=t;$(m&&C,e,"internal-error");const P=In.fromJSON(this.name,C);$(typeof m=="string",e,"internal-error"),St(r,e.name),St(s,e.name),$(typeof y=="boolean",e,"internal-error"),$(typeof g=="boolean",e,"internal-error"),St(i,e.name),St(a,e.name),St(l,e.name),St(u,e.name),St(h,e.name),St(f,e.name);const M=new ze({uid:m,auth:e,email:s,emailVerified:y,displayName:r,isAnonymous:g,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:P,createdAt:h,lastLoginAt:f});return S&&Array.isArray(S)&&(M.providerData=S.map(N=>({...N}))),u&&(M._redirectEventId=u),M}static async _fromIdTokenResponse(e,t,r=!1){const s=new In;s.updateFromServerResponse(t);const i=new ze({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Fs(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];$(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Bu(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new In;l.updateFromIdToken(r);const u=new ze({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new vo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,h),u}}const Xc=new Map;function ct(n){dt(n instanceof Function,"Expected a class definition");let e=Xc.get(n);return e?(dt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Xc.set(n,e),e)}class $u{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$u.type="NONE";const Yc=$u;function As(n,e,t){return`firebase:${n}:${e}:${t}`}class An{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=As(this.userKey,s.apiKey,i),this.fullPersistenceKey=As("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Us(this.auth,{idToken:e}).catch(()=>{});return t?ze._fromGetAccountInfoResponse(this.auth,t,e):null}return ze._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new An(ct(Yc),e,r);const s=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=s[0]||ct(Yc);const a=As(r,e.config.apiKey,e.name);let l=null;for(const h of t)try{const f=await h._get(a);if(f){let m;if(typeof f=="string"){const y=await Us(e,{idToken:f}).catch(()=>{});if(!y)break;m=await ze._fromGetAccountInfoResponse(e,y,f)}else m=ze._fromJSON(e,f);h!==i&&(l=m),i=h;break}}catch{}const u=s.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new An(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new An(i,e,r))}}function Jc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Hu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(qu(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ku(e))return"Blackberry";if(Gu(e))return"Webos";if(ju(e))return"Safari";if((e.includes("chrome/")||zu(e))&&!e.includes("edge/"))return"Chrome";if(Wu(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function qu(n=Pe()){return/firefox\//i.test(n)}function ju(n=Pe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zu(n=Pe()){return/crios\//i.test(n)}function Hu(n=Pe()){return/iemobile/i.test(n)}function Wu(n=Pe()){return/android/i.test(n)}function Ku(n=Pe()){return/blackberry/i.test(n)}function Gu(n=Pe()){return/webos/i.test(n)}function Ho(n=Pe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Zm(n=Pe()){return Ho(n)&&!!window.navigator?.standalone}function eg(){return fp()&&document.documentMode===10}function Qu(n=Pe()){return Ho(n)||Wu(n)||Gu(n)||Ku(n)||/windows phone/i.test(n)||Hu(n)}function Xu(n,e=[]){let t;switch(n){case"Browser":t=Jc(Pe());break;case"Worker":t=`${Jc(Pe())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ln}/${r}`}class tg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function ng(n,e={}){return yt(n,"GET","/v2/passwordPolicy",gt(n,e))}const rg=6;class sg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rg,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class ig{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Zc(this),this.idTokenSubscription=new Zc(this),this.beforeStateQueue=new tg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Lu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ct(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await An.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Us(this,{idToken:e}),r=await ze._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Fe(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Fs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fe(this.app))return Promise.reject(lt(this));const t=e?de(e):null;return t&&$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fe(this.app)?Promise.reject(lt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fe(this.app)?Promise.reject(lt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ct(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ng(this),t=new sg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ur("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ct(e)||this._popupRedirectResolver;$(t,this,"argument-error"),this.redirectPersistenceManager=await An.create(this,[ct(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if($(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Xu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Fe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Vm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function _t(n){return de(n)}class Zc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Tp(t=>this.observer=t)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ni={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function og(n){ni=n}function Yu(n){return ni.loadJS(n)}function ag(){return ni.recaptchaEnterpriseScript}function cg(){return ni.gapiScript}function lg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ug{constructor(){this.enterprise=new hg}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class hg{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const dg="recaptcha-enterprise",Ju="NO_RECAPTCHA";class fg{constructor(e){this.type=dg,this.auth=_t(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{zm(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new jm(u);return i.tenantId==null?i._agentRecaptchaConfig=h:i._tenantRecaptchaConfigs[i.tenantId]=h,a(h.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;Gc(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(h=>{a(h)}).catch(()=>{a(Ju)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ug().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Gc(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=ag();u.length!==0&&(u+=l),Yu(u).then(()=>{s(l,i,a)}).catch(h=>{a(h)})}}).catch(l=>{a(l)})})}}async function el(n,e,t,r=!1,s=!1){const i=new fg(n);let a;if(s)a=Ju;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Bs(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await el(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await el(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}function pg(n,e){const t=Bo(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(nn(i,e??{}))return s;qe(s,"already-initialized")}return t.initialize({options:e})}function mg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ct);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function gg(n,e,t){const r=_t(n);$(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Zu(e),{host:a,port:l}=yg(e),u=l===null?"":`:${l}`,h={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){$(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),$(nn(h,r.config.emulator)&&nn(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Mn(a)?(Ru(`${i}//${a}${u}`),Cu("Auth",!0)):_g()}function Zu(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yg(n){const e=Zu(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:tl(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:tl(a)}}}function tl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function _g(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Wo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return at("not implemented")}_getIdTokenResponse(e){return at("not implemented")}_linkToIdToken(e,t){return at("not implemented")}_getReauthenticationResolver(e){return at("not implemented")}}async function vg(n,e){return yt(n,"POST","/v1/accounts:signUp",e)}async function Eg(n,e){return $r(n,"POST","/v1/accounts:signInWithPassword",gt(n,e))}async function Tg(n,e){return yt(n,"POST","/v1/accounts:sendOobCode",gt(n,e))}async function wg(n,e){return Tg(n,e)}async function Ig(n,e){return $r(n,"POST","/v1/accounts:signInWithEmailLink",gt(n,e))}async function Ag(n,e){return $r(n,"POST","/v1/accounts:signInWithEmailLink",gt(n,e))}class Sr extends Wo{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Sr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Sr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bs(e,t,"signInWithPassword",Eg);case"emailLink":return Ig(e,{email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bs(e,r,"signUpPassword",vg);case"emailLink":return Ag(e,{idToken:t,email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function bn(n,e){return $r(n,"POST","/v1/accounts:signInWithIdp",gt(n,e))}const bg="http://localhost";class sn extends Wo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new sn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return bn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,bn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bn(e,t)}buildRequest(){const e={requestUri:bg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fr(t)}return e}}function Sg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Rg(n){const e=cr(lr(n)).link,t=e?cr(lr(e)).deep_link_id:null,r=cr(lr(n)).deep_link_id;return(r?cr(lr(r)).link:null)||r||t||e||n}class Ko{constructor(e){const t=cr(lr(e)),r=t.apiKey??null,s=t.oobCode??null,i=Sg(t.mode??null);$(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Rg(e);try{return new Ko(t)}catch{return null}}}class xn{constructor(){this.providerId=xn.PROVIDER_ID}static credential(e,t){return Sr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ko.parseLink(t);return $(r,"argument-error"),Sr._fromEmailAndCode(e,r.code,r.tenantId)}}xn.PROVIDER_ID="password";xn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Go{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qr extends Go{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Pt extends qr{constructor(){super("facebook.com")}static credential(e){return sn._fromParams({providerId:Pt.PROVIDER_ID,signInMethod:Pt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pt.credentialFromTaggedObject(e)}static credentialFromError(e){return Pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pt.credential(e.oauthAccessToken)}catch{return null}}}Pt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Pt.PROVIDER_ID="facebook.com";class ot extends qr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sn._fromParams({providerId:ot.PROVIDER_ID,signInMethod:ot.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ot.credentialFromTaggedObject(e)}static credentialFromError(e){return ot.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ot.credential(t,r)}catch{return null}}}ot.GOOGLE_SIGN_IN_METHOD="google.com";ot.PROVIDER_ID="google.com";class kt extends qr{constructor(){super("github.com")}static credential(e){return sn._fromParams({providerId:kt.PROVIDER_ID,signInMethod:kt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return kt.credentialFromTaggedObject(e)}static credentialFromError(e){return kt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return kt.credential(e.oauthAccessToken)}catch{return null}}}kt.GITHUB_SIGN_IN_METHOD="github.com";kt.PROVIDER_ID="github.com";class Nt extends qr{constructor(){super("twitter.com")}static credential(e,t){return sn._fromParams({providerId:Nt.PROVIDER_ID,signInMethod:Nt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Nt.credentialFromTaggedObject(e)}static credentialFromError(e){return Nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Nt.credential(t,r)}catch{return null}}}Nt.TWITTER_SIGN_IN_METHOD="twitter.com";Nt.PROVIDER_ID="twitter.com";async function Cg(n,e){return $r(n,"POST","/v1/accounts:signUp",gt(n,e))}class on{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ze._fromIdTokenResponse(e,r,s),a=nl(r);return new on({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=nl(r);return new on({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function nl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class $s extends mt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,$s.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new $s(e,t,r,s)}}function eh(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?$s._fromErrorAndOperation(n,i,e,r):i})}async function Pg(n,e,t=!1){const r=await br(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return on._forOperation(n,"link",r)}async function kg(n,e,t=!1){const{auth:r}=n;if(Fe(r.app))return Promise.reject(lt(r));const s="reauthenticate";try{const i=await br(n,eh(r,s,e,n),t);$(i.idToken,r,"internal-error");const a=zo(i.idToken);$(a,r,"internal-error");const{sub:l}=a;return $(n.uid===l,r,"user-mismatch"),on._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&qe(r,"user-mismatch"),i}}async function th(n,e,t=!1){if(Fe(n.app))return Promise.reject(lt(n));const r="signIn",s=await eh(n,r,e),i=await on._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Ng(n,e){return th(_t(n),e)}async function nh(n){const e=_t(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Dg(n,e,t){const r=_t(n);await Bs(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",wg)}async function Vg(n,e,t){if(Fe(n.app))return Promise.reject(lt(n));const r=_t(n),a=await Bs(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Cg).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&nh(n),u}),l=await on._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Og(n,e,t){return Fe(n.app)?Promise.reject(lt(n)):Ng(de(n),xn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&nh(n),r})}function Qo(n,e){return de(n).setPersistence(e)}function Mg(n,e,t,r){return de(n).onIdTokenChanged(e,t,r)}function Lg(n,e,t){return de(n).beforeAuthStateChanged(e,t)}function xg(n,e,t,r){return de(n).onAuthStateChanged(e,t,r)}function Ug(n){return de(n).signOut()}const qs="__sak";class rh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(qs,"1"),this.storage.removeItem(qs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Fg=1e3,Bg=10;class sh extends rh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Qu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);eg()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Bg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Fg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}sh.type="LOCAL";const ri=sh;class ih extends rh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ih.type="SESSION";const jr=ih;function $g(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class si{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new si(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async h=>h(t.origin,i)),u=await $g(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}si.receivers=[];function Xo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class qg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const h=Xo("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const y=m;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(y.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Je(){return window}function jg(n){Je().location.href=n}function oh(){return typeof Je().WorkerGlobalScope<"u"&&typeof Je().importScripts=="function"}async function zg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Hg(){return navigator?.serviceWorker?.controller||null}function Wg(){return oh()?self:null}const ah="firebaseLocalStorageDb",Kg=1,js="firebaseLocalStorage",ch="fbase_key";class zr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ii(n,e){return n.transaction([js],e?"readwrite":"readonly").objectStore(js)}function Gg(){const n=indexedDB.deleteDatabase(ah);return new zr(n).toPromise()}function Eo(){const n=indexedDB.open(ah,Kg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(js,{keyPath:ch})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(js)?e(r):(r.close(),await Gg(),e(await Eo()))})})}async function rl(n,e,t){const r=ii(n,!0).put({[ch]:e,value:t});return new zr(r).toPromise()}async function Qg(n,e){const t=ii(n,!1).get(e),r=await new zr(t).toPromise();return r===void 0?null:r.value}function sl(n,e){const t=ii(n,!0).delete(e);return new zr(t).toPromise()}const Xg=800,Yg=3;class lh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Eo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Yg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=si._getInstance(Wg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await zg(),!this.activeServiceWorker)return;this.sender=new qg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Hg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Eo();return await rl(e,qs,"1"),await sl(e,qs),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>rl(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Qg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>sl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=ii(s,!1).getAll();return new zr(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Xg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lh.type="LOCAL";const Jg=lh;new Br(3e4,6e4);function uh(n,e){return e?ct(e):($(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Yo extends Wo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Zg(n){return th(n.auth,new Yo(n),n.bypassAuthState)}function ey(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),kg(t,new Yo(n),n.bypassAuthState)}async function ty(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),Pg(t,new Yo(n),n.bypassAuthState)}class hh{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Zg;case"linkViaPopup":case"linkViaRedirect":return ty;case"reauthViaPopup":case"reauthViaRedirect":return ey;default:qe(this.auth,"internal-error")}}resolve(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ny=new Br(2e3,1e4);async function ry(n,e,t){if(Fe(n.app))return Promise.reject(He(n,"operation-not-supported-in-this-environment"));const r=_t(n);Om(n,e,Go);const s=uh(r,t);return new Zt(r,"signInViaPopup",e,s).executeNotNull()}class Zt extends hh{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Zt.currentPopupAction&&Zt.currentPopupAction.cancel(),Zt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $(e,this.auth,"internal-error"),e}async onExecution(){dt(this.filter.length===1,"Popup operations only handle one event");const e=Xo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ny.get())};e()}}Zt.currentPopupAction=null;const sy="pendingRedirect",bs=new Map;class iy extends hh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=bs.get(this.auth._key());if(!e){try{const r=await oy(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}bs.set(this.auth._key(),e)}return this.bypassAuthState||bs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function oy(n,e){const t=ly(e),r=cy(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function ay(n,e){bs.set(n._key(),e)}function cy(n){return ct(n._redirectPersistence)}function ly(n){return As(sy,n.config.apiKey,n.name)}async function uy(n,e,t=!1){if(Fe(n.app))return Promise.reject(lt(n));const r=_t(n),s=uh(r,e),a=await new iy(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const hy=600*1e3;class dy{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!fy(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!dh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(He(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hy&&this.cachedEventUids.clear(),this.cachedEventUids.has(il(e))}saveEventToCache(e){this.cachedEventUids.add(il(e)),this.lastProcessedEventTime=Date.now()}}function il(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function dh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function fy(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dh(n);default:return!1}}async function py(n,e={}){return yt(n,"GET","/v1/projects",e)}const my=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gy=/^https?/;async function yy(n){if(n.config.emulator)return;const{authorizedDomains:e}=await py(n);for(const t of e)try{if(_y(t))return}catch{}qe(n,"unauthorized-domain")}function _y(n){const e=_o(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!gy.test(t))return!1;if(my.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const vy=new Br(3e4,6e4);function ol(){const n=Je().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Ey(n){return new Promise((e,t)=>{function r(){ol(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ol(),t(He(n,"network-request-failed"))},timeout:vy.get()})}if(Je().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Je().gapi?.load)r();else{const s=lg("iframefcb");return Je()[s]=()=>{gapi.load?r():t(He(n,"network-request-failed"))},Yu(`${cg()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Ss=null,e})}let Ss=null;function Ty(n){return Ss=Ss||Ey(n),Ss}const wy=new Br(5e3,15e3),Iy="__/auth/iframe",Ay="emulator/auth/iframe",by={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Sy=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ry(n){const e=n.config;$(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?jo(e,Ay):`https://${n.config.authDomain}/${Iy}`,r={apiKey:e.apiKey,appName:n.name,v:Ln},s=Sy.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Fr(r).slice(1)}`}async function Cy(n){const e=await Ty(n),t=Je().gapi;return $(t,n,"internal-error"),e.open({where:document.body,url:Ry(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:by,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=He(n,"network-request-failed"),l=Je().setTimeout(()=>{i(a)},wy.get());function u(){Je().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const Py={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ky=500,Ny=600,Dy="_blank",Vy="http://localhost";class al{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Oy(n,e,t,r=ky,s=Ny){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...Py,width:r.toString(),height:s.toString(),top:i,left:a},h=Pe().toLowerCase();t&&(l=zu(h)?Dy:t),qu(h)&&(e=e||Vy,u.scrollbars="yes");const f=Object.entries(u).reduce((y,[g,S])=>`${y}${g}=${S},`,"");if(Zm(h)&&l!=="_self")return My(e||"",l),new al(null);const m=window.open(e||"",l,f);$(m,n,"popup-blocked");try{m.focus()}catch{}return new al(m)}function My(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const Ly="__/auth/handler",xy="emulator/auth/handler",Uy=encodeURIComponent("fac");async function cl(n,e,t,r,s,i){$(n.config.authDomain,n,"auth-domain-config-required"),$(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ln,eventId:s};if(e instanceof Go){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Ep(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof qr){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),h=u?`#${Uy}=${encodeURIComponent(u)}`:"";return`${Fy(n)}?${Fr(l).slice(1)}${h}`}function Fy({config:n}){return n.emulator?jo(n,xy):`https://${n.authDomain}/${Ly}`}const no="webStorageSupport";class By{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jr,this._completeRedirectFn=uy,this._overrideRedirectResult=ay}async _openPopup(e,t,r,s){dt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await cl(e,t,r,_o(),s);return Oy(e,i,Xo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await cl(e,t,r,_o(),s);return jg(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(dt(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Cy(e),r=new dy(e);return t.register("authEvent",s=>($(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(no,{type:no},s=>{const i=s?.[0]?.[no];i!==void 0&&t(!!i),qe(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yy(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Qu()||ju()||Ho()}}const $y=By;var ll="@firebase/auth",ul="1.12.0";class qy{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function jy(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zy(n){Cn(new rn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;$(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xu(n)},h=new ig(r,s,i,u);return mg(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Cn(new rn("auth-internal",e=>{const t=_t(e.getProvider("auth").getImmediate());return(r=>new qy(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Mt(ll,ul,jy(n)),Mt(ll,ul,"esm2020")}const Hy=300,Wy=Su("authIdTokenMaxAge")||Hy;let hl=null;const Ky=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Wy)return;const s=t?.token;hl!==s&&(hl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Gy(n=Du()){const e=Bo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=pg(n,{popupRedirectResolver:$y,persistence:[Jg,ri,jr]}),r=Su("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Ky(i.toString());Lg(t,a,()=>a(t.currentUser)),Mg(t,l=>a(l))}}const s=Au("auth");return s&&gg(t,`http://${s}`),t}function Qy(){return document.getElementsByTagName("head")?.[0]??document}og({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=He("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Qy().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});zy("Browser");var Xy="firebase",Yy="12.7.0";Mt(Xy,Yy,"app");var dl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Lt,fh;(function(){var n;function e(T,_){function E(){}E.prototype=_.prototype,T.F=_.prototype,T.prototype=new E,T.prototype.constructor=T,T.D=function(I,w,b){for(var v=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)v[Ae-2]=arguments[Ae];return _.prototype[w].apply(I,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,_,E){E||(E=0);const I=Array(16);if(typeof _=="string")for(var w=0;w<16;++w)I[w]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(w=0;w<16;++w)I[w]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=T.g[0],E=T.g[1],w=T.g[2];let b=T.g[3],v;v=_+(b^E&(w^b))+I[0]+3614090360&4294967295,_=E+(v<<7&4294967295|v>>>25),v=b+(w^_&(E^w))+I[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=w+(E^b&(_^E))+I[2]+606105819&4294967295,w=b+(v<<17&4294967295|v>>>15),v=E+(_^w&(b^_))+I[3]+3250441966&4294967295,E=w+(v<<22&4294967295|v>>>10),v=_+(b^E&(w^b))+I[4]+4118548399&4294967295,_=E+(v<<7&4294967295|v>>>25),v=b+(w^_&(E^w))+I[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=w+(E^b&(_^E))+I[6]+2821735955&4294967295,w=b+(v<<17&4294967295|v>>>15),v=E+(_^w&(b^_))+I[7]+4249261313&4294967295,E=w+(v<<22&4294967295|v>>>10),v=_+(b^E&(w^b))+I[8]+1770035416&4294967295,_=E+(v<<7&4294967295|v>>>25),v=b+(w^_&(E^w))+I[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=w+(E^b&(_^E))+I[10]+4294925233&4294967295,w=b+(v<<17&4294967295|v>>>15),v=E+(_^w&(b^_))+I[11]+2304563134&4294967295,E=w+(v<<22&4294967295|v>>>10),v=_+(b^E&(w^b))+I[12]+1804603682&4294967295,_=E+(v<<7&4294967295|v>>>25),v=b+(w^_&(E^w))+I[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=w+(E^b&(_^E))+I[14]+2792965006&4294967295,w=b+(v<<17&4294967295|v>>>15),v=E+(_^w&(b^_))+I[15]+1236535329&4294967295,E=w+(v<<22&4294967295|v>>>10),v=_+(w^b&(E^w))+I[1]+4129170786&4294967295,_=E+(v<<5&4294967295|v>>>27),v=b+(E^w&(_^E))+I[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=w+(_^E&(b^_))+I[11]+643717713&4294967295,w=b+(v<<14&4294967295|v>>>18),v=E+(b^_&(w^b))+I[0]+3921069994&4294967295,E=w+(v<<20&4294967295|v>>>12),v=_+(w^b&(E^w))+I[5]+3593408605&4294967295,_=E+(v<<5&4294967295|v>>>27),v=b+(E^w&(_^E))+I[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=w+(_^E&(b^_))+I[15]+3634488961&4294967295,w=b+(v<<14&4294967295|v>>>18),v=E+(b^_&(w^b))+I[4]+3889429448&4294967295,E=w+(v<<20&4294967295|v>>>12),v=_+(w^b&(E^w))+I[9]+568446438&4294967295,_=E+(v<<5&4294967295|v>>>27),v=b+(E^w&(_^E))+I[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=w+(_^E&(b^_))+I[3]+4107603335&4294967295,w=b+(v<<14&4294967295|v>>>18),v=E+(b^_&(w^b))+I[8]+1163531501&4294967295,E=w+(v<<20&4294967295|v>>>12),v=_+(w^b&(E^w))+I[13]+2850285829&4294967295,_=E+(v<<5&4294967295|v>>>27),v=b+(E^w&(_^E))+I[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=w+(_^E&(b^_))+I[7]+1735328473&4294967295,w=b+(v<<14&4294967295|v>>>18),v=E+(b^_&(w^b))+I[12]+2368359562&4294967295,E=w+(v<<20&4294967295|v>>>12),v=_+(E^w^b)+I[5]+4294588738&4294967295,_=E+(v<<4&4294967295|v>>>28),v=b+(_^E^w)+I[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=w+(b^_^E)+I[11]+1839030562&4294967295,w=b+(v<<16&4294967295|v>>>16),v=E+(w^b^_)+I[14]+4259657740&4294967295,E=w+(v<<23&4294967295|v>>>9),v=_+(E^w^b)+I[1]+2763975236&4294967295,_=E+(v<<4&4294967295|v>>>28),v=b+(_^E^w)+I[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=w+(b^_^E)+I[7]+4139469664&4294967295,w=b+(v<<16&4294967295|v>>>16),v=E+(w^b^_)+I[10]+3200236656&4294967295,E=w+(v<<23&4294967295|v>>>9),v=_+(E^w^b)+I[13]+681279174&4294967295,_=E+(v<<4&4294967295|v>>>28),v=b+(_^E^w)+I[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=w+(b^_^E)+I[3]+3572445317&4294967295,w=b+(v<<16&4294967295|v>>>16),v=E+(w^b^_)+I[6]+76029189&4294967295,E=w+(v<<23&4294967295|v>>>9),v=_+(E^w^b)+I[9]+3654602809&4294967295,_=E+(v<<4&4294967295|v>>>28),v=b+(_^E^w)+I[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=w+(b^_^E)+I[15]+530742520&4294967295,w=b+(v<<16&4294967295|v>>>16),v=E+(w^b^_)+I[2]+3299628645&4294967295,E=w+(v<<23&4294967295|v>>>9),v=_+(w^(E|~b))+I[0]+4096336452&4294967295,_=E+(v<<6&4294967295|v>>>26),v=b+(E^(_|~w))+I[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=w+(_^(b|~E))+I[14]+2878612391&4294967295,w=b+(v<<15&4294967295|v>>>17),v=E+(b^(w|~_))+I[5]+4237533241&4294967295,E=w+(v<<21&4294967295|v>>>11),v=_+(w^(E|~b))+I[12]+1700485571&4294967295,_=E+(v<<6&4294967295|v>>>26),v=b+(E^(_|~w))+I[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=w+(_^(b|~E))+I[10]+4293915773&4294967295,w=b+(v<<15&4294967295|v>>>17),v=E+(b^(w|~_))+I[1]+2240044497&4294967295,E=w+(v<<21&4294967295|v>>>11),v=_+(w^(E|~b))+I[8]+1873313359&4294967295,_=E+(v<<6&4294967295|v>>>26),v=b+(E^(_|~w))+I[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=w+(_^(b|~E))+I[6]+2734768916&4294967295,w=b+(v<<15&4294967295|v>>>17),v=E+(b^(w|~_))+I[13]+1309151649&4294967295,E=w+(v<<21&4294967295|v>>>11),v=_+(w^(E|~b))+I[4]+4149444226&4294967295,_=E+(v<<6&4294967295|v>>>26),v=b+(E^(_|~w))+I[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=w+(_^(b|~E))+I[2]+718787259&4294967295,w=b+(v<<15&4294967295|v>>>17),v=E+(b^(w|~_))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(w+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+w&4294967295,T.g[3]=T.g[3]+b&4294967295}r.prototype.v=function(T,_){_===void 0&&(_=T.length);const E=_-this.blockSize,I=this.C;let w=this.h,b=0;for(;b<_;){if(w==0)for(;b<=E;)s(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<_;)if(I[w++]=T.charCodeAt(b++),w==this.blockSize){s(this,I),w=0;break}}else for(;b<_;)if(I[w++]=T[b++],w==this.blockSize){s(this,I),w=0;break}}this.h=w,this.o+=_},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;_=this.o*8;for(var E=T.length-8;E<T.length;++E)T[E]=_&255,_/=256;for(this.v(T),T=Array(16),_=0,E=0;E<4;++E)for(let I=0;I<32;I+=8)T[_++]=this.g[E]>>>I&255;return T};function i(T,_){var E=l;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=_(T)}function a(T,_){this.h=_;const E=[];let I=!0;for(let w=T.length-1;w>=0;w--){const b=T[w]|0;I&&b==_||(E[w]=b,I=!1)}this.g=E}var l={};function u(T){return-128<=T&&T<128?i(T,function(_){return new a([_|0],_<0?-1:0)}):new a([T|0],T<0?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(T<0)return P(h(-T));const _=[];let E=1;for(let I=0;T>=E;I++)_[I]=T/E|0,E*=4294967296;return new a(_,0)}function f(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return P(f(T.substring(1),_));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=h(Math.pow(_,8));let I=m;for(let b=0;b<T.length;b+=8){var w=Math.min(8,T.length-b);const v=parseInt(T.substring(b,b+w),_);w<8?(w=h(Math.pow(_,w)),I=I.j(w).add(h(v))):(I=I.j(E),I=I.add(h(v)))}return I}var m=u(0),y=u(1),g=u(16777216);n=a.prototype,n.m=function(){if(C(this))return-P(this).m();let T=0,_=1;for(let E=0;E<this.g.length;E++){const I=this.i(E);T+=(I>=0?I:4294967296+I)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(S(this))return"0";if(C(this))return"-"+P(this).toString(T);const _=h(Math.pow(T,6));var E=this;let I="";for(;;){const w=U(E,_).g;E=M(E,w.j(_));let b=((E.g.length>0?E.g[0]:E.h)>>>0).toString(T);if(E=w,S(E))return b+I;for(;b.length<6;)b="0"+b;I=b+I}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function S(T){if(T.h!=0)return!1;for(let _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function C(T){return T.h==-1}n.l=function(T){return T=M(this,T),C(T)?-1:S(T)?0:1};function P(T){const _=T.g.length,E=[];for(let I=0;I<_;I++)E[I]=~T.g[I];return new a(E,~T.h).add(y)}n.abs=function(){return C(this)?P(this):this},n.add=function(T){const _=Math.max(this.g.length,T.g.length),E=[];let I=0;for(let w=0;w<=_;w++){let b=I+(this.i(w)&65535)+(T.i(w)&65535),v=(b>>>16)+(this.i(w)>>>16)+(T.i(w)>>>16);I=v>>>16,b&=65535,v&=65535,E[w]=v<<16|b}return new a(E,E[E.length-1]&-2147483648?-1:0)};function M(T,_){return T.add(P(_))}n.j=function(T){if(S(this)||S(T))return m;if(C(this))return C(T)?P(this).j(P(T)):P(P(this).j(T));if(C(T))return P(this.j(P(T)));if(this.l(g)<0&&T.l(g)<0)return h(this.m()*T.m());const _=this.g.length+T.g.length,E=[];for(var I=0;I<2*_;I++)E[I]=0;for(I=0;I<this.g.length;I++)for(let w=0;w<T.g.length;w++){const b=this.i(I)>>>16,v=this.i(I)&65535,Ae=T.i(w)>>>16,ae=T.i(w)&65535;E[2*I+2*w]+=v*ae,N(E,2*I+2*w),E[2*I+2*w+1]+=b*ae,N(E,2*I+2*w+1),E[2*I+2*w+1]+=v*Ae,N(E,2*I+2*w+1),E[2*I+2*w+2]+=b*Ae,N(E,2*I+2*w+2)}for(T=0;T<_;T++)E[T]=E[2*T+1]<<16|E[2*T];for(T=_;T<2*_;T++)E[T]=0;return new a(E,0)};function N(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function V(T,_){this.g=T,this.h=_}function U(T,_){if(S(_))throw Error("division by zero");if(S(T))return new V(m,m);if(C(T))return _=U(P(T),_),new V(P(_.g),P(_.h));if(C(_))return _=U(T,P(_)),new V(P(_.g),_.h);if(T.g.length>30){if(C(T)||C(_))throw Error("slowDivide_ only works with positive integers.");for(var E=y,I=_;I.l(T)<=0;)E=W(E),I=W(I);var w=F(E,1),b=F(I,1);for(I=F(I,2),E=F(E,2);!S(I);){var v=b.add(I);v.l(T)<=0&&(w=w.add(E),b=v),I=F(I,1),E=F(E,1)}return _=M(T,w.j(_)),new V(w,_)}for(w=m;T.l(_)>=0;){for(E=Math.max(1,Math.floor(T.m()/_.m())),I=Math.ceil(Math.log(E)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),b=h(E),v=b.j(_);C(v)||v.l(T)>0;)E-=I,b=h(E),v=b.j(_);S(b)&&(b=y),w=w.add(b),T=M(T,v)}return new V(w,T)}n.B=function(T){return U(this,T).h},n.and=function(T){const _=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<_;I++)E[I]=this.i(I)&T.i(I);return new a(E,this.h&T.h)},n.or=function(T){const _=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<_;I++)E[I]=this.i(I)|T.i(I);return new a(E,this.h|T.h)},n.xor=function(T){const _=Math.max(this.g.length,T.g.length),E=[];for(let I=0;I<_;I++)E[I]=this.i(I)^T.i(I);return new a(E,this.h^T.h)};function W(T){const _=T.g.length+1,E=[];for(let I=0;I<_;I++)E[I]=T.i(I)<<1|T.i(I-1)>>>31;return new a(E,T.h)}function F(T,_){const E=_>>5;_%=32;const I=T.g.length-E,w=[];for(let b=0;b<I;b++)w[b]=_>0?T.i(b+E)>>>_|T.i(b+E+1)<<32-_:T.i(b+E);return new a(w,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,fh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Lt=a}).apply(typeof dl<"u"?dl:typeof self<"u"?self:typeof window<"u"?window:{});var gs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ph,ur,mh,Rs,To,gh,yh,_h;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof gs=="object"&&gs];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var d=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var A=o[p];if(!(A in d))break e;d=d[A]}o=o[o.length-1],p=d[o],c=c(p),c!=p&&c!=null&&e(d,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,d){return o.call.apply(o.bind,arguments)}function h(o,c,d){return h=u,h.apply(null,arguments)}function f(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,c){function d(){}d.prototype=c.prototype,o.Z=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(p,A,R){for(var O=Array(arguments.length-2),H=2;H<arguments.length;H++)O[H-2]=arguments[H];return c.prototype[A].apply(p,O)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function g(o){const c=o.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=o[p];return d}return[]}function S(o,c){for(let p=1;p<arguments.length;p++){const A=arguments[p];var d=typeof A;if(d=d!="object"?d:A?Array.isArray(A)?"array":d:"null",d=="array"||d=="object"&&typeof A.length=="number"){d=o.length||0;const R=A.length||0;o.length=d+R;for(let O=0;O<R;O++)o[d+O]=A[O]}else o.push(A)}}class C{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function P(o){a.setTimeout(()=>{throw o},0)}function M(){var o=T;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class N{constructor(){this.h=this.g=null}add(c,d){const p=V.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var V=new C(()=>new U,o=>o.reset());class U{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let W,F=!1,T=new N,_=()=>{const o=Promise.resolve(void 0);W=()=>{o.then(E)}};function E(){for(var o;o=M();){try{o.h.call(o.g)}catch(d){P(d)}var c=V;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}F=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function w(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch{}return o})();function v(o){return/^[\s\xa0]*$/.test(o)}function Ae(o,c){w.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}m(Ae,w),Ae.prototype.init=function(o,c){const d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(d=="mouseover"?c=o.fromElement:d=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ae.Z.h.call(this)},Ae.prototype.h=function(){Ae.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ae="closure_listenable_"+(Math.random()*1e6|0),je=0;function De(o,c,d,p,A){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=A,this.key=++je,this.da=this.fa=!1}function Ge(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function vt(o,c,d){for(const p in o)c.call(d,o[p],p,o)}function ts(o,c){for(const d in o)c.call(void 0,o[d],d,o)}function zn(o){const c={};for(const d in o)c[d]=o[d];return c}const La="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xa(o,c){let d,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(d in p)o[d]=p[d];for(let R=0;R<La.length;R++)d=La[R],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function ns(o){this.src=o,this.g={},this.h=0}ns.prototype.add=function(o,c,d,p,A){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const O=Ri(o,c,p,A);return O>-1?(c=o[O],d||(c.fa=!1)):(c=new De(c,this.src,R,!!p,A),c.fa=d,o.push(c)),c};function Si(o,c){const d=c.type;if(d in o.g){var p=o.g[d],A=Array.prototype.indexOf.call(p,c,void 0),R;(R=A>=0)&&Array.prototype.splice.call(p,A,1),R&&(Ge(c),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Ri(o,c,d,p){for(let A=0;A<o.length;++A){const R=o[A];if(!R.da&&R.listener==c&&R.capture==!!d&&R.ha==p)return A}return-1}var Ci="closure_lm_"+(Math.random()*1e6|0),Pi={};function Ua(o,c,d,p,A){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Ua(o,c[R],d,p,A);return null}return d=$a(d),o&&o[ae]?o.J(c,d,l(p)?!!p.capture:!1,A):ff(o,c,d,!1,p,A)}function ff(o,c,d,p,A,R){if(!c)throw Error("Invalid event type");const O=l(A)?!!A.capture:!!A;let H=Ni(o);if(H||(o[Ci]=H=new ns(o)),d=H.add(c,d,p,O,R),d.proxy)return d;if(p=pf(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)b||(A=O),A===void 0&&(A=!1),o.addEventListener(c.toString(),p,A);else if(o.attachEvent)o.attachEvent(Ba(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function pf(){function o(d){return c.call(o.src,o.listener,d)}const c=mf;return o}function Fa(o,c,d,p,A){if(Array.isArray(c))for(var R=0;R<c.length;R++)Fa(o,c[R],d,p,A);else p=l(p)?!!p.capture:!!p,d=$a(d),o&&o[ae]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],d=Ri(c,d,p,A),d>-1&&(Ge(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=Ni(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Ri(c,d,p,A)),(d=o>-1?c[o]:null)&&ki(d))}function ki(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[ae])Si(c.i,o);else{var d=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(d,p,o.capture):c.detachEvent?c.detachEvent(Ba(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=Ni(c))?(Si(d,o),d.h==0&&(d.src=null,c[Ci]=null)):Ge(o)}}}function Ba(o){return o in Pi?Pi[o]:Pi[o]="on"+o}function mf(o,c){if(o.da)o=!0;else{c=new Ae(c,this);const d=o.listener,p=o.ha||o.src;o.fa&&ki(o),o=d.call(p,c)}return o}function Ni(o){return o=o[Ci],o instanceof ns?o:null}var Di="__closure_events_fn_"+(Math.random()*1e9>>>0);function $a(o){return typeof o=="function"?o:(o[Di]||(o[Di]=function(c){return o.handleEvent(c)}),o[Di])}function be(){I.call(this),this.i=new ns(this),this.M=this,this.G=null}m(be,I),be.prototype[ae]=!0,be.prototype.removeEventListener=function(o,c,d,p){Fa(this,o,c,d,p)};function ke(o,c){var d,p=o.G;if(p)for(d=[];p;p=p.G)d.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new w(c,o);else if(c instanceof w)c.target=c.target||o;else{var A=c;c=new w(p,o),xa(c,A)}A=!0;let R,O;if(d)for(O=d.length-1;O>=0;O--)R=c.g=d[O],A=rs(R,p,!0,c)&&A;if(R=c.g=o,A=rs(R,p,!0,c)&&A,A=rs(R,p,!1,c)&&A,d)for(O=0;O<d.length;O++)R=c.g=d[O],A=rs(R,p,!1,c)&&A}be.prototype.N=function(){if(be.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const d=o.g[c];for(let p=0;p<d.length;p++)Ge(d[p]);delete o.g[c],o.h--}}this.G=null},be.prototype.J=function(o,c,d,p){return this.i.add(String(o),c,!1,d,p)},be.prototype.K=function(o,c,d,p){return this.i.add(String(o),c,!0,d,p)};function rs(o,c,d,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let R=0;R<c.length;++R){const O=c[R];if(O&&!O.da&&O.capture==d){const H=O.listener,ye=O.ha||O.src;O.fa&&Si(o.i,O),A=H.call(ye,p)!==!1&&A}}return A&&!p.defaultPrevented}function gf(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function qa(o){o.g=gf(()=>{o.g=null,o.i&&(o.i=!1,qa(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class yf extends I{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:qa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Hn(o){I.call(this),this.h=o,this.g={}}m(Hn,I);var ja=[];function za(o){vt(o.g,function(c,d){this.g.hasOwnProperty(d)&&ki(c)},o),o.g={}}Hn.prototype.N=function(){Hn.Z.N.call(this),za(this)},Hn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Vi=a.JSON.stringify,_f=a.JSON.parse,vf=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Ha(){}function Wa(){}var Wn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Oi(){w.call(this,"d")}m(Oi,w);function Mi(){w.call(this,"c")}m(Mi,w);var Kt={},Ka=null;function ss(){return Ka=Ka||new be}Kt.Ia="serverreachability";function Ga(o){w.call(this,Kt.Ia,o)}m(Ga,w);function Kn(o){const c=ss();ke(c,new Ga(c))}Kt.STAT_EVENT="statevent";function Qa(o,c){w.call(this,Kt.STAT_EVENT,o),this.stat=c}m(Qa,w);function Ne(o){const c=ss();ke(c,new Qa(c,o))}Kt.Ja="timingevent";function Xa(o,c){w.call(this,Kt.Ja,o),this.size=c}m(Xa,w);function Gn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function Qn(){this.g=!0}Qn.prototype.ua=function(){this.g=!1};function Ef(o,c,d,p,A,R){o.info(function(){if(o.g)if(R){var O="",H=R.split("&");for(let ee=0;ee<H.length;ee++){var ye=H[ee].split("=");if(ye.length>1){const ve=ye[0];ye=ye[1];const Xe=ve.split("_");O=Xe.length>=2&&Xe[1]=="type"?O+(ve+"="+ye+"&"):O+(ve+"=redacted&")}}}else O=null;else O=R;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+c+`
`+d+`
`+O})}function Tf(o,c,d,p,A,R,O){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+c+`
`+d+`
`+R+" "+O})}function mn(o,c,d,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+If(o,d)+(p?" "+p:"")})}function wf(o,c){o.info(function(){return"TIMEOUT: "+c})}Qn.prototype.info=function(){};function If(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var d=R[o];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var A=p[0];if(A!="noop"&&A!="stop"&&A!="close")for(let O=1;O<p.length;O++)p[O]=""}}}}return Vi(R)}catch{return c}}var is={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ya={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ja;function Li(){}m(Li,Ha),Li.prototype.g=function(){return new XMLHttpRequest},Ja=new Li;function Xn(o){return encodeURIComponent(String(o))}function Af(o){var c=1;o=o.split(":");const d=[];for(;c>0&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function Et(o,c,d,p){this.j=o,this.i=c,this.l=d,this.S=p||1,this.V=new Hn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Za}function Za(){this.i=null,this.g="",this.h=!1}var ec={},xi={};function Ui(o,c,d){o.M=1,o.A=as(Qe(c)),o.u=d,o.R=!0,tc(o,null)}function tc(o,c){o.F=Date.now(),os(o),o.B=Qe(o.A);var d=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),pc(d.i,"t",p),o.C=0,d=o.j.L,o.h=new Za,o.g=Dc(o.j,d?c:null,!o.u),o.P>0&&(o.O=new yf(h(o.Y,o,o.g),o.P)),c=o.V,d=o.g,p=o.ba;var A="readystatechange";Array.isArray(A)||(A&&(ja[0]=A.toString()),A=ja);for(let R=0;R<A.length;R++){const O=Ua(d,A[R],p||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=o.J?zn(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Kn(),Ef(o.i,o.v,o.B,o.l,o.S,o.u)}Et.prototype.ba=function(o){o=o.target;const c=this.O;c&&It(o)==3?c.j():this.Y(o)},Et.prototype.Y=function(o){try{if(o==this.g)e:{const H=It(this.g),ye=this.g.ya(),ee=this.g.ca();if(!(H<3)&&(H!=3||this.g&&(this.h.h||this.g.la()||Tc(this.g)))){this.K||H!=4||ye==7||(ye==8||ee<=0?Kn(3):Kn(2)),Fi(this);var c=this.g.ca();this.X=c;var d=bf(this);if(this.o=c==200,Tf(this.i,this.v,this.B,this.l,this.S,H,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,A=this.g;if((p=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var R=p;break t}}R=null}if(o=R)mn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Bi(this,o);else{this.o=!1,this.m=3,Ne(12),Gt(this),Yn(this);break e}}if(this.R){o=!0;let ve;for(;!this.K&&this.C<d.length;)if(ve=Sf(this,d),ve==xi){H==4&&(this.m=4,Ne(14),o=!1),mn(this.i,this.l,null,"[Incomplete Response]");break}else if(ve==ec){this.m=4,Ne(15),mn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else mn(this.i,this.l,ve,null),Bi(this,ve);if(nc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),H!=4||d.length!=0||this.h.h||(this.m=1,Ne(16),o=!1),this.o=this.o&&o,!o)mn(this.i,this.l,d,"[Invalid Chunked Response]"),Gt(this),Yn(this);else if(d.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Gi(O),O.P=!0,Ne(11))}}else mn(this.i,this.l,d,null),Bi(this,d);H==4&&Gt(this),this.o&&!this.K&&(H==4?Cc(this.j,this):(this.o=!1,os(this)))}else Bf(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),Gt(this),Yn(this)}}}catch{}};function bf(o){if(!nc(o))return o.g.la();const c=Tc(o.g);if(c==="")return"";let d="";const p=c.length,A=It(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Gt(o),Yn(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,d+=o.h.i.decode(c[R],{stream:!(A&&R==p-1)});return c.length=0,o.h.g+=d,o.C=0,o.h.g}function nc(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Sf(o,c){var d=o.C,p=c.indexOf(`
`,d);return p==-1?xi:(d=Number(c.substring(d,p)),isNaN(d)?ec:(p+=1,p+d>c.length?xi:(c=c.slice(p,p+d),o.C=p+d,c)))}Et.prototype.cancel=function(){this.K=!0,Gt(this)};function os(o){o.T=Date.now()+o.H,rc(o,o.H)}function rc(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Gn(h(o.aa,o),c)}function Fi(o){o.D&&(a.clearTimeout(o.D),o.D=null)}Et.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(wf(this.i,this.B),this.M!=2&&(Kn(),Ne(17)),Gt(this),this.m=2,Yn(this)):rc(this,this.T-o)};function Yn(o){o.j.I==0||o.K||Cc(o.j,o)}function Gt(o){Fi(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,za(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Bi(o,c){try{var d=o.j;if(d.I!=0&&(d.g==o||$i(d.h,o))){if(!o.L&&$i(d.h,o)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)ds(d),us(d);else break e;Ki(d),Ne(18)}}else d.xa=A[1],0<d.xa-d.K&&A[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=Gn(h(d.Va,d),6e3));oc(d.h)<=1&&d.ta&&(d.ta=void 0)}else Xt(d,11)}else if((o.L||d.g==o)&&ds(d),!v(c))for(A=d.Ba.g.parse(c),c=0;c<A.length;c++){let ee=A[c];const ve=ee[0];if(!(ve<=d.K))if(d.K=ve,ee=ee[1],d.I==2)if(ee[0]=="c"){d.M=ee[1],d.ba=ee[2];const Xe=ee[3];Xe!=null&&(d.ka=Xe,d.j.info("VER="+d.ka));const Yt=ee[4];Yt!=null&&(d.za=Yt,d.j.info("SVER="+d.za));const At=ee[5];At!=null&&typeof At=="number"&&At>0&&(p=1.5*At,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const bt=o.g;if(bt){const ps=bt.g?bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ps){var R=p.h;R.g||ps.indexOf("spdy")==-1&&ps.indexOf("quic")==-1&&ps.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(qi(R,R.h),R.h=null))}if(p.G){const Qi=bt.g?bt.g.getResponseHeader("X-HTTP-Session-Id"):null;Qi&&(p.wa=Qi,se(p.J,p.G,Qi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var O=o;if(p.na=Nc(p,p.L?p.ba:null,p.W),O.L){ac(p.h,O);var H=O,ye=p.O;ye&&(H.H=ye),H.D&&(Fi(H),os(H)),p.g=O}else Sc(p);d.i.length>0&&hs(d)}else ee[0]!="stop"&&ee[0]!="close"||Xt(d,7);else d.I==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?Xt(d,7):Wi(d):ee[0]!="noop"&&d.l&&d.l.qa(ee),d.A=0)}}Kn(4)}catch{}}var Rf=class{constructor(o,c){this.g=o,this.map=c}};function sc(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ic(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function oc(o){return o.h?1:o.g?o.g.size:0}function $i(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function qi(o,c){o.g?o.g.add(c):o.h=c}function ac(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}sc.prototype.cancel=function(){if(this.i=cc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function cc(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const d of o.g.values())c=c.concat(d.G);return c}return g(o.i)}var lc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Cf(o,c){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const p=o[d].indexOf("=");let A,R=null;p>=0?(A=o[d].substring(0,p),R=o[d].substring(p+1)):A=o[d],c(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Tt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof Tt?(this.l=o.l,Jn(this,o.j),this.o=o.o,this.g=o.g,Zn(this,o.u),this.h=o.h,ji(this,mc(o.i)),this.m=o.m):o&&(c=String(o).match(lc))?(this.l=!1,Jn(this,c[1]||"",!0),this.o=er(c[2]||""),this.g=er(c[3]||"",!0),Zn(this,c[4]),this.h=er(c[5]||"",!0),ji(this,c[6]||"",!0),this.m=er(c[7]||"")):(this.l=!1,this.i=new nr(null,this.l))}Tt.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(tr(c,uc,!0),":");var d=this.g;return(d||c=="file")&&(o.push("//"),(c=this.o)&&o.push(tr(c,uc,!0),"@"),o.push(Xn(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(tr(d,d.charAt(0)=="/"?Nf:kf,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",tr(d,Vf)),o.join("")},Tt.prototype.resolve=function(o){const c=Qe(this);let d=!!o.j;d?Jn(c,o.j):d=!!o.o,d?c.o=o.o:d=!!o.g,d?c.g=o.g:d=o.u!=null;var p=o.h;if(d)Zn(c,o.u);else if(d=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var A=c.h.lastIndexOf("/");A!=-1&&(p=c.h.slice(0,A+1)+p)}if(A=p,A==".."||A==".")p="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){p=A.lastIndexOf("/",0)==0,A=A.split("/");const R=[];for(let O=0;O<A.length;){const H=A[O++];H=="."?p&&O==A.length&&R.push(""):H==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&O==A.length&&R.push("")):(R.push(H),p=!0)}p=R.join("/")}else p=A}return d?c.h=p:d=o.i.toString()!=="",d?ji(c,mc(o.i)):d=!!o.m,d&&(c.m=o.m),c};function Qe(o){return new Tt(o)}function Jn(o,c,d){o.j=d?er(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Zn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function ji(o,c,d){c instanceof nr?(o.i=c,Of(o.i,o.l)):(d||(c=tr(c,Df)),o.i=new nr(c,o.l))}function se(o,c,d){o.i.set(c,d)}function as(o){return se(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function er(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function tr(o,c,d){return typeof o=="string"?(o=encodeURI(o).replace(c,Pf),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Pf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var uc=/[#\/\?@]/g,kf=/[#\?:]/g,Nf=/[#\?]/g,Df=/[#\?@]/g,Vf=/#/g;function nr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Qt(o){o.g||(o.g=new Map,o.h=0,o.i&&Cf(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=nr.prototype,n.add=function(o,c){Qt(this),this.i=null,o=gn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this};function hc(o,c){Qt(o),c=gn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function dc(o,c){return Qt(o),c=gn(o,c),o.g.has(c)}n.forEach=function(o,c){Qt(this),this.g.forEach(function(d,p){d.forEach(function(A){o.call(c,A,p,this)},this)},this)};function fc(o,c){Qt(o);let d=[];if(typeof c=="string")dc(o,c)&&(d=d.concat(o.g.get(gn(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)d=d.concat(o[c]);return d}n.set=function(o,c){return Qt(this),this.i=null,o=gn(this,o),dc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=fc(this,o),o.length>0?String(o[0]):c):c};function pc(o,c,d){hc(o,c),d.length>0&&(o.i=null,o.g.set(gn(o,c),g(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const A=Xn(d);d=fc(this,d);for(let R=0;R<d.length;R++){let O=A;d[R]!==""&&(O+="="+Xn(d[R])),o.push(O)}}return this.i=o.join("&")};function mc(o){const c=new nr;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function gn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Of(o,c){c&&!o.j&&(Qt(o),o.i=null,o.g.forEach(function(d,p){const A=p.toLowerCase();p!=A&&(hc(this,p),pc(this,A,d))},o)),o.j=c}function Mf(o,c){const d=new Qn;if(a.Image){const p=new Image;p.onload=f(wt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=f(wt,d,"TestLoadImage: error",!1,c,p),p.onabort=f(wt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(wt,d,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function Lf(o,c){const d=new Qn,p=new AbortController,A=setTimeout(()=>{p.abort(),wt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(A),R.ok?wt(d,"TestPingServer: ok",!0,c):wt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),wt(d,"TestPingServer: error",!1,c)})}function wt(o,c,d,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(d)}catch{}}function xf(){this.g=new vf}function zi(o){this.i=o.Sb||null,this.h=o.ab||!1}m(zi,Ha),zi.prototype.g=function(){return new cs(this.i,this.h)};function cs(o,c){be.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(cs,be),n=cs.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,sr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,rr(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,sr(this)),this.g&&(this.readyState=3,sr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;gc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function gc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?rr(this):sr(this),this.readyState==3&&gc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,rr(this))},n.Na=function(o){this.g&&(this.response=o,rr(this))},n.ga=function(){this.g&&rr(this)};function rr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,sr(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=c.next();return o.join(`\r
`)};function sr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(cs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function yc(o){let c="";return vt(o,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function Hi(o,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=yc(d),typeof o=="string"?d!=null&&Xn(d):se(o,c,d))}function le(o){be.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(le,be);var Uf=/^https?$/i,Ff=["POST","PUT"];n=le.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ja.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){_c(this,R);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)d.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())d.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Ff,c,void 0)>=0)||p||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,O]of d)this.g.setRequestHeader(R,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){_c(this,R)}};function _c(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,vc(o),ls(o)}function vc(o){o.A||(o.A=!0,ke(o,"complete"),ke(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,ke(this,"complete"),ke(this,"abort"),ls(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ls(this,!0)),le.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ec(this):this.Xa())},n.Xa=function(){Ec(this)};function Ec(o){if(o.h&&typeof i<"u"){if(o.v&&It(o)==4)setTimeout(o.Ca.bind(o),0);else if(ke(o,"readystatechange"),It(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=R===0){let O=String(o.D).match(lc)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),p=!Uf.test(O?O.toLowerCase():"")}d=p}if(d)ke(o,"complete"),ke(o,"success");else{o.o=6;try{var A=It(o)>2?o.g.statusText:""}catch{A=""}o.l=A+" ["+o.ca()+"]",vc(o)}}finally{ls(o)}}}}function ls(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,c||ke(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function It(o){return o.g?o.g.readyState:0}n.ca=function(){try{return It(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),_f(c)}};function Tc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Bf(o){const c={};o=(o.g&&It(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(v(o[p]))continue;var d=Af(o[p]);const A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=c[A]||[];c[A]=R,R.push(d)}ts(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ir(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function wc(o){this.za=0,this.i=[],this.j=new Qn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ir("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ir("baseRetryDelayMs",5e3,o),this.Za=ir("retryDelaySeedMs",1e4,o),this.Ta=ir("forwardChannelMaxRetries",2,o),this.va=ir("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new sc(o&&o.concurrentRequestLimit),this.Ba=new xf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=wc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,d,p){Ne(0),this.W=o,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=Nc(this,null,this.W),hs(this)};function Wi(o){if(Ic(o),o.I==3){var c=o.V++,d=Qe(o.J);if(se(d,"SID",o.M),se(d,"RID",c),se(d,"TYPE","terminate"),or(o,d),c=new Et(o,o.j,c),c.M=2,c.A=as(Qe(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=c.A,d=!0),d||(c.g=Dc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),os(c)}kc(o)}function us(o){o.g&&(Gi(o),o.g.cancel(),o.g=null)}function Ic(o){us(o),o.v&&(a.clearTimeout(o.v),o.v=null),ds(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function hs(o){if(!ic(o.h)&&!o.m){o.m=!0;var c=o.Ea;W||_(),F||(W(),F=!0),T.add(c,o),o.D=0}}function $f(o,c){return oc(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Gn(h(o.Ea,o,c),Pc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const A=new Et(this,this.j,o);let R=this.o;if(this.U&&(R?(R=zn(R),xa(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=bc(this,A,c),d=Qe(this.J),se(d,"RID",o),se(d,"CVER",22),this.G&&se(d,"X-HTTP-Session-Id",this.G),or(this,d),R&&(this.R?c="headers="+Xn(yc(R))+"&"+c:this.u&&Hi(d,this.u,R)),qi(this.h,A),this.Ra&&se(d,"TYPE","init"),this.S?(se(d,"$req",c),se(d,"SID","null"),A.U=!0,Ui(A,d,null)):Ui(A,d,c),this.I=2}}else this.I==3&&(o?Ac(this,o):this.i.length==0||ic(this.h)||Ac(this))};function Ac(o,c){var d;c?d=c.l:d=o.V++;const p=Qe(o.J);se(p,"SID",o.M),se(p,"RID",d),se(p,"AID",o.K),or(o,p),o.u&&o.o&&Hi(p,o.u,o.o),d=new Et(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),c&&(o.i=c.G.concat(o.i)),c=bc(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),qi(o.h,d),Ui(d,p,c)}function or(o,c){o.H&&vt(o.H,function(d,p){se(c,p,d)}),o.l&&vt({},function(d,p){se(c,p,d)})}function bc(o,c,d){d=Math.min(o.i.length,d);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var A=o.i;let H=-1;for(;;){const ye=["count="+d];H==-1?d>0?(H=A[0].g,ye.push("ofs="+H)):H=0:ye.push("ofs="+H);let ee=!0;for(let ve=0;ve<d;ve++){var R=A[ve].g;const Xe=A[ve].map;if(R-=H,R<0)H=Math.max(0,A[ve].g-100),ee=!1;else try{R="req"+R+"_"||"";try{var O=Xe instanceof Map?Xe:Object.entries(Xe);for(const[Yt,At]of O){let bt=At;l(At)&&(bt=Vi(At)),ye.push(R+Yt+"="+encodeURIComponent(bt))}}catch(Yt){throw ye.push(R+"type="+encodeURIComponent("_badmap")),Yt}}catch{p&&p(Xe)}}if(ee){O=ye.join("&");break e}}O=void 0}return o=o.i.splice(0,d),c.G=o,O}function Sc(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;W||_(),F||(W(),F=!0),T.add(c,o),o.A=0}}function Ki(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Gn(h(o.Da,o),Pc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Rc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Gn(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),us(this),Rc(this))};function Gi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Rc(o){o.g=new Et(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=Qe(o.na);se(c,"RID","rpc"),se(c,"SID",o.M),se(c,"AID",o.K),se(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&se(c,"TO",o.ia),se(c,"TYPE","xmlhttp"),or(o,c),o.u&&o.o&&Hi(c,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=as(Qe(c)),d.u=null,d.R=!0,tc(d,o)}n.Va=function(){this.C!=null&&(this.C=null,us(this),Ki(this),Ne(19))};function ds(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function Cc(o,c){var d=null;if(o.g==c){ds(o),Gi(o),o.g=null;var p=2}else if($i(o.h,c))d=c.G,ac(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var A=o.D;p=ss(),ke(p,new Xa(p,d)),hs(o)}else Sc(o);else if(A=c.m,A==3||A==0&&c.X>0||!(p==1&&$f(o,c)||p==2&&Ki(o)))switch(d&&d.length>0&&(c=o.h,c.i=c.i.concat(d)),A){case 1:Xt(o,5);break;case 4:Xt(o,10);break;case 3:Xt(o,6);break;default:Xt(o,2)}}}function Pc(o,c){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*c}function Xt(o,c){if(o.j.info("Error code "+c),c==2){var d=h(o.bb,o),p=o.Ua;const A=!p;p=new Tt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Jn(p,"https"),as(p),A?Mf(p.toString(),d):Lf(p.toString(),d)}else Ne(2);o.I=0,o.l&&o.l.pa(c),kc(o),Ic(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function kc(o){if(o.I=0,o.ja=[],o.l){const c=cc(o.h);(c.length!=0||o.i.length!=0)&&(S(o.ja,c),S(o.ja,o.i),o.h.i.length=0,g(o.i),o.i.length=0),o.l.oa()}}function Nc(o,c,d){var p=d instanceof Tt?Qe(d):new Tt(d);if(p.g!="")c&&(p.g=c+"."+p.g),Zn(p,p.u);else{var A=a.location;p=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const R=new Tt(null);p&&Jn(R,p),c&&(R.g=c),A&&Zn(R,A),d&&(R.h=d),p=R}return d=o.G,c=o.wa,d&&c&&se(p,d,c),se(p,"VER",o.ka),or(o,p),p}function Dc(o,c,d){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new le(new zi({ab:d})):new le(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vc(){}n=Vc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function fs(){}fs.prototype.g=function(o,c){return new Le(o,c)};function Le(o,c){be.call(this),this.g=new wc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!v(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!v(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new yn(this)}m(Le,be),Le.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Le.prototype.close=function(){Wi(this.g)},Le.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=Vi(o),o=d);c.i.push(new Rf(c.Ya++,o)),c.I==3&&hs(c)},Le.prototype.N=function(){this.g.l=null,delete this.j,Wi(this.g),delete this.g,Le.Z.N.call(this)};function Oc(o){Oi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const d in c){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}m(Oc,Oi);function Mc(){Mi.call(this),this.status=1}m(Mc,Mi);function yn(o){this.g=o}m(yn,Vc),yn.prototype.ra=function(){ke(this.g,"a")},yn.prototype.qa=function(o){ke(this.g,new Oc(o))},yn.prototype.pa=function(o){ke(this.g,new Mc)},yn.prototype.oa=function(){ke(this.g,"b")},fs.prototype.createWebChannel=fs.prototype.g,Le.prototype.send=Le.prototype.o,Le.prototype.open=Le.prototype.m,Le.prototype.close=Le.prototype.close,_h=function(){return new fs},yh=function(){return ss()},gh=Kt,To={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},is.NO_ERROR=0,is.TIMEOUT=8,is.HTTP_ERROR=6,Rs=is,Ya.COMPLETE="complete",mh=Ya,Wa.EventType=Wn,Wn.OPEN="a",Wn.CLOSE="b",Wn.ERROR="c",Wn.MESSAGE="d",be.prototype.listen=be.prototype.J,ur=Wa,le.prototype.listenOnce=le.prototype.K,le.prototype.getLastError=le.prototype.Ha,le.prototype.getLastErrorCode=le.prototype.ya,le.prototype.getStatus=le.prototype.ca,le.prototype.getResponseJson=le.prototype.La,le.prototype.getResponseText=le.prototype.la,le.prototype.send=le.prototype.ea,le.prototype.setWithCredentials=le.prototype.Fa,ph=le}).apply(typeof gs<"u"?gs:typeof self<"u"?self:typeof window<"u"?window:{});const fl="@firebase/firestore",pl="4.9.3";class Re{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Re.UNAUTHENTICATED=new Re(null),Re.GOOGLE_CREDENTIALS=new Re("google-credentials-uid"),Re.FIRST_PARTY=new Re("first-party-uid"),Re.MOCK_USER=new Re("mock-user");let Un="12.7.0";const an=new Uo("@firebase/firestore");function _n(){return an.logLevel}function x(n,...e){if(an.logLevel<=K.DEBUG){const t=e.map(Jo);an.debug(`Firestore (${Un}): ${n}`,...t)}}function ft(n,...e){if(an.logLevel<=K.ERROR){const t=e.map(Jo);an.error(`Firestore (${Un}): ${n}`,...t)}}function Pn(n,...e){if(an.logLevel<=K.WARN){const t=e.map(Jo);an.warn(`Firestore (${Un}): ${n}`,...t)}}function Jo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function q(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,vh(n,r,t)}function vh(n,e,t){let r=`FIRESTORE (${Un}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ft(r),new Error(r)}function Z(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||vh(e,s,r)}function z(n,e){return n}const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends mt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ut{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Eh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Jy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Re.UNAUTHENTICATED)))}shutdown(){}}class Zy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class e_{constructor(e){this.t=e,this.currentUser=Re.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Z(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new ut;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ut,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ut)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z(typeof r.accessToken=="string",31837,{l:r}),new Eh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Z(e===null||typeof e=="string",2055,{h:e}),new Re(e)}}class t_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Re.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class n_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new t_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Re.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ml{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class r_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Z(this.o===void 0,3512);const r=i=>{i.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ml(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Z(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ml(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function s_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Zo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=s_(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function G(n,e){return n<e?-1:n>e?1:0}function wo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return ro(s)===ro(i)?G(s,i):ro(s)?1:-1}return G(n.length,e.length)}const i_=55296,o_=57343;function ro(n){const e=n.charCodeAt(0);return e>=i_&&e<=o_}function kn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const gl="__name__";class Ye{constructor(e,t,r){t===void 0?t=0:t>e.length&&q(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&q(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ye.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ye?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Ye.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return G(e.length,t.length)}static compareSegments(e,t){const r=Ye.isNumericId(e),s=Ye.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ye.extractNumericId(e).compare(Ye.extractNumericId(t)):wo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Lt.fromString(e.substring(4,e.length-2))}}class re extends Ye{construct(e,t,r){return new re(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new re(t)}static emptyPath(){return new re([])}}const a_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class we extends Ye{construct(e,t,r){return new we(e,t,r)}static isValidIdentifier(e){return a_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),we.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===gl}static keyField(){return new we([gl])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new L(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new L(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new L(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new L(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new we(t)}static emptyPath(){return new we([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(re.fromString(e))}static fromName(e){return new B(re.fromString(e).popFirst(5))}static empty(){return new B(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new re(e.slice()))}}function Th(n,e,t){if(!t)throw new L(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function c_(n,e,t,r){if(e===!0&&r===!0)throw new L(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function yl(n){if(!B.isDocumentKey(n))throw new L(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _l(n){if(B.isDocumentKey(n))throw new L(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function oi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":q(12329,{type:typeof n})}function We(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=oi(n);throw new L(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function l_(n,e){if(e<=0)throw new L(k.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function me(n,e){const t={typeString:n};return e&&(t.value=e),t}function Hr(n,e){if(!wh(n))throw new L(k.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new L(k.INVALID_ARGUMENT,t);return!0}const vl=-62135596800,El=1e6;class ie{static now(){return ie.fromMillis(Date.now())}static fromDate(e){return ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*El);return new ie(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<vl)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/El}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ie._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hr(e,ie._jsonSchema))return new ie(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-vl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ie._jsonSchemaVersion="firestore/timestamp/1.0",ie._jsonSchema={type:me("string",ie._jsonSchemaVersion),seconds:me("number"),nanoseconds:me("number")};class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new ie(0,0))}static max(){return new j(new ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Rr=-1;function u_(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=j.fromTimestamp(r===1e9?new ie(t+1,0):new ie(t,r));return new Ut(s,B.empty(),e)}function h_(n){return new Ut(n.readTime,n.key,Rr)}class Ut{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ut(j.min(),B.empty(),Rr)}static max(){return new Ut(j.max(),B.empty(),Rr)}}function d_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}const f_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class p_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Fn(n){if(n.code!==k.FAILED_PRECONDITION||n.message!==f_)throw n;x("LocalStore","Unexpectedly lost primary lease")}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):D.reject(t)}static resolve(e){return new D(((t,r)=>{t(e)}))}static reject(e){return new D(((t,r)=>{r(e)}))}static waitFor(e){return new D(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=D.resolve(!1);for(const r of e)t=t.next((s=>s?D.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new D(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const h=u;t(e[h]).next((f=>{a[h]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new D(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function m_(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Bn(n){return n.name==="IndexedDbTransactionError"}class ai{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ai.ce=-1;const ea=-1;function ci(n){return n==null}function zs(n){return n===0&&1/n==-1/0}function g_(n){return typeof n=="number"&&Number.isInteger(n)&&!zs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Ih="";function y_(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Tl(e)),e=__(n.get(t),e);return Tl(e)}function __(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Ih:t+="";break;default:t+=i}}return t}function Tl(n){return n+Ih+""}function wl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ah(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ce{constructor(e,t){this.comparator=e,this.root=t||Te.EMPTY}insert(e,t){return new ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Te.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Te.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ys(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ys(this.root,e,this.comparator,!1)}getReverseIterator(){return new ys(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ys(this.root,e,this.comparator,!0)}}class ys{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Te{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Te.RED,this.left=s??Te.EMPTY,this.right=i??Te.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Te(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Te.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Te.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Te.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Te.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}}Te.EMPTY=null,Te.RED=!0,Te.BLACK=!1;Te.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Te(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class _e{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Il(this.data.getIterator())}getIteratorFrom(e){return new Il(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof _e)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new _e(this.comparator);return t.data=e,t}}class Il{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Be{constructor(e){this.fields=e,e.sort(we.comparator)}static empty(){return new Be([])}unionWith(e){let t=new _e(we.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return kn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class bh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new bh("Invalid base64 string: "+i):i}})(e);return new Ie(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const v_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ft(n){if(Z(!!n,39018),typeof n=="string"){let e=0;const t=v_.exec(n);if(Z(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ue(n.seconds),nanos:ue(n.nanos)}}function ue(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Bt(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}const Sh="server_timestamp",Rh="__type__",Ch="__previous_value__",Ph="__local_write_time__";function ta(n){return(n?.mapValue?.fields||{})[Rh]?.stringValue===Sh}function li(n){const e=n.mapValue.fields[Ch];return ta(e)?li(e):e}function Cr(n){const e=Ft(n.mapValue.fields[Ph].timestampValue);return new ie(e.seconds,e.nanos)}class E_{constructor(e,t,r,s,i,a,l,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}}const Hs="(default)";class Pr{constructor(e,t){this.projectId=e,this.database=t||Hs}static empty(){return new Pr("","")}get isDefaultDatabase(){return this.database===Hs}isEqual(e){return e instanceof Pr&&e.projectId===this.projectId&&e.database===this.database}}const kh="__type__",T_="__max__",_s={mapValue:{}},Nh="__vector__",Ws="value";function $t(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ta(n)?4:I_(n)?9007199254740991:w_(n)?10:11:q(28295,{value:n})}function rt(n,e){if(n===e)return!0;const t=$t(n);if(t!==$t(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Cr(n).isEqual(Cr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Ft(s.timestampValue),l=Ft(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Bt(s.bytesValue).isEqual(Bt(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return ue(s.geoPointValue.latitude)===ue(i.geoPointValue.latitude)&&ue(s.geoPointValue.longitude)===ue(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return ue(s.integerValue)===ue(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=ue(s.doubleValue),l=ue(i.doubleValue);return a===l?zs(a)===zs(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return kn(n.arrayValue.values||[],e.arrayValue.values||[],rt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(wl(a)!==wl(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!rt(a[u],l[u])))return!1;return!0})(n,e);default:return q(52216,{left:n})}}function kr(n,e){return(n.values||[]).find((t=>rt(t,e)))!==void 0}function Nn(n,e){if(n===e)return 0;const t=$t(n),r=$t(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=ue(i.integerValue||i.doubleValue),u=ue(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return Al(n.timestampValue,e.timestampValue);case 4:return Al(Cr(n),Cr(e));case 5:return wo(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=Bt(i),u=Bt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){const f=G(l[h],u[h]);if(f!==0)return f}return G(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=G(ue(i.latitude),ue(a.latitude));return l!==0?l:G(ue(i.longitude),ue(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return bl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},h=l[Ws]?.arrayValue,f=u[Ws]?.arrayValue,m=G(h?.values?.length||0,f?.values?.length||0);return m!==0?m:bl(h,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===_s.mapValue&&a===_s.mapValue)return 0;if(i===_s.mapValue)return 1;if(a===_s.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const y=wo(u[m],f[m]);if(y!==0)return y;const g=Nn(l[u[m]],h[f[m]]);if(g!==0)return g}return G(u.length,f.length)})(n.mapValue,e.mapValue);default:throw q(23264,{he:t})}}function Al(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);const t=Ft(n),r=Ft(e),s=G(t.seconds,r.seconds);return s!==0?s:G(t.nanos,r.nanos)}function bl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Nn(t[s],r[s]);if(i)return i}return G(t.length,r.length)}function Dn(n){return Io(n)}function Io(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ft(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Bt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Io(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Io(t.fields[a])}`;return s+"}"})(n.mapValue):q(61005,{value:n})}function Cs(n){switch($t(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=li(n);return e?16+Cs(e):16;case 5:return 2*n.stringValue.length;case 6:return Bt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Cs(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return zt(r.fields,((i,a)=>{s+=i.length+Cs(a)})),s})(n.mapValue);default:throw q(13486,{value:n})}}function Sl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ao(n){return!!n&&"integerValue"in n}function na(n){return!!n&&"arrayValue"in n}function Rl(n){return!!n&&"nullValue"in n}function Cl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ps(n){return!!n&&"mapValue"in n}function w_(n){return(n?.mapValue?.fields||{})[kh]?.stringValue===Nh}function gr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return zt(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=gr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=gr(n.arrayValue.values[t]);return e}return{...n}}function I_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===T_}class Oe{constructor(e){this.value=e}static empty(){return new Oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ps(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gr(t)}setAll(e){let t=we.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=gr(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Ps(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ps(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){zt(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Oe(gr(this.value))}}function Dh(n){const e=[];return zt(n.fields,((t,r)=>{const s=new we([t]);if(Ps(r)){const i=Dh(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Be(e)}class Ce{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ce(e,0,j.min(),j.min(),j.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,s){return new Ce(e,1,t,j.min(),r,s,0)}static newNoDocument(e,t){return new Ce(e,2,t,j.min(),j.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new Ce(e,3,t,j.min(),j.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ce&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ks{constructor(e,t){this.position=e,this.inclusive=t}}function Pl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=Nn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function kl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!rt(n.position[t],e.position[t]))return!1;return!0}class Nr{constructor(e,t="asc"){this.field=e,this.dir=t}}function A_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Vh{}class pe extends Vh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new S_(e,t,r):t==="array-contains"?new P_(e,r):t==="in"?new k_(e,r):t==="not-in"?new N_(e,r):t==="array-contains-any"?new D_(e,r):new pe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new R_(e,r):new C_(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Nn(t,this.value)):t!==null&&$t(this.value)===$t(t)&&this.matchesComparison(Nn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ke extends Vh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ke(e,t)}matches(e){return Oh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Oh(n){return n.op==="and"}function Mh(n){return b_(n)&&Oh(n)}function b_(n){for(const e of n.filters)if(e instanceof Ke)return!1;return!0}function bo(n){if(n instanceof pe)return n.field.canonicalString()+n.op.toString()+Dn(n.value);if(Mh(n))return n.filters.map((e=>bo(e))).join(",");{const e=n.filters.map((t=>bo(t))).join(",");return`${n.op}(${e})`}}function Lh(n,e){return n instanceof pe?(function(r,s){return s instanceof pe&&r.op===s.op&&r.field.isEqual(s.field)&&rt(r.value,s.value)})(n,e):n instanceof Ke?(function(r,s){return s instanceof Ke&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&Lh(a,s.filters[l])),!0):!1})(n,e):void q(19439)}function xh(n){return n instanceof pe?(function(t){return`${t.field.canonicalString()} ${t.op} ${Dn(t.value)}`})(n):n instanceof Ke?(function(t){return t.op.toString()+" {"+t.getFilters().map(xh).join(" ,")+"}"})(n):"Filter"}class S_ extends pe{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class R_ extends pe{constructor(e,t){super(e,"in",t),this.keys=Uh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class C_ extends pe{constructor(e,t){super(e,"not-in",t),this.keys=Uh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Uh(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class P_ extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return na(t)&&kr(t.arrayValue,this.value)}}class k_ extends pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&kr(this.value.arrayValue,t)}}class N_ extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(kr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!kr(this.value.arrayValue,t)}}class D_ extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!na(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>kr(this.value.arrayValue,r)))}}class V_{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function Nl(n,e=null,t=[],r=[],s=null,i=null,a=null){return new V_(n,e,t,r,s,i,a)}function ra(n){const e=z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>bo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Dn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Dn(r))).join(",")),e.Te=t}return e.Te}function sa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!A_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Lh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!kl(n.startAt,e.startAt)&&kl(n.endAt,e.endAt)}function So(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class $n{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function O_(n,e,t,r,s,i,a,l){return new $n(n,e,t,r,s,i,a,l)}function ia(n){return new $n(n)}function Dl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Fh(n){return n.collectionGroup!==null}function yr(n){const e=z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new _e(we.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Nr(i,r))})),t.has(we.keyField().canonicalString())||e.Ie.push(new Nr(we.keyField(),r))}return e.Ie}function Ze(n){const e=z(n);return e.Ee||(e.Ee=M_(e,yr(n))),e.Ee}function M_(n,e){if(n.limitType==="F")return Nl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Nr(s.field,i)}));const t=n.endAt?new Ks(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ks(n.startAt.position,n.startAt.inclusive):null;return Nl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ro(n,e){const t=n.filters.concat([e]);return new $n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Gs(n,e,t){return new $n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ui(n,e){return sa(Ze(n),Ze(e))&&n.limitType===e.limitType}function Bh(n){return`${ra(Ze(n))}|lt:${n.limitType}`}function vn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>xh(s))).join(", ")}]`),ci(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Dn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Dn(s))).join(",")),`Target(${r})`})(Ze(n))}; limitType=${n.limitType})`}function hi(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):B.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of yr(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const h=Pl(a,l,u);return a.inclusive?h<=0:h<0})(r.startAt,yr(r),s)||r.endAt&&!(function(a,l,u){const h=Pl(a,l,u);return a.inclusive?h>=0:h>0})(r.endAt,yr(r),s))})(n,e)}function L_(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $h(n){return(e,t)=>{let r=!1;for(const s of yr(n)){const i=x_(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function x_(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),h=l.data.field(i);return u!==null&&h!==null?Nn(u,h):q(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return q(19790,{direction:n.dir})}}class hn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){zt(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return Ah(this.inner)}size(){return this.innerSize}}const U_=new ce(B.comparator);function pt(){return U_}const qh=new ce(B.comparator);function hr(...n){let e=qh;for(const t of n)e=e.insert(t.key,t);return e}function jh(n){let e=qh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function en(){return _r()}function zh(){return _r()}function _r(){return new hn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const F_=new ce(B.comparator),B_=new _e(B.comparator);function Q(...n){let e=B_;for(const t of n)e=e.add(t);return e}const $_=new _e(G);function q_(){return $_}function oa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function Hh(n){return{integerValue:""+n}}function Wh(n,e){return g_(e)?Hh(e):oa(n,e)}class di{constructor(){this._=void 0}}function j_(n,e,t){return n instanceof Dr?(function(s,i){const a={fields:{[Rh]:{stringValue:Sh},[Ph]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&ta(i)&&(i=li(i)),i&&(a.fields[Ch]=i),{mapValue:a}})(t,e):n instanceof Vr?Gh(n,e):n instanceof Or?Qh(n,e):(function(s,i){const a=Kh(s,i),l=Vl(a)+Vl(s.Ae);return Ao(a)&&Ao(s.Ae)?Hh(l):oa(s.serializer,l)})(n,e)}function z_(n,e,t){return n instanceof Vr?Gh(n,e):n instanceof Or?Qh(n,e):t}function Kh(n,e){return n instanceof Mr?(function(r){return Ao(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class Dr extends di{}class Vr extends di{constructor(e){super(),this.elements=e}}function Gh(n,e){const t=Xh(e);for(const r of n.elements)t.some((s=>rt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Or extends di{constructor(e){super(),this.elements=e}}function Qh(n,e){let t=Xh(e);for(const r of n.elements)t=t.filter((s=>!rt(s,r)));return{arrayValue:{values:t}}}class Mr extends di{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Vl(n){return ue(n.integerValue||n.doubleValue)}function Xh(n){return na(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Yh{constructor(e,t){this.field=e,this.transform=t}}function H_(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Vr&&s instanceof Vr||r instanceof Or&&s instanceof Or?kn(r.elements,s.elements,rt):r instanceof Mr&&s instanceof Mr?rt(r.Ae,s.Ae):r instanceof Dr&&s instanceof Dr})(n.transform,e.transform)}class W_{constructor(e,t){this.version=e,this.transformResults=t}}class Me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Me}static exists(e){return new Me(void 0,e)}static updateTime(e){return new Me(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ks(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class fi{}function Jh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new pi(n.key,Me.none()):new Wr(n.key,n.data,Me.none());{const t=n.data,r=Oe.empty();let s=new _e(we.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Ht(n.key,r,new Be(s.toArray()),Me.none())}}function K_(n,e,t){n instanceof Wr?(function(s,i,a){const l=s.value.clone(),u=Ml(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Ht?(function(s,i,a){if(!ks(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=Ml(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Zh(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function vr(n,e,t,r){return n instanceof Wr?(function(i,a,l,u){if(!ks(i.precondition,a))return l;const h=i.value.clone(),f=Ll(i.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Ht?(function(i,a,l,u){if(!ks(i.precondition,a))return l;const h=Ll(i.fieldTransforms,u,a),f=a.data;return f.setAll(Zh(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,l){return ks(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function G_(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Kh(r.transform,s||null);i!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,i))}return t||null}function Ol(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&kn(r,s,((i,a)=>H_(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Wr extends fi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ht extends fi{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Zh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Ml(n,e,t){const r=new Map;Z(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,z_(a,l,t[s]))}return r}function Ll(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,j_(i,a,e))}return r}class pi extends fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Q_ extends fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class X_{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&K_(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=zh();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Jh(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(j.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Q())}isEqual(e){return this.batchId===e.batchId&&kn(this.mutations,e.mutations,((t,r)=>Ol(t,r)))&&kn(this.baseMutations,e.baseMutations,((t,r)=>Ol(t,r)))}}class aa{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Z(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return F_})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new aa(e,t,r,s)}}class Y_{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class J_{constructor(e,t){this.count=e,this.unchangedNames=t}}var fe,X;function Z_(n){switch(n){case k.OK:return q(64938);case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return q(15467,{code:n})}}function ed(n){if(n===void 0)return ft("GRPC error has no .code"),k.UNKNOWN;switch(n){case fe.OK:return k.OK;case fe.CANCELLED:return k.CANCELLED;case fe.UNKNOWN:return k.UNKNOWN;case fe.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case fe.INTERNAL:return k.INTERNAL;case fe.UNAVAILABLE:return k.UNAVAILABLE;case fe.UNAUTHENTICATED:return k.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case fe.NOT_FOUND:return k.NOT_FOUND;case fe.ALREADY_EXISTS:return k.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return k.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case fe.ABORTED:return k.ABORTED;case fe.OUT_OF_RANGE:return k.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return k.UNIMPLEMENTED;case fe.DATA_LOSS:return k.DATA_LOSS;default:return q(39323,{code:n})}}(X=fe||(fe={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function ev(){return new TextEncoder}const tv=new Lt([4294967295,4294967295],0);function xl(n){const e=ev().encode(n),t=new fh;return t.update(e),new Uint8Array(t.digest())}function Ul(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Lt([t,r],0),new Lt([s,i],0)]}class ca{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new dr(`Invalid padding: ${t}`);if(r<0)throw new dr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new dr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new dr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Lt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Lt.fromNumber(r)));return s.compare(tv)===1&&(s=new Lt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=xl(e),[r,s]=Ul(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new ca(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=xl(e),[r,s]=Ul(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class dr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class mi{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Kr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new mi(j.min(),s,new ce(G),pt(),Q())}}class Kr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Kr(r,t,Q(),Q(),Q())}}class Ns{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class td{constructor(e,t){this.targetId=e,this.Ce=t}}class nd{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Fl{constructor(){this.ve=0,this.Fe=Bl(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Q(),t=Q(),r=Q();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:q(38017,{changeType:i})}})),new Kr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Bl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Z(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class nv{constructor(e){this.Ge=e,this.ze=new Map,this.je=pt(),this.Je=vs(),this.He=vs(),this.Ye=new ce(G)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(So(i))if(r===0){const a=new B(i.path);this.et(t,a,Ce.newNoDocument(a,j.min()))}else Z(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=Bt(r).toUint8Array()}catch(u){if(u instanceof bh)return Pn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new ca(a,s,i)}catch(u){return Pn(u instanceof dr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&So(l.target)){const u=new B(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Ce.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=Q();this.He.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new mi(e,t,this.Ye,this.je,r);return this.je=pt(),this.Je=vs(),this.He=vs(),this.Ye=new ce(G),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Fl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new _e(G),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new _e(G),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Fl),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function vs(){return new ce(B.comparator)}function Bl(){return new ce(B.comparator)}const rv={asc:"ASCENDING",desc:"DESCENDING"},sv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iv={and:"AND",or:"OR"};class ov{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Co(n,e){return n.useProto3Json||ci(e)?e:{value:e}}function Qs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function rd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function av(n,e){return Qs(n,e.toTimestamp())}function et(n){return Z(!!n,49232),j.fromTimestamp((function(t){const r=Ft(t);return new ie(r.seconds,r.nanos)})(n))}function la(n,e){return Po(n,e).canonicalString()}function Po(n,e){const t=(function(s){return new re(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function sd(n){const e=re.fromString(n);return Z(ld(e),10190,{key:e.toString()}),e}function ko(n,e){return la(n.databaseId,e.path)}function so(n,e){const t=sd(e);if(t.get(1)!==n.databaseId.projectId)throw new L(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(od(t))}function id(n,e){return la(n.databaseId,e)}function cv(n){const e=sd(n);return e.length===4?re.emptyPath():od(e)}function No(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function od(n){return Z(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function $l(n,e,t){return{name:ko(n,e),fields:t.value.mapValue.fields}}function lv(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:q(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(h,f){return h.useProto3Json?(Z(f===void 0||typeof f=="string",58123),Ie.fromBase64String(f||"")):(Z(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ie.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(h){const f=h.code===void 0?k.UNKNOWN:ed(h.code);return new L(f,h.message||"")})(a);t=new nd(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=so(n,r.document.name),i=et(r.document.updateTime),a=r.document.createTime?et(r.document.createTime):j.min(),l=new Oe({mapValue:{fields:r.document.fields}}),u=Ce.newFoundDocument(s,i,a,l),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Ns(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=so(n,r.document),i=r.readTime?et(r.readTime):j.min(),a=Ce.newNoDocument(s,i),l=r.removedTargetIds||[];t=new Ns([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=so(n,r.document),i=r.removedTargetIds||[];t=new Ns([],i,s,null)}else{if(!("filter"in e))return q(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new J_(s,i),l=r.targetId;t=new td(l,a)}}return t}function uv(n,e){let t;if(e instanceof Wr)t={update:$l(n,e.key,e.value)};else if(e instanceof pi)t={delete:ko(n,e.key)};else if(e instanceof Ht)t={update:$l(n,e.key,e.data),updateMask:vv(e.fieldMask)};else{if(!(e instanceof Q_))return q(16599,{Vt:e.type});t={verify:ko(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof Dr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Vr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Or)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Mr)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw q(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:av(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:q(27497)})(n,e.precondition)),t}function hv(n,e){return n&&n.length>0?(Z(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?et(s.updateTime):et(i);return a.isEqual(j.min())&&(a=et(i)),new W_(a,s.transformResults||[])})(t,e)))):[]}function dv(n,e){return{documents:[id(n,e.path)]}}function fv(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=id(n,s);const i=(function(h){if(h.length!==0)return cd(Ke.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(h){if(h.length!==0)return h.map((f=>(function(y){return{field:En(y.field),direction:gv(y.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Co(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:s}}function pv(n){let e=cv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Z(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const y=ad(m);return y instanceof Ke&&Mh(y)?y.getFilters():[y]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((y=>(function(S){return new Nr(Tn(S.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(y)))})(t.orderBy));let l=null;t.limit&&(l=(function(m){let y;return y=typeof m=="object"?m.value:m,ci(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(m){const y=!!m.before,g=m.values||[];return new Ks(g,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){const y=!m.before,g=m.values||[];return new Ks(g,y)})(t.endAt)),O_(e,s,a,i,l,"F",u,h)}function mv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ad(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Tn(t.unaryFilter.field);return pe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Tn(t.unaryFilter.field);return pe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Tn(t.unaryFilter.field);return pe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Tn(t.unaryFilter.field);return pe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}})(n):n.fieldFilter!==void 0?(function(t){return pe.create(Tn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ke.create(t.compositeFilter.filters.map((r=>ad(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return q(1026)}})(t.compositeFilter.op))})(n):q(30097,{filter:n})}function gv(n){return rv[n]}function yv(n){return sv[n]}function _v(n){return iv[n]}function En(n){return{fieldPath:n.canonicalString()}}function Tn(n){return we.fromServerFormat(n.fieldPath)}function cd(n){return n instanceof pe?(function(t){if(t.op==="=="){if(Cl(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NAN"}};if(Rl(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Cl(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NOT_NAN"}};if(Rl(t.value))return{unaryFilter:{field:En(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:En(t.field),op:yv(t.op),value:t.value}}})(n):n instanceof Ke?(function(t){const r=t.getFilters().map((s=>cd(s)));return r.length===1?r[0]:{compositeFilter:{op:_v(t.op),filters:r}}})(n):q(54877,{filter:n})}function vv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ld(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Dt{constructor(e,t,r,s,i=j.min(),a=j.min(),l=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Dt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Dt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Dt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Dt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ev{constructor(e){this.yt=e}}function Tv(n){const e=pv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Gs(e,e.limit,"L"):e}class wv{constructor(){this.Cn=new Iv}addToCollectionParentIndex(e,t){return this.Cn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Ut.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Ut.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class Iv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new _e(re.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new _e(re.comparator)).toArray()}}const ql={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ud=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(ud,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class Vn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Vn(0)}static cr(){return new Vn(-1)}}const jl="LruGarbageCollector",Av=1048576;function zl([n,e],[t,r]){const s=G(n,t);return s===0?G(e,r):s}class bv{constructor(e){this.Ir=e,this.buffer=new _e(zl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();zl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Sv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){x(jl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bn(t)?x(jl,"Ignoring IndexedDB error during garbage collection: ",t):await Fn(t)}await this.Vr(3e5)}))}}class Rv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return D.resolve(ai.ce);const r=new bv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(ql)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ql):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,l,u,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,l=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(h=Date.now(),_n()<=K.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function Cv(n,e){return new Rv(n,e)}class Pv{constructor(){this.changes=new hn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class kv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Nv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&vr(r.mutation,s,Be.empty(),ie.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,Q()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=Q()){const s=en();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=hr();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=en();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,Q())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=pt();const a=_r(),l=(function(){return _r()})();return t.forEach(((u,h)=>{const f=r.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof Ht)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),vr(f.mutation,h,f.mutation.getFieldMask(),ie.now())):a.set(h.key,Be.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((h,f)=>a.set(h,f))),t.forEach(((h,f)=>l.set(h,new kv(f,a.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=_r();let s=new ce(((a,l)=>a-l)),i=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let f=r.get(u)||Be.empty();f=l.applyToLocalView(h,f),r.set(u,f);const m=(s.get(l.batchId)||Q()).add(u);s=s.insert(l.batchId,m)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,f=u.value,m=zh();f.forEach((y=>{if(!i.has(y)){const g=Jh(t.get(y),r.get(y));g!==null&&m.set(y,g),i=i.add(y)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return D.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Fh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):D.resolve(en());let l=Rr,u=i;return a.next((h=>D.forEach(h,((f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?D.resolve():this.remoteDocumentCache.getEntry(e,f).next((y=>{u=u.insert(f,y)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,u,h,Q()))).next((f=>({batchId:l,changes:jh(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=hr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=hr();return this.indexManager.getCollectionParents(e,i).next((l=>D.forEach(l,(u=>{const h=(function(m,y){return new $n(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next((f=>{f.forEach(((m,y)=>{a=a.insert(m,y)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Ce.newInvalidDocument(f)))}));let l=hr();return a.forEach(((u,h)=>{const f=i.get(u);f!==void 0&&vr(f.mutation,h,Be.empty(),ie.now()),hi(t,h)&&(l=l.insert(u,h))})),l}))}}class Dv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return D.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:et(s.createTime)}})(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Tv(s.bundledQuery),readTime:et(s.readTime)}})(t)),D.resolve()}}class Vv{constructor(){this.overlays=new ce(B.comparator),this.qr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const r=en();return D.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),D.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){const s=en(),i=t.length+1,a=new B(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return D.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ce(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=i.get(h.largestBatchId);f===null&&(f=en(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=en(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=s)););return D.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Y_(t,r));let i=this.qr.get(t);i===void 0&&(i=Q(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class Ov{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}class ua{constructor(){this.Qr=new _e(Ee.$r),this.Ur=new _e(Ee.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Ee(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Ee(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new re([])),r=new Ee(t,e),s=new Ee(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new re([])),r=new Ee(t,e),s=new Ee(t,e+1);let i=Q();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new Ee(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ee{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||G(e.Yr,t.Yr)}static Kr(e,t){return G(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class Mv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new _e(Ee.$r)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new X_(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new Ee(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return D.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?ea:this.tr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ee(t,0),s=new Ee(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);i.push(l)})),D.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new _e(G);return t.forEach((s=>{const i=new Ee(s,0),a=new Ee(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(l=>{r=r.add(l.Yr)}))})),D.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;B.isDocumentKey(i)||(i=i.child(""));const a=new Ee(new B(i),0);let l=new _e(G);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(l=l.add(u.Yr)),!0)}),a),D.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Z(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return D.forEach(t.mutations,(s=>{const i=new Ee(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Ee(t,0),s=this.Zr.firstAfterOrEqual(r);return D.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Lv{constructor(e){this.ri=e,this.docs=(function(){return new ce(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():Ce.newInvalidDocument(t))}getEntries(e,t){let r=pt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ce.newInvalidDocument(s))})),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=pt();const a=t.path,l=new B(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||d_(h_(f),r)<=0||(s.has(f.key)||hi(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return D.resolve(i)}getAllFromCollectionGroup(e,t,r,s){q(9500)}ii(e,t){return D.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new xv(this)}getSize(e){return D.resolve(this.size)}}class xv extends Pv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),D.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Uv{constructor(e){this.persistence=e,this.si=new hn((t=>ra(t)),sa),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.oi=0,this._i=new ua,this.targetCount=0,this.ai=Vn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),D.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Vn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Pr(t),D.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),D.waitFor(i).next((()=>s))}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),D.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),D.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this._i.containsKey(t))}}class hd{constructor(e,t){this.ui={},this.overlays={},this.ci=new ai(0),this.li=!1,this.li=!0,this.hi=new Ov,this.referenceDelegate=e(this),this.Pi=new Uv(this),this.indexManager=new wv,this.remoteDocumentCache=(function(s){return new Lv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Ev(t),this.Ii=new Dv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Vv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Mv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new Fv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return D.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Fv extends p_{constructor(e){super(),this.currentSequenceNumber=e}}class ha{constructor(e){this.persistence=e,this.Ri=new ua,this.Vi=null}static mi(e){return new ha(e)}get fi(){if(this.Vi)return this.Vi;throw q(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,j.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Xs{constructor(e,t){this.persistence=e,this.pi=new hn((r=>y_(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Cv(this,t)}static mi(e,t){return new Xs(e,t)}Ei(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return D.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?D.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,i.removeEntry(a,j.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),D.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Cs(e.data.value)),t}br(e,t,r){return D.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return D.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class da{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Q(),s=Q();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new da(e,t.fromCache,r,s)}}class Bv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class $v{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return pp()?8:m_(Pe())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new Bv;return this.Ss(e,t,a).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(_n()<=K.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",vn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),D.resolve()):(_n()<=K.DEBUG&&x("QueryEngine","Query:",vn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(_n()<=K.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",vn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):D.resolve())}ys(e,t){if(Dl(t))return D.resolve(null);let r=Ze(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Gs(t,null,"F"),r=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=Q(...i);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const h=this.Ds(t,l);return this.Cs(t,h,a,u.readTime)?this.ys(e,Gs(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,r,s){return Dl(t)||s.isEqual(j.min())?D.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?D.resolve(null):(_n()<=K.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),vn(t)),this.vs(e,a,t,u_(s,Rr)).next((l=>l)))}))}Ds(e,t){let r=new _e($h(e));return t.forEach(((s,i)=>{hi(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return _n()<=K.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",vn(t)),this.ps.getDocumentsMatchingQuery(e,t,Ut.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const fa="LocalStore",qv=3e8;class jv{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ce(G),this.xs=new hn((i=>ra(i)),sa),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function zv(n,e,t,r){return new jv(n,e,t,r)}async function dd(n,e){const t=z(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=Q();for(const h of s){a.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of i){l.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:l})))}))}))}function Hv(n,e){const t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,h,f){const m=h.batch,y=m.keys();let g=D.resolve();return y.forEach((S=>{g=g.next((()=>f.getEntry(u,S))).next((C=>{const P=h.docVersions.get(S);Z(P!==null,48541),C.version.compareTo(P)<0&&(m.applyToRemoteDocument(C,h),C.isValidDocument()&&(C.setReadTime(h.commitVersion),f.addEntry(C)))}))})),g.next((()=>l.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=Q();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function fd(n){const e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Wv(n,e){const t=z(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((f,m)=>{const y=s.get(m);if(!y)return;l.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(i,f.addedDocuments,m))));let g=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?g=g.withResumeToken(Ie.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(f.resumeToken,r)),s=s.insert(m,g),(function(C,P,M){return C.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=qv?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(y,g,f)&&l.push(t.Pi.updateTargetData(i,g))}));let u=pt(),h=Q();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(Kv(i,a,e.documentUpdates).next((f=>{u=f.ks,h=f.qs}))),!r.isEqual(j.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next((m=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return D.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,h))).next((()=>u))})).then((i=>(t.Ms=s,i)))}function Kv(n,e,t){let r=Q(),s=Q();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=pt();return t.forEach(((l,u)=>{const h=i.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(j.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):x(fa,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function Gv(n,e){const t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=ea),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Qv(n,e){const t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,D.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new Dt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Do(n,e,t){const r=z(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Bn(a))throw a;x(fa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Hl(n,e,t){const r=z(n);let s=j.min(),i=Q();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,h,f){const m=z(u),y=m.xs.get(f);return y!==void 0?D.resolve(m.Ms.get(y)):m.Pi.getTargetData(h,f)})(r,a,Ze(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:j.min(),t?i:Q()))).next((l=>(Xv(r,L_(e),l),{documents:l,Qs:i})))))}function Xv(n,e,t){let r=n.Os.get(e)||j.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class Wl{constructor(){this.activeTargetIds=q_()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Yv{constructor(){this.Mo=new Wl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Wl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Jv{Oo(e){}shutdown(){}}const Kl="ConnectivityMonitor";class Gl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){x(Kl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){x(Kl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Es=null;function Vo(){return Es===null?Es=(function(){return 268435456+Math.round(2147483648*Math.random())})():Es++,"0x"+Es.toString(16)}const io="RestConnection",Zv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Hs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Vo(),l=this.zo(e,t.toUriEncodedString());x(io,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:h}=new URL(l),f=Mn(h);return this.Jo(e,l,u,r,f).then((m=>(x(io,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw Pn(io,`RPC '${e}' ${a} failed with error: `,m,"url: ",l,"request:",r),m}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Un})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=Zv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class tE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Se="WebChannelConnection";class nE extends eE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Vo();return new Promise(((l,u)=>{const h=new ph;h.setWithCredentials(!0),h.listenOnce(mh.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Rs.NO_ERROR:const m=h.getResponseJson();x(Se,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),l(m);break;case Rs.TIMEOUT:x(Se,`RPC '${e}' ${a} timed out`),u(new L(k.DEADLINE_EXCEEDED,"Request time out"));break;case Rs.HTTP_ERROR:const y=h.getStatus();if(x(Se,`RPC '${e}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let g=h.getResponseJson();Array.isArray(g)&&(g=g[0]);const S=g?.error;if(S&&S.status&&S.message){const C=(function(M){const N=M.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(N)>=0?N:k.UNKNOWN})(S.status);u(new L(C,S.message))}else u(new L(k.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new L(k.UNAVAILABLE,"Connection failed."));break;default:q(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{x(Se,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);x(Se,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Vo(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=_h(),l=yh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=i.join("");x(Se,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let y=!1,g=!1;const S=new tE({Yo:P=>{g?x(Se,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(y||(x(Se,`Opening RPC '${e}' stream ${s} transport.`),m.open(),y=!0),x(Se,`RPC '${e}' stream ${s} sending:`,P),m.send(P))},Zo:()=>m.close()}),C=(P,M,N)=>{P.listen(M,(V=>{try{N(V)}catch(U){setTimeout((()=>{throw U}),0)}}))};return C(m,ur.EventType.OPEN,(()=>{g||(x(Se,`RPC '${e}' stream ${s} transport opened.`),S.o_())})),C(m,ur.EventType.CLOSE,(()=>{g||(g=!0,x(Se,`RPC '${e}' stream ${s} transport closed`),S.a_(),this.E_(m))})),C(m,ur.EventType.ERROR,(P=>{g||(g=!0,Pn(Se,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),S.a_(new L(k.UNAVAILABLE,"The operation could not be completed")))})),C(m,ur.EventType.MESSAGE,(P=>{if(!g){const M=P.data[0];Z(!!M,16349);const N=M,V=N?.error||N[0]?.error;if(V){x(Se,`RPC '${e}' stream ${s} received error:`,V);const U=V.status;let W=(function(_){const E=fe[_];if(E!==void 0)return ed(E)})(U),F=V.message;W===void 0&&(W=k.INTERNAL,F="Unknown error status: "+U+" with message "+V.message),g=!0,S.a_(new L(W,F)),m.close()}else x(Se,`RPC '${e}' stream ${s} received:`,M),S.u_(M)}})),C(l,gh.STAT_EVENT,(P=>{P.stat===To.PROXY?x(Se,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===To.NOPROXY&&x(Se,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{S.__()}),0),S}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function oo(){return typeof document<"u"?document:null}function gi(n){return new ov(n,!0)}class pd{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ql="PersistentStream";class md{constructor(e,t,r,s,i,a,l,u){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new pd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(ft(t.toString()),ft("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new L(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(Ql,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(x(Ql,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class rE extends md{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=lv(this.serializer,e),r=(function(i){if(!("targetChange"in i))return j.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?et(a.readTime):j.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=No(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=So(u)?{documents:dv(i,u)}:{query:fv(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=rd(i,a.resumeToken);const h=Co(i,a.expectedCount);h!==null&&(l.expectedCount=h)}else if(a.snapshotVersion.compareTo(j.min())>0){l.readTime=Qs(i,a.snapshotVersion.toTimestamp());const h=Co(i,a.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const r=mv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=No(this.serializer),t.removeTarget=e,this.q_(t)}}class sE extends md{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Z(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Z(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Z(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=hv(e.writeResults,e.commitTime),r=et(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=No(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>uv(this.serializer,r)))};this.q_(t)}}class iE{}class oE extends iE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,Po(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new L(k.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,Po(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new L(k.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class aE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ft(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const cn="RemoteStore";class cE{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{dn(this)&&(x(cn,"Restarting streams for network reachability change."),await(async function(u){const h=z(u);h.Ea.add(4),await Gr(h),h.Ra.set("Unknown"),h.Ea.delete(4),await yi(h)})(this))}))})),this.Ra=new aE(r,s)}}async function yi(n){if(dn(n))for(const e of n.da)await e(!0)}async function Gr(n){for(const e of n.da)await e(!1)}function gd(n,e){const t=z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ya(t)?ga(t):qn(t).O_()&&ma(t,e))}function pa(n,e){const t=z(n),r=qn(t);t.Ia.delete(e),r.O_()&&yd(t,e),t.Ia.size===0&&(r.O_()?r.L_():dn(t)&&t.Ra.set("Unknown"))}function ma(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qn(n).Y_(e)}function yd(n,e){n.Va.Ue(e),qn(n).Z_(e)}function ga(n){n.Va=new nv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),qn(n).start(),n.Ra.ua()}function ya(n){return dn(n)&&!qn(n).x_()&&n.Ia.size>0}function dn(n){return z(n).Ea.size===0}function _d(n){n.Va=void 0}async function lE(n){n.Ra.set("Online")}async function uE(n){n.Ia.forEach(((e,t)=>{ma(n,e)}))}async function hE(n,e){_d(n),ya(n)?(n.Ra.ha(e),ga(n)):n.Ra.set("Unknown")}async function dE(n,e,t){if(n.Ra.set("Online"),e instanceof nd&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){x(cn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ys(n,r)}else if(e instanceof Ns?n.Va.Ze(e):e instanceof td?n.Va.st(e):n.Va.tt(e),!t.isEqual(j.min()))try{const r=await fd(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,h)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),yd(i,u);const m=new Dt(f.target,u,h,f.sequenceNumber);ma(i,m)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){x(cn,"Failed to raise snapshot:",r),await Ys(n,r)}}async function Ys(n,e,t){if(!Bn(e))throw e;n.Ea.add(1),await Gr(n),n.Ra.set("Offline"),t||(t=()=>fd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(cn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await yi(n)}))}function vd(n,e){return e().catch((t=>Ys(n,t,e)))}async function _i(n){const e=z(n),t=qt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ea;for(;fE(e);)try{const s=await Gv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,pE(e,s)}catch(s){await Ys(e,s)}Ed(e)&&Td(e)}function fE(n){return dn(n)&&n.Ta.length<10}function pE(n,e){n.Ta.push(e);const t=qt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function Ed(n){return dn(n)&&!qt(n).x_()&&n.Ta.length>0}function Td(n){qt(n).start()}async function mE(n){qt(n).ra()}async function gE(n){const e=qt(n);for(const t of n.Ta)e.ea(t.mutations)}async function yE(n,e,t){const r=n.Ta.shift(),s=aa.from(r,e,t);await vd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await _i(n)}async function _E(n,e){e&&qt(n).X_&&await(async function(r,s){if((function(a){return Z_(a)&&a!==k.ABORTED})(s.code)){const i=r.Ta.shift();qt(r).B_(),await vd(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await _i(r)}})(n,e),Ed(n)&&Td(n)}async function Xl(n,e){const t=z(n);t.asyncQueue.verifyOperationInProgress(),x(cn,"RemoteStore received new credentials");const r=dn(t);t.Ea.add(3),await Gr(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await yi(t)}async function vE(n,e){const t=z(n);e?(t.Ea.delete(2),await yi(t)):e||(t.Ea.add(2),await Gr(t),t.Ra.set("Unknown"))}function qn(n){return n.ma||(n.ma=(function(t,r,s){const i=z(t);return i.sa(),new rE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:lE.bind(null,n),t_:uE.bind(null,n),r_:hE.bind(null,n),H_:dE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ya(n)?ga(n):n.Ra.set("Unknown")):(await n.ma.stop(),_d(n))}))),n.ma}function qt(n){return n.fa||(n.fa=(function(t,r,s){const i=z(t);return i.sa(),new sE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:mE.bind(null,n),r_:_E.bind(null,n),ta:gE.bind(null,n),na:yE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await _i(n)):(await n.fa.stop(),n.Ta.length>0&&(x(cn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class _a{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ut,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new _a(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function va(n,e){if(ft("AsyncQueue",`${e}: ${n}`),Bn(n))return new L(k.UNAVAILABLE,`${e}: ${n}`);throw n}class Sn{static emptySet(e){return new Sn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=hr(),this.sortedSet=new ce(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Sn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Yl{constructor(){this.ga=new ce(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):q(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class On{constructor(e,t,r,s,i,a,l,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new On(e,t,Sn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ui(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class EE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class TE{constructor(){this.queries=Jl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=z(t),i=s.queries;s.queries=Jl(),i.forEach(((a,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new L(k.ABORTED,"Firestore shutting down"))}}function Jl(){return new hn((n=>Bh(n)),ui)}async function wd(n,e){const t=z(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new EE,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=va(a,`Initialization of query '${vn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Ea(t)}async function Id(n,e){const t=z(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function wE(n,e){const t=z(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Ea(t)}function IE(n,e,t){const r=z(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Ea(n){n.Ca.forEach((e=>{e.next()}))}var Oo,Zl;(Zl=Oo||(Oo={})).Ma="default",Zl.Cache="cache";class Ad{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new On(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=On.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Oo.Cache}}class bd{constructor(e){this.key=e}}class Sd{constructor(e){this.key=e}}class AE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Q(),this.mutatedKeys=Q(),this.eu=$h(e),this.tu=new Sn(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Yl,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const y=s.get(f),g=hi(this.query,m)?m:null,S=!!y&&this.mutatedKeys.has(y.key),C=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let P=!1;y&&g?y.data.isEqual(g.data)?S!==C&&(r.track({type:3,doc:g}),P=!0):this.su(y,g)||(r.track({type:2,doc:g}),P=!0,(u&&this.eu(g,u)>0||h&&this.eu(g,h)<0)&&(l=!0)):!y&&g?(r.track({type:0,doc:g}),P=!0):y&&!g&&(r.track({type:1,doc:y}),P=!0,(u||h)&&(l=!0)),P&&(g?(a=a.add(g),i=C?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(g,S){const C=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{Rt:P})}};return C(g)-C(S)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,h=u!==this.Za;return this.Za=u,a.length!==0||h?{snapshot:new On(this.query,e.tu,i,a,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Yl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Q(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Sd(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new bd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=Q();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return On.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ta="SyncEngine";class bE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class SE{constructor(e){this.key=e,this.hu=!1}}class RE{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new hn((l=>Bh(l)),ui),this.Iu=new Map,this.Eu=new Set,this.du=new ce(B.comparator),this.Au=new Map,this.Ru=new ua,this.Vu={},this.mu=new Map,this.fu=Vn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function CE(n,e,t=!0){const r=Dd(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Rd(r,e,t,!0),s}async function PE(n,e){const t=Dd(n);await Rd(t,e,!0,!1)}async function Rd(n,e,t,r){const s=await Qv(n.localStore,Ze(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await kE(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&gd(n.remoteStore,s),l}async function kE(n,e,t,r,s){n.pu=(m,y,g)=>(async function(C,P,M,N){let V=P.view.ru(M);V.Cs&&(V=await Hl(C.localStore,P.query,!1).then((({documents:T})=>P.view.ru(T,V))));const U=N&&N.targetChanges.get(P.targetId),W=N&&N.targetMismatches.get(P.targetId)!=null,F=P.view.applyChanges(V,C.isPrimaryClient,U,W);return tu(C,P.targetId,F.au),F.snapshot})(n,m,y,g);const i=await Hl(n.localStore,e,!0),a=new AE(e,i.Qs),l=a.ru(i.documents),u=Kr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(l,n.isPrimaryClient,u);tu(n,t,h.au);const f=new bE(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function NE(n,e,t){const r=z(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!ui(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Do(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&pa(r.remoteStore,s.targetId),Mo(r,s.targetId)})).catch(Fn)):(Mo(r,s.targetId),await Do(r.localStore,s.targetId,!0))}async function DE(n,e){const t=z(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),pa(t.remoteStore,r.targetId))}async function VE(n,e,t){const r=BE(n);try{const s=await(function(a,l){const u=z(a),h=ie.now(),f=l.reduce(((g,S)=>g.add(S.key)),Q());let m,y;return u.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let S=pt(),C=Q();return u.Ns.getEntries(g,f).next((P=>{S=P,S.forEach(((M,N)=>{N.isValidDocument()||(C=C.add(M))}))})).next((()=>u.localDocuments.getOverlayedDocuments(g,S))).next((P=>{m=P;const M=[];for(const N of l){const V=G_(N,m.get(N.key).overlayedDocument);V!=null&&M.push(new Ht(N.key,V,Dh(V.value.mapValue),Me.exists(!0)))}return u.mutationQueue.addMutationBatch(g,h,M,l)})).next((P=>{y=P;const M=P.applyToLocalDocumentSet(m,C);return u.documentOverlayCache.saveOverlays(g,P.batchId,M)}))})).then((()=>({batchId:y.batchId,changes:jh(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let h=a.Vu[a.currentUser.toKey()];h||(h=new ce(G)),h=h.insert(l,u),a.Vu[a.currentUser.toKey()]=h})(r,s.batchId,t),await Qr(r,s.changes),await _i(r.remoteStore)}catch(s){const i=va(s,"Failed to persist write");t.reject(i)}}async function Cd(n,e){const t=z(n);try{const r=await Wv(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(Z(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Z(a.hu,14607):s.removedDocuments.size>0&&(Z(a.hu,42227),a.hu=!1))})),await Qr(t,r,e)}catch(r){await Fn(r)}}function eu(n,e,t){const r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=z(a);u.onlineState=l;let h=!1;u.queries.forEach(((f,m)=>{for(const y of m.Sa)y.va(l)&&(h=!0)})),h&&Ea(u)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function OE(n,e,t){const r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new ce(B.comparator);a=a.insert(i,Ce.newNoDocument(i,j.min()));const l=Q().add(i),u=new mi(j.min(),new Map,new ce(G),a,l);await Cd(r,u),r.du=r.du.remove(i),r.Au.delete(e),wa(r)}else await Do(r.localStore,e,!1).then((()=>Mo(r,e,t))).catch(Fn)}async function ME(n,e){const t=z(n),r=e.batch.batchId;try{const s=await Hv(t.localStore,e);kd(t,r,null),Pd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Qr(t,s)}catch(s){await Fn(s)}}async function LE(n,e,t){const r=z(n);try{const s=await(function(a,l){const u=z(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return u.mutationQueue.lookupMutationBatch(h,l).next((m=>(Z(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>u.localDocuments.getDocuments(h,f)))}))})(r.localStore,e);kd(r,e,t),Pd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Qr(r,s)}catch(s){await Fn(s)}}function Pd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function kd(n,e,t){const r=z(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Mo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||Nd(n,r)}))}function Nd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(pa(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),wa(n))}function tu(n,e,t){for(const r of t)r instanceof bd?(n.Ru.addReference(r.key,e),xE(n,r)):r instanceof Sd?(x(Ta,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||Nd(n,r.key)):q(19791,{wu:r})}function xE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(x(Ta,"New document in limbo: "+t),n.Eu.add(r),wa(n))}function wa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(re.fromString(e)),r=n.fu.next();n.Au.set(r,new SE(t)),n.du=n.du.insert(t,r),gd(n.remoteStore,new Dt(Ze(ia(t.path)),r,"TargetPurposeLimboResolution",ai.ce))}}async function Qr(n,e,t){const r=z(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){s.push(h);const f=da.As(u.targetId,h);i.push(f)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(u,h){const f=z(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>D.forEach(h,(y=>D.forEach(y.Es,(g=>f.persistence.referenceDelegate.addReference(m,y.targetId,g))).next((()=>D.forEach(y.ds,(g=>f.persistence.referenceDelegate.removeReference(m,y.targetId,g)))))))))}catch(m){if(!Bn(m))throw m;x(fa,"Failed to update sequence numbers: "+m)}for(const m of h){const y=m.targetId;if(!m.fromCache){const g=f.Ms.get(y),S=g.snapshotVersion,C=g.withLastLimboFreeSnapshotVersion(S);f.Ms=f.Ms.insert(y,C)}}})(r.localStore,i))}async function UE(n,e){const t=z(n);if(!t.currentUser.isEqual(e)){x(Ta,"User change. New user:",e.toKey());const r=await dd(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new L(k.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Qr(t,r.Ls)}}function FE(n,e){const t=z(n),r=t.Au.get(e);if(r&&r.hu)return Q().add(r.key);{let s=Q();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Dd(n){const e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Cd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=FE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OE.bind(null,e),e.Pu.H_=wE.bind(null,e.eventManager),e.Pu.yu=IE.bind(null,e.eventManager),e}function BE(n){const e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ME.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=LE.bind(null,e),e}class Js{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=gi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return zv(this.persistence,new $v,e.initialUser,this.serializer)}Cu(e){return new hd(ha.mi,this.serializer)}Du(e){return new Yv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Js.provider={build:()=>new Js};class $E extends Js{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Z(this.persistence.referenceDelegate instanceof Xs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Sv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new hd((r=>Xs.mi(r,t)),this.serializer)}}class Lo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>eu(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=UE.bind(null,this.syncEngine),await vE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new TE})()}createDatastore(e){const t=gi(e.databaseInfo.databaseId),r=(function(i){return new nE(i)})(e.databaseInfo);return(function(i,a,l,u){return new oE(i,a,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new cE(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>eu(this.syncEngine,t,0)),(function(){return Gl.v()?new Gl:new Jv})())}createSyncEngine(e,t){return(function(s,i,a,l,u,h,f){const m=new RE(s,i,a,l,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=z(t);x(cn,"RemoteStore shutting down."),r.Ea.add(5),await Gr(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Lo.provider={build:()=>new Lo};class Vd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ft("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const jt="FirestoreClient";class qE{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Re.UNAUTHENTICATED,this.clientId=Zo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{x(jt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(x(jt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ut;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=va(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function ao(n,e){n.asyncQueue.verifyOperationInProgress(),x(jt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await dd(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function nu(n,e){n.asyncQueue.verifyOperationInProgress();const t=await jE(n);x(jt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Xl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Xl(e.remoteStore,s))),n._onlineComponents=e}async function jE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(jt,"Using user provided OfflineComponentProvider");try{await ao(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===k.FAILED_PRECONDITION||s.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Pn("Error using user provided cache. Falling back to memory cache: "+t),await ao(n,new Js)}}else x(jt,"Using default OfflineComponentProvider"),await ao(n,new $E(void 0));return n._offlineComponents}async function Od(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(jt,"Using user provided OnlineComponentProvider"),await nu(n,n._uninitializedComponentsProvider._online)):(x(jt,"Using default OnlineComponentProvider"),await nu(n,new Lo))),n._onlineComponents}function zE(n){return Od(n).then((e=>e.syncEngine))}async function Md(n){const e=await Od(n),t=e.eventManager;return t.onListen=CE.bind(null,e.syncEngine),t.onUnlisten=NE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=DE.bind(null,e.syncEngine),t}function HE(n,e,t={}){const r=new ut;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,h){const f=new Vd({next:y=>{f.Nu(),a.enqueueAndForget((()=>Id(i,m)));const g=y.docs.has(l);!g&&y.fromCache?h.reject(new L(k.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&y.fromCache&&u&&u.source==="server"?h.reject(new L(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new Ad(ia(l.path),f,{includeMetadataChanges:!0,qa:!0});return wd(i,m)})(await Md(n),n.asyncQueue,e,t,r))),r.promise}function WE(n,e,t={}){const r=new ut;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,h){const f=new Vd({next:y=>{f.Nu(),a.enqueueAndForget((()=>Id(i,m))),y.fromCache&&u.source==="server"?h.reject(new L(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new Ad(l,f,{includeMetadataChanges:!0,qa:!0});return wd(i,m)})(await Md(n),n.asyncQueue,e,t,r))),r.promise}function Ld(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const ru=new Map;const xd="firestore.googleapis.com",su=!0;class iu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=xd,this.ssl=su}else this.host=e.host,this.ssl=e.ssl??su;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ud;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Av)throw new L(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}c_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ld(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Jy;switch(r.type){case"firstParty":return new n_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=ru.get(t);r&&(x("ComponentProvider","Removing Datastore"),ru.delete(t),r.terminate())})(this),Promise.resolve()}}function KE(n,e,t,r={}){n=We(n,vi);const s=Mn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(Ru(`https://${l}`),Cu("Firestore",!0)),i.host!==xd&&i.host!==l&&Pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!nn(u,a)&&(n._setSettings(u),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Re.MOCK_USER;else{h=ip(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new L(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Re(m)}n._authCredentials=new Zy(new Eh(h,f))}}class Wt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Wt(this.firestore,e,this._query)}}class he{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new he(this.firestore,e,this._key)}toJSON(){return{type:he._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Hr(t,he._jsonSchema))return new he(e,r||null,new B(re.fromString(t.referencePath)))}}he._jsonSchemaVersion="firestore/documentReference/1.0",he._jsonSchema={type:me("string",he._jsonSchemaVersion),referencePath:me("string")};class xt extends Wt{constructor(e,t,r){super(e,t,ia(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new B(e))}withConverter(e){return new xt(this.firestore,e,this._path)}}function st(n,e,...t){if(n=de(n),Th("collection","path",e),n instanceof vi){const r=re.fromString(e,...t);return _l(r),new xt(n,null,r)}{if(!(n instanceof he||n instanceof xt))throw new L(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(re.fromString(e,...t));return _l(r),new xt(n.firestore,null,r)}}function oe(n,e,...t){if(n=de(n),arguments.length===1&&(e=Zo.newId()),Th("doc","path",e),n instanceof vi){const r=re.fromString(e,...t);return yl(r),new he(n,null,new B(r))}{if(!(n instanceof he||n instanceof xt))throw new L(k.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(re.fromString(e,...t));return yl(r),new he(n.firestore,n instanceof xt?n.converter:null,new B(r))}}const ou="AsyncQueue";class au{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new pd(this,"async_queue_retry"),this._c=()=>{const r=oo();r&&x(ou,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=oo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=oo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ut;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Bn(e))throw e;x(ou,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ft("INTERNAL UNHANDLED ERROR: ",cu(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=_a.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&q(47125,{Pc:cu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class fn extends vi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new au,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new au(e),this._firestoreClient=void 0,await e}}}function GE(n,e){const t=typeof n=="object"?n:Du(),r=typeof n=="string"?n:Hs,s=Bo(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=rp("firestore");i&&KE(s,...i)}return s}function Ei(n){if(n._terminated)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||QE(n),n._firestoreClient}function QE(n){const e=n._freezeSettings(),t=(function(s,i,a,l){return new E_(s,i,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ld(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new qE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class $e{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $e(Ie.fromBase64String(e))}catch(t){throw new L(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $e(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$e._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hr(e,$e._jsonSchema))return $e.fromBase64String(e.bytes)}}$e._jsonSchemaVersion="firestore/bytes/1.0",$e._jsonSchema={type:me("string",$e._jsonSchemaVersion),bytes:me("string")};class Xr{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new we(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yr{constructor(e){this._methodName=e}}class tt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:tt._jsonSchemaVersion}}static fromJSON(e){if(Hr(e,tt._jsonSchema))return new tt(e.latitude,e.longitude)}}tt._jsonSchemaVersion="firestore/geoPoint/1.0",tt._jsonSchema={type:me("string",tt._jsonSchemaVersion),latitude:me("number"),longitude:me("number")};class nt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hr(e,nt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new nt(e.vectorValues);throw new L(k.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}nt._jsonSchemaVersion="firestore/vectorValue/1.0",nt._jsonSchema={type:me("string",nt._jsonSchemaVersion),vectorValues:me("object")};const XE=/^__.*__$/;class YE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new Wr(e,this.data,t,this.fieldTransforms)}}class Ud{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ht(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Fd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ac:n})}}class Ia{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ia({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Zs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Fd(this.Ac)&&XE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class JE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||gi(e)}Cc(e,t,r,s=!1){return new Ia({Ac:e,methodName:t,Dc:r,path:we.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ti(n){const e=n._freezeSettings(),t=gi(n._databaseId);return new JE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Bd(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Sa("Data must be an object, but it was:",a,r);const l=jd(r,a);let u,h;if(i.merge)u=new Be(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const y=xo(e,m,t);if(!a.contains(y))throw new L(k.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Hd(f,y)||f.push(y)}u=new Be(f),h=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,h=a.fieldTransforms;return new YE(new Oe(l),u,h)}class wi extends Yr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wi}}class Aa extends Yr{_toFieldTransform(e){return new Yh(e.path,new Dr)}isEqual(e){return e instanceof Aa}}class ba extends Yr{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Mr(e.serializer,Wh(e.serializer,this.Fc));return new Yh(e.path,t)}isEqual(e){return e instanceof ba&&this.Fc===e.Fc}}function $d(n,e,t,r){const s=n.Cc(1,e,t);Sa("Data must be an object, but it was:",s,r);const i=[],a=Oe.empty();zt(r,((u,h)=>{const f=Ra(e,u,t);h=de(h);const m=s.yc(f);if(h instanceof wi)i.push(f);else{const y=Jr(h,m);y!=null&&(i.push(f),a.set(f,y))}}));const l=new Be(i);return new Ud(a,l,s.fieldTransforms)}function qd(n,e,t,r,s,i){const a=n.Cc(1,e,t),l=[xo(e,r,t)],u=[s];if(i.length%2!=0)throw new L(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)l.push(xo(e,i[y])),u.push(i[y+1]);const h=[],f=Oe.empty();for(let y=l.length-1;y>=0;--y)if(!Hd(h,l[y])){const g=l[y];let S=u[y];S=de(S);const C=a.yc(g);if(S instanceof wi)h.push(g);else{const P=Jr(S,C);P!=null&&(h.push(g),f.set(g,P))}}const m=new Be(h);return new Ud(f,m,a.fieldTransforms)}function ZE(n,e,t,r=!1){return Jr(t,n.Cc(r?4:3,e))}function Jr(n,e){if(zd(n=de(n)))return Sa("Unsupported field value:",e,n),jd(n,e);if(n instanceof Yr)return(function(r,s){if(!Fd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=Jr(l,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=de(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Wh(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ie.fromDate(r);return{timestampValue:Qs(s.serializer,i)}}if(r instanceof ie){const i=new ie(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Qs(s.serializer,i)}}if(r instanceof tt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $e)return{bytesValue:rd(s.serializer,r._byteString)};if(r instanceof he){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:la(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof nt)return(function(a,l){return{mapValue:{fields:{[kh]:{stringValue:Nh},[Ws]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw l.Sc("VectorValues must only contain numeric values.");return oa(l.serializer,h)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${oi(r)}`)})(n,e)}function jd(n,e){const t={};return Ah(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zt(n,((r,s)=>{const i=Jr(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function zd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ie||n instanceof tt||n instanceof $e||n instanceof he||n instanceof Yr||n instanceof nt)}function Sa(n,e,t){if(!zd(t)||!wh(t)){const r=oi(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function xo(n,e,t){if((e=de(e))instanceof Xr)return e._internalPath;if(typeof e=="string")return Ra(n,e);throw Zs("Field path arguments must be of type string or ",n,!1,void 0,t)}const eT=new RegExp("[~\\*/\\[\\]]");function Ra(n,e,t){if(e.search(eT)>=0)throw Zs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Xr(...e.split("."))._internalPath}catch{throw Zs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Zs(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new L(k.INVALID_ARGUMENT,l+n+u)}function Hd(n,e){return n.some((t=>t.isEqual(e)))}class Wd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ii("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tT extends Wd{data(){return super.data()}}function Ii(n,e){return typeof e=="string"?Ra(n,e):e instanceof Xr?e._internalPath:e._delegate._internalPath}function nT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ca{}class Pa extends Ca{}function jn(n,e,...t){let r=[];e instanceof Ca&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof Na)).length,l=i.filter((u=>u instanceof Ai)).length;if(a>1||a>0&&l>0)throw new L(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class Ai extends Pa{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ai(e,t,r)}_apply(e){const t=this._parse(e);return Kd(e._query,t),new Wt(e.firestore,e.converter,Ro(e._query,t))}_parse(e){const t=Ti(e.firestore);return(function(i,a,l,u,h,f,m){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new L(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){uu(m,f);const S=[];for(const C of m)S.push(lu(u,i,C));y={arrayValue:{values:S}}}else y=lu(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||uu(m,f),y=ZE(l,a,m,f==="in"||f==="not-in");return pe.create(h,f,y)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ka(n,e,t){const r=e,s=Ii("where",n);return Ai._create(s,r,t)}class Na extends Ca{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Na(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:Ke.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Kd(a,u),a=Ro(a,u)})(e._query,t),new Wt(e.firestore,e.converter,Ro(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Da extends Pa{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Da(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new L(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new L(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Nr(i,a)})(e._query,this._field,this._direction);return new Wt(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new $n(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function Zr(n,e="asc"){const t=e,r=Ii("orderBy",n);return Da._create(r,t)}class Va extends Pa{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Va(e,t,r)}_apply(e){return new Wt(e.firestore,e.converter,Gs(e._query,this._limit,this._limitType))}}function Oa(n){return l_("limit",n),Va._create("limit",n,"F")}function lu(n,e,t){if(typeof(t=de(t))=="string"){if(t==="")throw new L(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fh(e)&&t.indexOf("/")!==-1)throw new L(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(re.fromString(t));if(!B.isDocumentKey(r))throw new L(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Sl(n,new B(r))}if(t instanceof he)return Sl(n,t._key);throw new L(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${oi(t)}.`)}function uu(n,e){if(!Array.isArray(n)||n.length===0)throw new L(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Kd(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new L(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class rT{convertValue(e,t="none"){switch($t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Bt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zt(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Ws].arrayValue?.values?.map((r=>ue(r.doubleValue)));return new nt(t)}convertGeoPoint(e){return new tt(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=li(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Cr(e));default:return null}}convertTimestamp(e){const t=Ft(e);return new ie(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=re.fromString(e);Z(ld(r),9688,{name:e});const s=new Pr(r.get(1),r.get(3)),i=new B(r.popFirst(5));return s.isEqual(t)||ft(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Gd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class fr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class tn extends Wd{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ds(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ii("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(k.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=tn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}tn._jsonSchemaVersion="firestore/documentSnapshot/1.0",tn._jsonSchema={type:me("string",tn._jsonSchemaVersion),bundleSource:me("string","DocumentSnapshot"),bundleName:me("string"),bundle:me("string")};class Ds extends tn{data(e={}){return super.data(e)}}class Rn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new fr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ds(this._firestore,this._userDataWriter,r.key,r,new fr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new Ds(s._firestore,s._userDataWriter,l.doc.key,l.doc,new fr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new Ds(s._firestore,s._userDataWriter,l.doc.key,l.doc,new fr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return l.type!==0&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:sT(l.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(k.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Rn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Zo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function sT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:n})}}function Lr(n){n=We(n,he);const e=We(n.firestore,fn);return HE(Ei(e),n._key).then((t=>iT(e,n,t)))}Rn._jsonSchemaVersion="firestore/querySnapshot/1.0",Rn._jsonSchema={type:me("string",Rn._jsonSchemaVersion),bundleSource:me("string","QuerySnapshot"),bundleName:me("string"),bundle:me("string")};class Qd extends rT{constructor(e){super(),this.firestore=e}convertBytes(e){return new $e(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}function pn(n){n=We(n,Wt);const e=We(n.firestore,fn),t=Ei(e),r=new Qd(e);return nT(n._query),WE(t,n._query).then((s=>new Rn(e,r,n,s)))}function ln(n,e,t){n=We(n,he);const r=We(n.firestore,fn),s=Gd(n.converter,e,t);return bi(r,[Bd(Ti(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Me.none())])}function es(n,e,t,...r){n=We(n,he);const s=We(n.firestore,fn),i=Ti(s);let a;return a=typeof(e=de(e))=="string"||e instanceof Xr?qd(i,"updateDoc",n._key,e,t,r):$d(i,"updateDoc",n._key,e),bi(s,[a.toMutation(n._key,Me.exists(!0))])}function Xd(n){return bi(We(n.firestore,fn),[new pi(n._key,Me.none())])}function bi(n,e){return(function(r,s){const i=new ut;return r.asyncQueue.enqueueAndForget((async()=>VE(await zE(r),s,i))),i.promise})(Ei(n),e)}function iT(n,e,t){const r=t.docs.get(e._key),s=new Qd(n);return new tn(n,s,e._key,r,new fr(t.hasPendingWrites,t.fromCache),e.converter)}class oT{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ti(e)}set(e,t,r){this._verifyNotCommitted();const s=co(e,this._firestore),i=Gd(s.converter,t,r),a=Bd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Me.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=co(e,this._firestore);let a;return a=typeof(t=de(t))=="string"||t instanceof Xr?qd(this._dataReader,"WriteBatch.update",i._key,t,r,s):$d(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=co(e,this._firestore);return this._mutations=this._mutations.concat(new pi(t._key,Me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(k.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function co(n,e){if((n=de(n)).firestore!==e)throw new L(k.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Y(){return new Aa("serverTimestamp")}function ar(n){return new ba("increment",n)}function aT(n){return Ei(n=We(n,fn)),new oT(n,(e=>bi(n,e)))}(function(e,t=!0){(function(s){Un=s})(Ln),Cn(new rn("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new fn(new e_(r.getProvider("auth-internal")),new r_(a,r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new L(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pr(h.options.projectId,f)})(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),Mt(fl,pl,e),Mt(fl,pl,"esm2020")})();const cT={apiKey:"AIzaSyDJurXmliChoLZ5tdiXsH-kTaiyfcEtsgM",authDomain:"ethos-dev-ec0d6.firebaseapp.com",projectId:"ethos-dev-ec0d6",storageBucket:"ethos-dev-ec0d6.firebasestorage.app",messagingSenderId:"154735949292",appId:"1:154735949292:web:2641d40b6563c39f9efcc9"},Yd=Nu(cT),it=Gy(Yd),te=GE(Yd);function lT(n){return xg(it,n)}async function Jd(n=!0){await Qo(it,n?ri:jr);const e=new ot;return ry(it,e)}async function uT(n,e,t=!0){return await Qo(it,t?ri:jr),Og(it,n,e)}async function hT(n,e,t=!0){return await Qo(it,t?ri:jr),Vg(it,n,e)}async function dT(n){return Dg(it,n)}async function fT(){return Ug(it)}async function un(n){const e=oe(te,"users",n),t=await Lr(e);return t.exists()?t.data():null}async function pT(n,e){const t=oe(te,"users",n);await ln(t,{...e,friends:Array.isArray(e?.friends)?e.friends:[],createdAt:Y(),updatedAt:Y()});const r=oe(te,"profiles",n);await ln(r,{displayName:e?.displayName||"",updatedAt:Y()},{merge:!0})}async function mT(n,e){if(!e||typeof e!="object"||Array.isArray(e))throw new Error(`updateUserProfile() patch must be an object. Got: ${typeof e}`);const t=oe(te,"users",n);if(await es(t,{...e,updatedAt:Y()}),"displayName"in e){const r=oe(te,"profiles",n);await ln(r,{displayName:e.displayName||"",updatedAt:Y()},{merge:!0})}}async function gT(n,e){if(!n)return!1;const t=oe(te,"profiles",n),r=await Lr(t);return r.exists()?typeof e=="string"&&e.trim()&&(r.data().displayName||"")!==e?(await ln(t,{displayName:e,updatedAt:Y()},{merge:!0}),!0):!1:(await ln(t,{displayName:e||"",updatedAt:Y()}),!0)}async function yT(n,e,t){if(!n||!t)return!1;const r={};let s=!1;return(!t.uid||t.uid!==n)&&(r.uid=n,s=!0),e&&(!t.email||t.email!==e)&&(r.email=e,s=!0),"friends"in t||(r.friends=[],s=!0),s&&await mT(n,r),await gT(n,t?.displayName||""),s}async function _T(n){const e=st(te,"users",n,"tracks"),t=jn(e,Zr("sortOrder","asc"));return(await pn(t)).docs.map(s=>({id:s.id,...s.data()}))}async function Zd(n){const e=st(te,"users",n,"tracks"),t=jn(e,ka("isActive","==",!0),Zr("sortOrder","asc"));return(await pn(t)).docs.map(s=>({id:s.id,...s.data()}))}async function vT(n,e){const t=oe(st(te,"users",n,"tracks")),r={...e.meta??{},createdBy:e.meta?.createdBy??n};return await ln(t,{...e,meta:r,isActive:e.isActive??!0,sortOrder:e.sortOrder??Date.now(),createdAt:Y(),updatedAt:Y()}),t.id}async function hu(n,e,t){const r=oe(te,"users",n,"tracks",e);await es(r,{...t,updatedAt:Y()})}async function ET(n,e){const t=oe(te,"users",n,"tracks",e);await Xd(t)}async function ef(n,e){const t=oe(te,"users",n,"days",e),r=await Lr(t);return r.exists()?r.data():null}async function TT(n,e=14){const t=st(te,"users",n,"days"),r=jn(t,Zr("dayKey","desc"),Oa(e));return(await pn(r)).docs.map(i=>({id:i.id,...i.data()}))}async function du(n,e,t,r=200){const s=st(te,"users",n,"days",e,"entries"),i=jn(s,ka("trackId","==",t),Zr("createdAt","desc"),Oa(r));return(await pn(i)).docs.map(l=>({id:l.id,...l.data()}))}function xr(n){const e=r=>String(r??"").toLowerCase().trim().replace(/\s+/g," "),t={name:e(n?.name),type:String(n?.type??""),unit:e(n?.unit),cadence:String(n?.cadence??""),target:n?.target??null,config:n?.config??{}};return JSON.stringify(t)}async function wT(){return(await pn(st(te,"trackTemplates"))).docs.map(e=>({id:e.id,...e.data()}))}async function IT({track:n,createdBy:e,createdByName:t=null,category:r=null}){const s=xr(n),i=jn(st(te,"trackTemplates"),ka("normalizedKey","==",s),Oa(1)),a=await pn(i);if(!a.empty)return a.docs[0].id;const l=oe(st(te,"trackTemplates"));return await ln(l,{name:n.name??"",displayLabel:n.displayLabel??n.name??"",type:n.type??"",cadence:n.cadence??"daily",unit:n.unit??"",target:n.target??null,config:n.config??{},category:r,createdBy:e,createdByName:t,normalizedKey:s,createdAt:Y(),updatedAt:Y()}),l.id}const lo={themeMode:"system",accent1:"#7c3aed",accent2:"#14b8a6"};function tf(n){const e=n||{};return{themeMode:e.themeMode||lo.themeMode,accent1:e.accent1||lo.accent1,accent2:e.accent2||lo.accent2}}function nf(n){const e=tf(n?.preferences);document.documentElement.dataset.theme=e.themeMode,document.documentElement.style.setProperty("--accent-1",e.accent1),document.documentElement.style.setProperty("--accent-2",e.accent2)}const AT="/ethos/assets/auth-bg.png",bT=`
<svg class="authIcon" viewBox="0 0 48 48" aria-hidden="true">
  <path fill="#EA4335" d="M24 9.5c3.54 0 6.7 1.22 9.2 3.6l6.86-6.86C35.9 2.4 30.4 0 24 0 14.6 0 6.5 5.4 2.6 13.2l7.98 6.2C12.3 13.3 17.7 9.5 24 9.5z"/>
  <path fill="#4285F4" d="M46.1 24.5c0-1.6-.14-2.8-.44-4.1H24v7.8h12.5c-.25 2-1.6 5-4.6 7.1l7.1 5.5c4.2-3.9 7.1-9.6 7.1-16.3z"/>
  <path fill="#FBBC05" d="M10.6 28.6c-.46-1.4-.72-2.9-.72-4.6s.26-3.2.7-4.6l-7.98-6.2C.9 16.7 0 20.2 0 24c0 3.8.9 7.3 2.6 10.6l8-6z"/>
  <path fill="#34A853" d="M24 48c6.4 0 11.8-2.1 15.7-5.7l-7.1-5.5c-1.9 1.3-4.5 2.2-8.6 2.2-6.3 0-11.7-3.8-13.6-9.1l-8 6C6.5 42.6 14.6 48 24 48z"/>
</svg>
`,ST=`
<svg class="authIcon authIcon--mono" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/>
</svg>
`;function RT(){document.body.classList.remove("welcome-mode"),document.body.classList.add("auth-bg"),document.body.style.setProperty("--authBgUrl",`url("${AT}")`)}function CT(){RT();const n=document.getElementById("app"),e=localStorage.getItem("ethos_keepSignedIn"),t=e===null?!0:e==="true";n.innerHTML=`
    <div class="authWrap">
      <a class="authBack" href="#/welcome"> Back</a>

      <div class="authBlock">
        <div class="authTitle">LOGIN</div>

        <div class="authStack">
          <button id="googleBtn" class="authBtn" type="button">
            ${bT}
            <span>Continue with Google</span>
          </button>

          <button id="emailBtn" class="authBtn" type="button">
            ${ST}
            <span>Continue with Email</span>
          </button>

          <label class="authCheck">
            <input id="persist" type="checkbox" ${t?"checked":""} />
            <span>Keep me signed in</span>
          </label>

          <div id="msg" class="authMsg"></div>
        </div>
      </div>
    </div>
  `;const r=n.querySelector("#msg"),s=n.querySelector("#persist");s.addEventListener("change",()=>{localStorage.setItem("ethos_keepSignedIn",String(s.checked))}),n.querySelector("#emailBtn").addEventListener("click",()=>{J("#/auth/email")}),n.querySelector("#googleBtn").addEventListener("click",async()=>{r.textContent="";try{await Jd(s.checked)}catch(i){r.textContent=i?.message||"Google sign-in failed"}})}const PT="/ethos/assets/auth-bg.png",kT=`
<svg class="authIcon" viewBox="0 0 48 48" aria-hidden="true">
  <path fill="#EA4335" d="M24 9.5c3.54 0 6.7 1.22 9.2 3.6l6.86-6.86C35.9 2.4 30.4 0 24 0 14.6 0 6.5 5.4 2.6 13.2l7.98 6.2C12.3 13.3 17.7 9.5 24 9.5z"/>
  <path fill="#4285F4" d="M46.1 24.5c0-1.6-.14-2.8-.44-4.1H24v7.8h12.5c-.25 2-1.6 5-4.6 7.1l7.1 5.5c4.2-3.9 7.1-9.6 7.1-16.3z"/>
  <path fill="#FBBC05" d="M10.6 28.6c-.46-1.4-.72-2.9-.72-4.6s.26-3.2.7-4.6l-7.98-6.2C.9 16.7 0 20.2 0 24c0 3.8.9 7.3 2.6 10.6l8-6z"/>
  <path fill="#34A853" d="M24 48c6.4 0 11.8-2.1 15.7-5.7l-7.1-5.5c-1.9 1.3-4.5 2.2-8.6 2.2-6.3 0-11.7-3.8-13.6-9.1l-8 6C6.5 42.6 14.6 48 24 48z"/>
</svg>
`;function NT(){document.body.classList.remove("welcome-mode"),document.body.classList.add("auth-bg"),document.body.style.setProperty("--authBgUrl",`url("${PT}")`)}function DT(){NT();const n=document.getElementById("app");n.innerHTML=`
    <div class="authWrap">
      <a class="authBack" href="#/auth"> Back</a>

      <div class="authBlock">
        <div class="authTitle">LOGIN</div>

        <div class="authStack">
          <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" />

          <div style="display:flex; gap:10px;">
            <button id="loginBtn" class="authBtn" type="button" style="flex:1;">
              <span>Login</span>
            </button>

            <button id="registerBtn" class="authBtn" type="button" style="flex:1;">
              <span>Register</span>
            </button>
          </div>

          <div id="msg" class="authMsg"></div>

          <button id="googleBtn" class="authBtn" type="button">
            ${kT}
            <span>Continue with Google</span>
          </button>
        </div>
      </div>
    </div>
  `;const e=n.querySelector("#email"),t=n.querySelector("#msg");function r(l){t.textContent=l||""}function s(){return String(e.value||"").trim().toLowerCase()}function i(){const l=s();if(r(""),!l){r("Please enter an email.");return}J(`#/auth/password?email=${encodeURIComponent(l)}`)}function a(){const l=s();if(r(""),!l){r("Please enter an email.");return}J(`#/auth/create-password?email=${encodeURIComponent(l)}`)}n.querySelector("#loginBtn").addEventListener("click",i),n.querySelector("#registerBtn").addEventListener("click",a),e.addEventListener("keydown",l=>{l.key==="Enter"&&i()}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await Jd()}catch(l){r(l?.message||"Google sign-in failed.")}})}const VT="/ethos/assets/auth-bg.png";function OT(){document.body.classList.remove("welcome-mode"),document.body.classList.add("auth-bg"),document.body.style.setProperty("--authBgUrl",`url("${VT}")`)}function MT(){OT();const n=document.getElementById("app"),{query:e}=Ir(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="authWrap">
      <a class="authBack" href="#/auth/email"> Back</a>

      <div class="authBlock">
        <div class="authTitle">LOGIN</div>

        <div class="authStack">
          <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />

          <label class="authCheck">
            <input id="persist" type="checkbox" ${s?"checked":""} />
            <span>Keep me signed in</span>
          </label>

          <button id="login" class="authBtn" type="button">Sign in</button>

          <button id="forgot" type="button"
            style="background:transparent;border:0;color:rgba(255,255,255,0.72);cursor:pointer;justify-self:center;">
            Forgot password?
          </button>

          <a href="#/auth/email"
            style="color:rgba(255,255,255,0.72);text-decoration:none;justify-self:center;">
             Use a different email
          </a>

          <div id="msg" class="authMsg"></div>
        </div>
      </div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#persist");function u(f){i.textContent=f||""}t||u("Missing email. Go back and enter your email again.");async function h(){if(localStorage.setItem("ethos_keepSignedIn",String(l.checked)),u(""),!t)return;const f=String(a.value||"");if(!f){u("Please enter your password.");return}try{await uT(t,f,l.checked)}catch(m){const y=m?.code||"";if(y==="auth/user-not-found"){u("Account not found. Create an account instead."),J(`#/auth/create-password?email=${encodeURIComponent(t)}`);return}if(y==="auth/wrong-password"){u("Incorrect password.");return}if(y==="auth/too-many-requests"){u("Too many attempts. Try again later.");return}u(m?.message||"Sign-in failed.")}}n.querySelector("#login").addEventListener("click",h),a.addEventListener("keydown",f=>{f.key==="Enter"&&h()}),n.querySelector("#forgot").addEventListener("click",async()=>{if(u(""),!!t)try{await dT(t),u("Password reset email sent.")}catch(f){u(f?.message||"Could not send reset email.")}})}const LT="/ethos/assets/auth-bg.png";function xT(){document.body.classList.remove("welcome-mode"),document.body.classList.add("auth-bg"),document.body.style.setProperty("--authBgUrl",`url("${LT}")`)}function UT(){xT();const n=document.getElementById("app"),{query:e}=Ir(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="authWrap">
      <a class="authBack" href="#/auth/email"> Back</a>

      <div class="authBlock">
        <div class="authTitle">LOGIN</div>

        <div class="authStack">
          <input id="password" class="input" type="password" placeholder="Create password" autocomplete="new-password" />
          <input id="confirm" class="input" type="password" placeholder="Confirm password" autocomplete="new-password" />

          <label class="authCheck">
            <input id="persist" type="checkbox" ${s?"checked":""} />
            <span>Keep me signed in</span>
          </label>

          <button id="create" class="authBtn" type="button">Create account</button>

          <div id="msg" class="authMsg"></div>
        </div>
      </div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#confirm"),u=n.querySelector("#persist");function h(m){i.textContent=m||""}t||h("Missing email. Go back and enter your email again.");async function f(){if(localStorage.setItem("ethos_keepSignedIn",String(u.checked)),h(""),!t)return;const m=String(a.value||""),y=String(l.value||"");if(!m||m.length<6){h("Password should be at least 6 characters.");return}if(m!==y){h("Passwords do not match.");return}try{await hT(t,m,u.checked)}catch(g){const S=g?.code||"";if(S==="auth/email-already-in-use"){h("Account already exists. Please sign in."),J(`#/auth/password?email=${encodeURIComponent(t)}`);return}if(S==="auth/account-exists-with-different-credential"){h("This email is linked to Google sign-in."),J("#/auth/email");return}h(g?.message||"Account creation failed.")}}n.querySelector("#create").addEventListener("click",f),l.addEventListener("keydown",m=>{m.key==="Enter"&&f()})}const FT="/ethos/assets/auth-bg.png";function BT(){document.body.classList.remove("welcome-mode"),document.body.classList.add("auth-bg"),document.body.style.setProperty("--authBgUrl",`url("${FT}")`)}function $T(){if(typeof Intl<"u"&&typeof Intl.supportedValuesOf=="function")try{return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney","Asia/Singapore","Asia/Tokyo"]}function rf({user:n}){BT();const e=document.getElementById("app"),t=$T(),r=Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Kolkata";e.innerHTML=`
    <div class="authWrap">
      <a class="authBack" href="#/auth"> Back</a>

      <div class="authBlock">
        <div class="authTitle">PROFILE</div>

        <div class="authStack">
          <input id="name" class="input" type="text" placeholder="Display name (optional)" autocomplete="name" />
          <input id="dob" class="input" type="date" />

          <select id="tz" class="input">
            ${t.map(h=>`<option value="${h}" ${h===r?"selected":""}>${h}</option>`).join("")}
          </select>

          <button id="save" class="authBtn" type="button">Save</button>

          <div id="msg" class="authMsg"></div>
        </div>
      </div>
    </div>
  `;const s=e.querySelector("#msg"),i=e.querySelector("#name"),a=e.querySelector("#dob"),l=e.querySelector("#tz");function u(h){s.textContent=h||""}e.querySelector("#save").addEventListener("click",async()=>{u("");const h=String(i.value||"").trim(),f=String(a.value||"").trim(),m=String(l.value||"").trim();if(!m){u("Please select a timezone.");return}try{await pT(n.uid,{email:n.email||"",displayName:h||"",dob:f||"",timeZone:m,weekStartsOn:"monday",role:"user"}),window.location.hash="#/home",window.location.reload()}catch(y){u(y?.message||"Could not save profile.")}})}function qT(n){return{trophy:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 21h8M12 17v4M7 4h10v3a5 5 0 0 1-10 0V4Z"/><path d="M17 7h3a4 4 0 0 1-4 4M7 7H4a4 4 0 0 0 4 4"/></svg>',check:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20 6 9 17l-5-5"/></svg>',home:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V10.5Z"/></svg>',history:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 4v6h6"/><path d="M12 7v6l4 2"/></svg>',gear:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.5-2.3.7a8 8 0 0 0-5-2.9L12 0h-4l-.9 2.1a8 8 0 0 0-5 2.9l-2.3-.7-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 6l-2 1.2 2 3.5 2.3-.7a8 8 0 0 0 5 2.9L8 24h4l.9-2.1a8 8 0 0 0 5-2.9l2.3.7 2-3.5-2-1.2Z"/></svg>'}[n]||""}function jT({active:n}){return`
      <nav class="tabs">
        ${[{id:"leaderboard",label:"Leaderboard",href:"#/leaderboard",icon:"trophy"},{id:"today",label:"Today",href:"#/today",icon:"check"},{id:"home",label:"Home",href:"#/home",icon:"home",center:!0},{id:"history",label:"History",href:"#/history",icon:"history"},{id:"settings",label:"Settings",href:"#/settings",icon:"gear"}].map(t=>`
          <a class="tab ${t.center?"tab-center":""} ${n===t.id?"active":""}" href="${t.href}" aria-label="${t.label}">
            <span class="tab-ico">${qT(t.icon)}</span>
            <span class="tab-txt">${t.label}</span>
          </a>
        `).join("")}
      </nav>
    `}function ge({title:n,activeTab:e,content:t}){return`
    <div class="app">
      <header class="header">
        <div class="header-title">${n||"Ethos"}</div>
      </header>

      <main class="content">
        ${t||""}
      </main>

      ${jT({active:e})}
    </div>
  `}const zT="/ethos/assets/auth-bg.png";function HT(){document.body.classList.remove("welcome-mode"),document.body.classList.remove("auth-bg"),document.body.style.removeProperty("--authBgUrl"),document.body.style.removeProperty("--publicBgUrl"),document.body.classList.add("home-bg"),document.body.style.setProperty("--homeBgUrl",`url("${zT}")`)}function WT(n,e){const t=(e?.displayName||"").trim();if(t)return t;const r=(n?.displayName||"").trim();if(r)return r;const s=(n?.email||"").trim();return s&&s.includes("@")?s.split("@")[0]:"there"}function Vs({user:n,profile:e}={}){HT();const t=WT(n,e),r=document.getElementById("app");r.innerHTML=ge({title:"Home",activeTab:"home",content:`
      <section class="userWrap">
        <div class="userHero">
          <div class="userName">${KT(t)}</div>
          <div class="userPrompt">How are you doing today?</div>
        </div>
      </section>
    `})}function KT(n){return String(n).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function sf(n){return GT(new Date,n)}function GT(n,e){const t=QT(n,e);return`${t.year}-${ei(t.month)}-${ei(t.day)}`}function of(n){const[e,t,r]=n.split("-").map(Number),s=new Date(Date.UTC(e,t-1,r)),i=XT(s),a=`${e}-${ei(t)}`;return{weekKey:i,monthKey:a}}function QT(n,e){const r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(n).reduce((s,i)=>(i.type!=="literal"&&(s[i.type]=i.value),s),{});return{year:Number(r.year),month:Number(r.month),day:Number(r.day)}}function XT(n){const e=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=Math.ceil(((e-r)/864e5+1)/7);return`${e.getUTCFullYear()}-W${ei(s)}`}function ei(n){return String(n).padStart(2,"0")}function wn(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function YT(n){return!n||!n.length?"":`
    <div class="bullets">
      ${n.map(e=>`<div class="bullet">${e}</div>`).join("")}
    </div>
  `}function JT(n,e){return n?.tracks?.[e]||null}function ZT(n){return n==="weekly"?"This week":n==="monthly"?"This month":n==="yearly"?"This year":"Today"}function fu(n){if(typeof n!="string")return n;const e=n.match(/^(\d{4}-\d{2}-\d{2}):(.+)$/);return e?e[2]:n}function ew(n){const e=Array.isArray(n?.config?.options)?n.config.options:[],t={};for(const r of e)t[r.id]=r.label;return t}function tw(n,e,t,r){const s={};for(const i of n)s[i.id]=null;for(const i of e){const a=i?.period?.weekKey,l=i?.period?.monthKey;for(const u of n){if(u.cadence==="daily"||u.cadence==="weekly"&&a!==t||u.cadence==="monthly"&&l!==r)continue;const h=i?.tracks?.[u.id];if(h){if(s[u.id]||(s[u.id]={}),u.type==="COUNTER_INCREMENT"){s[u.id].sum=Number(s[u.id].sum||0)+Number(h.sum||0),s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0);continue}if(u.type==="NUMBER_REPLACE"){s[u.id].value===void 0&&(s[u.id].value=h.value);continue}if(u.type==="BOOLEAN"){s[u.id].done=!!s[u.id].done||!!h.done,s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0);continue}s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0),s[u.id].preview===void 0&&h.preview&&(s[u.id].preview=h.preview),s[u.id].lastValue===void 0&&h.lastValue&&(s[u.id].lastValue=h.lastValue)}}}return s}function nw(n,e,t,r){const s=n.cadence||"daily",i=ZT(s),a=Number(n?.target?.value||0),l=s==="daily"?e:t,u=n.type==="DROPDOWN_EVENT"?ew(n):null;let h="",f="",m="";if(n.type==="COUNTER_INCREMENT"){const g=Number(l?.sum||0);h=a?`${g} / ${a}`:`${g}`,f=a?`${i}  Target ${a}`:i}if(n.type==="BOOLEAN"){const g=!!l?.done;h=g?"":"",f=g?"Done":"Not yet"}if(n.type==="NUMBER_REPLACE"){const g=l?.value;h=g===0||g?`${g} ${n.unit||""}`.trim():"",f=i}if(n.type==="TEXT_APPEND"){const S=(r?.textEntriesByTrack?.[n.id]||[]).slice().map(M=>(M.text||"").trim()).filter(Boolean),C=S.length;h=C?`${C}`:"0",f=C===1?"1 entry":`${C} entries`;const P=S[0];P&&(m=`
        <div class="mini muted" style="margin-top:10px;">
          ${wn(P)}
        </div>
      `)}if(n.type==="DROPDOWN_EVENT"){const g=Number(l?.count||0);h=a?`${g} / ${a}`:`${g}`,f=g?s==="daily"?"Selected":"Events":"No selection yet";let S=[];s==="daily"?S=(Array.isArray(e?.lastValue)?e.lastValue:[]).map(P=>fu(P)).map(P=>u?.[P]||P).filter(Boolean):S=(r?.periodEventsByTrack?.[n.id]||[]).map(C=>fu(C)).map(C=>u?.[C]||C).filter(Boolean),S.length&&(m=`<div style="margin-top:10px;">${YT(S.slice(0,3).map(wn))}</div>`,f=s==="daily"?S[0]:`Events: ${S.length}`)}const y=n.type==="COUNTER_INCREMENT"?`${i}${a?`  Target ${a}`:""}`:n.type==="DROPDOWN_EVENT"?`${i}${a?`  Target ${a}`:""}`:i;return`
    <div class="card">
      <div class="row" style="justify-content:space-between;gap:12px;align-items:flex-start;">
        <div style="min-width:0;">
          <div class="card-title">${wn(n.name)}</div>
          <div class="mini muted">${y}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-weight:700;">${wn(h)}</div>
          ${f?`<div class="mini muted">${wn(f)}</div>`:""}
        </div>
      </div>
      ${m||""}
    </div>
  `}async function rw({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ge({title:"Today",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});try{const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=sf(r),{weekKey:i,monthKey:a}=of(s),l=await Zd(n.uid),u=await ef(n.uid,s),h=await TT(n.uid,31),f=tw(l,h,i,a),m={};for(const C of l)C.type==="TEXT_APPEND"&&(m[C.id]=await du(n.uid,s,C.id,20));const y={};for(const C of l){if(C.type!=="DROPDOWN_EVENT"||C.cadence==="daily")continue;const P=[];for(const M of h){if(C.cadence==="weekly"&&M?.period?.weekKey!==i||C.cadence==="monthly"&&M?.period?.monthKey!==a)continue;const N=M?.tracks?.[C.id],V=Number(N?.count||0);if(!V)continue;const U=await du(n.uid,M.dayKey,C.id,Math.min(30,V));for(const W of U){const F=W?.optionIds?.[0];F&&P.push(F)}}y[C.id]=P}const g={textEntriesByTrack:m,periodEventsByTrack:y},S=l.length?l.map(C=>nw(C,JT(u,C.id),f[C.id],g)).join(""):'<div class="card"><div class="muted">No active tracks yet. Add some in Settings  Manage Tracks.</div></div>';t.innerHTML=ge({title:"Today",activeTab:"today",content:`
        <div class="content">
          <div class="mini muted" style="margin:6px 0 14px;">${s}  ${r}</div>
          ${S}
        </div>

        <button class="fab" id="goLog" title="Log for today"></button>
      `}),t.querySelector("#goLog").addEventListener("click",()=>{J("#/today/log")})}catch(r){console.error("Today page load failed:",r),t.innerHTML=ge({title:"Today",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Today</h2>
          <p class="muted" style="white-space:pre-wrap;">${wn(r?.message||String(r))}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}function xe(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}async function sw({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ge({title:"Log",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=sf(r),{weekKey:i,monthKey:a}=of(s);try{const l=await Zd(n.uid),u=await ef(n.uid,s),h=l.map(f=>{const m=u?.tracks?.[f.id]||null;if(f.type==="TEXT_APPEND"){const y=m?.count||0;return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Entries today: ${y}</div>
            <textarea class="input" rows="2"
              data-track="${f.id}" data-type="TEXT_APPEND"
              placeholder="Write a quick note"></textarea>
          </div>
        `}if(f.type==="NUMBER_REPLACE"){const y=m?.value===0||m?.value?m.value:"";return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Current: ${xe(y)} ${xe(f.unit||"")}</div>
            <input class="input"
              inputmode="decimal"
              type="text"
              data-track="${f.id}" data-type="NUMBER_REPLACE"
              placeholder="Enter value"
              value="" />
          </div>
        `}if(f.type==="DROPDOWN_EVENT"){const y=m?.count||0,S=(Array.isArray(f.config?.options)?f.config.options:[]).map(C=>`<option value="${xe(C.id)}">${xe(C.label)}</option>`).join("");return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Count today: ${y}</div>
            <select class="select" data-track="${f.id}" data-type="DROPDOWN_EVENT">
              <option value="">Select</option>
              ${S}
            </select>
          </div>
        `}if(f.type==="COUNTER_INCREMENT"){const y=Number(f.config?.incrementStep||1),g=m?.sum||0;return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today: ${xe(g)} ${xe(f.unit||"")}</div>

            <div class="row" style="align-items:center;gap:10px;">
              <button class="btn" type="button" data-counter-dec="${f.id}"></button>

              <input class="input"
                style="width:90px;text-align:center;"
                inputmode="numeric"
                type="text"
                data-track="${f.id}" data-type="COUNTER_INCREMENT"
                data-step="${y}"
                placeholder="${y}"
                value="" />

              <button class="btn" type="button" data-counter-inc="${f.id}">+</button>

              <div class="mini muted">(${y} ${xe(f.unit||"")})</div>
            </div>
          </div>
        `}if(f.type==="BOOLEAN"){if((f.config?.booleanMode||"done_only")==="done_only"){const g=m?.done?"checked":"";return`
            <div class="card">
              <div class="card-title">${xe(f.name)}</div>
              <label class="toggle">
                <input type="checkbox" data-track="${f.id}" data-type="BOOLEAN_DONE" ${g}/>
                Done today
              </label>
            </div>
          `}return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today count: ${m?.count||0}</div>
            <input class="input" type="number" min="0" step="1"
              data-track="${f.id}" data-type="BOOLEAN_COUNT"
              placeholder="Add count (e.g. 1)" />
          </div>
        `}return""}).join("");t.innerHTML=ge({title:"Log",activeTab:"today",content:`
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
              <div class="mini muted">${s}  ${r}</div>
              <div style="font-weight:700;font-size:18px;">Log entries</div>
            </div>
            <button class="btn" id="back" type="button">Back</button>
          </div>

          ${h}

          <div class="row" style="justify-content:flex-end;gap:10px;margin-top:10px;">
            <button class="btn primary" id="submit" type="button">Submit</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;margin-top:8px;"></div>
        </div>
      `}),t.querySelector("#back").addEventListener("click",()=>J("#/today")),t.querySelectorAll("[data-counter-inc]").forEach(f=>{f.addEventListener("click",()=>{const m=f.dataset.counterInc,y=t.querySelector(`input[data-track="${m}"][data-type="COUNTER_INCREMENT"]`);if(!y)return;const g=Number(y.dataset.step||1),S=Number(String(y.value||"").trim()||0);y.value=String(S+g)})}),t.querySelectorAll("[data-counter-dec]").forEach(f=>{f.addEventListener("click",()=>{const m=f.dataset.counterDec,y=t.querySelector(`input[data-track="${m}"][data-type="COUNTER_INCREMENT"]`);if(!y)return;const g=Number(y.dataset.step||1),S=Number(String(y.value||"").trim()||0);y.value=String(Math.max(0,S-g))})}),t.querySelectorAll('select[data-type="DROPDOWN_EVENT"]').forEach(f=>{f.addEventListener("change",()=>{})}),t.querySelector("#submit").addEventListener("click",async()=>{const f=t.querySelector("#status");f.textContent="Saving";const m=aT(te),y=oe(te,"users",n.uid,"days",s);m.set(y,{dayKey:s,timeZone:r,period:{weekKey:i,monthKey:a},updatedAt:Y()},{merge:!0});const g=st(te,"users",n.uid,"days",s,"entries"),S=Array.from(t.querySelectorAll("[data-track][data-type]"));let C=0;for(const P of S){const M=P.dataset.track,N=P.dataset.type;if(N==="TEXT_APPEND"){const V=P.value.trim();if(!V)continue;const U=oe(g);m.set(U,{trackId:M,type:"TEXT_APPEND",text:V,createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"TEXT_APPEND",count:ar(1),preview:V.slice(0,80),lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}if(N==="NUMBER_REPLACE"){const V=P.value.trim();if(V==="")continue;const U=Number(V);if(Number.isNaN(U))continue;const W=oe(g);m.set(W,{trackId:M,type:"NUMBER_REPLACE",value:U,createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"NUMBER_REPLACE",value:U,lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}if(N==="COUNTER_INCREMENT"){const V=String(P.value||"").trim();if(V==="")continue;const U=Number(V);if(!U||Number.isNaN(U))continue;const W=oe(g);m.set(W,{trackId:M,type:"COUNTER_INCREMENT",deltaValue:U,createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"COUNTER_INCREMENT",count:ar(1),sum:ar(U),lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}if(N==="DROPDOWN_EVENT"){const V=P.value;if(!V)continue;const U=oe(g);m.set(U,{trackId:M,type:"DROPDOWN_EVENT",optionIds:[V],createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"DROPDOWN_EVENT",count:ar(1),lastValue:[V],lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}if(N==="BOOLEAN_DONE"){const V=!!P.checked,U=oe(g);m.set(U,{trackId:M,type:"BOOLEAN",value:V,createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"BOOLEAN",done:V,count:V?1:0,lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}if(N==="BOOLEAN_COUNT"){const V=P.value.trim();if(V==="")continue;const U=Number(V);if(!U||Number.isNaN(U))continue;const W=oe(g);m.set(W,{trackId:M,type:"BOOLEAN",deltaCount:U,createdAt:Y(),createdAtMs:Date.now()}),m.set(y,{tracks:{[M]:{type:"BOOLEAN",count:ar(U),done:!0,lastAt:Y()}},updatedAt:Y()},{merge:!0}),C++;continue}}if(!C){f.textContent="Nothing to save.",setTimeout(()=>f.textContent="",1200);return}try{await m.commit(),f.textContent="Saved.",J("#/today")}catch(P){console.error("Log submit failed:",P),f.textContent=`Save failed: ${P?.message||P}`,alert(`Save failed:
${P?.message||P}`)}})}catch(l){console.error("Today log page load failed:",l),t.innerHTML=ge({title:"Log",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Log</h2>
          <p class="muted" style="white-space:pre-wrap;">${l?.message||String(l)}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}const iw="2026-01-31T00:00:00+05:30",ow="2026-02-13T12:00:00+05:30",aw="/ethos/assets/leaderboard-construction.png";function af(n,e,t){return Math.min(t,Math.max(e,n))}function uo(n){return String(Math.floor(n)).padStart(2,"0")}function cw(n){const e=Math.max(0,Math.floor(n/1e3)),t=Math.floor(e/86400),r=Math.floor(e%86400/3600),s=Math.floor(e%3600/60),i=e%60;return{days:t,hours:r,minutes:s,seconds:i}}function Ts(n,e,t){return`
    <div class="lb-circleUnit">
      <div class="lb-ring">
        <svg class="lb-ringSvg" viewBox="0 0 120 120" aria-hidden="true">
          <circle class="lb-ringTrack" cx="60" cy="60" r="48"></circle>
          <circle class="lb-ringProg" id="${t}" cx="60" cy="60" r="48"></circle>
        </svg>

        <div class="lb-ringCenter">
          <div class="lb-ringNum" id="${e}">--</div>
          <div class="lb-ringLbl">${n}</div>
        </div>
      </div>
    </div>
  `}function Rt(n,e){if(!n)return;const r=2*Math.PI*48,s=af(e,0,1);n.style.strokeDasharray=`${r}`,n.style.strokeDashoffset=`${r*(1-s)}`}function lw(){window.__ethosLeaderboardTimer&&(clearInterval(window.__ethosLeaderboardTimer),window.__ethosLeaderboardTimer=null);const n=document.getElementById("app");n.innerHTML=ge({title:"History",activeTab:"History",content:`
      <section class="lb-page">
        <div class="card lb-card">
          <div class="lb-wrap">
            <div class="lb-title">
              Reflections <span class="lb-soon">coming soon</span>
            </div>

            <div class="lb-sub muted">
              Were building this the calm way  clean, fair, and actually useful.
            </div>

            <div class="lb-hero">
              <img class="lb-img" src="${aw}" alt="Leaderboard under construction" />
            </div>

            <div class="lb-circles" aria-label="Countdown">
              ${Ts("Days","lbDays","lbRingDays")}
              ${Ts("Hours","lbHours","lbRingHours")}
              ${Ts("Minutes","lbMins","lbRingMins")}
              ${Ts("Seconds","lbSecs","lbRingSecs")}
            </div>

            <div class="lb-progress">
              <div class="lb-progressTop">
                <div class="lb-progressLabel">Build progress</div>
                <div class="lb-progressPct" id="lbPct">0%</div>
              </div>

              <div class="lb-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                <div class="lb-barFill" id="lbBarFill" style="width:0%"></div>
              </div>

              <div class="lb-meta muted" id="lbMeta"></div>
            </div>
          </div>
        </div>
      </section>
    `});const e=document.getElementById("lbDays"),t=document.getElementById("lbHours"),r=document.getElementById("lbMins"),s=document.getElementById("lbSecs"),i=document.getElementById("lbRingDays"),a=document.getElementById("lbRingHours"),l=document.getElementById("lbRingMins"),u=document.getElementById("lbRingSecs"),h=document.getElementById("lbPct"),f=document.getElementById("lbBarFill"),m=document.getElementById("lbMeta"),y=new Date(iw).getTime(),g=new Date(ow).getTime();function S(){const C=Date.now(),P=g-C,{days:M,hours:N,minutes:V,seconds:U}=cw(P);e.textContent=String(M),t.textContent=uo(N),r.textContent=uo(V),s.textContent=uo(U),Rt(a,N/24),Rt(l,V/60),Rt(u,U/60);const W=Math.max(1,Math.min(30,M+1));Rt(i,1-M/W);const F=Math.max(1,g-y),T=C-y,_=af(T/F*100,0,100);h.textContent=`${Math.round(_)}%`,f.style.width=`${_}%`;const E=new Date(g).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});if(P<=0){m.textContent="Should be live now. If it isnt, its probably a deployment thing.",e.textContent="0",t.textContent="00",r.textContent="00",s.textContent="00",h.textContent="100%",f.style.width="100%",Rt(i,1),Rt(a,1),Rt(l,1),Rt(u,1);return}m.textContent=`Expected launch: ${E}`}S(),window.__ethosLeaderboardTimer=setInterval(S,1e3)}function uw(){const n=document.getElementById("app");n.innerHTML=ge({title:"Settings",activeTab:"settings",content:`
      <section class="card">
        <div class="card-title">Settings</div>

        <div class="list">
          <button class="list-item" id="goProfile" type="button">
            <div>
              <div class="li-title">Profile</div>
              <div class="muted">Name, DOB, timezone</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTheme" type="button">
            <div>
              <div class="li-title">Theme</div>
              <div class="muted">Mode + accent colors</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTracks" type="button">
            <div>
              <div class="li-title">Manage Tracks</div>
              <div class="muted">Add, edit, reorder, activate/deactivate</div>
            </div>
            <div class="chev"></div>
          </button>
        </div>
      </section>

      <section class="card">
        <div class="card-title">Account</div>
        <button id="logout" class="btn" type="button">Logout</button>
      </section>
    `}),n.querySelector("#goProfile").addEventListener("click",()=>J("#/settings/profile")),n.querySelector("#goTheme").addEventListener("click",()=>J("#/settings/theme")),n.querySelector("#goTracks").addEventListener("click",()=>J("#/settings/tracks")),n.querySelector("#logout").addEventListener("click",async()=>{await fT(),J("#/auth")})}const hw="2026-01-23T00:00:00+05:30",dw="2026-02-03T00:00:00+05:30",fw="/ethos/assets/leaderboard-construction.png";function cf(n,e,t){return Math.min(t,Math.max(e,n))}function ho(n){return String(Math.floor(n)).padStart(2,"0")}function pw(n){const e=Math.max(0,Math.floor(n/1e3)),t=Math.floor(e/86400),r=Math.floor(e%86400/3600),s=Math.floor(e%3600/60),i=e%60;return{days:t,hours:r,minutes:s,seconds:i}}function ws(n,e,t){return`
    <div class="lb-circleUnit">
      <div class="lb-ring">
        <svg class="lb-ringSvg" viewBox="0 0 120 120" aria-hidden="true">
          <circle class="lb-ringTrack" cx="60" cy="60" r="48"></circle>
          <circle class="lb-ringProg" id="${t}" cx="60" cy="60" r="48"></circle>
        </svg>

        <div class="lb-ringCenter">
          <div class="lb-ringNum" id="${e}">--</div>
          <div class="lb-ringLbl">${n}</div>
        </div>
      </div>
    </div>
  `}function Ct(n,e){if(!n)return;const r=2*Math.PI*48,s=cf(e,0,1);n.style.strokeDasharray=`${r}`,n.style.strokeDashoffset=`${r*(1-s)}`}function mw(){window.__ethosLeaderboardTimer&&(clearInterval(window.__ethosLeaderboardTimer),window.__ethosLeaderboardTimer=null);const n=document.getElementById("app");n.innerHTML=ge({title:"Leaderboard",activeTab:"leaderboard",content:`
      <section class="lb-page">
        <div class="card lb-card">
          <div class="lb-wrap">
            <div class="lb-title">
              Leaderboard <span class="lb-soon">coming soon</span>
            </div>

            <div class="lb-sub muted">
              Were building this the calm way  clean, fair, and actually useful.
            </div>

            <div class="lb-hero">
              <img class="lb-img" src="${fw}" alt="Leaderboard under construction" />
            </div>

            <div class="lb-circles" aria-label="Countdown">
              ${ws("Days","lbDays","lbRingDays")}
              ${ws("Hours","lbHours","lbRingHours")}
              ${ws("Minutes","lbMins","lbRingMins")}
              ${ws("Seconds","lbSecs","lbRingSecs")}
            </div>

            <div class="lb-progress">
              <div class="lb-progressTop">
                <div class="lb-progressLabel">Build progress</div>
                <div class="lb-progressPct" id="lbPct">0%</div>
              </div>

              <div class="lb-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                <div class="lb-barFill" id="lbBarFill" style="width:0%"></div>
              </div>

              <div class="lb-meta muted" id="lbMeta"></div>
            </div>
          </div>
        </div>
      </section>
    `});const e=document.getElementById("lbDays"),t=document.getElementById("lbHours"),r=document.getElementById("lbMins"),s=document.getElementById("lbSecs"),i=document.getElementById("lbRingDays"),a=document.getElementById("lbRingHours"),l=document.getElementById("lbRingMins"),u=document.getElementById("lbRingSecs"),h=document.getElementById("lbPct"),f=document.getElementById("lbBarFill"),m=document.getElementById("lbMeta"),y=new Date(hw).getTime(),g=new Date(dw).getTime();function S(){const C=Date.now(),P=g-C,{days:M,hours:N,minutes:V,seconds:U}=pw(P);e.textContent=String(M),t.textContent=ho(N),r.textContent=ho(V),s.textContent=ho(U),Ct(a,N/24),Ct(l,V/60),Ct(u,U/60);const W=Math.max(1,Math.min(30,M+1));Ct(i,1-M/W);const F=Math.max(1,g-y),T=C-y,_=cf(T/F*100,0,100);h.textContent=`${Math.round(_)}%`,f.style.width=`${_}%`;const E=new Date(g).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});if(P<=0){m.textContent="Should be live now. If it isnt, its probably a deployment thing.",e.textContent="0",t.textContent="00",r.textContent="00",s.textContent="00",h.textContent="100%",f.style.width="100%",Ct(i,1),Ct(a,1),Ct(l,1),Ct(u,1);return}m.textContent=`Expected launch: ${E}`}S(),window.__ethosLeaderboardTimer=setInterval(S,1e3)}function gw(){try{if(typeof Intl.supportedValuesOf=="function")return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney"]}async function yw({user:n}){const e=document.getElementById("app");e.innerHTML=ge({title:"Profile",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await un(n.uid),r=gw();e.innerHTML=ge({title:"Profile",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Profile</div>
            <div class="muted">Personal details for your Ethos space</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Display name</div>
            <input class="input" id="displayName" value="${t?.displayName||""}" placeholder="Your name" />
          </label>

          <label class="field">
            <div class="label">DOB (optional)</div>
            <input class="input" id="dob" type="date" value="${t?.dob||""}" />
          </label>

          <label class="field">
            <div class="label">Time zone</div>
            <input class="input" id="timeZone" list="tzList" value="${t?.timeZone||"Asia/Kolkata"}" />
            <datalist id="tzList">
              ${r.slice(0,500).map(s=>`<option value="${s}"></option>`).join("")}
            </datalist>
            <div class="mini muted">Tip: start typing Asia/ and pick from suggestions.</div>
          </label>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>J("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#displayName").value.trim(),a=e.querySelector("#dob").value||null,l=e.querySelector("#timeZone").value.trim()||"Asia/Kolkata";try{const u=oe(te,"users",n.uid);await es(u,{displayName:i,dob:a,timeZone:l,updatedAt:Y()}),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Profile save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Profile save failed:
${u?.message||u}`)}})}const lf=[{id:"seed_water",name:"Water",category:"Health",iconKey:"water",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"ml",config:{incrementStep:250},target:{mode:"value",value:3e3}}},{id:"seed_steps",name:"Steps",category:"Health",iconKey:"steps",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"steps",config:{incrementStep:500},target:{mode:"value",value:8e3}}},{id:"seed_protein",name:"Protein",category:"Health",iconKey:"protein",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"g",config:{incrementStep:10},target:{mode:"value",value:120}}},{id:"seed_calories",name:"Calories",category:"Health",iconKey:"calories",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"kcal",config:{incrementStep:50},target:{mode:"value",value:0}}},{id:"seed_vitamins",name:"Vitamins",category:"Health",iconKey:"vitamins",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_supps",name:"Supplements",category:"Health",iconKey:"supplements",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_workout",name:"Workout",category:"Fitness",iconKey:"workout",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_run",name:"Run",category:"Fitness",iconKey:"run",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_cycle",name:"Cycling",category:"Fitness",iconKey:"cycle",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_swim",name:"Swim",category:"Fitness",iconKey:"swim",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_strength",name:"Strength",category:"Fitness",iconKey:"strength",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_stretch",name:"Stretching",category:"Fitness",iconKey:"stretch",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_mobility",name:"Mobility",category:"Fitness",iconKey:"mobility",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_meditation",name:"Meditation",category:"Mind",iconKey:"meditation",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_breath",name:"Breathwork",category:"Mind",iconKey:"breath",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_journal",name:"Journal",category:"Mind",iconKey:"journal",track:{type:"TEXT_APPEND",cadence:"daily",unit:"entries",config:{maxLength:2e3},target:{mode:"count",value:0}}},{id:"seed_mood",name:"Mood",category:"Mind",iconKey:"mood",track:{type:"DROPDOWN_EVENT",cadence:"daily",unit:"",config:{options:[{id:"great",label:"Great"},{id:"good",label:"Good"},{id:"ok",label:"Okay"},{id:"low",label:"Low"},{id:"bad",label:"Bad"}]},target:{mode:"count",value:0}}},{id:"seed_focus",name:"Focus",category:"Mind",iconKey:"focus",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_gratitude",name:"Gratitude",category:"Mind",iconKey:"gratitude",track:{type:"TEXT_APPEND",cadence:"daily",unit:"entries",config:{maxLength:800},target:{mode:"count",value:0}}},{id:"seed_sleep",name:"Sleep",category:"Lifestyle",iconKey:"sleep",track:{type:"NUMBER_REPLACE",cadence:"daily",unit:"hrs",config:{precision:1,minValue:0,maxValue:24},target:null}},{id:"seed_reading",name:"Reading",category:"Lifestyle",iconKey:"reading",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"min",config:{incrementStep:10},target:{mode:"value",value:20}}},{id:"seed_skincare",name:"Skincare",category:"Lifestyle",iconKey:"skincare",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_screen",name:"Screen Time",category:"Lifestyle",iconKey:"screen_time",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"min",config:{incrementStep:15},target:{mode:"value",value:0}}},{id:"seed_coffee",name:"Coffee",category:"Lifestyle",iconKey:"coffee",track:{type:"COUNTER_INCREMENT",cadence:"daily",unit:"cups",config:{incrementStep:1},target:{mode:"value",value:0}}},{id:"seed_social",name:"Social",category:"Social",iconKey:"social",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_family",name:"Family Time",category:"Social",iconKey:"family",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_music",name:"Music",category:"Social",iconKey:"music",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_learn",name:"Learning",category:"Work",iconKey:"learn",track:{type:"COUNTER_INCREMENT",cadence:"weekly",unit:"min",config:{incrementStep:30},target:{mode:"value",value:0}}},{id:"seed_finance",name:"Finance Review",category:"Work",iconKey:"finance",track:{type:"BOOLEAN",cadence:"monthly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_chores",name:"Chores",category:"Home",iconKey:"chores",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_clean",name:"Clean",category:"Home",iconKey:"clean",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_cook",name:"Cook",category:"Home",iconKey:"cook",track:{type:"BOOLEAN",cadence:"weekly",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_sun",name:"Sunlight",category:"Lifestyle",iconKey:"sunlight",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_posture",name:"Posture",category:"Health",iconKey:"posture",track:{type:"BOOLEAN",cadence:"daily",unit:"",config:{booleanMode:"done_only"},target:null}},{id:"seed_energy",name:"Energy",category:"Mind",iconKey:"energy",track:{type:"NUMBER_REPLACE",cadence:"daily",unit:"/10",config:{precision:0,minValue:0,maxValue:10},target:null}},{id:"seed_misc_quick",name:"Quick Note",category:null,iconKey:"notes",track:{type:"TEXT_APPEND",cadence:"daily",unit:"entries",config:{maxLength:600},target:{mode:"count",value:0}}}];async function _w(n){const e=st(te,"users",n,"tracks"),t=jn(e,Zr("sortOrder","asc"));return(await pn(t)).docs.map(s=>({...s.data(),id:s.id}))}async function pu(n,e,t){const r=oe(te,"users",n,"tracks",e);await es(r,{...t,updatedAt:Y()})}async function vw(n,e){const t=oe(te,"users",n,"tracks",e);await Xd(t)}async function Ew({user:n}){const e=document.getElementById("app");e.innerHTML=ge({title:"Manage Tracks",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let t=[],r=[],s=[];await i(),h(),f();async function i(){t=await _w(n.uid),r=a(t.filter(N=>N.isActive!==!1)),s=a(t.filter(N=>N.isActive===!1))}function a(N){return N.slice().sort((V,U)=>(Number(V.sortOrder)||0)-(Number(U.sortOrder)||0))}function l(N){const V=N.cadence||"",U=N.unit?`  ${N.unit}`:"";return`${V}${U}`.trim()}function u(N){return N?.isPrivate?'<span class="pill">Private</span>':""}function h(){e.innerHTML=ge({title:"Manage Tracks",activeTab:"settings",content:`
        <section class="card">
          <div class="card-title">Active</div>
          <div class="muted">Hold the handle, then drag to reorder.</div>
          ${r.length?`<div class="list" id="activeList">${r.map(m).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No active tracks yet.</div>'}
        </section>

        <section class="card">
          <div class="card-title">Inactive</div>
          <div class="muted">Hidden from Today. Re-enable anytime.</div>
          ${s.length?`<div class="list" id="inactiveList">${s.map(y).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No inactive tracks.</div>'}
        </section>

        <!-- FAB + menu -->
        <button class="fab" id="fabTracks" title="Add track">
          <span class="fab-plus">+</span>
        </button>

        <div class="fab-menu hidden" id="fabMenu">
          <button class="fab-item" id="fabCustom">
            <span class="fab-ico"></span>
            <span>Create custom</span>
          </button>
          <button class="fab-item" id="fabTemplates">
            <span class="fab-ico"></span>
            <span>Templates</span>
          </button>
        </div>

        <div class="fab-backdrop hidden" id="fabBackdrop"></div>
      `})}function f(){e.querySelectorAll("[data-edit]").forEach(N=>{N.addEventListener("click",()=>{const V=N.getAttribute("data-edit");J(`#/settings/tracks/edit?trackId=${encodeURIComponent(V)}`)})}),e.querySelectorAll("[data-toggle]").forEach(N=>{N.addEventListener("click",async()=>{const V=N.getAttribute("data-toggle"),U=N.getAttribute("data-next")==="true";N.disabled=!0;try{await pu(n.uid,V,{isActive:U}),await i(),h(),f()}catch(W){console.error("Toggle failed:",W),alert(W?.message||"Could not update track."),N.disabled=!1}})}),e.querySelectorAll("[data-del]").forEach(N=>{N.addEventListener("click",async()=>{const V=N.getAttribute("data-del"),U=s.find(F=>F.id===V);if(!(!U||!confirm(`Delete "${U.name}"? This cannot be undone.`))){s=s.filter(F=>F.id!==V),h(),f();try{await vw(n.uid,V),await i(),h(),f()}catch(F){console.error("Delete failed:",F),alert(F?.message||"Could not delete track."),await i(),h(),f()}}})}),S(),g()}function m(N){return`
      <div class="track-row" data-id="${N.id}">
        <div class="drag-handle" data-handle="1" title="Hold & drag"></div>

        <div class="track-main">
          <div class="track-title">
            ${M(N.name)}
            ${u(N)}
          </div>
          <div class="track-meta muted">${M(l(N))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${N.id}" title="Edit">
            ${C()}
          </button>

          <!-- Toggle switch: ON -->
          <button class="switch on" data-toggle="${N.id}" data-next="false" title="Disable"></button>
        </div>
      </div>
    `}function y(N){return`
      <div class="track-row track-row-inactive" data-id="${N.id}">
        <div class="drag-handle drag-handle-disabled" title="Inactive"></div>

        <div class="track-main">
          <div class="track-title">
            ${M(N.name)}
            ${u(N)}
          </div>
          <div class="track-meta muted">${M(l(N))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${N.id}" title="Edit">
            ${C()}
          </button>

          <button class="icon-btn danger" data-del="${N.id}" title="Delete">
            ${P()}
          </button>

          <!-- Toggle switch: OFF -->
          <button class="switch" data-toggle="${N.id}" data-next="true" title="Enable"></button>
        </div>
      </div>
    `}function g(){const N=e.querySelector("#fabTracks"),V=e.querySelector("#fabMenu"),U=e.querySelector("#fabBackdrop");if(!N||!V||!U)return;const W=()=>{V.classList.remove("hidden"),U.classList.remove("hidden"),N.classList.add("fab-open")},F=()=>{V.classList.add("hidden"),U.classList.add("hidden"),N.classList.remove("fab-open")};N.addEventListener("click",()=>{!V.classList.contains("hidden")?F():W()}),U.addEventListener("click",F);const T=e.querySelector("#fabCustom"),_=e.querySelector("#fabTemplates");T?.addEventListener("click",()=>{F(),J("#/settings/tracks/new")}),_?.addEventListener("click",()=>{F(),J("#/settings/tracks/templates")})}function S(){const N=e.querySelector("#activeList");if(!N)return;let V=!1,U=!1,W=null,F=null,T=null,_=0,E=0;const I=ae=>{U&&ae.preventDefault()};N.querySelectorAll(".drag-handle").forEach(ae=>{ae.addEventListener("pointerdown",je=>{if(V=!0,U=!1,F=ae.closest(".track-row"),!F)return;ae.setPointerCapture?.(je.pointerId),_=je.clientY;const De=F.getBoundingClientRect();E=_-De.top,W=setTimeout(()=>{V&&w()},180)}),ae.addEventListener("pointermove",je=>{V&&U&&(je.preventDefault(),b(je.clientY))}),ae.addEventListener("pointerup",async()=>{V=!1,clearTimeout(W),U&&(v(),await Ae()),U=!1,F=null}),ae.addEventListener("pointercancel",()=>{V=!1,clearTimeout(W),U&&v(),U=!1,F=null})});function w(){U=!0,T=document.createElement("div"),T.className="drag-placeholder",T.style.height=`${F.getBoundingClientRect().height}px`,F.parentNode.insertBefore(T,F);const ae=F.getBoundingClientRect();F.classList.add("dragging"),F.style.width=`${ae.width}px`,F.style.position="fixed",F.style.left=`${ae.left}px`,F.style.zIndex="9999",document.addEventListener("touchmove",I,{passive:!1}),b(_)}function b(ae){const je=ae-E;F.style.top=`${je}px`;const De=[...N.querySelectorAll(".track-row:not(.dragging)")],Ge=ae;let vt=null;for(const ts of De){const zn=ts.getBoundingClientRect();if(Ge<zn.top+zn.height/2){vt=ts;break}}vt?N.insertBefore(T,vt):N.appendChild(T)}function v(){F.classList.remove("dragging"),F.style.position="",F.style.top="",F.style.left="",F.style.width="",F.style.zIndex="",N.insertBefore(F,T),T.remove(),T=null,document.removeEventListener("touchmove",I)}async function Ae(){r=[...N.querySelectorAll(".track-row")].map(De=>De.getAttribute("data-id")).filter(Boolean).map(De=>r.find(Ge=>Ge.id===De)).filter(Boolean);const je=Date.now();try{await Promise.all(r.map((De,Ge)=>pu(n.uid,De.id,{sortOrder:je+Ge*10}))),await i(),h(),f()}catch(De){console.error(De),alert(De?.message||"Could not save order.")}}}function C(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 20h9"></path>
        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
      </svg>
    `}function P(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18"></path>
        <path d="M8 6V4h8v2"></path>
        <path d="M19 6l-1 14H6L5 6"></path>
        <path d="M10 11v6"></path>
        <path d="M14 11v6"></path>
      </svg>
    `}function M(N){return String(N||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}}function Er(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Ma(){return Math.random().toString(36).slice(2,8)}const Tw=["","COUNTER_INCREMENT","BOOLEAN","NUMBER_REPLACE","TEXT_APPEND","DROPDOWN_EVENT"],ww={COUNTER_INCREMENT:"Counter",BOOLEAN:"Checklist",NUMBER_REPLACE:"Metric",TEXT_APPEND:"Notes",DROPDOWN_EVENT:"Choice"};function Iw(n){return n==="COUNTER_INCREMENT"?{unit:"ml",target:{mode:"value",value:0},config:{incrementStep:250}}:n==="BOOLEAN"?{unit:"",target:null,config:{booleanMode:"done_only"}}:n==="NUMBER_REPLACE"?{unit:"",target:null,config:{precision:2}}:n==="TEXT_APPEND"?{unit:"",target:null,config:{}}:n==="DROPDOWN_EVENT"?{unit:"",target:{mode:"count",value:0},config:{options:[{id:Ma(),label:""}]}}:{unit:"",target:null,config:{}}}function Os(n,e){const t={name:n.name??"",cadence:n.cadence??"daily",type:e,isActive:n.isActive??!0,sortOrder:n.sortOrder??Date.now(),isPrivate:!!n.isPrivate,meta:n.meta??{}};if(!e)return{...t,unit:"",target:null,config:{}};const r=Iw(e),s={};return e==="COUNTER_INCREMENT"&&(s.unit=n.unit||"",s.target={mode:n.target?.mode||"value",value:Number(n.target?.value||0)},s.config={incrementStep:Number(n.config?.incrementStep||1)}),e==="BOOLEAN"&&(s.unit="",s.target=null,s.config={booleanMode:n.config?.booleanMode||"done_only"}),e==="NUMBER_REPLACE"&&(s.unit=n.unit||"",s.target=null,s.config={precision:2}),e==="TEXT_APPEND"&&(s.unit="",s.target=null,s.config={}),e==="DROPDOWN_EVENT"&&(s.unit="",s.target={mode:"count",value:Number(n.target?.value||0)},s.config={options:Array.isArray(n.config?.options)?n.config.options:r.config.options}),{...t,unit:s.unit??r.unit,target:s.target??r.target,config:s.config??r.config}}function Aw(n){const e=n.type;return e?e==="COUNTER_INCREMENT"?`
      <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
        <label class="field" style="min-width:200px;">
          <div class="label">Unit</div>
          <input class="input" id="unit" value="${Er(n.unit||"")}" placeholder="ml / reps / steps..." />
        </label>

        <label class="field" style="min-width:200px;">
          <div class="label">Target</div>
          <input class="input" id="targetValue" type="number" value="${Number(n.target?.value||0)}" />
        </label>

        <label class="field" style="min-width:200px;">
          <div class="label">Increment step</div>
          <input class="input" id="incrementStep" type="number" value="${Number(n.config?.incrementStep||1)}" />
        </label>
      </div>
    `:e==="BOOLEAN"?'<div class="muted" style="margin-top:10px;">Checklist track (done / not done). No extra settings.</div>':e==="NUMBER_REPLACE"?`
      <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
        <label class="field" style="min-width:200px;">
          <div class="label">Unit</div>
          <input class="input" id="unit" value="${Er(n.unit||"")}" placeholder="kg / bpm..." />
        </label>
        <div class="muted" style="margin-top:8px;">Precision is fixed internally.</div>
      </div>
    `:e==="TEXT_APPEND"?'<div class="muted" style="margin-top:10px;">Notes track (append-only). No extra settings.</div>':e==="DROPDOWN_EVENT"?`
      <div style="margin-top:10px;">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div class="label">Options</div>
          <button class="btn" id="addOpt" type="button">Add</button>
        </div>
        <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px;">
          ${(Array.isArray(n.config?.options)?n.config.options:[]).map((r,s)=>`
              <div class="row" style="gap:8px;align-items:center;">
                <input class="input" data-opt="${s}" value="${Er(r.label||"")}" placeholder="Option label" />
                <button class="btn" data-up="${s}" type="button"></button>
                <button class="btn" data-down="${s}" type="button"></button>
                <button class="btn danger" data-del="${s}" type="button"></button>
              </div>
            `).join("")}
        </div>
        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="min-width:200px;">
            <div class="label">Target count</div>
            <input class="input" id="targetCount" type="number" value="${Number(n.target?.value||0)}" />
          </label>
        </div>
      </div>
    `:"":'<div class="muted" style="margin-top:8px;">Select a type to configure it.</div>'}function bw({mode:n,draft:e,publishAsTemplate:t}){return ge({title:n==="edit"?"Edit Track":"New Track",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">${n==="edit"?"Edit track":"Create a track"}</div>
            <div class="muted">Keep it simple. You can refine later.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Name</div>
            <input class="input" id="name" value="${Er(e.name||"")}" placeholder="Water / Steps / Journal" />
          </label>

          <div class="row" style="gap:12px;flex-wrap:wrap;align-items:flex-end;margin-top:10px;">
            <label class="field" style="min-width:220px;">
              <div class="label">Cadence</div>
              <select class="select" id="cadence">
                ${[{v:"daily",l:"Daily"},{v:"weekly",l:"Weekly"},{v:"monthly",l:"Monthly"},{v:"yearly",l:"Yearly"}].map(({v:r,l:s})=>`<option value="${r}" ${e.cadence===r?"selected":""}>${s}</option>`).join("")}
              </select>
            </label>

            <div class="field" style="flex:1;min-width:260px;">
              <div class="row" style="justify-content:space-between;align-items:center;gap:10px;">
                <div class="mini muted">Private (wont appear on leaderboard)</div>
                <button class="switch ${e.isPrivate?"on":""}" id="privacySwitch" type="button"></button>
              </div>
            </div>

            <label class="field" style="min-width:220px;">
              <div class="label">Type</div>
              <select class="select" id="type">
                ${Tw.map(r=>r?`<option value="${r}" ${e.type===r?"selected":""}>${Er(ww[r]||r)}</option>`:`<option value="" ${e.type?"":"selected"}>Select</option>`).join("")}
              </select>
            </label>
          </div>

          <div id="typeFields">${Aw(e)}</div>

          <!-- Publish toggle at END -->
          <div class="field" style="margin-top:12px;">
            <div class="row" style="justify-content:space-between;align-items:center;gap:10px;">
              <div>
                <div class="mini muted">Publish as template</div>
                <div class="muted" style="font-size:12px;margin-top:2px;">
                  Makes this available as a starting template for others.
                </div>
              </div>
              <button class="switch ${t?"on":""}" id="publishSwitch" type="button"></button>
            </div>
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;margin-top:12px;">
            ${n==="edit"?'<button class="btn danger" id="del" type="button">Delete</button>':""}
            <button class="btn primary" id="save" type="button">Save</button>
          </div>
        </div>
      </section>
    `})}function Sw(n){const e=(n.name||"").trim();if(!e)throw new Error("Name is required.");const t=n.cadence||"daily",r=n.type;if(!r)throw new Error("Select a type.");const s=Os(n,r),i={name:e,cadence:t,type:r,isPrivate:!!s.isPrivate};if(r==="COUNTER_INCREMENT"){const a=(s.unit||"").trim();if(!a)throw new Error("Unit is required for Counter.");i.unit=a,i.target={mode:s.target?.mode||"value",value:Number(s.target?.value||0)},i.config={incrementStep:Math.max(0,Number(s.config?.incrementStep||1))}}if(r==="BOOLEAN"&&(i.unit="",i.target=null,i.config={booleanMode:"done_only"}),r==="NUMBER_REPLACE"&&(i.unit=(s.unit||"").trim(),i.target=null,i.config={precision:2}),r==="TEXT_APPEND"&&(i.unit="",i.target=null,i.config={}),r==="DROPDOWN_EVENT"){i.unit="",i.target={mode:"count",value:Number(s.target?.value||0)};const l=(Array.isArray(s.config?.options)?s.config.options:[]).map(u=>({id:u.id||Ma(),label:(u.label||"").trim()})).filter(u=>u.label.length);if(!l.length)throw new Error("Add at least one option.");i.config={options:l}}return i}async function mu({user:n,mode:e}){const t=document.getElementById("app"),{query:r}=Ir(),s=r.get("trackId"),i=r.get("seedId"),a=r.get("templateId");if(e==="edit"&&!s){J("#/settings/tracks");return}t.innerHTML=ge({title:"Track",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let l=null;if(!s&&i){const y=(lf||[]).find(g=>g.id===i);y&&(l={id:y.id,name:y.name,cadence:y.track?.cadence||"daily",type:y.track?.type||"",unit:y.track?.unit||"",target:y.track?.target??null,config:y.track?.config??{},category:y.category??null})}if(!s&&!l&&a)try{const y=await Lr(oe(te,"trackTemplates",a));y.exists()&&(l={id:y.id,...y.data()})}catch(y){console.warn("Template read failed:",y?.message||y),l=null}let u=null;if(e==="edit"){const y=oe(te,"users",n.uid,"tracks",s),g=await Lr(y);if(!g.exists()){alert("Track not found."),J("#/settings/tracks");return}u={id:g.id,...g.data()}}let h=u?Os({name:u.name||"",cadence:u.cadence||"daily",type:u.type||"",unit:u.unit,target:u.target??null,config:u.config??{},isActive:u.isActive??!0,sortOrder:u.sortOrder??Date.now(),isPrivate:!!u.isPrivate,meta:u.meta??{}},u.type||""):l?Os({name:l.name||"",cadence:l.cadence||"daily",type:l.type||"",unit:l.unit,target:l.target??null,config:l.config??{},isActive:!0,sortOrder:Date.now(),isPrivate:!1,meta:{templateId:l.id,category:l.category??void 0}},l.type||""):{name:"",cadence:"daily",type:"",isPrivate:!1,isActive:!0,sortOrder:Date.now(),unit:"",target:null,config:{},meta:{}},f=!1;function m(){t.innerHTML=bw({mode:e,draft:h,publishAsTemplate:f}),t.querySelector("#back").addEventListener("click",()=>J("#/settings/tracks")),t.querySelector("#name").addEventListener("input",g=>h.name=g.target.value),t.querySelector("#cadence").addEventListener("change",g=>h.cadence=g.target.value),t.querySelector("#privacySwitch").addEventListener("click",()=>{h.isPrivate=!h.isPrivate,m()}),t.querySelector("#publishSwitch").addEventListener("click",()=>{f=!f,m()}),t.querySelector("#type").addEventListener("change",g=>{h=Os(h,g.target.value),m()});const y=h.type;if(y==="COUNTER_INCREMENT"&&(t.querySelector("#unit").addEventListener("input",g=>h.unit=g.target.value),t.querySelector("#targetValue").addEventListener("input",g=>h.target={mode:"value",value:Number(g.target.value||0)}),t.querySelector("#incrementStep").addEventListener("input",g=>h.config={...h.config??{},incrementStep:Number(g.target.value||1)})),y==="NUMBER_REPLACE"&&t.querySelector("#unit").addEventListener("input",g=>h.unit=g.target.value),y==="DROPDOWN_EVENT"){t.querySelector("#addOpt")?.addEventListener("click",()=>{const S=Array.isArray(h.config?.options)?h.config.options:[];S.push({id:Ma(),label:""}),h.config={...h.config??{},options:S},m()});const g=Array.isArray(h.config?.options)?h.config.options:[];t.querySelectorAll("[data-opt]").forEach(S=>{S.addEventListener("input",C=>{const P=Number(S.getAttribute("data-opt"));g[P]={...g[P],label:C.target.value},h.config={...h.config??{},options:g}})}),t.querySelectorAll("[data-up]").forEach(S=>{S.addEventListener("click",()=>{const C=Number(S.getAttribute("data-up"));C<=0||([g[C-1],g[C]]=[g[C],g[C-1]],h.config={...h.config??{},options:g},m())})}),t.querySelectorAll("[data-down]").forEach(S=>{S.addEventListener("click",()=>{const C=Number(S.getAttribute("data-down"));C>=g.length-1||([g[C+1],g[C]]=[g[C],g[C+1]],h.config={...h.config??{},options:g},m())})}),t.querySelectorAll("[data-del]").forEach(S=>{S.addEventListener("click",()=>{const C=Number(S.getAttribute("data-del"));g.splice(C,1),h.config={...h.config??{},options:g},m()})}),t.querySelector("#targetCount")?.addEventListener("input",S=>h.target={mode:"count",value:Number(S.target.value||0)})}t.querySelector("#save").addEventListener("click",async()=>{try{const g=Sw(h),S=xr(g),C={...h.meta??{},createdBy:n.uid,normalizedKey:S};if(e!=="edit"){const M=(await _T(n.uid)).find(N=>{const V={name:N.name,type:N.type,cadence:N.cadence,unit:N.unit,target:N.target??null,config:N.config??{}};return xr(V)===S});if(M){M.isActive===!1&&await hu(n.uid,M.id,{isActive:!0}),J(`#/settings/tracks/edit?trackId=${M.id}`);return}}if(f){const P=await IT({track:{...g,meta:C},createdBy:n.uid,createdByName:n.displayName??null,category:C.category??null});C.templateId=P}e==="edit"?await hu(n.uid,s,{...g,meta:C}):await vT(n.uid,{...g,meta:C,isActive:!0,sortOrder:Date.now()}),J("#/settings/tracks")}catch(g){alert(g?.message||String(g))}}),t.querySelector("#del")?.addEventListener("click",async()=>{confirm("Delete this track? This wont delete past entries.")&&(await ET(n.uid,s),J("#/settings/tracks"))})}m()}async function Rw({user:n}){const e=document.getElementById("app");e.innerHTML=ge({title:"Theme",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await un(n.uid),r=tf(t?.preferences);e.innerHTML=ge({title:"Theme",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Theme</div>
            <div class="muted">Set the vibe. Keep it calm.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Mode</div>
            <select class="select" id="themeMode">
              <option value="system" ${r.themeMode==="system"?"selected":""}>System</option>
              <option value="light" ${r.themeMode==="light"?"selected":""}>Light</option>
              <option value="dark" ${r.themeMode==="dark"?"selected":""}>Dark</option>
            </select>
          </label>

          <div class="row" style="gap:14px;flex-wrap:wrap;align-items:center;">
            <label class="field" style="min-width:200px;">
              <div class="label">Accent 1</div>
              <input class="input" id="accent1" type="color" value="${r.accent1}" />
            </label>

            <label class="field" style="min-width:200px;">
              <div class="label">Accent 2</div>
              <input class="input" id="accent2" type="color" value="${r.accent2}" />
            </label>
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>J("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#themeMode").value,a=e.querySelector("#accent1").value,l=e.querySelector("#accent2").value;try{const u=oe(te,"users",n.uid);await es(u,{preferences:{themeMode:i,accent1:a,accent2:l},updatedAt:Y()});const h=await un(n.uid);nf(h),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Theme save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Theme save failed:
${u?.message||u}`)}})}function uf(n){const e='width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"';if(!n)return`<svg ${e}>
      <path d="M12 2l1.2 4.2L17 7.5l-3.8 1.3L12 13l-1.2-4.2L7 7.5l3.8-1.3L12 2z" fill="currentColor" opacity="0.95"/>
      <path d="M18 12l.8 2.6 2.2.8-2.2.8L18 18l-.8-2.6-2.2-.8 2.2-.8L18 12z" fill="currentColor" opacity="0.8"/>
    </svg>`;const t='<path d="M12 2s-6 7-6 12a6 6 0 0012 0c0-5-6-12-6-12z" fill="currentColor"/>',r='<path d="M9.2 12.6l-1.6-1.6-1.4 1.4 3 3 7-7-1.4-1.4-5.6 5.6z" fill="currentColor"/>',s='<path d="M13 2L4 14h7l-1 8 9-12h-7l1-8z" fill="currentColor"/>';switch(n){case"water":case"hydrate":return`<svg ${e}>${t}</svg>`;case"steps":return`<svg ${e}>
        <path d="M8 3c2 0 3 2 3 4v2H8c-1.7 0-3-1.3-3-3 0-1.7 1.3-3 3-3z" fill="currentColor"/>
        <path d="M16 11c2 0 3 2 3 4v2h-3c-1.7 0-3-1.3-3-3 0-1.7 1.3-3 3-3z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"protein":return`<svg ${e}>
        <path d="M7 4h10a2 2 0 012 2v12a2 2 0 01-2 2H7a2 2 0 01-2-2V6a2 2 0 012-2z" fill="currentColor" opacity="0.9"/>
        <path d="M9 8h6v2H9V8zm0 4h6v2H9v-2z" fill="black" opacity="0.28"/>
      </svg>`;case"calories":return`<svg ${e}>
        <path d="M12 3c3 2.4 5 5.3 5 9a5 5 0 11-10 0c0-3.7 2-6.6 5-9z" fill="currentColor"/>
        <path d="M12 7c.9 1.2 1.6 2.3 1.6 3.6A1.6 1.6 0 1110.4 10c0-1.1.6-2.1 1.6-3z" fill="black" opacity="0.25"/>
      </svg>`;case"vitamins":case"supplements":return`<svg ${e}>
        <path d="M9 3h6v6H9V3z" fill="currentColor" opacity="0.9"/>
        <path d="M7 9h10a4 4 0 010 8H7a4 4 0 010-8z" fill="currentColor"/>
        <path d="M12 9v8" stroke="black" opacity="0.25" stroke-width="1.5"/>
      </svg>`;case"sunlight":case"nature":return`<svg ${e}>
        <path d="M12 7a5 5 0 100 10 5 5 0 000-10z" fill="currentColor"/>
        <path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M19.8 4.2l-2.1 2.1M6.3 17.7l-2.1 2.1"
          stroke="currentColor" stroke-width="1.5" opacity="0.75" stroke-linecap="round"/>
      </svg>`;case"posture":return`<svg ${e}>
        <path d="M12 4a2 2 0 110 4 2 2 0 010-4z" fill="currentColor"/>
        <path d="M10 21v-7l-2-3 2-2 2 2 2-2 2 2-2 3v7h-2v-6h-2v6h-2z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"energy":return`<svg ${e}>${s}</svg>`;case"done":case"check":return`<svg ${e}>${r}</svg>`;case"workout":case"strength":return`<svg ${e}>
        <path d="M5 10h2V8h2v8H7v-2H5v-4zm10-2h2v2h2v4h-2v2h-2V8zm-6 3h6v2H9v-2z" fill="currentColor"/>
      </svg>`;case"run":return`<svg ${e}>
        <path d="M13 5a2 2 0 11.001 4.001A2 2 0 0113 5z" fill="currentColor"/>
        <path d="M11 21l1-5-2-2-2 2-2-1 3-5 3-1 2 2h3v2h-2l-1 3 2 2-1 4h-2z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"cycle":return`<svg ${e}>
        <path d="M7 17a3 3 0 110-6 3 3 0 010 6zm10 0a3 3 0 110-6 3 3 0 010 6z" fill="currentColor"/>
        <path d="M8 14h4l2-4h2l-3 6H8v-2z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"swim":return`<svg ${e}>
        <path d="M13 6a2 2 0 11.001 4.001A2 2 0 0113 6z" fill="currentColor"/>
        <path d="M3 15c2 1.5 4 1.5 6 0 2 1.5 4 1.5 6 0 2 1.5 4 1.5 6 0v2c-2 1.5-4 1.5-6 0-2 1.5-4 1.5-6 0-2 1.5-4 1.5-6 0v-2z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"yoga":case"stretch":case"mobility":return`<svg ${e}>
        <path d="M12 4a2 2 0 110 4 2 2 0 010-4z" fill="currentColor"/>
        <path d="M6 20c2-4 4-6 6-6s4 2 6 6h-2c-1.2-2.5-2.5-4-4-4s-2.8 1.5-4 4H6z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"meditation":case"breath":return`<svg ${e}>
        <path d="M12 4a3 3 0 110 6 3 3 0 010-6z" fill="currentColor"/>
        <path d="M6.5 20c1.3-3 3.4-4.5 5.5-4.5S16.2 17 17.5 20H6.5z" fill="currentColor" opacity="0.9"/>
      </svg>`;case"journal":case"notes":return`<svg ${e}>
        <path d="M7 4h9a2 2 0 012 2v14H7a2 2 0 01-2-2V6a2 2 0 012-2z" fill="currentColor"/>
        <path d="M9 8h7v2H9V8zm0 4h7v2H9v-2z" fill="black" opacity="0.28"/>
      </svg>`;case"mood":return`<svg ${e}>
        <path d="M12 4a8 8 0 100 16 8 8 0 000-16z" fill="currentColor"/>
        <path d="M9.2 11.2a1 1 0 110-2 1 1 0 010 2zm5.6 0a1 1 0 110-2 1 1 0 010 2z" fill="black" opacity="0.25"/>
        <path d="M8.8 14.5c1 .9 2.2 1.3 3.2 1.3s2.2-.4 3.2-1.3" stroke="black" stroke-width="1.5" opacity="0.25" stroke-linecap="round"/>
      </svg>`;case"focus":return`<svg ${e}>
        <path d="M12 4a8 8 0 100 16 8 8 0 000-16z" fill="currentColor" opacity="0.9"/>
        <path d="M12 8a4 4 0 100 8 4 4 0 000-8z" fill="black" opacity="0.22"/>
        <path d="M12 10.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z" fill="black" opacity="0.28"/>
      </svg>`;case"gratitude":return`<svg ${e}>
        <path d="M12 21s-7-4.4-9-9c-1.5-3.5 1-7 4.5-7 1.8 0 3.2 1 4.5 2.5C13.8 6 15.2 5 17 5c3.5 0 6 3.5 4.5 7-2 4.6-9 9-9 9z" fill="currentColor"/>
      </svg>`;case"sleep":return`<svg ${e}>
        <path d="M14.5 3.5c-4.4.9-7 5.3-5.7 9.4 1.2 3.7 5.1 5.8 8.8 4.7-4.2 2.2-9.4-.1-10.7-4.6C5.4 7.9 9.1 3.2 14.5 3.5z" fill="currentColor"/>
      </svg>`;case"reading":return`<svg ${e}>
        <path d="M6 5h6a3 3 0 013 3v12H9a3 3 0 01-3-3V5z" fill="currentColor" opacity="0.95"/>
        <path d="M12 5h6v12a3 3 0 01-3 3h-3V5z" fill="currentColor" opacity="0.75"/>
      </svg>`;case"skincare":return`<svg ${e}>
        <path d="M12 3c3 2.2 5 5.5 5 9.2 0 4-2.2 7.8-5 8.8-2.8-1-5-4.8-5-8.8C7 8.5 9 5.2 12 3z" fill="currentColor"/>
      </svg>`;case"coffee":return`<svg ${e}>
        <path d="M6 8h10v6a4 4 0 01-4 4H10a4 4 0 01-4-4V8z" fill="currentColor"/>
        <path d="M16 9h1a2 2 0 010 4h-1V9z" fill="currentColor" opacity="0.85"/>
      </svg>`;case"screen_time":return`<svg ${e}>
        <path d="M7 5h10a2 2 0 012 2v8a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2z" fill="currentColor"/>
        <path d="M10 19h4" stroke="currentColor" stroke-width="1.5" opacity="0.75" stroke-linecap="round"/>
      </svg>`;case"social":case"friends":case"family":return`<svg ${e}>
        <path d="M8.5 11a2.5 2.5 0 110-5 2.5 2.5 0 010 5zm7 0a2.5 2.5 0 110-5 2.5 2.5 0 010 5z" fill="currentColor"/>
        <path d="M4 20c.8-3 2.6-4.5 4.5-4.5S12.2 17 13 20H4z" fill="currentColor" opacity="0.85"/>
        <path d="M11 20c.7-2.6 2.3-4 4.5-4s3.8 1.4 4.5 4H11z" fill="currentColor" opacity="0.7"/>
      </svg>`;case"music":return`<svg ${e}>
        <path d="M10 4v12.5a2.5 2.5 0 11-1.5-2.3V6h8v8.5a2.5 2.5 0 11-1.5-2.3V4h-5z" fill="currentColor"/>
      </svg>`;case"learn":case"practice":return`<svg ${e}>
        <path d="M4 7l8-3 8 3-8 3-8-3z" fill="currentColor" opacity="0.9"/>
        <path d="M6 10v6l6 3 6-3v-6l-6 3-6-3z" fill="currentColor"/>
      </svg>`;case"chores":case"clean":return`<svg ${e}>
        <path d="M7 10h10v10H7V10z" fill="currentColor" opacity="0.9"/>
        <path d="M9 4h6l1 6H8l1-6z" fill="currentColor"/>
      </svg>`;case"cook":return`<svg ${e}>
        <path d="M7 6h10v4H7V6z" fill="currentColor"/>
        <path d="M6 10h12v10H6V10z" fill="currentColor" opacity="0.85"/>
        <path d="M9 4v2M12 3v3M15 4v2" stroke="currentColor" stroke-width="1.5" opacity="0.7" stroke-linecap="round"/>
      </svg>`;case"finance":return`<svg ${e}>
        <path d="M6 18V9h3v9H6zm5 0V6h3v12h-3zm5 0v-7h3v7h-3z" fill="currentColor"/>
      </svg>`;default:return uf(null)}}const Cw={COUNTER_INCREMENT:"Counter",BOOLEAN:"Checklist",NUMBER_REPLACE:"Metric",TEXT_APPEND:"Notes",DROPDOWN_EVENT:"Choice"};function Pw(n){return n?n.charAt(0).toUpperCase()+n.slice(1):""}const gu=["tt-g1","tt-g2","tt-g3","tt-g4","tt-g5","tt-g7","tt-g8","tt-g9","tt-g10","tt-g11","tt-g12"];function kw(){return gu[Math.floor(Math.random()*gu.length)]}const yu=["tt-cat1","tt-cat2","tt-cat3","tt-cat4","tt-cat5","tt-cat6"];function Nw(n){let e=2166136261;for(let t=0;t<n.length;t++)e^=n.charCodeAt(t),e=Math.imul(e,16777619);return e>>>0}function Dw(n){return yu[Nw(String(n||""))%yu.length]}async function Vw(){const n=document.getElementById("app"),e=it.currentUser;if(!e?.uid){n.innerHTML=ge({title:"Templates",activeTab:"settings",content:'<div class="tt-page"><div class="muted">Please log in.</div></div>'});return}let t=null;try{t=await un(e.uid)}catch(g){console.warn("Failed to load my profile:",g?.message||g)}const r=Array.isArray(t?.friends)?t.friends:[],s=new Set([e.uid,...r]),i={};for(const g of r){const S=await un(g);i[g]=(S?.displayName||"").trim()}let a=[];try{a=await wT()}catch(g){console.warn("Failed to load DB templates:",g?.message||g)}const l=(lf||[]).map(g=>({id:g.id,name:g.name,displayLabel:g.displayLabel||g.name,category:g.category??null,createdBy:g.createdBy??null,createdByName:g.createdByName??null,iconKey:g.iconKey??null,track:g.track,source:"seed",normalizedKey:g.normalizedKey||xr({name:g.name,type:g.track?.type,cadence:g.track?.cadence,unit:g.track?.unit,target:g.track?.target,config:g.track?.config})})),u=(a||[]).map(g=>({id:g.id,name:g.name,displayLabel:g.displayLabel||g.name,category:g.category??null,createdBy:g.createdBy??null,createdByName:g.createdByName??null,iconKey:null,track:{type:g.type,cadence:g.cadence,unit:g.unit,target:g.target??null,config:g.config??{}},source:"db",normalizedKey:g.normalizedKey||xr({name:g.name,type:g.type,cadence:g.cadence,unit:g.unit,target:g.target??null,config:g.config??{}})})).filter(g=>g.createdBy?s.has(g.createdBy):!1),h={};for(const g of l)h[g.normalizedKey]=g;for(const g of u)h[g.normalizedKey]=g;const f=Object.values(h),m={};for(const g of f){let S="Misc";g.source==="db"?g.createdBy===e.uid?S="Added by you":S=`Added by ${i[g.createdBy]||"friend"}`:g.category&&(S=g.category),m[S]||(m[S]=[]),m[S].push(g)}const y=Object.keys(m).sort((g,S)=>{const C=g==="Misc",P=S==="Misc";if(C&&!P)return 1;if(!C&&P)return-1;const M=g.startsWith("Added by")||g==="Added by friend",N=S.startsWith("Added by")||S==="Added by friend";return M&&!N?1:!M&&N?-1:g.localeCompare(S)});for(const g of y)m[g].sort((S,C)=>(S.displayLabel||S.name).localeCompare(C.displayLabel||C.name));n.innerHTML=ge({title:"Templates",activeTab:"settings",content:`
      <div class="tt-page">
        ${y.map(g=>{const S=m[g]||[];return`
              <section class="tt-group">
                <div class="tt-header ${Dw(g)}">
                  <div class="tt-hTitle">${g}</div>
                  <div class="tt-divider"></div>
                </div>

                <div class="tt-grid">
                  ${S.map(P=>{const M=Cw[P.track?.type]||P.track?.type||"",N=Pw(P.track?.cadence);return`
                        <button
                          class="tt-tile ${kw()}"
                          data-template-id="${P.id}"
                          data-source="${P.source}"
                          type="button">
                          <div class="tt-icon">${uf(P.iconKey)}</div>
                          <div class="tt-title">${P.displayLabel||P.name}</div>
                          <div class="tt-footer">
                            <span class="tt-cadence">${N||""}</span>
                            <span class="tt-type">${M}</span>
                          </div>
                        </button>
                      `}).join("")}
                </div>
              </section>
            `}).join("")}
      </div>
    `}),n.querySelectorAll(".tt-tile").forEach(g=>{g.addEventListener("click",()=>{const S=g.dataset.templateId,C=g.dataset.source;S&&J(C==="seed"?`#/settings/tracks/new?seedId=${S}`:`#/settings/tracks/new?templateId=${S}`)})})}let ne=null,Ue=null,Tr=null,hf=!1,wr=null;function _u(n){return n==="#/welcome"||n.startsWith("#/auth")}function Ow(n){return["#/profile-setup","#/home","#/today","#/today/log","#/history","#/settings","#/leaderboard","#/settings/profile","#/settings/theme","#/settings/tracks","#/settings/tracks/edit","#/settings/tracks/new","#/settings/tracks/templates"].includes(n.split("?")[0])}async function Mw(){if(!ne){Ue=null,Tr=null;return}Tr!==ne.uid&&(Tr=ne.uid,Ue=await un(ne.uid))}function vu(n){switch(n.split("?")[0]){case"#/welcome":return Eu;case"#/auth":return CT;case"#/auth/email":return DT;case"#/auth/password":return MT;case"#/auth/create-password":return UT;case"#/profile-setup":return()=>rf({user:ne});case"#/home":return()=>Vs({user:ne,profile:Ue});case"#/today":return()=>rw({user:ne,profile:Ue});case"#/today/log":return()=>sw({user:ne,profile:Ue});case"#/history":return lw;case"#/leaderboard":return mw;case"#/settings":return()=>uw();case"#/settings/profile":return()=>yw({user:ne});case"#/settings/theme":return()=>Rw({user:ne});case"#/settings/tracks":return()=>Ew({user:ne});case"#/settings/tracks/edit":return()=>mu({user:ne,mode:"edit"});case"#/settings/tracks/new":return()=>mu({user:ne,mode:"new"});case"#/settings/tracks/templates":return()=>Vw();default:return null}}function Lw(n){console.error("App render fatal:",n);const e=document.getElementById("app");e.innerHTML=`
    <div class="center">
      <div class="card">
        <div class="card-title">Something broke</div>
        <p class="muted" style="white-space:pre-wrap;">${n?.message||String(n)}</p>
        <button class="btn" onclick="location.reload()">Reload</button>
      </div>
    </div>
  `}async function df(){try{if(!hf){document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';return}const{path:n}=Ir();if(!n){J("#/welcome");return}if(!ne){document.body.classList.add("public-bg"),_u(n)||J("#/welcome");const{path:e}=Ir();(vu(e)||Eu)();return}if(await Mw(),!Ue&&n!=="#/profile-setup"){J("#/profile-setup"),rf({user:ne});return}if(ne&&Ue&&wr!==ne.uid)try{const e=await yT(ne.uid,ne.email,Ue);wr=ne.uid,e&&(Ue=await un(ne.uid))}catch(e){console.error("Profile normalization failed:",e),wr=ne.uid}try{nf(Ue)}catch(e){console.warn("Theme apply failed (continuing):",e)}if(Ue&&_u(n)){J("#/home"),Vs();return}if(Ow(n)){(vu(n)||Vs)();return}J("#/home"),Vs()}catch(n){Lw(n)}}qf(df);lT(async n=>{ne=n||null,ne&&(document.body.classList.remove("public-bg"),document.body.style.removeProperty("--publicBgUrl")),hf=!0,ne?Tr!==ne.uid&&(Ue=null,wr=null):(Ue=null,Tr=null,wr=null),await df()});document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';
