(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Rf=()=>{};var wc={};const ru=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Sf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},su={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let v=(l&15)<<2|d>>6,R=d&63;u||(R=64,a||(v=64)),r.push(t[f],t[m],t[v],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ru(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Sf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new Pf;const v=i<<2|l>>4;if(r.push(v),d!==64){const R=l<<4&240|d>>2;if(r.push(R),m!==64){const D=d<<6&192|m;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Pf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Cf=function(n){const e=ru(n);return su.encodeByteArray(e,!0)},Es=function(n){return Cf(n).replace(/\./g,"")},iu=function(n){try{return su.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function kf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Nf=()=>kf().__FIREBASE_DEFAULTS__,Df=()=>{if(typeof process>"u"||typeof wc>"u")return;const n=wc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Vf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&iu(n[1]);return e&&JSON.parse(e)},$s=()=>{try{return Rf()||Nf()||Df()||Vf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ou=n=>$s()?.emulatorHosts?.[n],Of=n=>{const e=ou(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},au=()=>$s()?.config,cu=n=>$s()?.[`_${n}`];class Lf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function bn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function lu(n){return(await fetch(n,{credentials:"include"})).ok}function Mf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Es(JSON.stringify(t)),Es(JSON.stringify(a)),""].join(".")}const nr={};function xf(){const n={prod:[],emulator:[]};for(const e of Object.keys(nr))nr[e]?n.emulator.push(e):n.prod.push(e);return n}function Uf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ac=!1;function uu(n,e){if(typeof window>"u"||typeof document>"u"||!bn(window.location.host)||nr[n]===e||nr[n]||Ac)return;nr[n]=e;function t(v){return`__firebase__banner__${v}`}const r="__firebase__banner",i=xf().prod.length>0;function a(){const v=document.getElementById(r);v&&v.remove()}function l(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ac=!0,a()},v}function f(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function m(){const v=Uf(r),R=t("text"),D=document.getElementById(R)||document.createElement("span"),k=t("learnmore"),C=document.getElementById(k)||document.createElement("a"),M=t("preprendIcon"),q=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const x=v.element;l(x),f(C,k);const H=d();u(q,M),x.append(q,D,C,H),document.body.appendChild(x)}i?(D.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ff(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function Bf(){const n=$s()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function $f(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function qf(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function jf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Hf(){const n=Se();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function zf(){return!Bf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Wf(){try{return typeof indexedDB=="object"}catch{return!1}}function Gf(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const Kf="FirebaseError";class dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Kf,Object.setPrototypeOf(this,dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ar.prototype.create)}}class Ar{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Qf(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new dt(s,l,r)}}function Qf(n,e){return n.replace(Yf,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Yf=/\{\$([^}]+)}/g;function Xf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Qt(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(bc(i)&&bc(a)){if(!Qt(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function bc(n){return n!==null&&typeof n=="object"}function br(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Yn(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Xn(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Jf(n,e){const t=new Zf(n,e);return t.subscribe.bind(t)}class Zf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ep(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ui),s.error===void 0&&(s.error=Ui),s.complete===void 0&&(s.complete=Ui);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ep(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ui(){}function oe(n){return n&&n._delegate?n._delegate:n}class Yt{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const zt="[DEFAULT]";class tp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Lf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rp(e))try{this.getOrInitializeService({instanceIdentifier:zt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=zt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zt){return this.instances.has(e)}getOptions(e=zt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:np(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=zt){return this.component?this.component.multipleInstances?e:zt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function np(n){return n===zt?void 0:n}function rp(n){return n.instantiationMode==="EAGER"}class sp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(z||(z={}));const ip={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},op=z.INFO,ap={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},cp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ap[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ao{constructor(e){this.name=e,this._logLevel=op,this._logHandler=cp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ip[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}}const lp=(n,e)=>e.some(t=>n instanceof t);let Rc,Sc;function up(){return Rc||(Rc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hp(){return Sc||(Sc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const hu=new WeakMap,Zi=new WeakMap,du=new WeakMap,Fi=new WeakMap,bo=new WeakMap;function dp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(bt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&hu.set(t,n)}).catch(()=>{}),bo.set(e,n),e}function fp(n){if(Zi.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Zi.set(n,e)}let eo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Zi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||du.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function pp(n){eo=n(eo)}function mp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Bi(this),e,...t);return du.set(r,e.sort?e.sort():[e]),bt(r)}:hp().includes(n)?function(...e){return n.apply(Bi(this),e),bt(hu.get(this))}:function(...e){return bt(n.apply(Bi(this),e))}}function gp(n){return typeof n=="function"?mp(n):(n instanceof IDBTransaction&&fp(n),lp(n,up())?new Proxy(n,eo):n)}function bt(n){if(n instanceof IDBRequest)return dp(n);if(Fi.has(n))return Fi.get(n);const e=gp(n);return e!==n&&(Fi.set(n,e),bo.set(e,n)),e}const Bi=n=>bo.get(n);function _p(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=bt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(bt(a.result),u.oldVersion,u.newVersion,bt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const yp=["get","getKey","getAll","getAllKeys","count"],vp=["put","add","delete","clear"],$i=new Map;function Pc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if($i.get(e))return $i.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=vp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yp.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&u.done]))[0]};return $i.set(e,i),i}pp(n=>({...n,get:(e,t,r)=>Pc(e,t)||n.get(e,t,r),has:(e,t)=>!!Pc(e,t)||n.has(e,t)}));class Ep{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Tp(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Tp(n){return n.getComponent()?.type==="VERSION"}const to="@firebase/app",Cc="0.14.6";const ct=new Ao("@firebase/app"),Ip="@firebase/app-compat",wp="@firebase/analytics-compat",Ap="@firebase/analytics",bp="@firebase/app-check-compat",Rp="@firebase/app-check",Sp="@firebase/auth",Pp="@firebase/auth-compat",Cp="@firebase/database",kp="@firebase/data-connect",Np="@firebase/database-compat",Dp="@firebase/functions",Vp="@firebase/functions-compat",Op="@firebase/installations",Lp="@firebase/installations-compat",Mp="@firebase/messaging",xp="@firebase/messaging-compat",Up="@firebase/performance",Fp="@firebase/performance-compat",Bp="@firebase/remote-config",$p="@firebase/remote-config-compat",qp="@firebase/storage",jp="@firebase/storage-compat",Hp="@firebase/firestore",zp="@firebase/ai",Wp="@firebase/firestore-compat",Gp="firebase",Kp="12.6.0";const no="[DEFAULT]",Qp={[to]:"fire-core",[Ip]:"fire-core-compat",[Ap]:"fire-analytics",[wp]:"fire-analytics-compat",[Rp]:"fire-app-check",[bp]:"fire-app-check-compat",[Sp]:"fire-auth",[Pp]:"fire-auth-compat",[Cp]:"fire-rtdb",[kp]:"fire-data-connect",[Np]:"fire-rtdb-compat",[Dp]:"fire-fn",[Vp]:"fire-fn-compat",[Op]:"fire-iid",[Lp]:"fire-iid-compat",[Mp]:"fire-fcm",[xp]:"fire-fcm-compat",[Up]:"fire-perf",[Fp]:"fire-perf-compat",[Bp]:"fire-rc",[$p]:"fire-rc-compat",[qp]:"fire-gcs",[jp]:"fire-gcs-compat",[Hp]:"fire-fst",[Wp]:"fire-fst-compat",[zp]:"fire-vertex","fire-js":"fire-js",[Gp]:"fire-js-all"};const Ts=new Map,Yp=new Map,ro=new Map;function kc(n,e){try{n.container.addComponent(e)}catch(t){ct.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function yn(n){const e=n.name;if(ro.has(e))return ct.debug(`There were multiple attempts to register component ${e}.`),!1;ro.set(e,n);for(const t of Ts.values())kc(t,n);for(const t of Yp.values())kc(t,n);return!0}function Ro(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Le(n){return n==null?!1:n.settings!==void 0}const Xp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rt=new Ar("app","Firebase",Xp);class Jp{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Yt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Rt.create("app-deleted",{appName:this._name})}}const Rn=Kp;function fu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:no,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Rt.create("bad-app-name",{appName:String(s)});if(t||(t=au()),!t)throw Rt.create("no-options");const i=Ts.get(s);if(i){if(Qt(t,i.options)&&Qt(r,i.config))return i;throw Rt.create("duplicate-app",{appName:s})}const a=new sp(s);for(const u of ro.values())a.addComponent(u);const l=new Jp(t,r,a);return Ts.set(s,l),l}function pu(n=no){const e=Ts.get(n);if(!e&&n===no&&au())return fu();if(!e)throw Rt.create("no-app",{appName:n});return e}function St(n,e,t){let r=Qp[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ct.warn(a.join(" "));return}yn(new Yt(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Zp="firebase-heartbeat-database",em=1,ur="firebase-heartbeat-store";let qi=null;function mu(){return qi||(qi=_p(Zp,em,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ur)}catch(t){console.warn(t)}}}}).catch(n=>{throw Rt.create("idb-open",{originalErrorMessage:n.message})})),qi}async function tm(n){try{const t=(await mu()).transaction(ur),r=await t.objectStore(ur).get(gu(n));return await t.done,r}catch(e){if(e instanceof dt)ct.warn(e.message);else{const t=Rt.create("idb-get",{originalErrorMessage:e?.message});ct.warn(t.message)}}}async function Nc(n,e){try{const r=(await mu()).transaction(ur,"readwrite");await r.objectStore(ur).put(e,gu(n)),await r.done}catch(t){if(t instanceof dt)ct.warn(t.message);else{const r=Rt.create("idb-set",{originalErrorMessage:t?.message});ct.warn(r.message)}}}function gu(n){return`${n.name}!${n.options.appId}`}const nm=1024,rm=30;class sm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new om(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>rm){const s=am(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ct.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Dc(),{heartbeatsToSend:t,unsentEntries:r}=im(this._heartbeatsCache.heartbeats),s=Es(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ct.warn(e),""}}}function Dc(){return new Date().toISOString().substring(0,10)}function im(n,e=nm){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Vc(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class om{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wf()?Gf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await tm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Vc(n){return Es(JSON.stringify({version:2,heartbeats:n})).length}function am(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function cm(n){yn(new Yt("platform-logger",e=>new Ep(e),"PRIVATE")),yn(new Yt("heartbeat",e=>new sm(e),"PRIVATE")),St(to,Cc,n),St(to,Cc,"esm2020"),St("fire-js","")}cm("");function _u(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const lm=_u,yu=new Ar("auth","Firebase",_u());const Is=new Ao("@firebase/auth");function um(n,...e){Is.logLevel<=z.WARN&&Is.warn(`Auth (${Rn}): ${n}`,...e)}function cs(n,...e){Is.logLevel<=z.ERROR&&Is.error(`Auth (${Rn}): ${n}`,...e)}function Be(n,...e){throw Po(n,...e)}function qe(n,...e){return Po(n,...e)}function So(n,e,t){const r={...lm(),[e]:t};return new Ar("auth","Firebase",r).create(e,{appName:n.name})}function ot(n){return So(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function hm(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Be(n,"argument-error"),So(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Po(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return yu.create(n,...e)}function U(n,e,...t){if(!n)throw Po(e,...t)}function st(n){const e="INTERNAL ASSERTION FAILED: "+n;throw cs(e),new Error(e)}function lt(n,e){n||st(e)}function ws(){return typeof self<"u"&&self.location?.href||""}function vu(){return Oc()==="http:"||Oc()==="https:"}function Oc(){return typeof self<"u"&&self.location?.protocol||null}function dm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(vu()||qf()||"connection"in navigator)?navigator.onLine:!0}function fm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Rr{constructor(e,t){this.shortDelay=e,this.longDelay=t,lt(t>e,"Short delay should be less than long delay!"),this.isMobile=Ff()||jf()}get(){return dm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Co(n,e){lt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Eu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;st("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;st("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;st("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const pm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const mm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],gm=new Rr(3e4,6e4);function tt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function nt(n,e,t,r,s={}){return Tu(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=br({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...i};return $f()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&bn(n.emulatorConfig.host)&&(d.credentials="include"),Eu.fetch()(await Iu(n,n.config.apiHost,t,l),d)})}async function Tu(n,e,t){n._canInitEmulator=!1;const r={...pm,...e};try{const s=new ym(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw ns(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ns(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw ns(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw ns(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw So(n,f,d);Be(n,f)}}catch(s){if(s instanceof dt)throw s;Be(n,"network-request-failed",{message:String(s)})}}async function Sr(n,e,t,r,s={}){const i=await nt(n,e,t,r,s);return"mfaPendingCredential"in i&&Be(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Iu(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?Co(n.config,s):`${n.config.apiScheme}://${s}`;return mm.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function _m(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ym{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(qe(this.auth,"network-request-failed")),gm.get())})}}function ns(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=qe(n,e,r);return s.customData._tokenResponse=t,s}function Lc(n){return n!==void 0&&n.enterprise!==void 0}class vm{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return _m(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Em(n,e){return nt(n,"GET","/v2/recaptchaConfig",tt(n,e))}async function Tm(n,e){return nt(n,"POST","/v1/accounts:delete",e)}async function As(n,e){return nt(n,"POST","/v1/accounts:lookup",e)}function rr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Im(n,e=!1){const t=oe(n),r=await t.getIdToken(e),s=ko(r);U(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:rr(ji(s.auth_time)),issuedAtTime:rr(ji(s.iat)),expirationTime:rr(ji(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function ji(n){return Number(n)*1e3}function ko(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return cs("JWT malformed, contained fewer than 3 sections"),null;try{const s=iu(t);return s?JSON.parse(s):(cs("Failed to decode base64 JWT payload"),null)}catch(s){return cs("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Mc(n){const e=ko(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function hr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof dt&&wm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function wm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Am{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class so{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rr(this.lastLoginAt),this.creationTime=rr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bs(n){const e=n.auth,t=await n.getIdToken(),r=await hr(n,As(e,{idToken:t}));U(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?wu(s.providerUserInfo):[],a=Rm(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new so(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function bm(n){const e=oe(n);await bs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Rm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function wu(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Sm(n,e){const t=await Tu(n,{},async()=>{const r=br({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Iu(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&bn(n.emulatorConfig.host)&&(u.credentials="include"),Eu.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Pm(n,e){return nt(n,"POST","/v2/accounts:revokeToken",tt(n,e))}class fn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");const t=Mc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Sm(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new fn;return r&&(U(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(U(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(U(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new fn,this.toJSON())}_performRefresh(){return st("not implemented")}}function Et(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class $e{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Am(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new so(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await hr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Im(this,e)}reload(){return bm(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new $e({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await bs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Le(this.auth.app))return Promise.reject(ot(this.auth));const e=await this.getIdToken();return await hr(this,Tm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:v,isAnonymous:R,providerData:D,stsTokenManager:k}=t;U(m&&k,e,"internal-error");const C=fn.fromJSON(this.name,k);U(typeof m=="string",e,"internal-error"),Et(r,e.name),Et(s,e.name),U(typeof v=="boolean",e,"internal-error"),U(typeof R=="boolean",e,"internal-error"),Et(i,e.name),Et(a,e.name),Et(l,e.name),Et(u,e.name),Et(d,e.name),Et(f,e.name);const M=new $e({uid:m,auth:e,email:s,emailVerified:v,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:C,createdAt:d,lastLoginAt:f});return D&&Array.isArray(D)&&(M.providerData=D.map(q=>({...q}))),u&&(M._redirectEventId=u),M}static async _fromIdTokenResponse(e,t,r=!1){const s=new fn;s.updateFromServerResponse(t);const i=new $e({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await bs(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];U(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?wu(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new fn;l.updateFromIdToken(r);const u=new $e({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new so(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,d),u}}const xc=new Map;function it(n){lt(n instanceof Function,"Expected a class definition");let e=xc.get(n);return e?(lt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xc.set(n,e),e)}class Au{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Au.type="NONE";const Uc=Au;function ls(n,e,t){return`firebase:${n}:${e}:${t}`}class pn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ls(this.userKey,s.apiKey,i),this.fullPersistenceKey=ls("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await As(this.auth,{idToken:e}).catch(()=>{});return t?$e._fromGetAccountInfoResponse(this.auth,t,e):null}return $e._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new pn(it(Uc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||it(Uc);const a=ls(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const f=await d._get(a);if(f){let m;if(typeof f=="string"){const v=await As(e,{idToken:f}).catch(()=>{});if(!v)break;m=await $e._fromGetAccountInfoResponse(e,v,f)}else m=$e._fromJSON(e,f);d!==i&&(l=m),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new pn(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new pn(i,e,r))}}function Fc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Pu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(bu(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ku(e))return"Blackberry";if(Nu(e))return"Webos";if(Ru(e))return"Safari";if((e.includes("chrome/")||Su(e))&&!e.includes("edge/"))return"Chrome";if(Cu(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function bu(n=Se()){return/firefox\//i.test(n)}function Ru(n=Se()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Su(n=Se()){return/crios\//i.test(n)}function Pu(n=Se()){return/iemobile/i.test(n)}function Cu(n=Se()){return/android/i.test(n)}function ku(n=Se()){return/blackberry/i.test(n)}function Nu(n=Se()){return/webos/i.test(n)}function No(n=Se()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Cm(n=Se()){return No(n)&&!!window.navigator?.standalone}function km(){return Hf()&&document.documentMode===10}function Du(n=Se()){return No(n)||Cu(n)||Nu(n)||ku(n)||/windows phone/i.test(n)||Pu(n)}function Vu(n,e=[]){let t;switch(n){case"Browser":t=Fc(Se());break;case"Worker":t=`${Fc(Se())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Rn}/${r}`}class Nm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Dm(n,e={}){return nt(n,"GET","/v2/passwordPolicy",tt(n,e))}const Vm=6;class Om{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Vm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Lm{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bc(this),this.idTokenSubscription=new Bc(this),this.beforeStateQueue=new Nm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=it(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await pn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await As(this,{idToken:e}),r=await $e._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Le(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=fm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Le(this.app))return Promise.reject(ot(this));const t=e?oe(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Le(this.app)?Promise.reject(ot(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Le(this.app)?Promise.reject(ot(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(it(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Dm(this),t=new Om(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ar("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Pm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&it(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await pn.create(this,[it(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Le(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&um(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ft(n){return oe(n)}class Bc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Jf(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let qs={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Mm(n){qs=n}function Ou(n){return qs.loadJS(n)}function xm(){return qs.recaptchaEnterpriseScript}function Um(){return qs.gapiScript}function Fm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Bm{constructor(){this.enterprise=new $m}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class $m{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const qm="recaptcha-enterprise",Lu="NO_RECAPTCHA";class jm{constructor(e){this.type=qm,this.auth=ft(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{Em(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new vm(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;Lc(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Lu)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Bm().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Lc(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=xm();u.length!==0&&(u+=l),Ou(u).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function $c(n,e,t,r=!1,s=!1){const i=new jm(n);let a;if(s)a=Lu;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Rs(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await $c(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await $c(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}function Hm(n,e){const t=Ro(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Qt(i,e??{}))return s;Be(s,"already-initialized")}return t.initialize({options:e})}function zm(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(it);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Wm(n,e,t){const r=ft(n);U(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Mu(e),{host:a,port:l}=Gm(e),u=l===null?"":`:${l}`,d={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){U(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),U(Qt(d,r.config.emulator)&&Qt(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,bn(a)?(lu(`${i}//${a}${u}`),uu("Auth",!0)):Km()}function Mu(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Gm(n){const e=Mu(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:qc(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:qc(a)}}}function qc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Km(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Do{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return st("not implemented")}_getIdTokenResponse(e){return st("not implemented")}_linkToIdToken(e,t){return st("not implemented")}_getReauthenticationResolver(e){return st("not implemented")}}async function Qm(n,e){return nt(n,"POST","/v1/accounts:signUp",e)}async function Ym(n,e){return Sr(n,"POST","/v1/accounts:signInWithPassword",tt(n,e))}async function Xm(n,e){return nt(n,"POST","/v1/accounts:sendOobCode",tt(n,e))}async function Jm(n,e){return Xm(n,e)}async function Zm(n,e){return Sr(n,"POST","/v1/accounts:signInWithEmailLink",tt(n,e))}async function eg(n,e){return Sr(n,"POST","/v1/accounts:signInWithEmailLink",tt(n,e))}class dr extends Do{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new dr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new dr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rs(e,t,"signInWithPassword",Ym);case"emailLink":return Zm(e,{email:this._email,oobCode:this._password});default:Be(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rs(e,r,"signUpPassword",Qm);case"emailLink":return eg(e,{idToken:t,email:this._email,oobCode:this._password});default:Be(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function mn(n,e){return Sr(n,"POST","/v1/accounts:signInWithIdp",tt(n,e))}const tg="http://localhost";class Xt extends Do{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Be("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new Xt(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return mn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,mn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,mn(e,t)}buildRequest(){const e={requestUri:tg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=br(t)}return e}}function ng(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function rg(n){const e=Yn(Xn(n)).link,t=e?Yn(Xn(e)).deep_link_id:null,r=Yn(Xn(n)).deep_link_id;return(r?Yn(Xn(r)).link:null)||r||t||e||n}class Vo{constructor(e){const t=Yn(Xn(e)),r=t.apiKey??null,s=t.oobCode??null,i=ng(t.mode??null);U(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=rg(e);try{return new Vo(t)}catch{return null}}}class Sn{constructor(){this.providerId=Sn.PROVIDER_ID}static credential(e,t){return dr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Vo.parseLink(t);return U(r,"argument-error"),dr._fromEmailAndCode(e,r.code,r.tenantId)}}Sn.PROVIDER_ID="password";Sn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Sn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Oo{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Pr extends Oo{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Tt extends Pr{constructor(){super("facebook.com")}static credential(e){return Xt._fromParams({providerId:Tt.PROVIDER_ID,signInMethod:Tt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Tt.credentialFromTaggedObject(e)}static credentialFromError(e){return Tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Tt.credential(e.oauthAccessToken)}catch{return null}}}Tt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Tt.PROVIDER_ID="facebook.com";class rt extends Pr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xt._fromParams({providerId:rt.PROVIDER_ID,signInMethod:rt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rt.credentialFromTaggedObject(e)}static credentialFromError(e){return rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return rt.credential(t,r)}catch{return null}}}rt.GOOGLE_SIGN_IN_METHOD="google.com";rt.PROVIDER_ID="google.com";class It extends Pr{constructor(){super("github.com")}static credential(e){return Xt._fromParams({providerId:It.PROVIDER_ID,signInMethod:It.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return It.credentialFromTaggedObject(e)}static credentialFromError(e){return It.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return It.credential(e.oauthAccessToken)}catch{return null}}}It.GITHUB_SIGN_IN_METHOD="github.com";It.PROVIDER_ID="github.com";class wt extends Pr{constructor(){super("twitter.com")}static credential(e,t){return Xt._fromParams({providerId:wt.PROVIDER_ID,signInMethod:wt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return wt.credentialFromTaggedObject(e)}static credentialFromError(e){return wt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return wt.credential(t,r)}catch{return null}}}wt.TWITTER_SIGN_IN_METHOD="twitter.com";wt.PROVIDER_ID="twitter.com";async function sg(n,e){return Sr(n,"POST","/v1/accounts:signUp",tt(n,e))}class Jt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await $e._fromIdTokenResponse(e,r,s),a=jc(r);return new Jt({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=jc(r);return new Jt({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function jc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Ss extends dt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ss.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ss(e,t,r,s)}}function xu(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ss._fromErrorAndOperation(n,i,e,r):i})}async function ig(n,e,t=!1){const r=await hr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Jt._forOperation(n,"link",r)}async function og(n,e,t=!1){const{auth:r}=n;if(Le(r.app))return Promise.reject(ot(r));const s="reauthenticate";try{const i=await hr(n,xu(r,s,e,n),t);U(i.idToken,r,"internal-error");const a=ko(i.idToken);U(a,r,"internal-error");const{sub:l}=a;return U(n.uid===l,r,"user-mismatch"),Jt._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&Be(r,"user-mismatch"),i}}async function Uu(n,e,t=!1){if(Le(n.app))return Promise.reject(ot(n));const r="signIn",s=await xu(n,r,e),i=await Jt._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function ag(n,e){return Uu(ft(n),e)}async function Fu(n){const e=ft(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function cg(n,e,t){const r=ft(n);await Rs(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Jm)}async function lg(n,e,t){if(Le(n.app))return Promise.reject(ot(n));const r=ft(n),a=await Rs(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",sg).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Fu(n),u}),l=await Jt._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function ug(n,e,t){return Le(n.app)?Promise.reject(ot(n)):ag(oe(n),Sn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Fu(n),r})}async function hg(n,e){return nt(n,"POST","/v1/accounts:createAuthUri",tt(n,e))}async function dg(n,e){const t=vu()?ws():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await hg(oe(n),r);return s||[]}function Lo(n,e){return oe(n).setPersistence(e)}function fg(n,e,t,r){return oe(n).onIdTokenChanged(e,t,r)}function pg(n,e,t){return oe(n).beforeAuthStateChanged(e,t)}function mg(n,e,t,r){return oe(n).onAuthStateChanged(e,t,r)}function gg(n){return oe(n).signOut()}const Ps="__sak";class Bu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ps,"1"),this.storage.removeItem(Ps),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const _g=1e3,yg=10;class $u extends Bu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Du(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);km()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,yg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},_g)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$u.type="LOCAL";const js=$u;class qu extends Bu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}qu.type="SESSION";const Cr=qu;function vg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Hs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Hs(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),u=await vg(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hs.receivers=[];function Mo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Eg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=Mo("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const v=m;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(v.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Ke(){return window}function Tg(n){Ke().location.href=n}function ju(){return typeof Ke().WorkerGlobalScope<"u"&&typeof Ke().importScripts=="function"}async function Ig(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function wg(){return navigator?.serviceWorker?.controller||null}function Ag(){return ju()?self:null}const Hu="firebaseLocalStorageDb",bg=1,Cs="firebaseLocalStorage",zu="fbase_key";class kr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zs(n,e){return n.transaction([Cs],e?"readwrite":"readonly").objectStore(Cs)}function Rg(){const n=indexedDB.deleteDatabase(Hu);return new kr(n).toPromise()}function io(){const n=indexedDB.open(Hu,bg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Cs,{keyPath:zu})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Cs)?e(r):(r.close(),await Rg(),e(await io()))})})}async function Hc(n,e,t){const r=zs(n,!0).put({[zu]:e,value:t});return new kr(r).toPromise()}async function Sg(n,e){const t=zs(n,!1).get(e),r=await new kr(t).toPromise();return r===void 0?null:r.value}function zc(n,e){const t=zs(n,!0).delete(e);return new kr(t).toPromise()}const Pg=800,Cg=3;class Wu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await io(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Cg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ju()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hs._getInstance(Ag()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Ig(),!this.activeServiceWorker)return;this.sender=new Eg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||wg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await io();return await Hc(e,Ps,"1"),await zc(e,Ps),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Hc(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Sg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>zc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=zs(s,!1).getAll();return new kr(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Pg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Wu.type="LOCAL";const kg=Wu;new Rr(3e4,6e4);function Gu(n,e){return e?it(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class xo extends Do{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return mn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return mn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return mn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ng(n){return Uu(n.auth,new xo(n),n.bypassAuthState)}function Dg(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),og(t,new xo(n),n.bypassAuthState)}async function Vg(n){const{auth:e,user:t}=n;return U(t,e,"internal-error"),ig(t,new xo(n),n.bypassAuthState)}class Ku{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ng;case"linkViaPopup":case"linkViaRedirect":return Vg;case"reauthViaPopup":case"reauthViaRedirect":return Dg;default:Be(this.auth,"internal-error")}}resolve(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Og=new Rr(2e3,1e4);async function Lg(n,e,t){if(Le(n.app))return Promise.reject(qe(n,"operation-not-supported-in-this-environment"));const r=ft(n);hm(n,e,Oo);const s=Gu(r,t);return new Wt(r,"signInViaPopup",e,s).executeNotNull()}class Wt extends Ku{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Wt.currentPopupAction&&Wt.currentPopupAction.cancel(),Wt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){lt(this.filter.length===1,"Popup operations only handle one event");const e=Mo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Og.get())};e()}}Wt.currentPopupAction=null;const Mg="pendingRedirect",us=new Map;class xg extends Ku{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=us.get(this.auth._key());if(!e){try{const r=await Ug(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}us.set(this.auth._key(),e)}return this.bypassAuthState||us.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ug(n,e){const t=$g(e),r=Bg(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function Fg(n,e){us.set(n._key(),e)}function Bg(n){return it(n._redirectPersistence)}function $g(n){return ls(Mg,n.config.apiKey,n.name)}async function qg(n,e,t=!1){if(Le(n.app))return Promise.reject(ot(n));const r=ft(n),s=Gu(r,e),a=await new xg(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const jg=600*1e3;class Hg{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zg(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Qu(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(qe(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jg&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wc(e))}saveEventToCache(e){this.cachedEventUids.add(Wc(e)),this.lastProcessedEventTime=Date.now()}}function Wc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Qu({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function zg(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qu(n);default:return!1}}async function Wg(n,e={}){return nt(n,"GET","/v1/projects",e)}const Gg=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Kg=/^https?/;async function Qg(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Wg(n);for(const t of e)try{if(Yg(t))return}catch{}Be(n,"unauthorized-domain")}function Yg(n){const e=ws(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Kg.test(t))return!1;if(Gg.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Xg=new Rr(3e4,6e4);function Gc(){const n=Ke().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Jg(n){return new Promise((e,t)=>{function r(){Gc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Gc(),t(qe(n,"network-request-failed"))},timeout:Xg.get()})}if(Ke().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ke().gapi?.load)r();else{const s=Fm("iframefcb");return Ke()[s]=()=>{gapi.load?r():t(qe(n,"network-request-failed"))},Ou(`${Um()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw hs=null,e})}let hs=null;function Zg(n){return hs=hs||Jg(n),hs}const e_=new Rr(5e3,15e3),t_="__/auth/iframe",n_="emulator/auth/iframe",r_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},s_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function i_(n){const e=n.config;U(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Co(e,n_):`https://${n.config.authDomain}/${t_}`,r={apiKey:e.apiKey,appName:n.name,v:Rn},s=s_.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${br(r).slice(1)}`}async function o_(n){const e=await Zg(n),t=Ke().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:i_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:r_,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=qe(n,"network-request-failed"),l=Ke().setTimeout(()=>{i(a)},e_.get());function u(){Ke().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const a_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},c_=500,l_=600,u_="_blank",h_="http://localhost";class Kc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function d_(n,e,t,r=c_,s=l_){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...a_,width:r.toString(),height:s.toString(),top:i,left:a},d=Se().toLowerCase();t&&(l=Su(d)?u_:t),bu(d)&&(e=e||h_,u.scrollbars="yes");const f=Object.entries(u).reduce((v,[R,D])=>`${v}${R}=${D},`,"");if(Cm(d)&&l!=="_self")return f_(e||"",l),new Kc(null);const m=window.open(e||"",l,f);U(m,n,"popup-blocked");try{m.focus()}catch{}return new Kc(m)}function f_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const p_="__/auth/handler",m_="emulator/auth/handler",g_=encodeURIComponent("fac");async function Qc(n,e,t,r,s,i){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Rn,eventId:s};if(e instanceof Oo){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Xf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof Pr){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),d=u?`#${g_}=${encodeURIComponent(u)}`:"";return`${__(n)}?${br(l).slice(1)}${d}`}function __({config:n}){return n.emulator?Co(n,m_):`https://${n.authDomain}/${p_}`}const Hi="webStorageSupport";class y_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cr,this._completeRedirectFn=qg,this._overrideRedirectResult=Fg}async _openPopup(e,t,r,s){lt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Qc(e,t,r,ws(),s);return d_(e,i,Mo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Qc(e,t,r,ws(),s);return Tg(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(lt(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await o_(e),r=new Hg(e);return t.register("authEvent",s=>(U(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Hi,{type:Hi},s=>{const i=s?.[0]?.[Hi];i!==void 0&&t(!!i),Be(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Qg(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Du()||Ru()||No()}}const v_=y_;var Yc="@firebase/auth",Xc="1.12.0";class E_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function T_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function I_(n){yn(new Yt("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;U(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vu(n)},d=new Lm(r,s,i,u);return zm(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),yn(new Yt("auth-internal",e=>{const t=ft(e.getProvider("auth").getImmediate());return(r=>new E_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),St(Yc,Xc,T_(n)),St(Yc,Xc,"esm2020")}const w_=300,A_=cu("authIdTokenMaxAge")||w_;let Jc=null;const b_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>A_)return;const s=t?.token;Jc!==s&&(Jc=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function R_(n=pu()){const e=Ro(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Hm(n,{popupRedirectResolver:v_,persistence:[kg,js,Cr]}),r=cu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=b_(i.toString());pg(t,a,()=>a(t.currentUser)),fg(t,l=>a(l))}}const s=ou("auth");return s&&Wm(t,`http://${s}`),t}function S_(){return document.getElementsByTagName("head")?.[0]??document}Mm({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=qe("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",S_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});I_("Browser");var P_="firebase",C_="12.7.0";St(P_,C_,"app");var Zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Pt,Yu;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.F=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.D=function(I,E,A){for(var _=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)_[ke-2]=arguments[ke];return g.prototype[E].apply(I,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,g,y){y||(y=0);const I=Array(16);if(typeof g=="string")for(var E=0;E<16;++E)I[E]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(E=0;E<16;++E)I[E]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],E=T.g[2];let A=T.g[3],_;_=g+(A^y&(E^A))+I[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[1]+3905402710&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[2]+606105819&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[3]+3250441966&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[5]+1200080426&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[6]+2821735955&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[7]+4249261313&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[9]+2336552879&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[10]+4294925233&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[11]+2304563134&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[13]+4254626195&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[14]+2792965006&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[15]+1236535329&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(E^A&(y^E))+I[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[6]+3225465664&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[11]+643717713&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[0]+3921069994&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[10]+38016083&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[15]+3634488961&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[4]+3889429448&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[14]+3275163606&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[3]+4107603335&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[8]+1163531501&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[2]+4243563512&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[7]+1735328473&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[12]+2368359562&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(y^E^A)+I[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[8]+2272392833&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[11]+1839030562&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[14]+4259657740&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[4]+1272893353&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[7]+4139469664&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[10]+3200236656&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[0]+3936430074&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[3]+3572445317&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[6]+76029189&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[12]+3873151461&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[15]+530742520&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[2]+3299628645&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(E^(y|~A))+I[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[7]+1126891415&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[14]+2878612391&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[5]+4237533241&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[3]+2399980690&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[10]+4293915773&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[1]+2240044497&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[15]+4264355552&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[6]+2734768916&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[13]+1309151649&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[11]+3174756917&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[2]+718787259&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+A&4294967295}r.prototype.v=function(T,g){g===void 0&&(g=T.length);const y=g-this.blockSize,I=this.C;let E=this.h,A=0;for(;A<g;){if(E==0)for(;A<=y;)s(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<g;)if(I[E++]=T.charCodeAt(A++),E==this.blockSize){s(this,I),E=0;break}}else for(;A<g;)if(I[E++]=T[A++],E==this.blockSize){s(this,I),E=0;break}}this.h=E,this.o+=g},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;g=this.o*8;for(var y=T.length-8;y<T.length;++y)T[y]=g&255,g/=256;for(this.v(T),T=Array(16),g=0,y=0;y<4;++y)for(let I=0;I<32;I+=8)T[g++]=this.g[y]>>>I&255;return T};function i(T,g){var y=l;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function a(T,g){this.h=g;const y=[];let I=!0;for(let E=T.length-1;E>=0;E--){const A=T[E]|0;I&&A==g||(y[E]=A,I=!1)}this.g=y}var l={};function u(T){return-128<=T&&T<128?i(T,function(g){return new a([g|0],g<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return m;if(T<0)return C(d(-T));const g=[];let y=1;for(let I=0;T>=y;I++)g[I]=T/y|0,y*=4294967296;return new a(g,0)}function f(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return C(f(T.substring(1),g));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(g,8));let I=m;for(let A=0;A<T.length;A+=8){var E=Math.min(8,T.length-A);const _=parseInt(T.substring(A,A+E),g);E<8?(E=d(Math.pow(g,E)),I=I.j(E).add(d(_))):(I=I.j(y),I=I.add(d(_)))}return I}var m=u(0),v=u(1),R=u(16777216);n=a.prototype,n.m=function(){if(k(this))return-C(this).m();let T=0,g=1;for(let y=0;y<this.g.length;y++){const I=this.i(y);T+=(I>=0?I:4294967296+I)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(D(this))return"0";if(k(this))return"-"+C(this).toString(T);const g=d(Math.pow(T,6));var y=this;let I="";for(;;){const E=H(y,g).g;y=M(y,E.j(g));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(T);if(y=E,D(y))return A+I;for(;A.length<6;)A="0"+A;I=A+I}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function D(T){if(T.h!=0)return!1;for(let g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function k(T){return T.h==-1}n.l=function(T){return T=M(this,T),k(T)?-1:D(T)?0:1};function C(T){const g=T.g.length,y=[];for(let I=0;I<g;I++)y[I]=~T.g[I];return new a(y,~T.h).add(v)}n.abs=function(){return k(this)?C(this):this},n.add=function(T){const g=Math.max(this.g.length,T.g.length),y=[];let I=0;for(let E=0;E<=g;E++){let A=I+(this.i(E)&65535)+(T.i(E)&65535),_=(A>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);I=_>>>16,A&=65535,_&=65535,y[E]=_<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function M(T,g){return T.add(C(g))}n.j=function(T){if(D(this)||D(T))return m;if(k(this))return k(T)?C(this).j(C(T)):C(C(this).j(T));if(k(T))return C(this.j(C(T)));if(this.l(R)<0&&T.l(R)<0)return d(this.m()*T.m());const g=this.g.length+T.g.length,y=[];for(var I=0;I<2*g;I++)y[I]=0;for(I=0;I<this.g.length;I++)for(let E=0;E<T.g.length;E++){const A=this.i(I)>>>16,_=this.i(I)&65535,ke=T.i(E)>>>16,Ft=T.i(E)&65535;y[2*I+2*E]+=_*Ft,q(y,2*I+2*E),y[2*I+2*E+1]+=A*Ft,q(y,2*I+2*E+1),y[2*I+2*E+1]+=_*ke,q(y,2*I+2*E+1),y[2*I+2*E+2]+=A*ke,q(y,2*I+2*E+2)}for(T=0;T<g;T++)y[T]=y[2*T+1]<<16|y[2*T];for(T=g;T<2*g;T++)y[T]=0;return new a(y,0)};function q(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function x(T,g){this.g=T,this.h=g}function H(T,g){if(D(g))throw Error("division by zero");if(D(T))return new x(m,m);if(k(T))return g=H(C(T),g),new x(C(g.g),C(g.h));if(k(g))return g=H(T,C(g)),new x(C(g.g),g.h);if(T.g.length>30){if(k(T)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var y=v,I=g;I.l(T)<=0;)y=se(y),I=se(I);var E=ae(y,1),A=ae(I,1);for(I=ae(I,2),y=ae(y,2);!D(I);){var _=A.add(I);_.l(T)<=0&&(E=E.add(y),A=_),I=ae(I,1),y=ae(y,1)}return g=M(T,E.j(g)),new x(E,g)}for(E=m;T.l(g)>=0;){for(y=Math.max(1,Math.floor(T.m()/g.m())),I=Math.ceil(Math.log(y)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),A=d(y),_=A.j(g);k(_)||_.l(T)>0;)y-=I,A=d(y),_=A.j(g);D(A)&&(A=v),E=E.add(A),T=M(T,_)}return new x(E,T)}n.B=function(T){return H(this,T).h},n.and=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)&T.i(I);return new a(y,this.h&T.h)},n.or=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)|T.i(I);return new a(y,this.h|T.h)},n.xor=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)^T.i(I);return new a(y,this.h^T.h)};function se(T){const g=T.g.length+1,y=[];for(let I=0;I<g;I++)y[I]=T.i(I)<<1|T.i(I-1)>>>31;return new a(y,T.h)}function ae(T,g){const y=g>>5;g%=32;const I=T.g.length-y,E=[];for(let A=0;A<I;A++)E[A]=g>0?T.i(A+y)>>>g|T.i(A+y+1)<<32-g:T.i(A+y);return new a(E,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Yu=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Pt=a}).apply(typeof Zc<"u"?Zc:typeof self<"u"?self:typeof window<"u"?window:{});var rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Xu,Jn,Ju,ds,oo,Zu,eh,th;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof rs=="object"&&rs];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var h=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var w=o[p];if(!(w in h))break e;h=h[w]}o=o[o.length-1],p=h[o],c=c(p),c!=p&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&h.push([p,c[p]]);return h}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=u,d.apply(null,arguments)}function f(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,w,b){for(var N=Array(arguments.length-2),j=2;j<arguments.length;j++)N[j-2]=arguments[j];return c.prototype[w].apply(p,N)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){const c=o.length;if(c>0){const h=Array(c);for(let p=0;p<c;p++)h[p]=o[p];return h}return[]}function D(o,c){for(let p=1;p<arguments.length;p++){const w=arguments[p];var h=typeof w;if(h=h!="object"?h:w?Array.isArray(w)?"array":h:"null",h=="array"||h=="object"&&typeof w.length=="number"){h=o.length||0;const b=w.length||0;o.length=h+b;for(let N=0;N<b;N++)o[h+N]=w[N]}else o.push(w)}}class k{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function C(o){a.setTimeout(()=>{throw o},0)}function M(){var o=T;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class q{constructor(){this.h=this.g=null}add(c,h){const p=x.get();p.set(c,h),this.h?this.h.next=p:this.g=p,this.h=p}}var x=new k(()=>new H,o=>o.reset());class H{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let se,ae=!1,T=new q,g=()=>{const o=Promise.resolve(void 0);se=()=>{o.then(y)}};function y(){for(var o;o=M();){try{o.h.call(o.g)}catch(h){C(h)}var c=x;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}ae=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function ke(o,c){E.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}m(ke,E),ke.prototype.init=function(o,c){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&ke.Z.h.call(this)},ke.prototype.h=function(){ke.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ft="closure_listenable_"+(Math.random()*1e6|0),Gd=0;function Kd(o,c,h,p,w){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!p,this.ha=w,this.key=++Gd,this.da=this.fa=!1}function $r(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function qr(o,c,h){for(const p in o)c.call(h,o[p],p,o)}function Qd(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function Ia(o){const c={};for(const h in o)c[h]=o[h];return c}const wa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Aa(o,c){let h,p;for(let w=1;w<arguments.length;w++){p=arguments[w];for(h in p)o[h]=p[h];for(let b=0;b<wa.length;b++)h=wa[b],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function jr(o){this.src=o,this.g={},this.h=0}jr.prototype.add=function(o,c,h,p,w){const b=o.toString();o=this.g[b],o||(o=this.g[b]=[],this.h++);const N=mi(o,c,p,w);return N>-1?(c=o[N],h||(c.fa=!1)):(c=new Kd(c,this.src,b,!!p,w),c.fa=h,o.push(c)),c};function pi(o,c){const h=c.type;if(h in o.g){var p=o.g[h],w=Array.prototype.indexOf.call(p,c,void 0),b;(b=w>=0)&&Array.prototype.splice.call(p,w,1),b&&($r(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function mi(o,c,h,p){for(let w=0;w<o.length;++w){const b=o[w];if(!b.da&&b.listener==c&&b.capture==!!h&&b.ha==p)return w}return-1}var gi="closure_lm_"+(Math.random()*1e6|0),_i={};function ba(o,c,h,p,w){if(Array.isArray(c)){for(let b=0;b<c.length;b++)ba(o,c[b],h,p,w);return null}return h=Pa(h),o&&o[Ft]?o.J(c,h,l(p)?!!p.capture:!1,w):Yd(o,c,h,!1,p,w)}function Yd(o,c,h,p,w,b){if(!c)throw Error("Invalid event type");const N=l(w)?!!w.capture:!!w;let j=vi(o);if(j||(o[gi]=j=new jr(o)),h=j.add(c,h,p,N,b),h.proxy)return h;if(p=Xd(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)A||(w=N),w===void 0&&(w=!1),o.addEventListener(c.toString(),p,w);else if(o.attachEvent)o.attachEvent(Sa(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Xd(){function o(h){return c.call(o.src,o.listener,h)}const c=Jd;return o}function Ra(o,c,h,p,w){if(Array.isArray(c))for(var b=0;b<c.length;b++)Ra(o,c[b],h,p,w);else p=l(p)?!!p.capture:!!p,h=Pa(h),o&&o[Ft]?(o=o.i,b=String(c).toString(),b in o.g&&(c=o.g[b],h=mi(c,h,p,w),h>-1&&($r(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[b],o.h--)))):o&&(o=vi(o))&&(c=o.g[c.toString()],o=-1,c&&(o=mi(c,h,p,w)),(h=o>-1?c[o]:null)&&yi(h))}function yi(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Ft])pi(c.i,o);else{var h=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(h,p,o.capture):c.detachEvent?c.detachEvent(Sa(h),p):c.addListener&&c.removeListener&&c.removeListener(p),(h=vi(c))?(pi(h,o),h.h==0&&(h.src=null,c[gi]=null)):$r(o)}}}function Sa(o){return o in _i?_i[o]:_i[o]="on"+o}function Jd(o,c){if(o.da)o=!0;else{c=new ke(c,this);const h=o.listener,p=o.ha||o.src;o.fa&&yi(o),o=h.call(p,c)}return o}function vi(o){return o=o[gi],o instanceof jr?o:null}var Ei="__closure_events_fn_"+(Math.random()*1e9>>>0);function Pa(o){return typeof o=="function"?o:(o[Ei]||(o[Ei]=function(c){return o.handleEvent(c)}),o[Ei])}function we(){I.call(this),this.i=new jr(this),this.M=this,this.G=null}m(we,I),we.prototype[Ft]=!0,we.prototype.removeEventListener=function(o,c,h,p){Ra(this,o,c,h,p)};function Pe(o,c){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new E(c,o);else if(c instanceof E)c.target=c.target||o;else{var w=c;c=new E(p,o),Aa(c,w)}w=!0;let b,N;if(h)for(N=h.length-1;N>=0;N--)b=c.g=h[N],w=Hr(b,p,!0,c)&&w;if(b=c.g=o,w=Hr(b,p,!0,c)&&w,w=Hr(b,p,!1,c)&&w,h)for(N=0;N<h.length;N++)b=c.g=h[N],w=Hr(b,p,!1,c)&&w}we.prototype.N=function(){if(we.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let p=0;p<h.length;p++)$r(h[p]);delete o.g[c],o.h--}}this.G=null},we.prototype.J=function(o,c,h,p){return this.i.add(String(o),c,!1,h,p)},we.prototype.K=function(o,c,h,p){return this.i.add(String(o),c,!0,h,p)};function Hr(o,c,h,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let b=0;b<c.length;++b){const N=c[b];if(N&&!N.da&&N.capture==h){const j=N.listener,pe=N.ha||N.src;N.fa&&pi(o.i,N),w=j.call(pe,p)!==!1&&w}}return w&&!p.defaultPrevented}function Zd(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Ca(o){o.g=Zd(()=>{o.g=null,o.i&&(o.i=!1,Ca(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class ef extends I{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ca(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vn(o){I.call(this),this.h=o,this.g={}}m(Vn,I);var ka=[];function Na(o){qr(o.g,function(c,h){this.g.hasOwnProperty(h)&&yi(c)},o),o.g={}}Vn.prototype.N=function(){Vn.Z.N.call(this),Na(this)},Vn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ti=a.JSON.stringify,tf=a.JSON.parse,nf=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Da(){}function Va(){}var On={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ii(){E.call(this,"d")}m(Ii,E);function wi(){E.call(this,"c")}m(wi,E);var Bt={},Oa=null;function zr(){return Oa=Oa||new we}Bt.Ia="serverreachability";function La(o){E.call(this,Bt.Ia,o)}m(La,E);function Ln(o){const c=zr();Pe(c,new La(c))}Bt.STAT_EVENT="statevent";function Ma(o,c){E.call(this,Bt.STAT_EVENT,o),this.stat=c}m(Ma,E);function Ce(o){const c=zr();Pe(c,new Ma(c,o))}Bt.Ja="timingevent";function xa(o,c){E.call(this,Bt.Ja,o),this.size=c}m(xa,E);function Mn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function xn(){this.g=!0}xn.prototype.ua=function(){this.g=!1};function rf(o,c,h,p,w,b){o.info(function(){if(o.g)if(b){var N="",j=b.split("&");for(let X=0;X<j.length;X++){var pe=j[X].split("=");if(pe.length>1){const _e=pe[0];pe=pe[1];const We=_e.split("_");N=We.length>=2&&We[1]=="type"?N+(_e+"="+pe+"&"):N+(_e+"=redacted&")}}}else N=null;else N=b;return"XMLHTTP REQ ("+p+") [attempt "+w+"]: "+c+`
`+h+`
`+N})}function sf(o,c,h,p,w,b,N){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+w+"]: "+c+`
`+h+`
`+b+" "+N})}function on(o,c,h,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+af(o,h)+(p?" "+p:"")})}function of(o,c){o.info(function(){return"TIMEOUT: "+c})}xn.prototype.info=function(){};function af(o,c){if(!o.g)return c;if(!c)return null;try{const b=JSON.parse(c);if(b){for(o=0;o<b.length;o++)if(Array.isArray(b[o])){var h=b[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var w=p[0];if(w!="noop"&&w!="stop"&&w!="close")for(let N=1;N<p.length;N++)p[N]=""}}}}return Ti(b)}catch{return c}}var Wr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ua={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Fa;function Ai(){}m(Ai,Da),Ai.prototype.g=function(){return new XMLHttpRequest},Fa=new Ai;function Un(o){return encodeURIComponent(String(o))}function cf(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function pt(o,c,h,p){this.j=o,this.i=c,this.l=h,this.S=p||1,this.V=new Vn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ba}function Ba(){this.i=null,this.g="",this.h=!1}var $a={},bi={};function Ri(o,c,h){o.M=1,o.A=Kr(ze(c)),o.u=h,o.R=!0,qa(o,null)}function qa(o,c){o.F=Date.now(),Gr(o),o.B=ze(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),tc(h.i,"t",p),o.C=0,h=o.j.L,o.h=new Ba,o.g=vc(o.j,h?c:null,!o.u),o.P>0&&(o.O=new ef(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,p=o.ba;var w="readystatechange";Array.isArray(w)||(w&&(ka[0]=w.toString()),w=ka);for(let b=0;b<w.length;b++){const N=ba(h,w[b],p||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.J?Ia(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Ln(),rf(o.i,o.v,o.B,o.l,o.S,o.u)}pt.prototype.ba=function(o){o=o.target;const c=this.O;c&&_t(o)==3?c.j():this.Y(o)},pt.prototype.Y=function(o){try{if(o==this.g)e:{const j=_t(this.g),pe=this.g.ya(),X=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||cc(this.g)))){this.K||j!=4||pe==7||(pe==8||X<=0?Ln(3):Ln(2)),Si(this);var c=this.g.ca();this.X=c;var h=lf(this);if(this.o=c==200,sf(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,w=this.g;if((p=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(p)){var b=p;break t}}b=null}if(o=b)on(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Pi(this,o);else{this.o=!1,this.m=3,Ce(12),$t(this),Fn(this);break e}}if(this.R){o=!0;let _e;for(;!this.K&&this.C<h.length;)if(_e=uf(this,h),_e==bi){j==4&&(this.m=4,Ce(14),o=!1),on(this.i,this.l,null,"[Incomplete Response]");break}else if(_e==$a){this.m=4,Ce(15),on(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else on(this.i,this.l,_e,null),Pi(this,_e);if(ja(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||h.length!=0||this.h.h||(this.m=1,Ce(16),o=!1),this.o=this.o&&o,!o)on(this.i,this.l,h,"[Invalid Chunked Response]"),$t(this),Fn(this);else if(h.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Mi(N),N.P=!0,Ce(11))}}else on(this.i,this.l,h,null),Pi(this,h);j==4&&$t(this),this.o&&!this.K&&(j==4?mc(this.j,this):(this.o=!1,Gr(this)))}else Af(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ce(12)):(this.m=0,Ce(13)),$t(this),Fn(this)}}}catch{}};function lf(o){if(!ja(o))return o.g.la();const c=cc(o.g);if(c==="")return"";let h="";const p=c.length,w=_t(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return $t(o),Fn(o),"";o.h.i=new a.TextDecoder}for(let b=0;b<p;b++)o.h.h=!0,h+=o.h.i.decode(c[b],{stream:!(w&&b==p-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function ja(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function uf(o,c){var h=o.C,p=c.indexOf(`
`,h);return p==-1?bi:(h=Number(c.substring(h,p)),isNaN(h)?$a:(p+=1,p+h>c.length?bi:(c=c.slice(p,p+h),o.C=p+h,c)))}pt.prototype.cancel=function(){this.K=!0,$t(this)};function Gr(o){o.T=Date.now()+o.H,Ha(o,o.H)}function Ha(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Mn(d(o.aa,o),c)}function Si(o){o.D&&(a.clearTimeout(o.D),o.D=null)}pt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(of(this.i,this.B),this.M!=2&&(Ln(),Ce(17)),$t(this),this.m=2,Fn(this)):Ha(this,this.T-o)};function Fn(o){o.j.I==0||o.K||mc(o.j,o)}function $t(o){Si(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,Na(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Pi(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Ci(h.h,o))){if(!o.L&&Ci(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var w=p;if(w[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)Zr(h),Xr(h);else break e;Li(h),Ce(18)}}else h.xa=w[1],0<h.xa-h.K&&w[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Mn(d(h.Va,h),6e3));Ga(h.h)<=1&&h.ta&&(h.ta=void 0)}else jt(h,11)}else if((o.L||h.g==o)&&Zr(h),!_(c))for(w=h.Ba.g.parse(c),c=0;c<w.length;c++){let X=w[c];const _e=X[0];if(!(_e<=h.K))if(h.K=_e,X=X[1],h.I==2)if(X[0]=="c"){h.M=X[1],h.ba=X[2];const We=X[3];We!=null&&(h.ka=We,h.j.info("VER="+h.ka));const Ht=X[4];Ht!=null&&(h.za=Ht,h.j.info("SVER="+h.za));const yt=X[5];yt!=null&&typeof yt=="number"&&yt>0&&(p=1.5*yt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const vt=o.g;if(vt){const ts=vt.g?vt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ts){var b=p.h;b.g||ts.indexOf("spdy")==-1&&ts.indexOf("quic")==-1&&ts.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(ki(b,b.h),b.h=null))}if(p.G){const xi=vt.g?vt.g.getResponseHeader("X-HTTP-Session-Id"):null;xi&&(p.wa=xi,ee(p.J,p.G,xi))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var N=o;if(p.na=yc(p,p.L?p.ba:null,p.W),N.L){Ka(p.h,N);var j=N,pe=p.O;pe&&(j.H=pe),j.D&&(Si(j),Gr(j)),p.g=N}else fc(p);h.i.length>0&&Jr(h)}else X[0]!="stop"&&X[0]!="close"||jt(h,7);else h.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?jt(h,7):Oi(h):X[0]!="noop"&&h.l&&h.l.qa(X),h.A=0)}}Ln(4)}catch{}}var hf=class{constructor(o,c){this.g=o,this.map=c}};function za(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Wa(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Ga(o){return o.h?1:o.g?o.g.size:0}function Ci(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function ki(o,c){o.g?o.g.add(c):o.h=c}function Ka(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}za.prototype.cancel=function(){if(this.i=Qa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Qa(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return R(o.i)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function df(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let w,b=null;p>=0?(w=o[h].substring(0,p),b=o[h].substring(p+1)):w=o[h],c(w,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function mt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof mt?(this.l=o.l,Bn(this,o.j),this.o=o.o,this.g=o.g,$n(this,o.u),this.h=o.h,Ni(this,nc(o.i)),this.m=o.m):o&&(c=String(o).match(Ya))?(this.l=!1,Bn(this,c[1]||"",!0),this.o=qn(c[2]||""),this.g=qn(c[3]||"",!0),$n(this,c[4]),this.h=qn(c[5]||"",!0),Ni(this,c[6]||"",!0),this.m=qn(c[7]||"")):(this.l=!1,this.i=new Hn(null,this.l))}mt.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(jn(c,Xa,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(jn(c,Xa,!0),"@"),o.push(Un(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(jn(h,h.charAt(0)=="/"?mf:pf,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",jn(h,_f)),o.join("")},mt.prototype.resolve=function(o){const c=ze(this);let h=!!o.j;h?Bn(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var p=o.h;if(h)$n(c,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var w=c.h.lastIndexOf("/");w!=-1&&(p=c.h.slice(0,w+1)+p)}if(w=p,w==".."||w==".")p="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){p=w.lastIndexOf("/",0)==0,w=w.split("/");const b=[];for(let N=0;N<w.length;){const j=w[N++];j=="."?p&&N==w.length&&b.push(""):j==".."?((b.length>1||b.length==1&&b[0]!="")&&b.pop(),p&&N==w.length&&b.push("")):(b.push(j),p=!0)}p=b.join("/")}else p=w}return h?c.h=p:h=o.i.toString()!=="",h?Ni(c,nc(o.i)):h=!!o.m,h&&(c.m=o.m),c};function ze(o){return new mt(o)}function Bn(o,c,h){o.j=h?qn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function $n(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function Ni(o,c,h){c instanceof Hn?(o.i=c,yf(o.i,o.l)):(h||(c=jn(c,gf)),o.i=new Hn(c,o.l))}function ee(o,c,h){o.i.set(c,h)}function Kr(o){return ee(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function qn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function jn(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,ff),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function ff(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Xa=/[#\/\?@]/g,pf=/[#\?:]/g,mf=/[#\?]/g,gf=/[#\?@]/g,_f=/#/g;function Hn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function qt(o){o.g||(o.g=new Map,o.h=0,o.i&&df(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=Hn.prototype,n.add=function(o,c){qt(this),this.i=null,o=an(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Ja(o,c){qt(o),c=an(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Za(o,c){return qt(o),c=an(o,c),o.g.has(c)}n.forEach=function(o,c){qt(this),this.g.forEach(function(h,p){h.forEach(function(w){o.call(c,w,p,this)},this)},this)};function ec(o,c){qt(o);let h=[];if(typeof c=="string")Za(o,c)&&(h=h.concat(o.g.get(an(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}n.set=function(o,c){return qt(this),this.i=null,o=an(this,o),Za(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=ec(this,o),o.length>0?String(o[0]):c):c};function tc(o,c,h){Ja(o,c),h.length>0&&(o.i=null,o.g.set(an(o,c),R(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var h=c[p];const w=Un(h);h=ec(this,h);for(let b=0;b<h.length;b++){let N=w;h[b]!==""&&(N+="="+Un(h[b])),o.push(N)}}return this.i=o.join("&")};function nc(o){const c=new Hn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function an(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function yf(o,c){c&&!o.j&&(qt(o),o.i=null,o.g.forEach(function(h,p){const w=p.toLowerCase();p!=w&&(Ja(this,p),tc(this,w,h))},o)),o.j=c}function vf(o,c){const h=new xn;if(a.Image){const p=new Image;p.onload=f(gt,h,"TestLoadImage: loaded",!0,c,p),p.onerror=f(gt,h,"TestLoadImage: error",!1,c,p),p.onabort=f(gt,h,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(gt,h,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function Ef(o,c){const h=new xn,p=new AbortController,w=setTimeout(()=>{p.abort(),gt(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(b=>{clearTimeout(w),b.ok?gt(h,"TestPingServer: ok",!0,c):gt(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),gt(h,"TestPingServer: error",!1,c)})}function gt(o,c,h,p,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),p(h)}catch{}}function Tf(){this.g=new nf}function Di(o){this.i=o.Sb||null,this.h=o.ab||!1}m(Di,Da),Di.prototype.g=function(){return new Qr(this.i,this.h)};function Qr(o,c){we.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Qr,we),n=Qr.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Wn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,zn(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Wn(this)),this.g&&(this.readyState=3,Wn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;rc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function rc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?zn(this):Wn(this),this.readyState==3&&rc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,zn(this))},n.Na=function(o){this.g&&(this.response=o,zn(this))},n.ga=function(){this.g&&zn(this)};function zn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Wn(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Wn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Qr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function sc(o){let c="";return qr(o,function(h,p){c+=p,c+=":",c+=h,c+=`\r
`}),c}function Vi(o,c,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=sc(h),typeof o=="string"?h!=null&&Un(h):ee(o,c,h))}function ie(o){we.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ie,we);var If=/^https?$/i,wf=["POST","PUT"];n=ie.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Fa.g(),this.g.onreadystatechange=v(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(b){ic(this,b);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var w in p)h.set(w,p[w]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const b of p.keys())h.set(b,p.get(b));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(b=>b.toLowerCase()=="content-type"),w=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(wf,c,void 0)>=0)||p||w||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[b,N]of h)this.g.setRequestHeader(b,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(b){ic(this,b)}};function ic(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,oc(o),Yr(o)}function oc(o){o.A||(o.A=!0,Pe(o,"complete"),Pe(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Pe(this,"complete"),Pe(this,"abort"),Yr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yr(this,!0)),ie.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ac(this):this.Xa())},n.Xa=function(){ac(this)};function ac(o){if(o.h&&typeof i<"u"){if(o.v&&_t(o)==4)setTimeout(o.Ca.bind(o),0);else if(Pe(o,"readystatechange"),_t(o)==4){o.h=!1;try{const b=o.ca();e:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var p;if(p=b===0){let N=String(o.D).match(Ya)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),p=!If.test(N?N.toLowerCase():"")}h=p}if(h)Pe(o,"complete"),Pe(o,"success");else{o.o=6;try{var w=_t(o)>2?o.g.statusText:""}catch{w=""}o.l=w+" ["+o.ca()+"]",oc(o)}}finally{Yr(o)}}}}function Yr(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||Pe(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function _t(o){return o.g?o.g.readyState:0}n.ca=function(){try{return _t(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),tf(c)}};function cc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Af(o){const c={};o=(o.g&&_t(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(_(o[p]))continue;var h=cf(o[p]);const w=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const b=c[w]||[];c[w]=b,b.push(h)}Qd(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gn(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function lc(o){this.za=0,this.i=[],this.j=new xn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Gn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Gn("baseRetryDelayMs",5e3,o),this.Za=Gn("retryDelaySeedMs",1e4,o),this.Ta=Gn("forwardChannelMaxRetries",2,o),this.va=Gn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new za(o&&o.concurrentRequestLimit),this.Ba=new Tf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=lc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,h,p){Ce(0),this.W=o,this.H=c||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=yc(this,null,this.W),Jr(this)};function Oi(o){if(uc(o),o.I==3){var c=o.V++,h=ze(o.J);if(ee(h,"SID",o.M),ee(h,"RID",c),ee(h,"TYPE","terminate"),Kn(o,h),c=new pt(o,o.j,c),c.M=2,c.A=Kr(ze(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=vc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Gr(c)}_c(o)}function Xr(o){o.g&&(Mi(o),o.g.cancel(),o.g=null)}function uc(o){Xr(o),o.v&&(a.clearTimeout(o.v),o.v=null),Zr(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function Jr(o){if(!Wa(o.h)&&!o.m){o.m=!0;var c=o.Ea;se||g(),ae||(se(),ae=!0),T.add(c,o),o.D=0}}function bf(o,c){return Ga(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Mn(d(o.Ea,o,c),gc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const w=new pt(this,this.j,o);let b=this.o;if(this.U&&(b?(b=Ia(b),Aa(b,this.U)):b=this.U),this.u!==null||this.R||(w.J=b,b=null),this.S)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=dc(this,w,c),h=ze(this.J),ee(h,"RID",o),ee(h,"CVER",22),this.G&&ee(h,"X-HTTP-Session-Id",this.G),Kn(this,h),b&&(this.R?c="headers="+Un(sc(b))+"&"+c:this.u&&Vi(h,this.u,b)),ki(this.h,w),this.Ra&&ee(h,"TYPE","init"),this.S?(ee(h,"$req",c),ee(h,"SID","null"),w.U=!0,Ri(w,h,null)):Ri(w,h,c),this.I=2}}else this.I==3&&(o?hc(this,o):this.i.length==0||Wa(this.h)||hc(this))};function hc(o,c){var h;c?h=c.l:h=o.V++;const p=ze(o.J);ee(p,"SID",o.M),ee(p,"RID",h),ee(p,"AID",o.K),Kn(o,p),o.u&&o.o&&Vi(p,o.u,o.o),h=new pt(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=dc(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),ki(o.h,h),Ri(h,p,c)}function Kn(o,c){o.H&&qr(o.H,function(h,p){ee(c,p,h)}),o.l&&qr({},function(h,p){ee(c,p,h)})}function dc(o,c,h){h=Math.min(o.i.length,h);const p=o.l?d(o.l.Ka,o.l,o):null;e:{var w=o.i;let j=-1;for(;;){const pe=["count="+h];j==-1?h>0?(j=w[0].g,pe.push("ofs="+j)):j=0:pe.push("ofs="+j);let X=!0;for(let _e=0;_e<h;_e++){var b=w[_e].g;const We=w[_e].map;if(b-=j,b<0)j=Math.max(0,w[_e].g-100),X=!1;else try{b="req"+b+"_"||"";try{var N=We instanceof Map?We:Object.entries(We);for(const[Ht,yt]of N){let vt=yt;l(yt)&&(vt=Ti(yt)),pe.push(b+Ht+"="+encodeURIComponent(vt))}}catch(Ht){throw pe.push(b+"type="+encodeURIComponent("_badmap")),Ht}}catch{p&&p(We)}}if(X){N=pe.join("&");break e}}N=void 0}return o=o.i.splice(0,h),c.G=o,N}function fc(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;se||g(),ae||(se(),ae=!0),T.add(c,o),o.A=0}}function Li(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Mn(d(o.Da,o),gc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,pc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Mn(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ce(10),Xr(this),pc(this))};function Mi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function pc(o){o.g=new pt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=ze(o.na);ee(c,"RID","rpc"),ee(c,"SID",o.M),ee(c,"AID",o.K),ee(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&ee(c,"TO",o.ia),ee(c,"TYPE","xmlhttp"),Kn(o,c),o.u&&o.o&&Vi(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Kr(ze(c)),h.u=null,h.R=!0,qa(h,o)}n.Va=function(){this.C!=null&&(this.C=null,Xr(this),Li(this),Ce(19))};function Zr(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function mc(o,c){var h=null;if(o.g==c){Zr(o),Mi(o),o.g=null;var p=2}else if(Ci(o.h,c))h=c.G,Ka(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var w=o.D;p=zr(),Pe(p,new xa(p,h)),Jr(o)}else fc(o);else if(w=c.m,w==3||w==0&&c.X>0||!(p==1&&bf(o,c)||p==2&&Li(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),w){case 1:jt(o,5);break;case 4:jt(o,10);break;case 3:jt(o,6);break;default:jt(o,2)}}}function gc(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function jt(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),p=o.Ua;const w=!p;p=new mt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Bn(p,"https"),Kr(p),w?vf(p.toString(),h):Ef(p.toString(),h)}else Ce(2);o.I=0,o.l&&o.l.pa(c),_c(o),uc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function _c(o){if(o.I=0,o.ja=[],o.l){const c=Qa(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ja,c),D(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function yc(o,c,h){var p=h instanceof mt?ze(h):new mt(h);if(p.g!="")c&&(p.g=c+"."+p.g),$n(p,p.u);else{var w=a.location;p=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const b=new mt(null);p&&Bn(b,p),c&&(b.g=c),w&&$n(b,w),h&&(b.h=h),p=b}return h=o.G,c=o.wa,h&&c&&ee(p,h,c),ee(p,"VER",o.ka),Kn(o,p),p}function vc(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new ie(new Di({ab:h})):new ie(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ec(){}n=Ec.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function es(){}es.prototype.g=function(o,c){return new Oe(o,c)};function Oe(o,c){we.call(this),this.g=new lc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new cn(this)}m(Oe,we),Oe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Oe.prototype.close=function(){Oi(this.g)},Oe.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Ti(o),o=h);c.i.push(new hf(c.Ya++,o)),c.I==3&&Jr(c)},Oe.prototype.N=function(){this.g.l=null,delete this.j,Oi(this.g),delete this.g,Oe.Z.N.call(this)};function Tc(o){Ii.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}m(Tc,Ii);function Ic(){wi.call(this),this.status=1}m(Ic,wi);function cn(o){this.g=o}m(cn,Ec),cn.prototype.ra=function(){Pe(this.g,"a")},cn.prototype.qa=function(o){Pe(this.g,new Tc(o))},cn.prototype.pa=function(o){Pe(this.g,new Ic)},cn.prototype.oa=function(){Pe(this.g,"b")},es.prototype.createWebChannel=es.prototype.g,Oe.prototype.send=Oe.prototype.o,Oe.prototype.open=Oe.prototype.m,Oe.prototype.close=Oe.prototype.close,th=function(){return new es},eh=function(){return zr()},Zu=Bt,oo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Wr.NO_ERROR=0,Wr.TIMEOUT=8,Wr.HTTP_ERROR=6,ds=Wr,Ua.COMPLETE="complete",Ju=Ua,Va.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",we.prototype.listen=we.prototype.J,Jn=Va,ie.prototype.listenOnce=ie.prototype.K,ie.prototype.getLastError=ie.prototype.Ha,ie.prototype.getLastErrorCode=ie.prototype.ya,ie.prototype.getStatus=ie.prototype.ca,ie.prototype.getResponseJson=ie.prototype.La,ie.prototype.getResponseText=ie.prototype.la,ie.prototype.send=ie.prototype.ea,ie.prototype.setWithCredentials=ie.prototype.Fa,Xu=ie}).apply(typeof rs<"u"?rs:typeof self<"u"?self:typeof window<"u"?window:{});const el="@firebase/firestore",tl="4.9.3";class be{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}be.UNAUTHENTICATED=new be(null),be.GOOGLE_CREDENTIALS=new be("google-credentials-uid"),be.FIRST_PARTY=new be("first-party-uid"),be.MOCK_USER=new be("mock-user");let Pn="12.7.0";const Zt=new Ao("@firebase/firestore");function ln(){return Zt.logLevel}function O(n,...e){if(Zt.logLevel<=z.DEBUG){const t=e.map(Uo);Zt.debug(`Firestore (${Pn}): ${n}`,...t)}}function ut(n,...e){if(Zt.logLevel<=z.ERROR){const t=e.map(Uo);Zt.error(`Firestore (${Pn}): ${n}`,...t)}}function vn(n,...e){if(Zt.logLevel<=z.WARN){const t=e.map(Uo);Zt.warn(`Firestore (${Pn}): ${n}`,...t)}}function Uo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function F(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,nh(n,r,t)}function nh(n,e,t){let r=`FIRESTORE (${Pn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ut(r),new Error(r)}function Q(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||nh(e,s,r)}function $(n,e){return n}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class at{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class rh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class k_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(be.UNAUTHENTICATED)))}shutdown(){}}class N_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class D_{constructor(e){this.t=e,this.currentUser=be.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new at;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new at,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new at)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new rh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new be(e)}}class V_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=be.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class O_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new V_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(be.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class nl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class L_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Le(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);const r=i=>{i.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new nl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new nl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function M_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Fo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=M_(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function W(n,e){return n<e?-1:n>e?1:0}function ao(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return zi(s)===zi(i)?W(s,i):zi(s)?1:-1}return W(n.length,e.length)}const x_=55296,U_=57343;function zi(n){const e=n.charCodeAt(0);return e>=x_&&e<=U_}function En(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const rl="__name__";class Ge{constructor(e,t,r){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&F(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ge.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ge?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Ge.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return W(e.length,t.length)}static compareSegments(e,t){const r=Ge.isNumericId(e),s=Ge.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ge.extractNumericId(e).compare(Ge.extractNumericId(t)):ao(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pt.fromString(e.substring(4,e.length-2))}}class J extends Ge{construct(e,t,r){return new J(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new J(t)}static emptyPath(){return new J([])}}const F_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Te extends Ge{construct(e,t,r){return new Te(e,t,r)}static isValidIdentifier(e){return F_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Te.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rl}static keyField(){return new Te([rl])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Te(t)}static emptyPath(){return new Te([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(J.fromString(e))}static fromName(e){return new L(J.fromString(e).popFirst(5))}static empty(){return new L(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&J.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new J(e.slice()))}}function sh(n,e,t){if(!t)throw new V(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function B_(n,e,t,r){if(e===!0&&r===!0)throw new V(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sl(n){if(!L.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function il(n){if(L.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ih(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ws(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function je(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ws(n);throw new V(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function $_(n,e){if(e<=0)throw new V(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function de(n,e){const t={typeString:n};return e&&(t.value=e),t}function Nr(n,e){if(!ih(n))throw new V(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new V(S.INVALID_ARGUMENT,t);return!0}const ol=-62135596800,al=1e6;class te{static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*al);return new te(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ol)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/al}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:te._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Nr(e,te._jsonSchema))return new te(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ol;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}te._jsonSchemaVersion="firestore/timestamp/1.0",te._jsonSchema={type:de("string",te._jsonSchemaVersion),seconds:de("number"),nanoseconds:de("number")};class B{static fromTimestamp(e){return new B(e)}static min(){return new B(new te(0,0))}static max(){return new B(new te(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const fr=-1;function q_(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=B.fromTimestamp(r===1e9?new te(t+1,0):new te(t,r));return new kt(s,L.empty(),e)}function j_(n){return new kt(n.readTime,n.key,fr)}class kt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new kt(B.min(),L.empty(),fr)}static max(){return new kt(B.max(),L.empty(),fr)}}function H_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:W(n.largestBatchId,e.largestBatchId))}const z_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class W_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Cn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==z_)throw n;O("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next((f=>{a[d]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new P(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function G_(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function kn(n){return n.name==="IndexedDbTransactionError"}class Gs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Gs.ce=-1;const Bo=-1;function Ks(n){return n==null}function ks(n){return n===0&&1/n==-1/0}function K_(n){return typeof n=="number"&&Number.isInteger(n)&&!ks(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const oh="";function Q_(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=cl(e)),e=Y_(n.get(t),e);return cl(e)}function Y_(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case oh:t+="";break;default:t+=i}}return t}function cl(n){return n+oh+""}function ll(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Mt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ah(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class re{constructor(e,t){this.comparator=e,this.root=t||Ee.EMPTY}insert(e,t){return new re(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ee.BLACK,null,null))}remove(e){return new re(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ee.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ss(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ss(this.root,e,this.comparator,!1)}getReverseIterator(){return new ss(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ss(this.root,e,this.comparator,!0)}}class ss{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ee{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Ee.RED,this.left=s??Ee.EMPTY,this.right=i??Ee.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Ee(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ee.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ee.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ee.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ee.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}}Ee.EMPTY=null,Ee.RED=!0,Ee.BLACK=!1;Ee.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Ee(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ge{constructor(e){this.comparator=e,this.data=new re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ul(this.data.getIterator())}getIteratorFrom(e){return new ul(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ge)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ge(this.comparator);return t.data=e,t}}class ul{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Me{constructor(e){this.fields=e,e.sort(Te.comparator)}static empty(){return new Me([])}unionWith(e){let t=new ge(Te.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Me(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return En(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class ch extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ch("Invalid base64 string: "+i):i}})(e);return new Ie(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const X_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nt(n){if(Q(!!n,39018),typeof n=="string"){let e=0;const t=X_.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ce(n.seconds),nanos:ce(n.nanos)}}function ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Dt(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}const lh="server_timestamp",uh="__type__",hh="__previous_value__",dh="__local_write_time__";function $o(n){return(n?.mapValue?.fields||{})[uh]?.stringValue===lh}function Qs(n){const e=n.mapValue.fields[hh];return $o(e)?Qs(e):e}function pr(n){const e=Nt(n.mapValue.fields[dh].timestampValue);return new te(e.seconds,e.nanos)}class J_{constructor(e,t,r,s,i,a,l,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f}}const Ns="(default)";class mr{constructor(e,t){this.projectId=e,this.database=t||Ns}static empty(){return new mr("","")}get isDefaultDatabase(){return this.database===Ns}isEqual(e){return e instanceof mr&&e.projectId===this.projectId&&e.database===this.database}}const fh="__type__",Z_="__max__",is={mapValue:{}},ph="__vector__",Ds="value";function Vt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$o(n)?4:ty(n)?9007199254740991:ey(n)?10:11:F(28295,{value:n})}function Ze(n,e){if(n===e)return!0;const t=Vt(n);if(t!==Vt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pr(n).isEqual(pr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Nt(s.timestampValue),l=Nt(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Dt(s.bytesValue).isEqual(Dt(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return ce(s.geoPointValue.latitude)===ce(i.geoPointValue.latitude)&&ce(s.geoPointValue.longitude)===ce(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return ce(s.integerValue)===ce(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=ce(s.doubleValue),l=ce(i.doubleValue);return a===l?ks(a)===ks(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return En(n.arrayValue.values||[],e.arrayValue.values||[],Ze);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ll(a)!==ll(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!Ze(a[u],l[u])))return!1;return!0})(n,e);default:return F(52216,{left:n})}}function gr(n,e){return(n.values||[]).find((t=>Ze(t,e)))!==void 0}function Tn(n,e){if(n===e)return 0;const t=Vt(n),r=Vt(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=ce(i.integerValue||i.doubleValue),u=ce(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return hl(n.timestampValue,e.timestampValue);case 4:return hl(pr(n),pr(e));case 5:return ao(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=Dt(i),u=Dt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=W(l[d],u[d]);if(f!==0)return f}return W(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=W(ce(i.latitude),ce(a.latitude));return l!==0?l:W(ce(i.longitude),ce(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return dl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},d=l[Ds]?.arrayValue,f=u[Ds]?.arrayValue,m=W(d?.values?.length||0,f?.values?.length||0);return m!==0?m:dl(d,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===is.mapValue&&a===is.mapValue)return 0;if(i===is.mapValue)return 1;if(a===is.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const v=ao(u[m],f[m]);if(v!==0)return v;const R=Tn(l[u[m]],d[f[m]]);if(R!==0)return R}return W(u.length,f.length)})(n.mapValue,e.mapValue);default:throw F(23264,{he:t})}}function hl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);const t=Nt(n),r=Nt(e),s=W(t.seconds,r.seconds);return s!==0?s:W(t.nanos,r.nanos)}function dl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Tn(t[s],r[s]);if(i)return i}return W(t.length,r.length)}function In(n){return co(n)}function co(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Nt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Dt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=co(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${co(t.fields[a])}`;return s+"}"})(n.mapValue):F(61005,{value:n})}function fs(n){switch(Vt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Qs(n);return e?16+fs(e):16;case 5:return 2*n.stringValue.length;case 6:return Dt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+fs(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Mt(r.fields,((i,a)=>{s+=i.length+fs(a)})),s})(n.mapValue);default:throw F(13486,{value:n})}}function fl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function lo(n){return!!n&&"integerValue"in n}function qo(n){return!!n&&"arrayValue"in n}function pl(n){return!!n&&"nullValue"in n}function ml(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ps(n){return!!n&&"mapValue"in n}function ey(n){return(n?.mapValue?.fields||{})[fh]?.stringValue===ph}function sr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Mt(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=sr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sr(n.arrayValue.values[t]);return e}return{...n}}function ty(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Z_}class De{constructor(e){this.value=e}static empty(){return new De({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ps(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sr(t)}setAll(e){let t=Te.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=sr(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ps(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ze(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ps(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Mt(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new De(sr(this.value))}}function mh(n){const e=[];return Mt(n.fields,((t,r)=>{const s=new Te([t]);if(ps(r)){const i=mh(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Me(e)}class Re{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Re(e,0,B.min(),B.min(),B.min(),De.empty(),0)}static newFoundDocument(e,t,r,s){return new Re(e,1,t,B.min(),r,s,0)}static newNoDocument(e,t){return new Re(e,2,t,B.min(),B.min(),De.empty(),0)}static newUnknownDocument(e,t){return new Re(e,3,t,B.min(),B.min(),De.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=De.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=De.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vs{constructor(e,t){this.position=e,this.inclusive=t}}function gl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Tn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function _l(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ze(n.position[t],e.position[t]))return!1;return!0}class _r{constructor(e,t="asc"){this.field=e,this.dir=t}}function ny(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class gh{}class he extends gh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new sy(e,t,r):t==="array-contains"?new ay(e,r):t==="in"?new cy(e,r):t==="not-in"?new ly(e,r):t==="array-contains-any"?new uy(e,r):new he(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new iy(e,r):new oy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Tn(t,this.value)):t!==null&&Vt(this.value)===Vt(t)&&this.matchesComparison(Tn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class He extends gh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new He(e,t)}matches(e){return _h(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function _h(n){return n.op==="and"}function yh(n){return ry(n)&&_h(n)}function ry(n){for(const e of n.filters)if(e instanceof He)return!1;return!0}function uo(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+In(n.value);if(yh(n))return n.filters.map((e=>uo(e))).join(",");{const e=n.filters.map((t=>uo(t))).join(",");return`${n.op}(${e})`}}function vh(n,e){return n instanceof he?(function(r,s){return s instanceof he&&r.op===s.op&&r.field.isEqual(s.field)&&Ze(r.value,s.value)})(n,e):n instanceof He?(function(r,s){return s instanceof He&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&vh(a,s.filters[l])),!0):!1})(n,e):void F(19439)}function Eh(n){return n instanceof he?(function(t){return`${t.field.canonicalString()} ${t.op} ${In(t.value)}`})(n):n instanceof He?(function(t){return t.op.toString()+" {"+t.getFilters().map(Eh).join(" ,")+"}"})(n):"Filter"}class sy extends he{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class iy extends he{constructor(e,t){super(e,"in",t),this.keys=Th("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class oy extends he{constructor(e,t){super(e,"not-in",t),this.keys=Th("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Th(n,e){return(e.arrayValue?.values||[]).map((t=>L.fromName(t.referenceValue)))}class ay extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qo(t)&&gr(t.arrayValue,this.value)}}class cy extends he{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&gr(this.value.arrayValue,t)}}class ly extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if(gr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!gr(this.value.arrayValue,t)}}class uy extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>gr(this.value.arrayValue,r)))}}class hy{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function yl(n,e=null,t=[],r=[],s=null,i=null,a=null){return new hy(n,e,t,r,s,i,a)}function jo(n){const e=$(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>uo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Ks(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>In(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>In(r))).join(",")),e.Te=t}return e.Te}function Ho(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ny(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!vh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!_l(n.startAt,e.startAt)&&_l(n.endAt,e.endAt)}function ho(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Nn{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dy(n,e,t,r,s,i,a,l){return new Nn(n,e,t,r,s,i,a,l)}function zo(n){return new Nn(n)}function vl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ih(n){return n.collectionGroup!==null}function ir(n){const e=$(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ge(Te.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new _r(i,r))})),t.has(Te.keyField().canonicalString())||e.Ie.push(new _r(Te.keyField(),r))}return e.Ie}function Qe(n){const e=$(n);return e.Ee||(e.Ee=fy(e,ir(n))),e.Ee}function fy(n,e){if(n.limitType==="F")return yl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new _r(s.field,i)}));const t=n.endAt?new Vs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vs(n.startAt.position,n.startAt.inclusive):null;return yl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function fo(n,e){const t=n.filters.concat([e]);return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Os(n,e,t){return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ys(n,e){return Ho(Qe(n),Qe(e))&&n.limitType===e.limitType}function wh(n){return`${jo(Qe(n))}|lt:${n.limitType}`}function un(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Eh(s))).join(", ")}]`),Ks(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>In(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>In(s))).join(",")),`Target(${r})`})(Qe(n))}; limitType=${n.limitType})`}function Xs(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):L.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of ir(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const d=gl(a,l,u);return a.inclusive?d<=0:d<0})(r.startAt,ir(r),s)||r.endAt&&!(function(a,l,u){const d=gl(a,l,u);return a.inclusive?d>=0:d>0})(r.endAt,ir(r),s))})(n,e)}function py(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ah(n){return(e,t)=>{let r=!1;for(const s of ir(n)){const i=my(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function my(n,e,t){const r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Tn(u,d):F(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}class tn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Mt(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return ah(this.inner)}size(){return this.innerSize}}const gy=new re(L.comparator);function ht(){return gy}const bh=new re(L.comparator);function Zn(...n){let e=bh;for(const t of n)e=e.insert(t.key,t);return e}function Rh(n){let e=bh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Gt(){return or()}function Sh(){return or()}function or(){return new tn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const _y=new re(L.comparator),yy=new ge(L.comparator);function G(...n){let e=yy;for(const t of n)e=e.add(t);return e}const vy=new ge(W);function Ey(){return vy}function Wo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ks(e)?"-0":e}}function Ph(n){return{integerValue:""+n}}function Ch(n,e){return K_(e)?Ph(e):Wo(n,e)}class Js{constructor(){this._=void 0}}function Ty(n,e,t){return n instanceof yr?(function(s,i){const a={fields:{[uh]:{stringValue:lh},[dh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&$o(i)&&(i=Qs(i)),i&&(a.fields[hh]=i),{mapValue:a}})(t,e):n instanceof vr?Nh(n,e):n instanceof Er?Dh(n,e):(function(s,i){const a=kh(s,i),l=El(a)+El(s.Ae);return lo(a)&&lo(s.Ae)?Ph(l):Wo(s.serializer,l)})(n,e)}function Iy(n,e,t){return n instanceof vr?Nh(n,e):n instanceof Er?Dh(n,e):t}function kh(n,e){return n instanceof Tr?(function(r){return lo(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class yr extends Js{}class vr extends Js{constructor(e){super(),this.elements=e}}function Nh(n,e){const t=Vh(e);for(const r of n.elements)t.some((s=>Ze(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Er extends Js{constructor(e){super(),this.elements=e}}function Dh(n,e){let t=Vh(e);for(const r of n.elements)t=t.filter((s=>!Ze(s,r)));return{arrayValue:{values:t}}}class Tr extends Js{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function El(n){return ce(n.integerValue||n.doubleValue)}function Vh(n){return qo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Oh{constructor(e,t){this.field=e,this.transform=t}}function wy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof vr&&s instanceof vr||r instanceof Er&&s instanceof Er?En(r.elements,s.elements,Ze):r instanceof Tr&&s instanceof Tr?Ze(r.Ae,s.Ae):r instanceof yr&&s instanceof yr})(n.transform,e.transform)}class Ay{constructor(e,t){this.version=e,this.transformResults=t}}class Ve{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ve}static exists(e){return new Ve(void 0,e)}static updateTime(e){return new Ve(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ms(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Zs{}function Lh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ei(n.key,Ve.none()):new Dr(n.key,n.data,Ve.none());{const t=n.data,r=De.empty();let s=new ge(Te.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new xt(n.key,r,new Me(s.toArray()),Ve.none())}}function by(n,e,t){n instanceof Dr?(function(s,i,a){const l=s.value.clone(),u=Il(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof xt?(function(s,i,a){if(!ms(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=Il(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Mh(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function ar(n,e,t,r){return n instanceof Dr?(function(i,a,l,u){if(!ms(i.precondition,a))return l;const d=i.value.clone(),f=wl(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof xt?(function(i,a,l,u){if(!ms(i.precondition,a))return l;const d=wl(i.fieldTransforms,u,a),f=a.data;return f.setAll(Mh(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,l){return ms(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Ry(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=kh(r.transform,s||null);i!=null&&(t===null&&(t=De.empty()),t.set(r.field,i))}return t||null}function Tl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&En(r,s,((i,a)=>wy(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Dr extends Zs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class xt extends Zs{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Mh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Il(n,e,t){const r=new Map;Q(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,Iy(a,l,t[s]))}return r}function wl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Ty(i,a,e))}return r}class ei extends Zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sy extends Zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Py{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&by(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ar(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ar(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Sh();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Lh(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(B.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),G())}isEqual(e){return this.batchId===e.batchId&&En(this.mutations,e.mutations,((t,r)=>Tl(t,r)))&&En(this.baseMutations,e.baseMutations,((t,r)=>Tl(t,r)))}}class Go{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return _y})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Go(e,t,r,s)}}class Cy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ky{constructor(e,t){this.count=e,this.unchangedNames=t}}var ue,K;function Ny(n){switch(n){case S.OK:return F(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function xh(n){if(n===void 0)return ut("GRPC error has no .code"),S.UNKNOWN;switch(n){case ue.OK:return S.OK;case ue.CANCELLED:return S.CANCELLED;case ue.UNKNOWN:return S.UNKNOWN;case ue.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case ue.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case ue.INTERNAL:return S.INTERNAL;case ue.UNAVAILABLE:return S.UNAVAILABLE;case ue.UNAUTHENTICATED:return S.UNAUTHENTICATED;case ue.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case ue.NOT_FOUND:return S.NOT_FOUND;case ue.ALREADY_EXISTS:return S.ALREADY_EXISTS;case ue.PERMISSION_DENIED:return S.PERMISSION_DENIED;case ue.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case ue.ABORTED:return S.ABORTED;case ue.OUT_OF_RANGE:return S.OUT_OF_RANGE;case ue.UNIMPLEMENTED:return S.UNIMPLEMENTED;case ue.DATA_LOSS:return S.DATA_LOSS;default:return F(39323,{code:n})}}(K=ue||(ue={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";function Dy(){return new TextEncoder}const Vy=new Pt([4294967295,4294967295],0);function Al(n){const e=Dy().encode(n),t=new Yu;return t.update(e),new Uint8Array(t.digest())}function bl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Pt([t,r],0),new Pt([s,i],0)]}class Ko{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new er(`Invalid padding: ${t}`);if(r<0)throw new er(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new er(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new er(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Pt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Pt.fromNumber(r)));return s.compare(Vy)===1&&(s=new Pt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Al(e),[r,s]=bl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Ko(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Al(e),[r,s]=bl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class er extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ti{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Vr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ti(B.min(),s,new re(W),ht(),G())}}class Vr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Vr(r,t,G(),G(),G())}}class gs{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Uh{constructor(e,t){this.targetId=e,this.Ce=t}}class Fh{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Rl{constructor(){this.ve=0,this.Fe=Sl(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=G(),t=G(),r=G();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:F(38017,{changeType:i})}})),new Vr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Sl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Oy{constructor(e){this.Ge=e,this.ze=new Map,this.je=ht(),this.Je=os(),this.He=os(),this.Ye=new re(W)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:F(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(ho(i))if(r===0){const a=new L(i.path);this.et(t,a,Re.newNoDocument(a,B.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=Dt(r).toUint8Array()}catch(u){if(u instanceof ch)return vn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Ko(a,s,i)}catch(u){return vn(u instanceof er?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&ho(l.target)){const u=new L(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Re.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=G();this.He.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new ti(e,t,this.Ye,this.je,r);return this.je=ht(),this.Je=os(),this.He=os(),this.Ye=new re(W),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Rl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ge(W),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ge(W),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Rl),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function os(){return new re(L.comparator)}function Sl(){return new re(L.comparator)}const Ly={asc:"ASCENDING",desc:"DESCENDING"},My={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xy={and:"AND",or:"OR"};class Uy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function po(n,e){return n.useProto3Json||Ks(e)?e:{value:e}}function Ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Fy(n,e){return Ls(n,e.toTimestamp())}function Ye(n){return Q(!!n,49232),B.fromTimestamp((function(t){const r=Nt(t);return new te(r.seconds,r.nanos)})(n))}function Qo(n,e){return mo(n,e).canonicalString()}function mo(n,e){const t=(function(s){return new J(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function $h(n){const e=J.fromString(n);return Q(Wh(e),10190,{key:e.toString()}),e}function go(n,e){return Qo(n.databaseId,e.path)}function Wi(n,e){const t=$h(e);if(t.get(1)!==n.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(jh(t))}function qh(n,e){return Qo(n.databaseId,e)}function By(n){const e=$h(n);return e.length===4?J.emptyPath():jh(e)}function _o(n){return new J(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jh(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pl(n,e,t){return{name:go(n,e),fields:t.value.mapValue.fields}}function $y(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(Q(f===void 0||typeof f=="string",58123),Ie.fromBase64String(f||"")):(Q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ie.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const f=d.code===void 0?S.UNKNOWN:xh(d.code);return new V(f,d.message||"")})(a);t=new Fh(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Wi(n,r.document.name),i=Ye(r.document.updateTime),a=r.document.createTime?Ye(r.document.createTime):B.min(),l=new De({mapValue:{fields:r.document.fields}}),u=Re.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];t=new gs(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Wi(n,r.document),i=r.readTime?Ye(r.readTime):B.min(),a=Re.newNoDocument(s,i),l=r.removedTargetIds||[];t=new gs([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Wi(n,r.document),i=r.removedTargetIds||[];t=new gs([],i,s,null)}else{if(!("filter"in e))return F(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new ky(s,i),l=r.targetId;t=new Uh(l,a)}}return t}function qy(n,e){let t;if(e instanceof Dr)t={update:Pl(n,e.key,e.value)};else if(e instanceof ei)t={delete:go(n,e.key)};else if(e instanceof xt)t={update:Pl(n,e.key,e.data),updateMask:Xy(e.fieldMask)};else{if(!(e instanceof Sy))return F(16599,{Vt:e.type});t={verify:go(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof yr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof vr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Er)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Tr)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw F(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:Fy(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)})(n,e.precondition)),t}function jy(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?Ye(s.updateTime):Ye(i);return a.isEqual(B.min())&&(a=Ye(i)),new Ay(a,s.transformResults||[])})(t,e)))):[]}function Hy(n,e){return{documents:[qh(n,e.path)]}}function zy(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=qh(n,s);const i=(function(d){if(d.length!==0)return zh(He.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(v){return{field:hn(v.field),direction:Ky(v.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=po(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function Wy(n){let e=By(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Q(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const v=Hh(m);return v instanceof He&&yh(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((v=>(function(D){return new _r(dn(D.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(v)))})(t.orderBy));let l=null;t.limit&&(l=(function(m){let v;return v=typeof m=="object"?m.value:m,Ks(v)?null:v})(t.limit));let u=null;t.startAt&&(u=(function(m){const v=!!m.before,R=m.values||[];return new Vs(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const v=!m.before,R=m.values||[];return new Vs(R,v)})(t.endAt)),dy(e,s,a,i,l,"F",u,d)}function Gy(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Hh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=dn(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=dn(t.unaryFilter.field);return he.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=dn(t.unaryFilter.field);return he.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=dn(t.unaryFilter.field);return he.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}})(n):n.fieldFilter!==void 0?(function(t){return he.create(dn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return He.create(t.compositeFilter.filters.map((r=>Hh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}})(t.compositeFilter.op))})(n):F(30097,{filter:n})}function Ky(n){return Ly[n]}function Qy(n){return My[n]}function Yy(n){return xy[n]}function hn(n){return{fieldPath:n.canonicalString()}}function dn(n){return Te.fromServerFormat(n.fieldPath)}function zh(n){return n instanceof he?(function(t){if(t.op==="=="){if(ml(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NAN"}};if(pl(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ml(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NOT_NAN"}};if(pl(t.value))return{unaryFilter:{field:hn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hn(t.field),op:Qy(t.op),value:t.value}}})(n):n instanceof He?(function(t){const r=t.getFilters().map((s=>zh(s)));return r.length===1?r[0]:{compositeFilter:{op:Yy(t.op),filters:r}}})(n):F(54877,{filter:n})}function Xy(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Wh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class At{constructor(e,t,r,s,i=B.min(),a=B.min(),l=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new At(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new At(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new At(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new At(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Jy{constructor(e){this.yt=e}}function Zy(n){const e=Wy({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Os(e,e.limit,"L"):e}class ev{constructor(){this.Cn=new tv}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(kt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(kt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class tv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ge(J.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ge(J.comparator)).toArray()}}const Cl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gh=41943040;class Ne{static withCacheSize(e){return new Ne(e,Ne.DEFAULT_COLLECTION_PERCENTILE,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ne.DEFAULT_COLLECTION_PERCENTILE=10,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ne.DEFAULT=new Ne(Gh,Ne.DEFAULT_COLLECTION_PERCENTILE,Ne.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ne.DISABLED=new Ne(-1,0,0);class wn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new wn(0)}static cr(){return new wn(-1)}}const kl="LruGarbageCollector",nv=1048576;function Nl([n,e],[t,r]){const s=W(n,t);return s===0?W(e,r):s}class rv{constructor(e){this.Ir=e,this.buffer=new ge(Nl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Nl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){O(kl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){kn(t)?O(kl,"Ignoring IndexedDB error during garbage collection: ",t):await Cn(t)}await this.Vr(3e5)}))}}class iv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Gs.ce);const r=new rv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Cl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Cl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,l,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,l=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(d=Date.now(),ln()<=z.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function ov(n,e){return new iv(n,e)}class av{constructor(){this.changes=new tn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&ar(r.mutation,s,Me.empty(),te.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,G()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=G()){const s=Gt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=Zn();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Gt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,G())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=ht();const a=or(),l=(function(){return or()})();return t.forEach(((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof xt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),ar(f.mutation,d,f.mutation.getFieldMask(),te.now())):a.set(d.key,Me.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((d,f)=>a.set(d,f))),t.forEach(((d,f)=>l.set(d,new cv(f,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=or();let s=new re(((a,l)=>a-l)),i=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let f=r.get(u)||Me.empty();f=l.applyToLocalView(d,f),r.set(u,f);const m=(s.get(l.batchId)||G()).add(u);s=s.insert(l.batchId,m)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,m=Sh();f.forEach((v=>{if(!i.has(v)){const R=Lh(t.get(v),r.get(v));R!==null&&m.set(v,R),i=i.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ih(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):P.resolve(Gt());let l=fr,u=i;return a.next((d=>P.forEach(d,((f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((v=>{u=u.insert(f,v)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,u,d,G()))).next((f=>({batchId:l,changes:Rh(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next((r=>{let s=Zn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=Zn();return this.indexManager.getCollectionParents(e,i).next((l=>P.forEach(l,(u=>{const d=(function(m,v){return new Nn(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((f=>{f.forEach(((m,v)=>{a=a.insert(m,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Re.newInvalidDocument(f)))}));let l=Zn();return a.forEach(((u,d)=>{const f=i.get(u);f!==void 0&&ar(f.mutation,d,Me.empty(),te.now()),Xs(t,d)&&(l=l.insert(u,d))})),l}))}}class uv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Ye(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Zy(s.bundledQuery),readTime:Ye(s.readTime)}})(t)),P.resolve()}}class hv{constructor(){this.overlays=new re(L.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Gt();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Gt(),i=t.length+1,a=new L(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new re(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Gt(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Gt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,f)=>l.set(d,f))),!(l.size()>=s)););return P.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Cy(t,r));let i=this.qr.get(t);i===void 0&&(i=G(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class dv{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class Yo{constructor(){this.Qr=new ge(ye.$r),this.Ur=new ge(ye.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ye(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new ye(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new L(new J([])),r=new ye(t,e),s=new ye(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new L(new J([])),r=new ye(t,e),s=new ye(t,e+1);let i=G();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new ye(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ye{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return L.comparator(e.key,t.key)||W(e.Yr,t.Yr)}static Kr(e,t){return W(e.Yr,t.Yr)||L.comparator(e.key,t.key)}}class fv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ge(ye.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Py(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new ye(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Bo:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ye(t,0),s=new ye(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);i.push(l)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ge(W);return t.forEach((s=>{const i=new ye(s,0),a=new ye(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(l=>{r=r.add(l.Yr)}))})),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;L.isDocumentKey(i)||(i=i.child(""));const a=new ye(new L(i),0);let l=new ge(W);return this.Zr.forEachWhile((u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Yr)),!0)}),a),P.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Q(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,(s=>{const i=new ye(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new ye(t,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class pv{constructor(e){this.ri=e,this.docs=(function(){return new re(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let r=ht();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Re.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ht();const a=t.path,l=new L(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||H_(j_(f),r)<=0||(s.has(f.key)||Xs(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,r,s){F(9500)}ii(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new mv(this)}getSize(e){return P.resolve(this.size)}}class mv extends av{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class gv{constructor(e){this.persistence=e,this.si=new tn((t=>jo(t)),Ho),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new Yo,this.targetCount=0,this.ai=wn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new wn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class Kh{constructor(e,t){this.ui={},this.overlays={},this.ci=new Gs(0),this.li=!1,this.li=!0,this.hi=new dv,this.referenceDelegate=e(this),this.Pi=new gv(this),this.indexManager=new ev,this.remoteDocumentCache=(function(s){return new pv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Jy(t),this.Ii=new uv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new fv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);const s=new _v(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return P.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class _v extends W_{constructor(e){super(),this.currentSequenceNumber=e}}class Xo{constructor(e){this.persistence=e,this.Ri=new Yo,this.Vi=null}static mi(e){return new Xo(e)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(r=>{const s=L.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,B.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ms{constructor(e,t){this.persistence=e,this.pi=new tn((r=>Q_(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=ov(this,t)}static mi(e,t){return new Ms(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,i.removeEntry(a,B.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=fs(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Jo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=G(),s=G();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Jo(e,t.fromCache,r,s)}}class yv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return zf()?8:G_(Se())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new yv;return this.Ss(e,t,a).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(ln()<=z.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",un(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(ln()<=z.DEBUG&&O("QueryEngine","Query:",un(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(ln()<=z.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",un(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qe(t))):P.resolve())}ys(e,t){if(vl(t))return P.resolve(null);let r=Qe(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Os(t,null,"F"),r=Qe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=G(...i);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const d=this.Ds(t,l);return this.Cs(t,d,a,u.readTime)?this.ys(e,Os(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ws(e,t,r,s){return vl(t)||s.isEqual(B.min())?P.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?P.resolve(null):(ln()<=z.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),un(t)),this.vs(e,a,t,q_(s,fr)).next((l=>l)))}))}Ds(e,t){let r=new ge(Ah(e));return t.forEach(((s,i)=>{Xs(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return ln()<=z.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",un(t)),this.ps.getDocumentsMatchingQuery(e,t,kt.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const Zo="LocalStore",Ev=3e8;class Tv{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new re(W),this.xs=new tn((i=>jo(i)),Ho),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Iv(n,e,t,r){return new Tv(n,e,t,r)}async function Qh(n,e){const t=$(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=G();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function wv(n,e){const t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,f){const m=d.batch,v=m.keys();let R=P.resolve();return v.forEach((D=>{R=R.next((()=>f.getEntry(u,D))).next((k=>{const C=d.docVersions.get(D);Q(C!==null,48541),k.version.compareTo(C)<0&&(m.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))}))})),R.next((()=>l.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=G();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Yh(n){const e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Av(n,e){const t=$(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((f,m)=>{const v=s.get(m);if(!v)return;l.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(i,f.addedDocuments,m))));let R=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?R=R.withResumeToken(Ie.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,r)),s=s.insert(m,R),(function(k,C,M){return k.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Ev?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(v,R,f)&&l.push(t.Pi.updateTargetData(i,R))}));let u=ht(),d=G();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(bv(i,a,e.documentUpdates).next((f=>{u=f.ks,d=f.qs}))),!r.isEqual(B.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next((m=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return P.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,d))).next((()=>u))})).then((i=>(t.Ms=s,i)))}function bv(n,e,t){let r=G(),s=G();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=ht();return t.forEach(((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(B.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):O(Zo,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function Rv(n,e){const t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Bo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Sv(n,e){const t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,P.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new At(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function yo(n,e,t){const r=$(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!kn(a))throw a;O(Zo,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Dl(n,e,t){const r=$(n);let s=B.min(),i=G();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,f){const m=$(u),v=m.xs.get(f);return v!==void 0?P.resolve(m.Ms.get(v)):m.Pi.getTargetData(d,f)})(r,a,Qe(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:B.min(),t?i:G()))).next((l=>(Pv(r,py(e),l),{documents:l,Qs:i})))))}function Pv(n,e,t){let r=n.Os.get(e)||B.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class Vl{constructor(){this.activeTargetIds=Ey()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Cv{constructor(){this.Mo=new Vl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Vl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class kv{Oo(e){}shutdown(){}}const Ol="ConnectivityMonitor";class Ll{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){O(Ol,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){O(Ol,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let as=null;function vo(){return as===null?as=(function(){return 268435456+Math.round(2147483648*Math.random())})():as++,"0x"+as.toString(16)}const Gi="RestConnection",Nv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Dv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Ns?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=vo(),l=this.zo(e,t.toUriEncodedString());O(Gi,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:d}=new URL(l),f=bn(d);return this.Jo(e,l,u,r,f).then((m=>(O(Gi,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw vn(Gi,`RPC '${e}' ${a} failed with error: `,m,"url: ",l,"request:",r),m}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Pn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=Nv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Vv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ae="WebChannelConnection";class Ov extends Dv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=vo();return new Promise(((l,u)=>{const d=new Xu;d.setWithCredentials(!0),d.listenOnce(Ju.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ds.NO_ERROR:const m=d.getResponseJson();O(Ae,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),l(m);break;case ds.TIMEOUT:O(Ae,`RPC '${e}' ${a} timed out`),u(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case ds.HTTP_ERROR:const v=d.getStatus();if(O(Ae,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const D=R?.error;if(D&&D.status&&D.message){const k=(function(M){const q=M.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(q)>=0?q:S.UNKNOWN})(D.status);u(new V(k,D.message))}else u(new V(S.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new V(S.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(Ae,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);O(Ae,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=vo(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=th(),l=eh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=i.join("");O(Ae,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let v=!1,R=!1;const D=new Vv({Yo:C=>{R?O(Ae,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(v||(O(Ae,`Opening RPC '${e}' stream ${s} transport.`),m.open(),v=!0),O(Ae,`RPC '${e}' stream ${s} sending:`,C),m.send(C))},Zo:()=>m.close()}),k=(C,M,q)=>{C.listen(M,(x=>{try{q(x)}catch(H){setTimeout((()=>{throw H}),0)}}))};return k(m,Jn.EventType.OPEN,(()=>{R||(O(Ae,`RPC '${e}' stream ${s} transport opened.`),D.o_())})),k(m,Jn.EventType.CLOSE,(()=>{R||(R=!0,O(Ae,`RPC '${e}' stream ${s} transport closed`),D.a_(),this.E_(m))})),k(m,Jn.EventType.ERROR,(C=>{R||(R=!0,vn(Ae,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),D.a_(new V(S.UNAVAILABLE,"The operation could not be completed")))})),k(m,Jn.EventType.MESSAGE,(C=>{if(!R){const M=C.data[0];Q(!!M,16349);const q=M,x=q?.error||q[0]?.error;if(x){O(Ae,`RPC '${e}' stream ${s} received error:`,x);const H=x.status;let se=(function(g){const y=ue[g];if(y!==void 0)return xh(y)})(H),ae=x.message;se===void 0&&(se=S.INTERNAL,ae="Unknown error status: "+H+" with message "+x.message),R=!0,D.a_(new V(se,ae)),m.close()}else O(Ae,`RPC '${e}' stream ${s} received:`,M),D.u_(M)}})),k(l,Zu.STAT_EVENT,(C=>{C.stat===oo.PROXY?O(Ae,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===oo.NOPROXY&&O(Ae,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{D.__()}),0),D}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Ki(){return typeof document<"u"?document:null}function ni(n){return new Uy(n,!0)}class Xh{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ml="PersistentStream";class Jh{constructor(e,t,r,s,i,a,l,u){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(ut(t.toString()),ut("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new V(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return O(Ml,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(O(Ml,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Lv extends Jh{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=$y(this.serializer,e),r=(function(i){if(!("targetChange"in i))return B.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Ye(a.readTime):B.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=_o(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=ho(u)?{documents:Hy(i,u)}:{query:zy(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Bh(i,a.resumeToken);const d=po(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){l.readTime=Ls(i,a.snapshotVersion.toTimestamp());const d=po(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=Gy(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=_o(this.serializer),t.removeTarget=e,this.q_(t)}}class Mv extends Jh{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=jy(e.writeResults,e.commitTime),r=Ye(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=_o(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>qy(this.serializer,r)))};this.q_(t)}}class xv{}class Uv extends xv{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,mo(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new V(S.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,mo(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(S.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Fv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ut(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const en="RemoteStore";class Bv{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{nn(this)&&(O(en,"Restarting streams for network reachability change."),await(async function(u){const d=$(u);d.Ea.add(4),await Or(d),d.Ra.set("Unknown"),d.Ea.delete(4),await ri(d)})(this))}))})),this.Ra=new Fv(r,s)}}async function ri(n){if(nn(n))for(const e of n.da)await e(!0)}async function Or(n){for(const e of n.da)await e(!1)}function Zh(n,e){const t=$(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ra(t)?na(t):Dn(t).O_()&&ta(t,e))}function ea(n,e){const t=$(n),r=Dn(t);t.Ia.delete(e),r.O_()&&ed(t,e),t.Ia.size===0&&(r.O_()?r.L_():nn(t)&&t.Ra.set("Unknown"))}function ta(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Dn(n).Y_(e)}function ed(n,e){n.Va.Ue(e),Dn(n).Z_(e)}function na(n){n.Va=new Oy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Dn(n).start(),n.Ra.ua()}function ra(n){return nn(n)&&!Dn(n).x_()&&n.Ia.size>0}function nn(n){return $(n).Ea.size===0}function td(n){n.Va=void 0}async function $v(n){n.Ra.set("Online")}async function qv(n){n.Ia.forEach(((e,t)=>{ta(n,e)}))}async function jv(n,e){td(n),ra(n)?(n.Ra.ha(e),na(n)):n.Ra.set("Unknown")}async function Hv(n,e,t){if(n.Ra.set("Online"),e instanceof Fh&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){O(en,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await xs(n,r)}else if(e instanceof gs?n.Va.Ze(e):e instanceof Uh?n.Va.st(e):n.Va.tt(e),!t.isEqual(B.min()))try{const r=await Yh(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),ed(i,u);const m=new At(f.target,u,d,f.sequenceNumber);ta(i,m)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){O(en,"Failed to raise snapshot:",r),await xs(n,r)}}async function xs(n,e,t){if(!kn(e))throw e;n.Ea.add(1),await Or(n),n.Ra.set("Offline"),t||(t=()=>Yh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(en,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ri(n)}))}function nd(n,e){return e().catch((t=>xs(n,t,e)))}async function si(n){const e=$(n),t=Ot(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Bo;for(;zv(e);)try{const s=await Rv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Wv(e,s)}catch(s){await xs(e,s)}rd(e)&&sd(e)}function zv(n){return nn(n)&&n.Ta.length<10}function Wv(n,e){n.Ta.push(e);const t=Ot(n);t.O_()&&t.X_&&t.ea(e.mutations)}function rd(n){return nn(n)&&!Ot(n).x_()&&n.Ta.length>0}function sd(n){Ot(n).start()}async function Gv(n){Ot(n).ra()}async function Kv(n){const e=Ot(n);for(const t of n.Ta)e.ea(t.mutations)}async function Qv(n,e,t){const r=n.Ta.shift(),s=Go.from(r,e,t);await nd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await si(n)}async function Yv(n,e){e&&Ot(n).X_&&await(async function(r,s){if((function(a){return Ny(a)&&a!==S.ABORTED})(s.code)){const i=r.Ta.shift();Ot(r).B_(),await nd(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await si(r)}})(n,e),rd(n)&&sd(n)}async function xl(n,e){const t=$(n);t.asyncQueue.verifyOperationInProgress(),O(en,"RemoteStore received new credentials");const r=nn(t);t.Ea.add(3),await Or(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ri(t)}async function Xv(n,e){const t=$(n);e?(t.Ea.delete(2),await ri(t)):e||(t.Ea.add(2),await Or(t),t.Ra.set("Unknown"))}function Dn(n){return n.ma||(n.ma=(function(t,r,s){const i=$(t);return i.sa(),new Lv(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:$v.bind(null,n),t_:qv.bind(null,n),r_:jv.bind(null,n),H_:Hv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ra(n)?na(n):n.Ra.set("Unknown")):(await n.ma.stop(),td(n))}))),n.ma}function Ot(n){return n.fa||(n.fa=(function(t,r,s){const i=$(t);return i.sa(),new Mv(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Gv.bind(null,n),r_:Yv.bind(null,n),ta:Kv.bind(null,n),na:Qv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await si(n)):(await n.fa.stop(),n.Ta.length>0&&(O(en,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class sa{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new at,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new sa(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ia(n,e){if(ut("AsyncQueue",`${e}: ${n}`),kn(n))return new V(S.UNAVAILABLE,`${e}: ${n}`);throw n}class gn{static emptySet(e){return new gn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Zn(),this.sortedSet=new re(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new gn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ul{constructor(){this.ga=new re(L.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):F(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class An{constructor(e,t,r,s,i,a,l,u,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new An(e,t,gn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ys(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Jv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Zv{constructor(){this.queries=Fl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=$(t),i=s.queries;s.queries=Fl(),i.forEach(((a,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new V(S.ABORTED,"Firestore shutting down"))}}function Fl(){return new tn((n=>wh(n)),Ys)}async function id(n,e){const t=$(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new Jv,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=ia(a,`Initialization of query '${un(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&oa(t)}async function od(n,e){const t=$(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function eE(n,e){const t=$(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&oa(t)}function tE(n,e,t){const r=$(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function oa(n){n.Ca.forEach((e=>{e.next()}))}var Eo,Bl;(Bl=Eo||(Eo={})).Ma="default",Bl.Cache="cache";class ad{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new An(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=An.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Eo.Cache}}class cd{constructor(e){this.key=e}}class ld{constructor(e){this.key=e}}class nE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=G(),this.mutatedKeys=G(),this.eu=Ah(e),this.tu=new gn(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Ul,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const v=s.get(f),R=Xs(this.query,m)?m:null,D=!!v&&this.mutatedKeys.has(v.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let C=!1;v&&R?v.data.isEqual(R.data)?D!==k&&(r.track({type:3,doc:R}),C=!0):this.su(v,R)||(r.track({type:2,doc:R}),C=!0,(u&&this.eu(R,u)>0||d&&this.eu(R,d)<0)&&(l=!0)):!v&&R?(r.track({type:0,doc:R}),C=!0):v&&!R&&(r.track({type:1,doc:v}),C=!0,(u||d)&&(l=!0)),C&&(R?(a=a.add(R),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(R,D){const k=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:C})}};return k(R)-k(D)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new An(this.query,e.tu,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ul,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=G(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new ld(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new cd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=G();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return An.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const aa="SyncEngine";class rE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class sE{constructor(e){this.key=e,this.hu=!1}}class iE{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new tn((l=>wh(l)),Ys),this.Iu=new Map,this.Eu=new Set,this.du=new re(L.comparator),this.Au=new Map,this.Ru=new Yo,this.Vu={},this.mu=new Map,this.fu=wn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function oE(n,e,t=!0){const r=md(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await ud(r,e,t,!0),s}async function aE(n,e){const t=md(n);await ud(t,e,!0,!1)}async function ud(n,e,t,r){const s=await Sv(n.localStore,Qe(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await cE(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Zh(n.remoteStore,s),l}async function cE(n,e,t,r,s){n.pu=(m,v,R)=>(async function(k,C,M,q){let x=C.view.ru(M);x.Cs&&(x=await Dl(k.localStore,C.query,!1).then((({documents:T})=>C.view.ru(T,x))));const H=q&&q.targetChanges.get(C.targetId),se=q&&q.targetMismatches.get(C.targetId)!=null,ae=C.view.applyChanges(x,k.isPrimaryClient,H,se);return ql(k,C.targetId,ae.au),ae.snapshot})(n,m,v,R);const i=await Dl(n.localStore,e,!0),a=new nE(e,i.Qs),l=a.ru(i.documents),u=Vr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,u);ql(n,t,d.au);const f=new rE(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function lE(n,e,t){const r=$(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Ys(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await yo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ea(r.remoteStore,s.targetId),To(r,s.targetId)})).catch(Cn)):(To(r,s.targetId),await yo(r.localStore,s.targetId,!0))}async function uE(n,e){const t=$(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ea(t.remoteStore,r.targetId))}async function hE(n,e,t){const r=yE(n);try{const s=await(function(a,l){const u=$(a),d=te.now(),f=l.reduce(((R,D)=>R.add(D.key)),G());let m,v;return u.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let D=ht(),k=G();return u.Ns.getEntries(R,f).next((C=>{D=C,D.forEach(((M,q)=>{q.isValidDocument()||(k=k.add(M))}))})).next((()=>u.localDocuments.getOverlayedDocuments(R,D))).next((C=>{m=C;const M=[];for(const q of l){const x=Ry(q,m.get(q.key).overlayedDocument);x!=null&&M.push(new xt(q.key,x,mh(x.value.mapValue),Ve.exists(!0)))}return u.mutationQueue.addMutationBatch(R,d,M,l)})).next((C=>{v=C;const M=C.applyToLocalDocumentSet(m,k);return u.documentOverlayCache.saveOverlays(R,C.batchId,M)}))})).then((()=>({batchId:v.batchId,changes:Rh(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new re(W)),d=d.insert(l,u),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Lr(r,s.changes),await si(r.remoteStore)}catch(s){const i=ia(s,"Failed to persist write");t.reject(i)}}async function hd(n,e){const t=$(n);try{const r=await Av(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await Lr(t,r,e)}catch(r){await Cn(r)}}function $l(n,e,t){const r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=$(a);u.onlineState=l;let d=!1;u.queries.forEach(((f,m)=>{for(const v of m.Sa)v.va(l)&&(d=!0)})),d&&oa(u)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function dE(n,e,t){const r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new re(L.comparator);a=a.insert(i,Re.newNoDocument(i,B.min()));const l=G().add(i),u=new ti(B.min(),new Map,new re(W),a,l);await hd(r,u),r.du=r.du.remove(i),r.Au.delete(e),ca(r)}else await yo(r.localStore,e,!1).then((()=>To(r,e,t))).catch(Cn)}async function fE(n,e){const t=$(n),r=e.batch.batchId;try{const s=await wv(t.localStore,e);fd(t,r,null),dd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Lr(t,s)}catch(s){await Cn(s)}}async function pE(n,e,t){const r=$(n);try{const s=await(function(a,l){const u=$(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next((m=>(Q(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(d,m)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>u.localDocuments.getDocuments(d,f)))}))})(r.localStore,e);fd(r,e,t),dd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Lr(r,s)}catch(s){await Cn(s)}}function dd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function fd(n,e,t){const r=$(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function To(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||pd(n,r)}))}function pd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ea(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),ca(n))}function ql(n,e,t){for(const r of t)r instanceof cd?(n.Ru.addReference(r.key,e),mE(n,r)):r instanceof ld?(O(aa,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||pd(n,r.key)):F(19791,{wu:r})}function mE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(O(aa,"New document in limbo: "+t),n.Eu.add(r),ca(n))}function ca(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new L(J.fromString(e)),r=n.fu.next();n.Au.set(r,new sE(t)),n.du=n.du.insert(t,r),Zh(n.remoteStore,new At(Qe(zo(t.path)),r,"TargetPurposeLimboResolution",Gs.ce))}}async function Lr(n,e,t){const r=$(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Jo.As(u.targetId,d);i.push(f)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(u,d){const f=$(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(d,(v=>P.forEach(v.Es,(R=>f.persistence.referenceDelegate.addReference(m,v.targetId,R))).next((()=>P.forEach(v.ds,(R=>f.persistence.referenceDelegate.removeReference(m,v.targetId,R)))))))))}catch(m){if(!kn(m))throw m;O(Zo,"Failed to update sequence numbers: "+m)}for(const m of d){const v=m.targetId;if(!m.fromCache){const R=f.Ms.get(v),D=R.snapshotVersion,k=R.withLastLimboFreeSnapshotVersion(D);f.Ms=f.Ms.insert(v,k)}}})(r.localStore,i))}async function gE(n,e){const t=$(n);if(!t.currentUser.isEqual(e)){O(aa,"User change. New user:",e.toKey());const r=await Qh(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new V(S.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Lr(t,r.Ls)}}function _E(n,e){const t=$(n),r=t.Au.get(e);if(r&&r.hu)return G().add(r.key);{let s=G();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function md(n){const e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=hd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_E.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dE.bind(null,e),e.Pu.H_=eE.bind(null,e.eventManager),e.Pu.yu=tE.bind(null,e.eventManager),e}function yE(n){const e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pE.bind(null,e),e}class Us{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ni(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Iv(this.persistence,new vv,e.initialUser,this.serializer)}Cu(e){return new Kh(Xo.mi,this.serializer)}Du(e){return new Cv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Us.provider={build:()=>new Us};class vE extends Us{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof Ms,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new sv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ne.withCacheSize(this.cacheSizeBytes):Ne.DEFAULT;return new Kh((r=>Ms.mi(r,t)),this.serializer)}}class Io{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$l(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=gE.bind(null,this.syncEngine),await Xv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Zv})()}createDatastore(e){const t=ni(e.databaseInfo.databaseId),r=(function(i){return new Ov(i)})(e.databaseInfo);return(function(i,a,l,u){return new Uv(i,a,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new Bv(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>$l(this.syncEngine,t,0)),(function(){return Ll.v()?new Ll:new kv})())}createSyncEngine(e,t){return(function(s,i,a,l,u,d,f){const m=new iE(s,i,a,l,u,d);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=$(t);O(en,"RemoteStore shutting down."),r.Ea.add(5),await Or(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Io.provider={build:()=>new Io};class gd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ut("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Lt="FirestoreClient";class EE{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=be.UNAUTHENTICATED,this.clientId=Fo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{O(Lt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(O(Lt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new at;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ia(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Qi(n,e){n.asyncQueue.verifyOperationInProgress(),O(Lt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Qh(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function jl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await TE(n);O(Lt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>xl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>xl(e.remoteStore,s))),n._onlineComponents=e}async function TE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Lt,"Using user provided OfflineComponentProvider");try{await Qi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;vn("Error using user provided cache. Falling back to memory cache: "+t),await Qi(n,new Us)}}else O(Lt,"Using default OfflineComponentProvider"),await Qi(n,new vE(void 0));return n._offlineComponents}async function _d(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Lt,"Using user provided OnlineComponentProvider"),await jl(n,n._uninitializedComponentsProvider._online)):(O(Lt,"Using default OnlineComponentProvider"),await jl(n,new Io))),n._onlineComponents}function IE(n){return _d(n).then((e=>e.syncEngine))}async function yd(n){const e=await _d(n),t=e.eventManager;return t.onListen=oE.bind(null,e.syncEngine),t.onUnlisten=lE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=aE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=uE.bind(null,e.syncEngine),t}function wE(n,e,t={}){const r=new at;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new gd({next:v=>{f.Nu(),a.enqueueAndForget((()=>od(i,m)));const R=v.docs.has(l);!R&&v.fromCache?d.reject(new V(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&v.fromCache&&u&&u.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new ad(zo(l.path),f,{includeMetadataChanges:!0,qa:!0});return id(i,m)})(await yd(n),n.asyncQueue,e,t,r))),r.promise}function AE(n,e,t={}){const r=new at;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new gd({next:v=>{f.Nu(),a.enqueueAndForget((()=>od(i,m))),v.fromCache&&u.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new ad(l,f,{includeMetadataChanges:!0,qa:!0});return id(i,m)})(await yd(n),n.asyncQueue,e,t,r))),r.promise}function vd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Hl=new Map;const Ed="firestore.googleapis.com",zl=!0;class Wl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ed,this.ssl=zl}else this.host=e.host,this.ssl=e.ssl??zl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Gh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<nv)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}B_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ii{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new k_;switch(r.type){case"firstParty":return new O_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Hl.get(t);r&&(O("ComponentProvider","Removing Datastore"),Hl.delete(t),r.terminate())})(this),Promise.resolve()}}function bE(n,e,t,r={}){n=je(n,ii);const s=bn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(lu(`https://${l}`),uu("Firestore",!0)),i.host!==Ed&&i.host!==l&&vn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!Qt(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=be.MOCK_USER;else{d=Mf(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new be(m)}n._authCredentials=new N_(new rh(d,f))}}class Ut{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ut(this.firestore,e,this._query)}}class le{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ct(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}toJSON(){return{type:le._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Nr(t,le._jsonSchema))return new le(e,r||null,new L(J.fromString(t.referencePath)))}}le._jsonSchemaVersion="firestore/documentReference/1.0",le._jsonSchema={type:de("string",le._jsonSchemaVersion),referencePath:de("string")};class Ct extends Ut{constructor(e,t,r){super(e,t,zo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new L(e))}withConverter(e){return new Ct(this.firestore,e,this._path)}}function rn(n,e,...t){if(n=oe(n),sh("collection","path",e),n instanceof ii){const r=J.fromString(e,...t);return il(r),new Ct(n,null,r)}{if(!(n instanceof le||n instanceof Ct))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(J.fromString(e,...t));return il(r),new Ct(n.firestore,null,r)}}function me(n,e,...t){if(n=oe(n),arguments.length===1&&(e=Fo.newId()),sh("doc","path",e),n instanceof ii){const r=J.fromString(e,...t);return sl(r),new le(n,null,new L(r))}{if(!(n instanceof le||n instanceof Ct))throw new V(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(J.fromString(e,...t));return sl(r),new le(n.firestore,n instanceof Ct?n.converter:null,new L(r))}}const Gl="AsyncQueue";class Kl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xh(this,"async_queue_retry"),this._c=()=>{const r=Ki();r&&O(Gl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ki();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ki();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new at;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!kn(e))throw e;O(Gl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,ut("INTERNAL UNHANDLED ERROR: ",Ql(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=sa.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:Ql(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ql(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class sn extends ii{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Kl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Kl(e),this._firestoreClient=void 0,await e}}}function RE(n,e){const t=typeof n=="object"?n:pu(),r=typeof n=="string"?n:Ns,s=Ro(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Of("firestore");i&&bE(s,...i)}return s}function oi(n){if(n._terminated)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||SE(n),n._firestoreClient}function SE(n){const e=n._freezeSettings(),t=(function(s,i,a,l){return new J_(s,i,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,vd(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new EE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class Fe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fe(Ie.fromBase64String(e))}catch(t){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fe(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Nr(e,Fe._jsonSchema))return Fe.fromBase64String(e.bytes)}}Fe._jsonSchemaVersion="firestore/bytes/1.0",Fe._jsonSchema={type:de("string",Fe._jsonSchemaVersion),bytes:de("string")};class Mr{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class xr{constructor(e){this._methodName=e}}class Xe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xe._jsonSchemaVersion}}static fromJSON(e){if(Nr(e,Xe._jsonSchema))return new Xe(e.latitude,e.longitude)}}Xe._jsonSchemaVersion="firestore/geoPoint/1.0",Xe._jsonSchema={type:de("string",Xe._jsonSchemaVersion),latitude:de("number"),longitude:de("number")};class Je{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Je._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Nr(e,Je._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Je(e.vectorValues);throw new V(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Je._jsonSchemaVersion="firestore/vectorValue/1.0",Je._jsonSchema={type:de("string",Je._jsonSchemaVersion),vectorValues:de("object")};const PE=/^__.*__$/;class CE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new xt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dr(e,this.data,t,this.fieldTransforms)}}class Td{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Id(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}class la{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new la({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Fs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Id(this.Ac)&&PE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class kE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ni(e)}Cc(e,t,r,s=!1){return new la({Ac:e,methodName:t,Dc:r,path:Te.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ai(n){const e=n._freezeSettings(),t=ni(n._databaseId);return new kE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wd(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);da("Data must be an object, but it was:",a,r);const l=Rd(r,a);let u,d;if(i.merge)u=new Me(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const v=wo(e,m,t);if(!a.contains(v))throw new V(S.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Pd(f,v)||f.push(v)}u=new Me(f),d=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,d=a.fieldTransforms;return new CE(new De(l),u,d)}class ci extends xr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ci}}class ua extends xr{_toFieldTransform(e){return new Oh(e.path,new yr)}isEqual(e){return e instanceof ua}}class ha extends xr{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Tr(e.serializer,Ch(e.serializer,this.Fc));return new Oh(e.path,t)}isEqual(e){return e instanceof ha&&this.Fc===e.Fc}}function Ad(n,e,t,r){const s=n.Cc(1,e,t);da("Data must be an object, but it was:",s,r);const i=[],a=De.empty();Mt(r,((u,d)=>{const f=fa(e,u,t);d=oe(d);const m=s.yc(f);if(d instanceof ci)i.push(f);else{const v=Ur(d,m);v!=null&&(i.push(f),a.set(f,v))}}));const l=new Me(i);return new Td(a,l,s.fieldTransforms)}function bd(n,e,t,r,s,i){const a=n.Cc(1,e,t),l=[wo(e,r,t)],u=[s];if(i.length%2!=0)throw new V(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)l.push(wo(e,i[v])),u.push(i[v+1]);const d=[],f=De.empty();for(let v=l.length-1;v>=0;--v)if(!Pd(d,l[v])){const R=l[v];let D=u[v];D=oe(D);const k=a.yc(R);if(D instanceof ci)d.push(R);else{const C=Ur(D,k);C!=null&&(d.push(R),f.set(R,C))}}const m=new Me(d);return new Td(f,m,a.fieldTransforms)}function NE(n,e,t,r=!1){return Ur(t,n.Cc(r?4:3,e))}function Ur(n,e){if(Sd(n=oe(n)))return da("Unsupported field value:",e,n),Rd(n,e);if(n instanceof xr)return(function(r,s){if(!Id(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=Ur(l,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=oe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Ch(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=te.fromDate(r);return{timestampValue:Ls(s.serializer,i)}}if(r instanceof te){const i=new te(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ls(s.serializer,i)}}if(r instanceof Xe)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Fe)return{bytesValue:Bh(s.serializer,r._byteString)};if(r instanceof le){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Qo(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Je)return(function(a,l){return{mapValue:{fields:{[fh]:{stringValue:ph},[Ds]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Wo(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Ws(r)}`)})(n,e)}function Rd(n,e){const t={};return ah(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mt(n,((r,s)=>{const i=Ur(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Sd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof te||n instanceof Xe||n instanceof Fe||n instanceof le||n instanceof xr||n instanceof Je)}function da(n,e,t){if(!Sd(t)||!ih(t)){const r=Ws(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function wo(n,e,t){if((e=oe(e))instanceof Mr)return e._internalPath;if(typeof e=="string")return fa(n,e);throw Fs("Field path arguments must be of type string or ",n,!1,void 0,t)}const DE=new RegExp("[~\\*/\\[\\]]");function fa(n,e,t){if(e.search(DE)>=0)throw Fs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mr(...e.split("."))._internalPath}catch{throw Fs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Fs(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new V(S.INVALID_ARGUMENT,l+n+u)}function Pd(n,e){return n.some((t=>t.isEqual(e)))}class Cd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new VE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(li("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class VE extends Cd{data(){return super.data()}}function li(n,e){return typeof e=="string"?fa(n,e):e instanceof Mr?e._internalPath:e._delegate._internalPath}function OE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pa{}class ma extends pa{}function Fr(n,e,...t){let r=[];e instanceof pa&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof ga)).length,l=i.filter((u=>u instanceof ui)).length;if(a>1||a>0&&l>0)throw new V(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class ui extends ma{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ui(e,t,r)}_apply(e){const t=this._parse(e);return Nd(e._query,t),new Ut(e.firestore,e.converter,fo(e._query,t))}_parse(e){const t=ai(e.firestore);return(function(i,a,l,u,d,f,m){let v;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Xl(m,f);const D=[];for(const k of m)D.push(Yl(u,i,k));v={arrayValue:{values:D}}}else v=Yl(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Xl(m,f),v=NE(l,a,m,f==="in"||f==="not-in");return he.create(d,f,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function kd(n,e,t){const r=e,s=li("where",n);return ui._create(s,r,t)}class ga extends pa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ga(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:He.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Nd(a,u),a=fo(a,u)})(e._query,t),new Ut(e.firestore,e.converter,fo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class _a extends ma{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _a(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _r(i,a)})(e._query,this._field,this._direction);return new Ut(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new Nn(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function hi(n,e="asc"){const t=e,r=li("orderBy",n);return _a._create(r,t)}class ya extends ma{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ya(e,t,r)}_apply(e){return new Ut(e.firestore,e.converter,Os(e._query,this._limit,this._limitType))}}function va(n){return $_("limit",n),ya._create("limit",n,"F")}function Yl(n,e,t){if(typeof(t=oe(t))=="string"){if(t==="")throw new V(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ih(e)&&t.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(J.fromString(t));if(!L.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fl(n,new L(r))}if(t instanceof le)return fl(n,t._key);throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ws(t)}.`)}function Xl(n,e){if(!Array.isArray(n)||n.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Nd(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class LE{convertValue(e,t="none"){switch(Vt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Dt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Mt(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Ds].arrayValue?.values?.map((r=>ce(r.doubleValue)));return new Je(t)}convertGeoPoint(e){return new Xe(ce(e.latitude),ce(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Qs(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(pr(e));default:return null}}convertTimestamp(e){const t=Nt(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=J.fromString(e);Q(Wh(r),9688,{name:e});const s=new mr(r.get(1),r.get(3)),i=new L(r.popFirst(5));return s.isEqual(t)||ut(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Dd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class tr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Kt extends Cd{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _s(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(li("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Kt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Kt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Kt._jsonSchema={type:de("string",Kt._jsonSchemaVersion),bundleSource:de("string","DocumentSnapshot"),bundleName:de("string"),bundle:de("string")};class _s extends Kt{data(e={}){return super.data(e)}}class _n{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new tr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new _s(this._firestore,this._userDataWriter,r.key,r,new tr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new _s(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new _s(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:ME(l.type),doc:u,oldIndex:d,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=_n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Fo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function ME(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}function Ea(n){n=je(n,le);const e=je(n.firestore,sn);return wE(oi(e),n._key).then((t=>UE(e,n,t)))}_n._jsonSchemaVersion="firestore/querySnapshot/1.0",_n._jsonSchema={type:de("string",_n._jsonSchemaVersion),bundleSource:de("string","QuerySnapshot"),bundleName:de("string"),bundle:de("string")};class Vd extends LE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function Br(n){n=je(n,Ut);const e=je(n.firestore,sn),t=oi(e),r=new Vd(e);return OE(n._query),AE(t,n._query).then((s=>new _n(e,r,n,s)))}function Ta(n,e,t){n=je(n,le);const r=je(n.firestore,sn),s=Dd(n.converter,e,t);return fi(r,[wd(ai(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ve.none())])}function di(n,e,t,...r){n=je(n,le);const s=je(n.firestore,sn),i=ai(s);let a;return a=typeof(e=oe(e))=="string"||e instanceof Mr?bd(i,"updateDoc",n._key,e,t,r):Ad(i,"updateDoc",n._key,e),fi(s,[a.toMutation(n._key,Ve.exists(!0))])}function xE(n){return fi(je(n.firestore,sn),[new ei(n._key,Ve.none())])}function fi(n,e){return(function(r,s){const i=new at;return r.asyncQueue.enqueueAndForget((async()=>hE(await IE(r),s,i))),i.promise})(oi(n),e)}function UE(n,e,t){const r=t.docs.get(e._key),s=new Vd(n);return new Kt(n,s,e._key,r,new tr(t.hasPendingWrites,t.fromCache),e.converter)}class FE{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ai(e)}set(e,t,r){this._verifyNotCommitted();const s=Yi(e,this._firestore),i=Dd(s.converter,t,r),a=wd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Ve.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Yi(e,this._firestore);let a;return a=typeof(t=oe(t))=="string"||t instanceof Mr?bd(this._dataReader,"WriteBatch.update",i._key,t,r,s):Ad(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Ve.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Yi(e,this._firestore);return this._mutations=this._mutations.concat(new ei(t._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Yi(n,e){if((n=oe(n)).firestore!==e)throw new V(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Y(){return new ua("serverTimestamp")}function Qn(n){return new ha("increment",n)}function Od(n){return oi(n=je(n,sn)),new FE(n,(e=>fi(n,e)))}(function(e,t=!0){(function(s){Pn=s})(Rn),yn(new Yt("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new sn(new D_(r.getProvider("auth-internal")),new L_(a,r.getProvider("app-check-internal")),(function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mr(d.options.projectId,f)})(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),St(el,tl,e),St(el,tl,"esm2020")})();const BE={apiKey:"AIzaSyDJurXmliChoLZ5tdiXsH-kTaiyfcEtsgM",authDomain:"ethos-dev-ec0d6.firebaseapp.com",projectId:"ethos-dev-ec0d6",storageBucket:"ethos-dev-ec0d6.firebasestorage.app",messagingSenderId:"154735949292",appId:"1:154735949292:web:2641d40b6563c39f9efcc9"},Ld=fu(BE),et=R_(Ld),fe=RE(Ld);function $E(n){return mg(et,n)}async function Md(n=!0){await Lo(et,n?js:Cr);const e=new rt;return Lg(et,e)}async function qE(n){const e=String(n||"").trim().toLowerCase();return e?dg(et,e):[]}async function jE(n,e,t=!0){return await Lo(et,t?js:Cr),ug(et,n,e)}async function HE(n,e,t=!0){return await Lo(et,t?js:Cr),lg(et,n,e)}async function zE(n){return cg(et,n)}async function WE(){return gg(et)}async function Ir(n){const e=me(fe,"users",n),t=await Ea(e);return t.exists()?t.data():null}async function GE(n,e){const t=me(fe,"users",n),r={uid:n,email:e?.email??null,role:e?.role??"user",weekStartsOn:"monday",displayName:e?.displayName??"",dob:e?.dob??null,timeZone:e?.timeZone??e?.preferences?.timeZone??"Asia/Kolkata",preferences:{...e?.preferences||{}},createdAt:Y(),updatedAt:Y()};return await Ta(t,r,{merge:!0}),r}async function KE(n,e,t){const r={};let s=!1;t?.uid||(r.uid=n,s=!0),t?.role||(r.role="user",s=!0),t?.weekStartsOn||(r.weekStartsOn="monday",s=!0),!t?.email&&e&&(r.email=e,s=!0);const i=t?.preferences?.timeZone;if(!t?.timeZone&&i&&(r.timeZone=i,s=!0),!t?.timeZone&&!i&&(r.timeZone="Asia/Kolkata",s=!0),!s)return!1;const a=me(fe,"users",n);return await Ta(a,{...r,updatedAt:Y()},{merge:!0}),!0}async function xd(n){const e=rn(fe,"users",n,"tracks"),t=Fr(e,kd("isActive","==",!0),hi("sortOrder","asc"));return(await Br(t)).docs.map(s=>({...s.data(),id:s.id}))}async function QE(n,e){const t=rn(fe,"users",n,"tracks"),r=me(t),s={...e,isActive:e?.isActive??!0,sortOrder:e?.sortOrder??Date.now(),createdAt:Y(),updatedAt:Y()};return await Ta(r,s),r.id}async function YE(n,e,t){const r=me(fe,"users",n,"tracks",e);await di(r,{...t,updatedAt:Y()})}async function XE(n,e){const t=me(fe,"users",n,"tracks",e);await xE(t)}async function Ud(n,e){const t=me(fe,"users",n,"days",e),r=await Ea(t);return r.exists()?r.data():null}async function JE(n,e){const t=rn(fe,"users",n,"days"),r=Fr(t,hi("dayKey","desc"),va(e));return(await Br(r)).docs.map(i=>i.data())}async function Jl(n,e,t,r=50){const s=rn(fe,"users",n,"days",e,"entries"),i=Fr(s,kd("trackId","==",t),hi("createdAtMs","desc"),va(r));return(await Br(i)).docs.map(l=>({id:l.id,...l.data()}))}const Xi={themeMode:"system",accent1:"#7c3aed",accent2:"#14b8a6"};function Fd(n){const e=n||{};return{themeMode:e.themeMode||Xi.themeMode,accent1:e.accent1||Xi.accent1,accent2:e.accent2||Xi.accent2}}function Bd(n){const e=Fd(n?.preferences);document.documentElement.dataset.theme=e.themeMode,document.documentElement.style.setProperty("--accent-1",e.accent1),document.documentElement.style.setProperty("--accent-2",e.accent2)}function wr(){const n=window.location.hash||"#/auth",[e,t]=n.split("?"),r=new URLSearchParams(t||"");return{path:e,query:r,raw:n}}function Z(n){window.location.hash=n}function ZE(n){window.addEventListener("hashchange",n)}function $d(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h1>Ethos</h1>
      <p class="muted">A calm place to stay aligned.</p>

      <label class="check">
        <input id="persist" type="checkbox" checked />
        <span>Keep me signed in</span>
      </label>

      <div class="stack">
        <button id="googleBtn" class="btn primary">Continue with Google</button>
        <button id="emailBtn" class="btn">Continue with Email</button>
      </div>
    </div>
  `;const e=n.querySelector("#persist"),t=localStorage.getItem("ethos_keepSignedIn");t!==null&&(e.checked=t==="true"),e.addEventListener("change",()=>{localStorage.setItem("ethos_keepSignedIn",String(e.checked))}),n.querySelector("#emailBtn").addEventListener("click",()=>{Z("#/auth/email")}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await Md(e.checked)}catch(r){alert(r?.message||"Google sign-in failed")}})}function eT(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h2>Continue with Email</h2>
      <p class="muted">Enter your email to continue.</p>

      <div class="stack">
        <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" />
        <button id="next" class="btn primary">Next </button>
        <a class="link" href="#/auth"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
      <div id="googleHint" class="stack" style="margin-top:12px; display:none;">
        <button id="googleBtn" class="btn">Continue with Google instead</button>
      </div>
    </div>
  `;const e=n.querySelector("#email"),t=n.querySelector("#msg"),r=n.querySelector("#googleHint");function s(a){t.textContent=a||""}async function i(){const a=String(e.value||"").trim().toLowerCase();if(s(""),r.style.display="none",!a){s("Please enter an email.");return}try{const l=await qE(a);if(!l||l.length===0){Z(`#/auth/create-password?email=${encodeURIComponent(a)}`);return}const u=l.includes("google.com"),d=l.includes("password");if(u&&!d){s("This email is linked to Google sign-in."),r.style.display="block";return}if(d){Z(`#/auth/password?email=${encodeURIComponent(a)}`);return}s("This email uses a different sign-in method. Try Google sign-in."),r.style.display="block"}catch(l){s(l?.message||"Could not check sign-in method.")}}n.querySelector("#next").addEventListener("click",i),e.addEventListener("keydown",a=>{a.key==="Enter"&&i()}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await Md()}catch(a){s(a?.message||"Google sign-in failed")}})}function tT(){const n=document.getElementById("app"),{query:e}=wr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Welcome back</h2>
      <p class="muted">${t?`Signing in as ${t}`:"Enter your password to continue."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
        
        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="login" class="btn primary">Sign in</button>

        <button id="forgot" class="btn ghost">Forgot password?</button>
        <a class="link" href="#/auth/email"> Use a different email</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#persist");function u(f){i.textContent=f||""}t||u("Missing email. Go back and enter your email again.");async function d(){if(localStorage.setItem("ethos_keepSignedIn",String(l.checked)),u(""),!t)return;const f=String(a.value||"");if(!f){u("Please enter your password.");return}try{await jE(t,f,l.checked)}catch(m){u(m?.message||"Sign-in failed.")}}n.querySelector("#login").addEventListener("click",d),a.addEventListener("keydown",f=>{f.key==="Enter"&&d()}),n.querySelector("#forgot").addEventListener("click",async()=>{if(u(""),!!t)try{await zE(t),u("Password reset email sent.")}catch(f){u(f?.message||"Could not send reset email.")}})}function nT(){const n=document.getElementById("app"),{query:e}=wr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Create your account</h2>
      <p class="muted">${t?`For ${t}`:"Missing email. Go back and enter your email again."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Create password" autocomplete="new-password" />
        <input id="confirm" class="input" type="password" placeholder="Confirm password" autocomplete="new-password" />

        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="create" class="btn primary">Create account</button>
        <a class="link" href="#/auth/email"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#confirm"),u=n.querySelector("#persist");function d(m){i.textContent=m||""}async function f(){if(localStorage.setItem("ethos_keepSignedIn",String(u.checked)),d(""),!t)return;const m=String(a.value||""),v=String(l.value||"");if(!m||m.length<6){d("Password should be at least 6 characters.");return}if(m!==v){d("Passwords do not match.");return}try{await HE(t,m,u.checked)}catch(R){const D=R?.code||"";if(D==="auth/email-already-in-use"||D==="auth/account-exists-with-different-credential"){d("This email is already linked to a different sign-in method. Try Google sign-in."),navigate("#/auth/email");return}d(R?.message||"Account creation failed.")}}n.querySelector("#create").addEventListener("click",f),l.addEventListener("keydown",m=>{m.key==="Enter"&&f()})}function rT(){if(typeof Intl<"u"&&typeof Intl.supportedValuesOf=="function")try{return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney","Asia/Singapore","Asia/Tokyo"]}function qd({user:n}){const e=document.getElementById("app"),t=rT(),r=Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Kolkata";e.innerHTML=`
    <div class="center">
      <h2>Set up your profile</h2>
      <p class="muted">This helps Ethos keep your days aligned to your timezone.</p>

      <div class="stack">
        <label class="label">Display name</label>
        <input id="name" class="input" type="text" placeholder="What should we call you?" />

        <label class="label">Date of birth</label>
        <input id="dob" class="input" type="date" />

        <label class="label">Timezone</label>
        <select id="tz" class="input">
          ${t.map(d=>`<option value="${d}" ${d===r?"selected":""}>${d}</option>`).join("")}
        </select>

        <button id="save" class="btn primary">Save</button>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const s=e.querySelector("#msg"),i=e.querySelector("#name"),a=e.querySelector("#dob"),l=e.querySelector("#tz");function u(d){s.textContent=d||""}e.querySelector("#save").addEventListener("click",async()=>{u("");const d=String(i.value||"").trim(),f=String(a.value||"").trim(),m=String(l.value||"").trim();if(!m){u("Please select a timezone.");return}try{await GE(n.uid,{email:n.email||"",displayName:d||"",dob:f||"",timeZone:m,weekStartsOn:"monday",role:"user"}),Z("#/home")}catch(v){u(v?.message||"Could not save profile.")}})}function sT(n){return{trophy:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 21h8M12 17v4M7 4h10v3a5 5 0 0 1-10 0V4Z"/><path d="M17 7h3a4 4 0 0 1-4 4M7 7H4a4 4 0 0 0 4 4"/></svg>',check:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20 6 9 17l-5-5"/></svg>',home:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V10.5Z"/></svg>',history:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 4v6h6"/><path d="M12 7v6l4 2"/></svg>',gear:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.5-2.3.7a8 8 0 0 0-5-2.9L12 0h-4l-.9 2.1a8 8 0 0 0-5 2.9l-2.3-.7-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 6l-2 1.2 2 3.5 2.3-.7a8 8 0 0 0 5 2.9L8 24h4l.9-2.1a8 8 0 0 0 5-2.9l2.3.7 2-3.5-2-1.2Z"/></svg>'}[n]||""}function iT({active:n}){return`
      <nav class="tabs">
        ${[{id:"leaderboard",label:"Leaderboard",href:"#/leaderboard",icon:"trophy"},{id:"today",label:"Today",href:"#/today",icon:"check"},{id:"home",label:"Home",href:"#/home",icon:"home",center:!0},{id:"history",label:"History",href:"#/history",icon:"history"},{id:"settings",label:"Settings",href:"#/settings",icon:"gear"}].map(t=>`
          <a class="tab ${t.center?"tab-center":""} ${n===t.id?"active":""}" href="${t.href}" aria-label="${t.label}">
            <span class="tab-ico">${sT(t.icon)}</span>
            <span class="tab-txt">${t.label}</span>
          </a>
        `).join("")}
      </nav>
    `}function ve({title:n,activeTab:e,content:t}){return`
    <div class="app">
      <header class="header">
        <div class="header-title">${n||"Ethos"}</div>
      </header>

      <main class="content">
        ${t||""}
      </main>

      ${iT({active:e})}
    </div>
  `}function ys(){const n=document.getElementById("app");n.innerHTML=ve({title:"Home",activeTab:"home",content:`
      <section class="card">
        <div class="card-title">How are you doing today?</div>
        <div class="muted">A gentle glance. No pressure.</div>
      </section>

      <section class="card">
        <div class="card-title">Pinned targets (stub)</div>
        <div class="muted">Example: 8,000 / 15,000 steps</div>
        <div class="muted">Example: 1.5L / 3L water</div>
        <div class="muted">Example: 3 / 6 sessions this week</div>
      </section>
    `})}function jd(n){return oT(new Date,n)}function oT(n,e){const t=aT(n,e);return`${t.year}-${Bs(t.month)}-${Bs(t.day)}`}function Hd(n){const[e,t,r]=n.split("-").map(Number),s=new Date(Date.UTC(e,t-1,r)),i=cT(s),a=`${e}-${Bs(t)}`;return{weekKey:i,monthKey:a}}function aT(n,e){const r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(n).reduce((s,i)=>(i.type!=="literal"&&(s[i.type]=i.value),s),{});return{year:Number(r.year),month:Number(r.month),day:Number(r.day)}}function cT(n){const e=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=Math.ceil(((e-r)/864e5+1)/7);return`${e.getUTCFullYear()}-W${Bs(s)}`}function Bs(n){return String(n).padStart(2,"0")}function Zl(n){return!n||!n.length?"":`
      <div class="bullets">
        ${n.map(e=>`<div class="bullet">${e}</div>`).join("")}
      </div>
    `}function lT(n,e){return n?.tracks?.[e]||null}function uT(n,e,t){n?.target?.mode;const r=Number(n?.target?.value||0),i=(n.cadence||"daily")==="daily"?e:t;if(!i)return r?`0 / ${r}`:"";if(n.type==="COUNTER_INCREMENT"){const l=Number(i.sum||0);return r?`${l} / ${r}`:`${l}`}if(n.type==="NUMBER_REPLACE"){const l=i.value;return l===0||l?`${l} ${n.unit||""}`.trim():""}const a=Number(i.count||0);return r?`${a} / ${r}`:`${a}`}function hT(n,e,t,r){const s={};for(const i of n)s[i.id]=null;for(const i of e){const a=i?.period?.weekKey,l=i?.period?.monthKey;for(const u of n){if(u.cadence==="weekly"&&a!==t||u.cadence==="monthly"&&l!==r||u.cadence==="daily")continue;const d=i?.tracks?.[u.id];d&&(s[u.id]||(s[u.id]={}),u.type==="COUNTER_INCREMENT"?(s[u.id].sum=Number(s[u.id].sum||0)+Number(d.sum||0),s[u.id].count=Number(s[u.id].count||0)+Number(d.count||0)):u.type==="NUMBER_REPLACE"?s[u.id].value===void 0&&(s[u.id].value=d.value):(s[u.id].count=Number(s[u.id].count||0)+Number(d.count||0),s[u.id].preview===void 0&&d.preview&&(s[u.id].preview=d.preview),s[u.id].lastValue===void 0&&d.lastValue&&(s[u.id].lastValue=d.lastValue),s[u.id].done===void 0&&d.done!==void 0&&(s[u.id].done=d.done)))}}return s}function dT(n,e,t,r){const s=n.cadence==="daily"?"Today":n.cadence==="weekly"?"This week":"This month",i=uT(n,e,t),a=Number(n?.target?.value||0),l=(()=>{if(!a)return!1;const f=n.cadence==="daily"?e:t;return f?n.type==="COUNTER_INCREMENT"?Number(f.sum||0)>=a:n.type==="NUMBER_REPLACE"?!1:Number(f.count||0)>=a:!1})();let u="",d="";if(n.type==="TEXT_APPEND"){const v=(r?.textEntriesByTrack?.[n.id]||[]).slice().reverse().map(R=>(R.text||"").trim()).filter(Boolean);d=v.length?`${v.length} entries`:"No notes yet",u=Zl(v.map(R=>R))}if(n.type==="DROPDOWN_EVENT"){const f=r?.periodEventsByTrack?.[n.id]||[];d=f.length?`Events: ${f.length}`:"No selection yet",u=Zl(f)}return n.type==="BOOLEAN"&&n.config?.booleanMode==="done_only"&&(d=e?.done?"Done":"Not yet",u=""),d||(n.type==="NUMBER_REPLACE"?d=e?.value===0||e?.value?`${e.value} ${n.unit||""}`.trim():"":(d=l?"Done":"Not yet",a||(d=""),n.type==="COUNTER_INCREMENT"&&(d=""))),`
      <div class="card">
        <div class="row" style="justify-content:space-between;gap:12px;align-items:flex-start;">
          <div style="min-width:0;">
            <div class="card-title">${n.name}</div>
            <div class="mini muted">${s}${a?`  Target ${a}`:""}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:700;">${i}</div>
            ${d?`<div class="mini muted">${d}</div>`:""}
          </div>
        </div>
  
        ${u?`<div style="margin-top:10px;">${u}</div>`:""}
      </div>
    `}async function fT({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ve({title:"Today",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});try{const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=jd(r),{weekKey:i,monthKey:a}=Hd(s),l=await xd(n.uid),u=await Ud(n.uid,s),d=await JE(n.uid,31),f=hT(l,d,i,a),m={};for(const k of l)k.type==="TEXT_APPEND"&&(m[k.id]=await Jl(n.uid,s,k.id,20));const v={};for(const k of l){if(k.type!=="DROPDOWN_EVENT"||k.cadence==="daily")continue;const C=[];for(const M of d){if(k.cadence==="weekly"&&M?.period?.weekKey!==i||k.cadence==="monthly"&&M?.period?.monthKey!==a)continue;const q=M?.tracks?.[k.id],x=Number(q?.count||0);if(!x)continue;(await Jl(n.uid,M.dayKey,k.id,Math.min(30,x))).slice().reverse().forEach(se=>{const ae=se?.optionIds?.[0];ae&&C.push(`${M.dayKey}: ${ae}`)})}v[k.id]=C}const R={textEntriesByTrack:m,periodEventsByTrack:v},D=l.length?l.map(k=>dT(k,lT(u,k.id),f[k.id],R)).join(""):'<div class="card"><div class="muted">No active tracks yet. Add some in Settings  Manage Tracks.</div></div>';t.innerHTML=ve({title:"Today",activeTab:"today",content:`
          <div class="content">
            <div class="mini muted" style="margin:6px 0 14px;">${s}  ${r}</div>
            ${D}
          </div>
  
          <button class="fab" id="goLog" title="Log for today"></button>
        `}),t.querySelector("#goLog").addEventListener("click",()=>{Z("#/today/log")})}catch(r){console.error("Today page load failed:",r),t.innerHTML=ve({title:"Today",activeTab:"today",content:`
          <div class="center">
            <h2 style="margin:0 0 10px;">Couldnt load Today</h2>
            <p class="muted" style="white-space:pre-wrap;">${r?.message||String(r)}</p>
            <button class="btn" onclick="location.reload()">Reload</button>
          </div>
        `})}}function xe(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}async function pT({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ve({title:"Log",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=jd(r),{weekKey:i,monthKey:a}=Hd(s);try{const l=await xd(n.uid),u=await Ud(n.uid,s),d=l.map(f=>{const m=u?.tracks?.[f.id]||null;if(f.type==="NUMBER_REPLACE"){const v=m?.value===0||m?.value?m.value:"";return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Current: ${v===""?"":xe(v)} ${xe(f.unit||"")}</div>
            <input class="input" type="number" step="${f.config?.precision?1/Math.pow(10,f.config.precision):"any"}"
              data-track="${f.id}" data-type="NUMBER_REPLACE" placeholder="Enter value" />
          </div>
        `}if(f.type==="TEXT_APPEND")return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">${m?.count?`Entries today: ${m.count}`:"No entries yet"}</div>
            <textarea class="textarea" data-track="${f.id}" data-type="TEXT_APPEND" placeholder="Write a quick note..."></textarea>
          </div>
        `;if(f.type==="DROPDOWN_EVENT"){const v=(f.config?.options||[]).map(R=>`<option value="${xe(R.id)}">${xe(R.label)}</option>`).join("");return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">${m?.count?`Count today: ${m.count}`:"No events yet"}</div>
            <select class="select" data-track="${f.id}" data-type="DROPDOWN_EVENT">
              <option value="">Select</option>
              ${v}
            </select>
          </div>
        `}if(f.type==="COUNTER_INCREMENT"){const v=f.config?.incrementStep||1,R=m?.sum||0;return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today: ${xe(R)} ${xe(f.unit||"")}</div>
            <input class="input" type="number" min="0" step="${v}"
              data-track="${f.id}" data-type="COUNTER_INCREMENT"
              placeholder="Add amount (e.g. ${v})" />
          </div>
        `}if(f.type==="BOOLEAN"){if((f.config?.booleanMode||"done_only")==="done_only"){const R=m?.done?"checked":"";return`
            <div class="card">
              <div class="card-title">${xe(f.name)}</div>
              <label class="toggle">
                <input type="checkbox" data-track="${f.id}" data-type="BOOLEAN_DONE" ${R}/>
                Done today
              </label>
            </div>
          `}return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today count: ${m?.count||0}</div>
            <input class="input" type="number" min="0" step="1"
              data-track="${f.id}" data-type="BOOLEAN_COUNT"
              placeholder="Add count (e.g. 1)" />
          </div>
        `}return""}).join("");t.innerHTML=ve({title:"Log",activeTab:"today",content:`
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
              <div class="mini muted">${s}  ${r}</div>
              <div style="font-weight:700;font-size:18px;">Log entries</div>
            </div>
            <button class="btn" id="back" type="button">Back</button>
          </div>

          ${d}

          <div class="row" style="justify-content:flex-end;gap:10px;margin-top:10px;">
            <button class="btn primary" id="submit" type="button">Submit</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;margin-top:8px;"></div>
        </div>
      `}),t.querySelector("#back").addEventListener("click",()=>Z("#/today")),t.querySelector("#submit").addEventListener("click",async()=>{const f=t.querySelector("#status");f.textContent="Saving";const m=Od(fe),v=me(fe,"users",n.uid,"days",s);m.set(v,{dayKey:s,timeZone:r,period:{weekKey:i,monthKey:a},updatedAt:Y()},{merge:!0});const R=rn(fe,"users",n.uid,"days",s,"entries"),D=Array.from(t.querySelectorAll("[data-track][data-type]"));let k=0;for(const C of D){const M=C.dataset.track,q=C.dataset.type;if(q==="TEXT_APPEND"){const x=C.value.trim();if(!x)continue;const H=me(R);m.set(H,{trackId:M,type:"TEXT_APPEND",text:x,createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"TEXT_APPEND",count:Qn(1),preview:x.slice(0,80),lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}if(q==="NUMBER_REPLACE"){const x=C.value.trim();if(x==="")continue;const H=Number(x);if(Number.isNaN(H))continue;const se=me(R);m.set(se,{trackId:M,type:"NUMBER_REPLACE",value:H,createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"NUMBER_REPLACE",value:H,lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}if(q==="COUNTER_INCREMENT"){const x=C.value.trim();if(x==="")continue;const H=Number(x);if(!H||Number.isNaN(H))continue;const se=me(R);m.set(se,{trackId:M,type:"COUNTER_INCREMENT",deltaValue:H,createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"COUNTER_INCREMENT",count:Qn(1),sum:Qn(H),lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}if(q==="DROPDOWN_EVENT"){const x=C.value;if(!x)continue;const H=me(R);m.set(H,{trackId:M,type:"DROPDOWN_EVENT",optionIds:[x],createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"DROPDOWN_EVENT",count:Qn(1),lastValue:[x],lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}if(q==="BOOLEAN_DONE"){const x=!!C.checked,H=me(R);m.set(H,{trackId:M,type:"BOOLEAN",value:x,createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"BOOLEAN",done:x,count:x?1:0,lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}if(q==="BOOLEAN_COUNT"){const x=C.value.trim();if(x==="")continue;const H=Number(x);if(!H||Number.isNaN(H))continue;const se=me(R);m.set(se,{trackId:M,type:"BOOLEAN",deltaCount:H,createdAt:Y(),createdAtMs:Date.now()}),m.set(v,{tracks:{[M]:{type:"BOOLEAN",count:Qn(H),done:!0,lastAt:Y()}},updatedAt:Y()},{merge:!0}),k++;continue}}if(!k){f.textContent="Nothing to save.",setTimeout(()=>f.textContent="",1200);return}try{await m.commit(),f.textContent="Saved.",Z("#/today")}catch(C){console.error("Log submit failed:",C),f.textContent=`Save failed: ${C?.message||C}`,alert(`Save failed:
${C?.message||C}`)}})}catch(l){console.error("Today log page load failed:",l),t.innerHTML=ve({title:"Log",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Log</h2>
          <p class="muted" style="white-space:pre-wrap;">${l?.message||String(l)}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}function mT(){const n=document.getElementById("app");n.innerHTML=ve({title:"History",activeTab:"history",content:`
      <section class="card">
        <div class="card-title">Reflection (stub)</div>
        <div class="muted">Calendar/list view comes next.</div>
      </section>
    `})}function gT(){const n=document.getElementById("app");n.innerHTML=ve({title:"Settings",activeTab:"settings",content:`
      <section class="card">
        <div class="card-title">Settings</div>

        <div class="list">
          <button class="list-item" id="goProfile" type="button">
            <div>
              <div class="li-title">Profile</div>
              <div class="muted">Name, DOB, timezone</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTheme" type="button">
            <div>
              <div class="li-title">Theme</div>
              <div class="muted">Mode + accent colors</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTracks" type="button">
            <div>
              <div class="li-title">Manage Tracks</div>
              <div class="muted">Add, edit, reorder, activate/deactivate</div>
            </div>
            <div class="chev"></div>
          </button>
        </div>
      </section>

      <section class="card">
        <div class="card-title">Account</div>
        <button id="logout" class="btn" type="button">Logout</button>
      </section>
    `}),n.querySelector("#goProfile").addEventListener("click",()=>Z("#/settings/profile")),n.querySelector("#goTheme").addEventListener("click",()=>Z("#/settings/theme")),n.querySelector("#goTracks").addEventListener("click",()=>Z("#/settings/tracks")),n.querySelector("#logout").addEventListener("click",async()=>{await WE(),Z("#/auth")})}function _T(){const n=document.getElementById("app");n.innerHTML=ve({title:"Leaderboard",activeTab:"leaderboard",content:`
      <section class="card">
        <div class="card-title">Leaderboard (stub)</div>
        <div class="muted">Well wire this after data model is locked.</div>
      </section>
    `})}function yT(){try{if(typeof Intl.supportedValuesOf=="function")return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney"]}async function vT({user:n}){const e=document.getElementById("app");e.innerHTML=ve({title:"Profile",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Ir(n.uid),r=yT();e.innerHTML=ve({title:"Profile",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Profile</div>
            <div class="muted">Personal details for your Ethos space</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Display name</div>
            <input class="input" id="displayName" value="${t?.displayName||""}" placeholder="Your name" />
          </label>

          <label class="field">
            <div class="label">DOB (optional)</div>
            <input class="input" id="dob" type="date" value="${t?.dob||""}" />
          </label>

          <label class="field">
            <div class="label">Time zone</div>
            <input class="input" id="timeZone" list="tzList" value="${t?.timeZone||"Asia/Kolkata"}" />
            <datalist id="tzList">
              ${r.slice(0,500).map(s=>`<option value="${s}"></option>`).join("")}
            </datalist>
            <div class="mini muted">Tip: start typing Asia/ and pick from suggestions.</div>
          </label>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>Z("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#displayName").value.trim(),a=e.querySelector("#dob").value||null,l=e.querySelector("#timeZone").value.trim()||"Asia/Kolkata";try{const u=me(fe,"users",n.uid);await di(u,{displayName:i,dob:a,timeZone:l,updatedAt:Y()}),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Profile save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Profile save failed:
${u?.message||u}`)}})}const ET={defaultTracks:[{name:"Water",type:"COUNTER_INCREMENT",cadence:"daily",unit:"ml",target:{mode:"value",value:3e3},config:{incrementStep:250,minDelta:1,maxDelta:1e6}},{name:"Meditation",type:"BOOLEAN",cadence:"daily",unit:"sessions",target:{mode:"count",value:1},config:{booleanMode:"done_only"}},{name:"Skincare",type:"BOOLEAN",cadence:"daily",unit:"times",target:{mode:"count",value:2},config:{booleanMode:"count",suggestedDelta:1}},{name:"Weight",type:"NUMBER_REPLACE",cadence:"daily",unit:"kg",target:{mode:"value",value:0},config:{minValue:0,maxValue:500,precision:1}},{name:"Food Notes",type:"TEXT_APPEND",cadence:"daily",unit:"entries",target:{mode:"count",value:0},config:{maxLength:2e3,showOnDashboard:!0}},{name:"Workout Type",type:"DROPDOWN_EVENT",cadence:"weekly",unit:"sessions",target:{mode:"count",value:3},config:{optionsAreUserEditable:!0,allowMultiSelect:!1,options:[{id:"legs",label:"Legs"},{id:"chest",label:"Chest"},{id:"back",label:"Back"},{id:"cardio",label:"Cardio"}]}}]};async function TT(n){const e=rn(fe,"users",n,"tracks"),t=Fr(e,hi("sortOrder","asc"));return(await Br(t)).docs.map(s=>({...s.data(),id:s.id}))}async function Ji(n,e,t){const r=me(fe,"users",n,"tracks",e);await di(r,{...t,updatedAt:Y()})}async function IT(n){const e=rn(fe,"users",n,"tracks"),t=Fr(e,va(1));if(!(await Br(t)).empty)return{didSeed:!1};const s=Od(fe),i=Y();return ET.defaultTracks.forEach((a,l)=>{const u=me(e);s.set(u,{...a,isActive:!0,sortOrder:(l+1)*10,createdAt:i,updatedAt:i})}),await s.commit(),{didSeed:!0}}async function vs({user:n}){const e=document.getElementById("app");e.innerHTML=ve({title:"Tracks",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await TT(n.uid),r=t.filter(a=>a.isActive!==!1),s=t.filter(a=>a.isActive===!1);e.innerHTML=ve({title:"Manage Tracks",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Tracks</div>
            <div class="muted">What you want to notice, repeat, or reflect on.</div>
          </div>
          <button class="btn" id="back">Back</button>
        </div>

        <div class="row" style="gap:8px;flex-wrap:wrap;margin-top:12px;">
          <button class="btn primary" id="newTrack">Add new track</button>
          <button class="btn" id="seed">Add defaults (if empty)</button>
        </div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Active tracks</div>
            <div class="muted">Reorder what shows on Today.</div>
          </div>
        </div>

        ${r.length?`<div class="list">${r.map((a,l)=>i(a,l,r.length,!0)).join("")}</div>`:`
          <div class="muted">No active tracks yet.</div>
        `}
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Inactive tracks</div>
            <div class="muted">Hidden from Today. You can re-activate anytime.</div>
          </div>
        </div>

        ${s.length?`<div class="list">${s.map(a=>i(a,-1,-1,!1)).join("")}</div>`:`
          <div class="muted">No inactive tracks.</div>
        `}
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>Z("#/settings")),e.querySelector("#newTrack").addEventListener("click",()=>Z("#/settings/tracks/new")),e.querySelector("#seed").addEventListener("click",async()=>{const a=await IT(n.uid);alert(a.didSeed?"Defaults added.":"You already have tracks."),vs({user:n})}),e.querySelectorAll("[data-toggle]").forEach(a=>{a.addEventListener("click",async()=>{const l=a.getAttribute("data-toggle"),u=a.getAttribute("data-next")==="true";a.disabled=!0,a.textContent="Saving";try{await Ji(n.uid,l,{isActive:u}),await vs({user:n})}catch(d){console.error("Toggle failed:",d),alert(d?.message||"Could not update track."),a.disabled=!1,a.textContent=u?"Activate":"Deactivate"}})}),e.querySelectorAll("[data-edit]").forEach(a=>{a.addEventListener("click",async()=>{const l=a.getAttribute("data-edit");Z(`#/settings/tracks/edit?trackId=${encodeURIComponent(l)}`)})}),e.querySelectorAll("[data-move]").forEach(a=>{a.addEventListener("click",async()=>{const l=a.getAttribute("data-move"),u=a.getAttribute("data-dir"),d=r.findIndex(k=>k.id===l);if(d<0)return;const f=u==="up"?d-1:d+1;if(f<0||f>=r.length)return;const m=r[d],v=r[f],R=Number(m.sortOrder||0),D=Number(v.sortOrder||0);a.disabled=!0;try{await Promise.all([Ji(n.uid,m.id,{sortOrder:D||Date.now()}),Ji(n.uid,v.id,{sortOrder:R||Date.now()+1})]),await vs({user:n})}catch(k){console.error("Reorder failed:",k),alert(k?.message||"Could not reorder."),a.disabled=!1}})});function i(a,l,u,d){const f=d&&l>0,m=d&&l>=0&&l<u-1;return`
      <div class="list-item" style="cursor:default;">
        <div style="min-width:0;">
          <div class="li-title">${a.name}</div>
          <div class="muted">${a.type}  ${a.cadence}${a.unit?`  ${a.unit}`:""}</div>
        </div>

        <div class="row" style="gap:8px;flex-wrap:wrap;justify-content:flex-end;">
          ${d?`
            <button class="btn" data-move="${a.id}" data-dir="up" ${f?"":"disabled"} title="Move up"></button>
            <button class="btn" data-move="${a.id}" data-dir="down" ${m?"":"disabled"} title="Move down"></button>
          `:""}

          <button class="btn" data-edit="${a.id}">Edit</button>

          ${a.isActive!==!1?`<button class="btn" data-toggle="${a.id}" data-next="false">Deactivate</button>`:`<button class="btn primary" data-toggle="${a.id}" data-next="true">Activate</button>`}
        </div>
      </div>
    `}}function wT(n){const{path:e}=wr(),t=e.indexOf("?");return t===-1?null:new URLSearchParams(e.slice(t+1)).get(n)}async function eu({user:n,mode:e}){const t=document.getElementById("app"),r=wT("trackId");if(e==="edit"&&!r){Z("#/settings/tracks");return}t.innerHTML=ve({title:"Track",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let s=null;if(e==="edit"){const i=me(fe,"users",n.uid,"tracks",r),a=await Ea(i);if(!a.exists()){Z("#/settings/tracks");return}s={id:a.id,...a.data()}}else s={name:"",type:"COUNTER_INCREMENT",cadence:"daily",unit:"",isActive:!0,sortOrder:Date.now(),target:{mode:"value",value:0},config:{incrementStep:1}};t.innerHTML=ve({title:e==="edit"?"Edit Track":"New Track",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">${e==="edit"?"Edit track":"Create a track"}</div>
            <div class="muted">Keep it simple. You can refine later.</div>
          </div>
          <button class="btn" id="back">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Name</div>
            <input class="input" id="name" value="${s.name||""}" placeholder="Water / Steps / Journal" />
          </label>

          <div class="row" style="gap:12px;flex-wrap:wrap;">
            <label class="field" style="min-width:220px;">
              <div class="label">Type</div>
              <select class="select" id="type">
                ${["COUNTER_INCREMENT","BOOLEAN","NUMBER_REPLACE","TEXT_APPEND","DROPDOWN_EVENT"].map(i=>`<option value="${i}" ${s.type===i?"selected":""}>${i}</option>`).join("")}
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Cadence</div>
              <select class="select" id="cadence">
                ${["daily","weekly","monthly"].map(i=>`<option value="${i}" ${s.cadence===i?"selected":""}>${i}</option>`).join("")}
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Unit</div>
              <input class="input" id="unit" value="${s.unit||""}" placeholder="ml / steps / kg / times" />
            </label>
          </div>

          <div class="row" style="gap:12px;flex-wrap:wrap;">
            <label class="field" style="min-width:220px;">
              <div class="label">Target mode</div>
              <select class="select" id="targetMode">
                <option value="value" ${s.target?.mode==="value"?"selected":""}>value</option>
                <option value="count" ${s.target?.mode==="count"?"selected":""}>count</option>
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Target value</div>
              <input class="input" id="targetValue" type="number" value="${Number(s.target?.value||0)}" />
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Active</div>
              <select class="select" id="isActive">
                <option value="true" ${s.isActive?"selected":""}>true</option>
                <option value="false" ${s.isActive?"":"selected"}>false</option>
              </select>
            </label>
          </div>

          <section class="card" style="margin:12px 0;">
            <div class="card-title">Type config (MVP)</div>
            <div class="muted">Well make this dynamic per type in the next pass.</div>

            <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
              <label class="field" style="min-width:220px;">
                <div class="label">incrementStep (COUNTER_INCREMENT)</div>
                <input class="input" id="incrementStep" type="number"
                  value="${Number(s.config?.incrementStep||1)}" />
              </label>

              <label class="field" style="min-width:220px;">
                <div class="label">booleanMode (BOOLEAN)</div>
                <select class="select" id="booleanMode">
                  <option value="done_only" ${(s.config?.booleanMode||"done_only")==="done_only"?"selected":""}>done_only</option>
                  <option value="count" ${(s.config?.booleanMode||"")==="count"?"selected":""}>count</option>
                </select>
              </label>

              <label class="field" style="min-width:220px;">
                <div class="label">precision (NUMBER_REPLACE)</div>
                <input class="input" id="precision" type="number" step="0.1"
                  value="${Number(s.config?.precision??1)}" />
              </label>
            </div>
          </section>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            ${e==="edit"?'<button class="btn danger" id="del">Delete</button>':""}
            <button class="btn primary" id="save">Save</button>
          </div>
        </div>
      </section>
    `}),t.querySelector("#back").addEventListener("click",()=>Z("#/settings/tracks")),t.querySelector("#save").addEventListener("click",async()=>{const i=t.querySelector("#name").value.trim();if(!i)return alert("Name is required.");const a=t.querySelector("#type").value,l=t.querySelector("#cadence").value,u=t.querySelector("#unit").value.trim(),d=t.querySelector("#targetMode").value,f=Number(t.querySelector("#targetValue").value||0),m=t.querySelector("#isActive").value==="true",v=Number(t.querySelector("#incrementStep").value||1),R=t.querySelector("#booleanMode").value,D=Number(t.querySelector("#precision").value||1),k={name:i,type:a,cadence:l,unit:u,isActive:m,target:{mode:d,value:f},config:{...s.config||{},incrementStep:v,booleanMode:R,precision:D}};e==="edit"?await YE(n.uid,r,k):await QE(n.uid,k),alert("Saved."),Z("#/settings/tracks")}),t.querySelector("#del")?.addEventListener("click",async()=>{confirm("Delete this track? This wont delete past entries.")&&(await XE(n.uid,r),Z("#/settings/tracks"))})}async function AT({user:n}){const e=document.getElementById("app");e.innerHTML=ve({title:"Theme",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Ir(n.uid),r=Fd(t?.preferences);e.innerHTML=ve({title:"Theme",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Theme</div>
            <div class="muted">Set the vibe. Keep it calm.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Mode</div>
            <select class="select" id="themeMode">
              <option value="system" ${r.themeMode==="system"?"selected":""}>System</option>
              <option value="light" ${r.themeMode==="light"?"selected":""}>Light</option>
              <option value="dark" ${r.themeMode==="dark"?"selected":""}>Dark</option>
            </select>
          </label>

          <div class="row" style="gap:14px;flex-wrap:wrap;align-items:center;">
            <label class="field" style="min-width:200px;">
              <div class="label">Accent 1</div>
              <input class="input" id="accent1" type="color" value="${r.accent1}" />
            </label>

            <label class="field" style="min-width:200px;">
              <div class="label">Accent 2</div>
              <input class="input" id="accent2" type="color" value="${r.accent2}" />
            </label>
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>Z("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#themeMode").value,a=e.querySelector("#accent1").value,l=e.querySelector("#accent2").value;try{const u=me(fe,"users",n.uid);await di(u,{preferences:{themeMode:i,accent1:a,accent2:l},updatedAt:Y()});const d=await Ir(n.uid);Bd(d),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Theme save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Theme save failed:
${u?.message||u}`)}})}let ne=null,Ue=null,cr=null,zd=!1,lr=null;function tu(n){return n.startsWith("#/auth")}function bT(n){return["#/profile-setup","#/home","#/today","#/history","#/settings","#/leaderboard","#/settings/profile","#/settings/theme","#/settings/tracks","#/settings/tracks/edit","#/settings/tracks/new","#/today/log"].includes(n.split("?")[0])}async function RT(){if(!ne){Ue=null,cr=null;return}cr!==ne.uid&&(cr=ne.uid,Ue=await Ir(ne.uid))}function nu(n){switch(n){case"#/auth":return $d;case"#/auth/email":return eT;case"#/auth/password":return tT;case"#/auth/create-password":return nT;case"#/profile-setup":return()=>qd({user:ne});case"#/home":return ys;case"#/today":return()=>fT({user:ne,profile:Ue});case"#/today/log":return()=>pT({user:ne,profile:Ue});case"#/history":return mT;case"#/leaderboard":return _T;case"#/settings":return()=>gT();case"#/settings/profile":return()=>vT({user:ne});case"#/settings/theme":return()=>AT({user:ne});case"#/settings/tracks":return()=>vs({user:ne});case"#/settings/tracks/edit":return()=>eu({user:ne,mode:"edit"});case"#/settings/tracks/new":return()=>eu({user:ne,mode:"new"});default:return null}}async function Wd(){if(!zd){document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';return}const{path:n}=wr();if(!n){Z("#/auth");return}if(!ne){tu(n)||Z("#/auth");const{path:e}=wr();(nu(e)||$d)();return}if(await RT(),!Ue&&n!=="#/profile-setup"){Z("#/profile-setup"),qd({user:ne});return}if(ne&&Ue&&lr!==ne.uid)try{const e=await KE(ne.uid,ne.email,Ue);lr=ne.uid,e&&(Ue=await Ir(ne.uid))}catch(e){console.error("Profile normalization failed:",e),lr=ne.uid}if(Bd(Ue),Ue&&tu(n)){Z("#/home"),ys();return}if(bT(n)){(nu(n)||ys)();return}Z("#/home"),ys()}ZE(Wd);$E(async n=>{ne=n||null,zd=!0,ne?cr!==ne.uid&&(Ue=null,lr=null):(Ue=null,cr=null,lr=null),await Wd()});document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';
