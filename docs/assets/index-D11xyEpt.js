(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Cf=()=>{};var Sc={};const cu=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},lu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,h=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let y=(l&15)<<2|h>>6,b=h&63;u||(b=64,a||(y=64)),r.push(t[f],t[m],t[y],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(cu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):kf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||h==null||m==null)throw new Nf;const y=i<<2|l>>4;if(r.push(y),h!==64){const b=l<<4&240|h>>2;if(r.push(b),m!==64){const D=h<<6&192|m;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Nf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Df=function(n){const e=cu(n);return lu.encodeByteArray(e,!0)},Is=function(n){return Df(n).replace(/\./g,"")},uu=function(n){try{return lu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Vf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Of=()=>Vf().__FIREBASE_DEFAULTS__,Lf=()=>{if(typeof process>"u"||typeof Sc>"u")return;const n=Sc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Mf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&uu(n[1]);return e&&JSON.parse(e)},Hs=()=>{try{return Cf()||Of()||Lf()||Mf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},hu=n=>Hs()?.emulatorHosts?.[n],xf=n=>{const e=hu(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},du=()=>Hs()?.config,fu=n=>Hs()?.[`_${n}`];class Uf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Cn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pu(n){return(await fetch(n,{credentials:"include"})).ok}function Ff(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Is(JSON.stringify(t)),Is(JSON.stringify(a)),""].join(".")}const cr={};function Bf(){const n={prod:[],emulator:[]};for(const e of Object.keys(cr))cr[e]?n.emulator.push(e):n.prod.push(e);return n}function $f(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Pc=!1;function mu(n,e){if(typeof window>"u"||typeof document>"u"||!Cn(window.location.host)||cr[n]===e||cr[n]||Pc)return;cr[n]=e;function t(y){return`__firebase__banner__${y}`}const r="__firebase__banner",i=Bf().prod.length>0;function a(){const y=document.getElementById(r);y&&y.remove()}function l(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,b){y.setAttribute("width","24"),y.setAttribute("id",b),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{Pc=!0,a()},y}function f(y,b){y.setAttribute("id",b),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){const y=$f(r),b=t("text"),D=document.getElementById(b)||document.createElement("span"),k=t("learnmore"),C=document.getElementById(k)||document.createElement("a"),x=t("preprendIcon"),N=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const O=y.element;l(O),f(C,k);const U=h();u(N,x),O.append(N,D,C,U),document.body.appendChild(O)}i?(D.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ce())}function jf(){const n=Hs()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Hf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function zf(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Wf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Gf(){const n=Ce();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Kf(){return!jf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qf(){try{return typeof indexedDB=="object"}catch{return!1}}function Yf(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const Xf="FirebaseError";class gt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Xf,Object.setPrototypeOf(this,gt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nr.prototype.create)}}class Nr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Jf(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new gt(s,l,r)}}function Jf(n,e){return n.replace(Zf,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Zf=/\{\$([^}]+)}/g;function ep(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zt(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(Cc(i)&&Cc(a)){if(!Zt(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Cc(n){return n!==null&&typeof n=="object"}function Dr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function nr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function rr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function tp(n,e){const t=new np(n,e);return t.subscribe.bind(t)}class np{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");rp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=ji),s.error===void 0&&(s.error=ji),s.complete===void 0&&(s.complete=ji);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function rp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ji(){}function ce(n){return n&&n._delegate?n._delegate:n}class en{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Qt="[DEFAULT]";class sp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Uf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(op(e))try{this.getOrInitializeService({instanceIdentifier:Qt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Qt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Qt){return this.instances.has(e)}getOptions(e=Qt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ip(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Qt){return this.component?this.component.multipleInstances?e:Qt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ip(n){return n===Qt?void 0:n}function op(n){return n.instantiationMode==="EAGER"}class ap{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var W;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(W||(W={}));const cp={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},lp=W.INFO,up={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},hp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=up[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Co{constructor(e){this.name=e,this._logLevel=lp,this._logHandler=hp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}}const dp=(n,e)=>e.some(t=>n instanceof t);let kc,Nc;function fp(){return kc||(kc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pp(){return Nc||(Nc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const gu=new WeakMap,ro=new WeakMap,yu=new WeakMap,Hi=new WeakMap,ko=new WeakMap;function mp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(kt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&gu.set(t,n)}).catch(()=>{}),ko.set(e,n),e}function gp(n){if(ro.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});ro.set(n,e)}let so={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ro.get(n);if(e==="objectStoreNames")return n.objectStoreNames||yu.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return kt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function yp(n){so=n(so)}function _p(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(zi(this),e,...t);return yu.set(r,e.sort?e.sort():[e]),kt(r)}:pp().includes(n)?function(...e){return n.apply(zi(this),e),kt(gu.get(this))}:function(...e){return kt(n.apply(zi(this),e))}}function vp(n){return typeof n=="function"?_p(n):(n instanceof IDBTransaction&&gp(n),dp(n,fp())?new Proxy(n,so):n)}function kt(n){if(n instanceof IDBRequest)return mp(n);if(Hi.has(n))return Hi.get(n);const e=vp(n);return e!==n&&(Hi.set(n,e),ko.set(e,n)),e}const zi=n=>ko.get(n);function Ep(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=kt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(kt(a.result),u.oldVersion,u.newVersion,kt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const Tp=["get","getKey","getAll","getAllKeys","count"],wp=["put","add","delete","clear"],Wi=new Map;function Dc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Wi.get(e))return Wi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=wp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Tp.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),s&&u.done]))[0]};return Wi.set(e,i),i}yp(n=>({...n,get:(e,t,r)=>Dc(e,t)||n.get(e,t,r),has:(e,t)=>!!Dc(e,t)||n.has(e,t)}));class Ip{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ap(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Ap(n){return n.getComponent()?.type==="VERSION"}const io="@firebase/app",Vc="0.14.6";const dt=new Co("@firebase/app"),bp="@firebase/app-compat",Rp="@firebase/analytics-compat",Sp="@firebase/analytics",Pp="@firebase/app-check-compat",Cp="@firebase/app-check",kp="@firebase/auth",Np="@firebase/auth-compat",Dp="@firebase/database",Vp="@firebase/data-connect",Op="@firebase/database-compat",Lp="@firebase/functions",Mp="@firebase/functions-compat",xp="@firebase/installations",Up="@firebase/installations-compat",Fp="@firebase/messaging",Bp="@firebase/messaging-compat",$p="@firebase/performance",qp="@firebase/performance-compat",jp="@firebase/remote-config",Hp="@firebase/remote-config-compat",zp="@firebase/storage",Wp="@firebase/storage-compat",Gp="@firebase/firestore",Kp="@firebase/ai",Qp="@firebase/firestore-compat",Yp="firebase",Xp="12.6.0";const oo="[DEFAULT]",Jp={[io]:"fire-core",[bp]:"fire-core-compat",[Sp]:"fire-analytics",[Rp]:"fire-analytics-compat",[Cp]:"fire-app-check",[Pp]:"fire-app-check-compat",[kp]:"fire-auth",[Np]:"fire-auth-compat",[Dp]:"fire-rtdb",[Vp]:"fire-data-connect",[Op]:"fire-rtdb-compat",[Lp]:"fire-fn",[Mp]:"fire-fn-compat",[xp]:"fire-iid",[Up]:"fire-iid-compat",[Fp]:"fire-fcm",[Bp]:"fire-fcm-compat",[$p]:"fire-perf",[qp]:"fire-perf-compat",[jp]:"fire-rc",[Hp]:"fire-rc-compat",[zp]:"fire-gcs",[Wp]:"fire-gcs-compat",[Gp]:"fire-fst",[Qp]:"fire-fst-compat",[Kp]:"fire-vertex","fire-js":"fire-js",[Yp]:"fire-js-all"};const As=new Map,Zp=new Map,ao=new Map;function Oc(n,e){try{n.container.addComponent(e)}catch(t){dt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function wn(n){const e=n.name;if(ao.has(e))return dt.debug(`There were multiple attempts to register component ${e}.`),!1;ao.set(e,n);for(const t of As.values())Oc(t,n);for(const t of Zp.values())Oc(t,n);return!0}function No(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ue(n){return n==null?!1:n.settings!==void 0}const em={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Nt=new Nr("app","Firebase",em);class tm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new en("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}const kn=Xp;function _u(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:oo,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Nt.create("bad-app-name",{appName:String(s)});if(t||(t=du()),!t)throw Nt.create("no-options");const i=As.get(s);if(i){if(Zt(t,i.options)&&Zt(r,i.config))return i;throw Nt.create("duplicate-app",{appName:s})}const a=new ap(s);for(const u of ao.values())a.addComponent(u);const l=new tm(t,r,a);return As.set(s,l),l}function vu(n=oo){const e=As.get(n);if(!e&&n===oo&&du())return _u();if(!e)throw Nt.create("no-app",{appName:n});return e}function Dt(n,e,t){let r=Jp[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dt.warn(a.join(" "));return}wn(new en(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const nm="firebase-heartbeat-database",rm=1,yr="firebase-heartbeat-store";let Gi=null;function Eu(){return Gi||(Gi=Ep(nm,rm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(yr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Nt.create("idb-open",{originalErrorMessage:n.message})})),Gi}async function sm(n){try{const t=(await Eu()).transaction(yr),r=await t.objectStore(yr).get(Tu(n));return await t.done,r}catch(e){if(e instanceof gt)dt.warn(e.message);else{const t=Nt.create("idb-get",{originalErrorMessage:e?.message});dt.warn(t.message)}}}async function Lc(n,e){try{const r=(await Eu()).transaction(yr,"readwrite");await r.objectStore(yr).put(e,Tu(n)),await r.done}catch(t){if(t instanceof gt)dt.warn(t.message);else{const r=Nt.create("idb-set",{originalErrorMessage:t?.message});dt.warn(r.message)}}}function Tu(n){return`${n.name}!${n.options.appId}`}const im=1024,om=30;class am{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Mc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>om){const s=um(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){dt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Mc(),{heartbeatsToSend:t,unsentEntries:r}=cm(this._heartbeatsCache.heartbeats),s=Is(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return dt.warn(e),""}}}function Mc(){return new Date().toISOString().substring(0,10)}function cm(n,e=im){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),xc(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),xc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class lm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qf()?Yf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await sm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Lc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Lc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function xc(n){return Is(JSON.stringify({version:2,heartbeats:n})).length}function um(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function hm(n){wn(new en("platform-logger",e=>new Ip(e),"PRIVATE")),wn(new en("heartbeat",e=>new am(e),"PRIVATE")),Dt(io,Vc,n),Dt(io,Vc,"esm2020"),Dt("fire-js","")}hm("");function wu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const dm=wu,Iu=new Nr("auth","Firebase",wu());const bs=new Co("@firebase/auth");function fm(n,...e){bs.logLevel<=W.WARN&&bs.warn(`Auth (${kn}): ${n}`,...e)}function ds(n,...e){bs.logLevel<=W.ERROR&&bs.error(`Auth (${kn}): ${n}`,...e)}function qe(n,...e){throw Vo(n,...e)}function ze(n,...e){return Vo(n,...e)}function Do(n,e,t){const r={...dm(),[e]:t};return new Nr("auth","Firebase",r).create(e,{appName:n.name})}function ut(n){return Do(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pm(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&qe(n,"argument-error"),Do(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Vo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Iu.create(n,...e)}function $(n,e,...t){if(!n)throw Vo(e,...t)}function ct(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ds(e),new Error(e)}function ft(n,e){n||ct(e)}function Rs(){return typeof self<"u"&&self.location?.href||""}function Au(){return Uc()==="http:"||Uc()==="https:"}function Uc(){return typeof self<"u"&&self.location?.protocol||null}function mm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Au()||zf()||"connection"in navigator)?navigator.onLine:!0}function gm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Vr{constructor(e,t){this.shortDelay=e,this.longDelay=t,ft(t>e,"Short delay should be less than long delay!"),this.isMobile=qf()||Wf()}get(){return mm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Oo(n,e){ft(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class bu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ym={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const _m=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],vm=new Vr(3e4,6e4);function it(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ot(n,e,t,r,s={}){return Ru(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Dr({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:u,...i};return Hf()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Cn(n.emulatorConfig.host)&&(h.credentials="include"),bu.fetch()(await Su(n,n.config.apiHost,t,l),h)})}async function Ru(n,e,t){n._canInitEmulator=!1;const r={...ym,...e};try{const s=new Tm(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw os(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,h]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw os(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw os(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw os(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Do(n,f,h);qe(n,f)}}catch(s){if(s instanceof gt)throw s;qe(n,"network-request-failed",{message:String(s)})}}async function Or(n,e,t,r,s={}){const i=await ot(n,e,t,r,s);return"mfaPendingCredential"in i&&qe(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Su(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?Oo(n.config,s):`${n.config.apiScheme}://${s}`;return _m.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function Em(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Tm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ze(this.auth,"network-request-failed")),vm.get())})}}function os(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ze(n,e,r);return s.customData._tokenResponse=t,s}function Fc(n){return n!==void 0&&n.enterprise!==void 0}class wm{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Em(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Im(n,e){return ot(n,"GET","/v2/recaptchaConfig",it(n,e))}async function Am(n,e){return ot(n,"POST","/v1/accounts:delete",e)}async function Ss(n,e){return ot(n,"POST","/v1/accounts:lookup",e)}function lr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function bm(n,e=!1){const t=ce(n),r=await t.getIdToken(e),s=Lo(r);$(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:lr(Ki(s.auth_time)),issuedAtTime:lr(Ki(s.iat)),expirationTime:lr(Ki(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function Ki(n){return Number(n)*1e3}function Lo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ds("JWT malformed, contained fewer than 3 sections"),null;try{const s=uu(t);return s?JSON.parse(s):(ds("Failed to decode base64 JWT payload"),null)}catch(s){return ds("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Bc(n){const e=Lo(n);return $(e,"internal-error"),$(typeof e.exp<"u","internal-error"),$(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function _r(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof gt&&Rm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Rm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Sm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class co{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=lr(this.lastLoginAt),this.creationTime=lr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ps(n){const e=n.auth,t=await n.getIdToken(),r=await _r(n,Ss(e,{idToken:t}));$(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Pu(s.providerUserInfo):[],a=Cm(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,h=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new co(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function Pm(n){const e=ce(n);await Ps(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Cm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Pu(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function km(n,e){const t=await Ru(n,{},async()=>{const r=Dr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Su(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&Cn(n.emulatorConfig.host)&&(u.credentials="include"),bu.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Nm(n,e){return ot(n,"POST","/v2/accounts:revokeToken",it(n,e))}class yn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$(e.idToken,"internal-error"),$(typeof e.idToken<"u","internal-error"),$(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Bc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$(e.length!==0,"internal-error");const t=Bc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:($(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await km(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new yn;return r&&($(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&($(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&($(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yn,this.toJSON())}_performRefresh(){return ct("not implemented")}}function bt(n,e){$(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class He{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Sm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new co(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await _r(this,this.stsTokenManager.getToken(this.auth,e));return $(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return bm(this,e)}reload(){return Pm(this)}_assign(e){this!==e&&($(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new He({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ps(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ue(this.auth.app))return Promise.reject(ut(this.auth));const e=await this.getIdToken();return await _r(this,Am(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:y,isAnonymous:b,providerData:D,stsTokenManager:k}=t;$(m&&k,e,"internal-error");const C=yn.fromJSON(this.name,k);$(typeof m=="string",e,"internal-error"),bt(r,e.name),bt(s,e.name),$(typeof y=="boolean",e,"internal-error"),$(typeof b=="boolean",e,"internal-error"),bt(i,e.name),bt(a,e.name),bt(l,e.name),bt(u,e.name),bt(h,e.name),bt(f,e.name);const x=new He({uid:m,auth:e,email:s,emailVerified:y,displayName:r,isAnonymous:b,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:C,createdAt:h,lastLoginAt:f});return D&&Array.isArray(D)&&(x.providerData=D.map(N=>({...N}))),u&&(x._redirectEventId=u),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new yn;s.updateFromServerResponse(t);const i=new He({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ps(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];$(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Pu(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new yn;l.updateFromIdToken(r);const u=new He({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new co(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,h),u}}const $c=new Map;function lt(n){ft(n instanceof Function,"Expected a class definition");let e=$c.get(n);return e?(ft(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,$c.set(n,e),e)}class Cu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Cu.type="NONE";const qc=Cu;function fs(n,e,t){return`firebase:${n}:${e}:${t}`}class _n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=fs(this.userKey,s.apiKey,i),this.fullPersistenceKey=fs("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Ss(this.auth,{idToken:e}).catch(()=>{});return t?He._fromGetAccountInfoResponse(this.auth,t,e):null}return He._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new _n(lt(qc),e,r);const s=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let i=s[0]||lt(qc);const a=fs(r,e.config.apiKey,e.name);let l=null;for(const h of t)try{const f=await h._get(a);if(f){let m;if(typeof f=="string"){const y=await Ss(e,{idToken:f}).catch(()=>{});if(!y)break;m=await He._fromGetAccountInfoResponse(e,y,f)}else m=He._fromJSON(e,f);h!==i&&(l=m),i=h;break}}catch{}const u=s.filter(h=>h._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new _n(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==i)try{await h._remove(a)}catch{}})),new _n(i,e,r))}}function jc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Vu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ku(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Lu(e))return"Blackberry";if(Mu(e))return"Webos";if(Nu(e))return"Safari";if((e.includes("chrome/")||Du(e))&&!e.includes("edge/"))return"Chrome";if(Ou(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function ku(n=Ce()){return/firefox\//i.test(n)}function Nu(n=Ce()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Du(n=Ce()){return/crios\//i.test(n)}function Vu(n=Ce()){return/iemobile/i.test(n)}function Ou(n=Ce()){return/android/i.test(n)}function Lu(n=Ce()){return/blackberry/i.test(n)}function Mu(n=Ce()){return/webos/i.test(n)}function Mo(n=Ce()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Dm(n=Ce()){return Mo(n)&&!!window.navigator?.standalone}function Vm(){return Gf()&&document.documentMode===10}function xu(n=Ce()){return Mo(n)||Ou(n)||Mu(n)||Lu(n)||/windows phone/i.test(n)||Vu(n)}function Uu(n,e=[]){let t;switch(n){case"Browser":t=jc(Ce());break;case"Worker":t=`${jc(Ce())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${kn}/${r}`}class Om{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Lm(n,e={}){return ot(n,"GET","/v2/passwordPolicy",it(n,e))}const Mm=6;class xm{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Mm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Um{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hc(this),this.idTokenSubscription=new Hc(this),this.beforeStateQueue=new Om(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Iu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=lt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await _n.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Ss(this,{idToken:e}),r=await He._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ue(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return $(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ps(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=gm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ue(this.app))return Promise.reject(ut(this));const t=e?ce(e):null;return t&&$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ue(this.app)?Promise.reject(ut(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ue(this.app)?Promise.reject(ut(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(lt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Lm(this),t=new xm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Nr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Nm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&lt(e)||this._popupRedirectResolver;$(t,this,"argument-error"),this.redirectPersistenceManager=await _n.create(this,[lt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if($(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Uu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Ue(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&fm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function yt(n){return ce(n)}class Hc{constructor(e){this.auth=e,this.observer=null,this.addObserver=tp(t=>this.observer=t)}get next(){return $(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zs={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Fm(n){zs=n}function Fu(n){return zs.loadJS(n)}function Bm(){return zs.recaptchaEnterpriseScript}function $m(){return zs.gapiScript}function qm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class jm{constructor(){this.enterprise=new Hm}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Hm{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const zm="recaptcha-enterprise",Bu="NO_RECAPTCHA";class Wm{constructor(e){this.type=zm,this.auth=yt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{Im(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new wm(u);return i.tenantId==null?i._agentRecaptchaConfig=h:i._tenantRecaptchaConfigs[i.tenantId]=h,a(h.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;Fc(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(h=>{a(h)}).catch(()=>{a(Bu)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jm().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Fc(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=Bm();u.length!==0&&(u+=l),Fu(u).then(()=>{s(l,i,a)}).catch(h=>{a(h)})}}).catch(l=>{a(l)})})}}async function zc(n,e,t,r=!1,s=!1){const i=new Wm(n);let a;if(s)a=Bu;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Cs(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await zc(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await zc(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}function Gm(n,e){const t=No(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Zt(i,e??{}))return s;qe(s,"already-initialized")}return t.initialize({options:e})}function Km(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(lt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Qm(n,e,t){const r=yt(n);$(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=$u(e),{host:a,port:l}=Ym(e),u=l===null?"":`:${l}`,h={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){$(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),$(Zt(h,r.config.emulator)&&Zt(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Cn(a)?(pu(`${i}//${a}${u}`),mu("Auth",!0)):Xm()}function $u(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ym(n){const e=$u(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Wc(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Wc(a)}}}function Wc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Xm(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class xo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ct("not implemented")}_getIdTokenResponse(e){return ct("not implemented")}_linkToIdToken(e,t){return ct("not implemented")}_getReauthenticationResolver(e){return ct("not implemented")}}async function Jm(n,e){return ot(n,"POST","/v1/accounts:signUp",e)}async function Zm(n,e){return Or(n,"POST","/v1/accounts:signInWithPassword",it(n,e))}async function eg(n,e){return ot(n,"POST","/v1/accounts:sendOobCode",it(n,e))}async function tg(n,e){return eg(n,e)}async function ng(n,e){return Or(n,"POST","/v1/accounts:signInWithEmailLink",it(n,e))}async function rg(n,e){return Or(n,"POST","/v1/accounts:signInWithEmailLink",it(n,e))}class vr extends xo{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new vr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new vr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cs(e,t,"signInWithPassword",Zm);case"emailLink":return ng(e,{email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cs(e,r,"signUpPassword",Jm);case"emailLink":return rg(e,{idToken:t,email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function vn(n,e){return Or(n,"POST","/v1/accounts:signInWithIdp",it(n,e))}const sg="http://localhost";class tn extends xo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new tn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new tn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return vn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,vn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vn(e,t)}buildRequest(){const e={requestUri:sg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Dr(t)}return e}}function ig(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function og(n){const e=nr(rr(n)).link,t=e?nr(rr(e)).deep_link_id:null,r=nr(rr(n)).deep_link_id;return(r?nr(rr(r)).link:null)||r||t||e||n}class Uo{constructor(e){const t=nr(rr(e)),r=t.apiKey??null,s=t.oobCode??null,i=ig(t.mode??null);$(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=og(e);try{return new Uo(t)}catch{return null}}}class Nn{constructor(){this.providerId=Nn.PROVIDER_ID}static credential(e,t){return vr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Uo.parseLink(t);return $(r,"argument-error"),vr._fromEmailAndCode(e,r.code,r.tenantId)}}Nn.PROVIDER_ID="password";Nn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Nn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Fo{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Lr extends Fo{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rt extends Lr{constructor(){super("facebook.com")}static credential(e){return tn._fromParams({providerId:Rt.PROVIDER_ID,signInMethod:Rt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rt.credentialFromTaggedObject(e)}static credentialFromError(e){return Rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Rt.credential(e.oauthAccessToken)}catch{return null}}}Rt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Rt.PROVIDER_ID="facebook.com";class at extends Lr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return tn._fromParams({providerId:at.PROVIDER_ID,signInMethod:at.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return at.credentialFromTaggedObject(e)}static credentialFromError(e){return at.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return at.credential(t,r)}catch{return null}}}at.GOOGLE_SIGN_IN_METHOD="google.com";at.PROVIDER_ID="google.com";class St extends Lr{constructor(){super("github.com")}static credential(e){return tn._fromParams({providerId:St.PROVIDER_ID,signInMethod:St.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return St.credentialFromTaggedObject(e)}static credentialFromError(e){return St.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return St.credential(e.oauthAccessToken)}catch{return null}}}St.GITHUB_SIGN_IN_METHOD="github.com";St.PROVIDER_ID="github.com";class Pt extends Lr{constructor(){super("twitter.com")}static credential(e,t){return tn._fromParams({providerId:Pt.PROVIDER_ID,signInMethod:Pt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Pt.credentialFromTaggedObject(e)}static credentialFromError(e){return Pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Pt.credential(t,r)}catch{return null}}}Pt.TWITTER_SIGN_IN_METHOD="twitter.com";Pt.PROVIDER_ID="twitter.com";async function ag(n,e){return Or(n,"POST","/v1/accounts:signUp",it(n,e))}class nn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await He._fromIdTokenResponse(e,r,s),a=Gc(r);return new nn({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Gc(r);return new nn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Gc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class ks extends gt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ks.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ks(e,t,r,s)}}function qu(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ks._fromErrorAndOperation(n,i,e,r):i})}async function cg(n,e,t=!1){const r=await _r(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return nn._forOperation(n,"link",r)}async function lg(n,e,t=!1){const{auth:r}=n;if(Ue(r.app))return Promise.reject(ut(r));const s="reauthenticate";try{const i=await _r(n,qu(r,s,e,n),t);$(i.idToken,r,"internal-error");const a=Lo(i.idToken);$(a,r,"internal-error");const{sub:l}=a;return $(n.uid===l,r,"user-mismatch"),nn._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&qe(r,"user-mismatch"),i}}async function ju(n,e,t=!1){if(Ue(n.app))return Promise.reject(ut(n));const r="signIn",s=await qu(n,r,e),i=await nn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function ug(n,e){return ju(yt(n),e)}async function Hu(n){const e=yt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function hg(n,e,t){const r=yt(n);await Cs(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",tg)}async function dg(n,e,t){if(Ue(n.app))return Promise.reject(ut(n));const r=yt(n),a=await Cs(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ag).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Hu(n),u}),l=await nn._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function fg(n,e,t){return Ue(n.app)?Promise.reject(ut(n)):ug(ce(n),Nn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Hu(n),r})}async function pg(n,e){return ot(n,"POST","/v1/accounts:createAuthUri",it(n,e))}async function mg(n,e){const t=Au()?Rs():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await pg(ce(n),r);return s||[]}function Bo(n,e){return ce(n).setPersistence(e)}function gg(n,e,t,r){return ce(n).onIdTokenChanged(e,t,r)}function yg(n,e,t){return ce(n).beforeAuthStateChanged(e,t)}function _g(n,e,t,r){return ce(n).onAuthStateChanged(e,t,r)}function vg(n){return ce(n).signOut()}const Ns="__sak";class zu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ns,"1"),this.storage.removeItem(Ns),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Eg=1e3,Tg=10;class Wu extends zu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);Vm()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Tg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Eg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Wu.type="LOCAL";const Ws=Wu;class Gu extends zu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gu.type="SESSION";const Mr=Gu;function wg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Gs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Gs(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async h=>h(t.origin,i)),u=await wg(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Gs.receivers=[];function $o(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Ig{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const h=$o("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const y=m;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(y.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Je(){return window}function Ag(n){Je().location.href=n}function Ku(){return typeof Je().WorkerGlobalScope<"u"&&typeof Je().importScripts=="function"}async function bg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Rg(){return navigator?.serviceWorker?.controller||null}function Sg(){return Ku()?self:null}const Qu="firebaseLocalStorageDb",Pg=1,Ds="firebaseLocalStorage",Yu="fbase_key";class xr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ks(n,e){return n.transaction([Ds],e?"readwrite":"readonly").objectStore(Ds)}function Cg(){const n=indexedDB.deleteDatabase(Qu);return new xr(n).toPromise()}function lo(){const n=indexedDB.open(Qu,Pg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ds,{keyPath:Yu})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ds)?e(r):(r.close(),await Cg(),e(await lo()))})})}async function Kc(n,e,t){const r=Ks(n,!0).put({[Yu]:e,value:t});return new xr(r).toPromise()}async function kg(n,e){const t=Ks(n,!1).get(e),r=await new xr(t).toPromise();return r===void 0?null:r.value}function Qc(n,e){const t=Ks(n,!0).delete(e);return new xr(t).toPromise()}const Ng=800,Dg=3;class Xu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await lo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Dg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ku()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gs._getInstance(Sg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await bg(),!this.activeServiceWorker)return;this.sender=new Ig(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Rg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await lo();return await Kc(e,Ns,"1"),await Qc(e,Ns),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Kc(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>kg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Qc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Ks(s,!1).getAll();return new xr(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Ng)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Xu.type="LOCAL";const Vg=Xu;new Vr(3e4,6e4);function Ju(n,e){return e?lt(e):($(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class qo extends xo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return vn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return vn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Og(n){return ju(n.auth,new qo(n),n.bypassAuthState)}function Lg(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),lg(t,new qo(n),n.bypassAuthState)}async function Mg(n){const{auth:e,user:t}=n;return $(t,e,"internal-error"),cg(t,new qo(n),n.bypassAuthState)}class Zu{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Og;case"linkViaPopup":case"linkViaRedirect":return Mg;case"reauthViaPopup":case"reauthViaRedirect":return Lg;default:qe(this.auth,"internal-error")}}resolve(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const xg=new Vr(2e3,1e4);async function Ug(n,e,t){if(Ue(n.app))return Promise.reject(ze(n,"operation-not-supported-in-this-environment"));const r=yt(n);pm(n,e,Fo);const s=Ju(r,t);return new Yt(r,"signInViaPopup",e,s).executeNotNull()}class Yt extends Zu{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Yt.currentPopupAction&&Yt.currentPopupAction.cancel(),Yt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $(e,this.auth,"internal-error"),e}async onExecution(){ft(this.filter.length===1,"Popup operations only handle one event");const e=$o();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ze(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,xg.get())};e()}}Yt.currentPopupAction=null;const Fg="pendingRedirect",ps=new Map;class Bg extends Zu{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ps.get(this.auth._key());if(!e){try{const r=await $g(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ps.set(this.auth._key(),e)}return this.bypassAuthState||ps.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $g(n,e){const t=Hg(e),r=jg(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function qg(n,e){ps.set(n._key(),e)}function jg(n){return lt(n._redirectPersistence)}function Hg(n){return fs(Fg,n.config.apiKey,n.name)}async function zg(n,e,t=!1){if(Ue(n.app))return Promise.reject(ut(n));const r=yt(n),s=Ju(r,e),a=await new Bg(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const Wg=600*1e3;class Gg{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Kg(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!eh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Wg&&this.cachedEventUids.clear(),this.cachedEventUids.has(Yc(e))}saveEventToCache(e){this.cachedEventUids.add(Yc(e)),this.lastProcessedEventTime=Date.now()}}function Yc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function eh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Kg(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return eh(n);default:return!1}}async function Qg(n,e={}){return ot(n,"GET","/v1/projects",e)}const Yg=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xg=/^https?/;async function Jg(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Qg(n);for(const t of e)try{if(Zg(t))return}catch{}qe(n,"unauthorized-domain")}function Zg(n){const e=Rs(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Xg.test(t))return!1;if(Yg.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const ey=new Vr(3e4,6e4);function Xc(){const n=Je().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function ty(n){return new Promise((e,t)=>{function r(){Xc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Xc(),t(ze(n,"network-request-failed"))},timeout:ey.get()})}if(Je().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Je().gapi?.load)r();else{const s=qm("iframefcb");return Je()[s]=()=>{gapi.load?r():t(ze(n,"network-request-failed"))},Fu(`${$m()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw ms=null,e})}let ms=null;function ny(n){return ms=ms||ty(n),ms}const ry=new Vr(5e3,15e3),sy="__/auth/iframe",iy="emulator/auth/iframe",oy={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ay=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cy(n){const e=n.config;$(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Oo(e,iy):`https://${n.config.authDomain}/${sy}`,r={apiKey:e.apiKey,appName:n.name,v:kn},s=ay.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Dr(r).slice(1)}`}async function ly(n){const e=await ny(n),t=Je().gapi;return $(t,n,"internal-error"),e.open({where:document.body,url:cy(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oy,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ze(n,"network-request-failed"),l=Je().setTimeout(()=>{i(a)},ry.get());function u(){Je().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const uy={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hy=500,dy=600,fy="_blank",py="http://localhost";class Jc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function my(n,e,t,r=hy,s=dy){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...uy,width:r.toString(),height:s.toString(),top:i,left:a},h=Ce().toLowerCase();t&&(l=Du(h)?fy:t),ku(h)&&(e=e||py,u.scrollbars="yes");const f=Object.entries(u).reduce((y,[b,D])=>`${y}${b}=${D},`,"");if(Dm(h)&&l!=="_self")return gy(e||"",l),new Jc(null);const m=window.open(e||"",l,f);$(m,n,"popup-blocked");try{m.focus()}catch{}return new Jc(m)}function gy(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const yy="__/auth/handler",_y="emulator/auth/handler",vy=encodeURIComponent("fac");async function Zc(n,e,t,r,s,i){$(n.config.authDomain,n,"auth-domain-config-required"),$(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:kn,eventId:s};if(e instanceof Fo){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ep(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof Lr){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),h=u?`#${vy}=${encodeURIComponent(u)}`:"";return`${Ey(n)}?${Dr(l).slice(1)}${h}`}function Ey({config:n}){return n.emulator?Oo(n,_y):`https://${n.authDomain}/${yy}`}const Qi="webStorageSupport";class Ty{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mr,this._completeRedirectFn=zg,this._overrideRedirectResult=qg}async _openPopup(e,t,r,s){ft(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Zc(e,t,r,Rs(),s);return my(e,i,$o())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Zc(e,t,r,Rs(),s);return Ag(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ft(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await ly(e),r=new Gg(e);return t.register("authEvent",s=>($(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Qi,{type:Qi},s=>{const i=s?.[0]?.[Qi];i!==void 0&&t(!!i),qe(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Jg(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xu()||Nu()||Mo()}}const wy=Ty;var el="@firebase/auth",tl="1.12.0";class Iy{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ay(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function by(n){wn(new en("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;$(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Uu(n)},h=new Um(r,s,i,u);return Km(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),wn(new en("auth-internal",e=>{const t=yt(e.getProvider("auth").getImmediate());return(r=>new Iy(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Dt(el,tl,Ay(n)),Dt(el,tl,"esm2020")}const Ry=300,Sy=fu("authIdTokenMaxAge")||Ry;let nl=null;const Py=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Sy)return;const s=t?.token;nl!==s&&(nl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Cy(n=vu()){const e=No(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Gm(n,{popupRedirectResolver:wy,persistence:[Vg,Ws,Mr]}),r=fu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Py(i.toString());yg(t,a,()=>a(t.currentUser)),gg(t,l=>a(l))}}const s=hu("auth");return s&&Qm(t,`http://${s}`),t}function ky(){return document.getElementsByTagName("head")?.[0]??document}Fm({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ze("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",ky().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});by("Browser");var Ny="firebase",Dy="12.7.0";Dt(Ny,Dy,"app");var rl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Vt,th;(function(){var n;function e(E,g){function v(){}v.prototype=g.prototype,E.F=g.prototype,E.prototype=new v,E.prototype.constructor=E,E.D=function(w,T,A){for(var _=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)_[Ae-2]=arguments[Ae];return g.prototype[T].apply(w,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,v){v||(v=0);const w=Array(16);if(typeof g=="string")for(var T=0;T<16;++T)w[T]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(T=0;T<16;++T)w[T]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=E.g[0],v=E.g[1],T=E.g[2];let A=E.g[3],_;_=g+(A^v&(T^A))+w[0]+3614090360&4294967295,g=v+(_<<7&4294967295|_>>>25),_=A+(T^g&(v^T))+w[1]+3905402710&4294967295,A=g+(_<<12&4294967295|_>>>20),_=T+(v^A&(g^v))+w[2]+606105819&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(g^T&(A^g))+w[3]+3250441966&4294967295,v=T+(_<<22&4294967295|_>>>10),_=g+(A^v&(T^A))+w[4]+4118548399&4294967295,g=v+(_<<7&4294967295|_>>>25),_=A+(T^g&(v^T))+w[5]+1200080426&4294967295,A=g+(_<<12&4294967295|_>>>20),_=T+(v^A&(g^v))+w[6]+2821735955&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(g^T&(A^g))+w[7]+4249261313&4294967295,v=T+(_<<22&4294967295|_>>>10),_=g+(A^v&(T^A))+w[8]+1770035416&4294967295,g=v+(_<<7&4294967295|_>>>25),_=A+(T^g&(v^T))+w[9]+2336552879&4294967295,A=g+(_<<12&4294967295|_>>>20),_=T+(v^A&(g^v))+w[10]+4294925233&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(g^T&(A^g))+w[11]+2304563134&4294967295,v=T+(_<<22&4294967295|_>>>10),_=g+(A^v&(T^A))+w[12]+1804603682&4294967295,g=v+(_<<7&4294967295|_>>>25),_=A+(T^g&(v^T))+w[13]+4254626195&4294967295,A=g+(_<<12&4294967295|_>>>20),_=T+(v^A&(g^v))+w[14]+2792965006&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(g^T&(A^g))+w[15]+1236535329&4294967295,v=T+(_<<22&4294967295|_>>>10),_=g+(T^A&(v^T))+w[1]+4129170786&4294967295,g=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(g^v))+w[6]+3225465664&4294967295,A=g+(_<<9&4294967295|_>>>23),_=T+(g^v&(A^g))+w[11]+643717713&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^g&(T^A))+w[0]+3921069994&4294967295,v=T+(_<<20&4294967295|_>>>12),_=g+(T^A&(v^T))+w[5]+3593408605&4294967295,g=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(g^v))+w[10]+38016083&4294967295,A=g+(_<<9&4294967295|_>>>23),_=T+(g^v&(A^g))+w[15]+3634488961&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^g&(T^A))+w[4]+3889429448&4294967295,v=T+(_<<20&4294967295|_>>>12),_=g+(T^A&(v^T))+w[9]+568446438&4294967295,g=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(g^v))+w[14]+3275163606&4294967295,A=g+(_<<9&4294967295|_>>>23),_=T+(g^v&(A^g))+w[3]+4107603335&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^g&(T^A))+w[8]+1163531501&4294967295,v=T+(_<<20&4294967295|_>>>12),_=g+(T^A&(v^T))+w[13]+2850285829&4294967295,g=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(g^v))+w[2]+4243563512&4294967295,A=g+(_<<9&4294967295|_>>>23),_=T+(g^v&(A^g))+w[7]+1735328473&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^g&(T^A))+w[12]+2368359562&4294967295,v=T+(_<<20&4294967295|_>>>12),_=g+(v^T^A)+w[5]+4294588738&4294967295,g=v+(_<<4&4294967295|_>>>28),_=A+(g^v^T)+w[8]+2272392833&4294967295,A=g+(_<<11&4294967295|_>>>21),_=T+(A^g^v)+w[11]+1839030562&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^g)+w[14]+4259657740&4294967295,v=T+(_<<23&4294967295|_>>>9),_=g+(v^T^A)+w[1]+2763975236&4294967295,g=v+(_<<4&4294967295|_>>>28),_=A+(g^v^T)+w[4]+1272893353&4294967295,A=g+(_<<11&4294967295|_>>>21),_=T+(A^g^v)+w[7]+4139469664&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^g)+w[10]+3200236656&4294967295,v=T+(_<<23&4294967295|_>>>9),_=g+(v^T^A)+w[13]+681279174&4294967295,g=v+(_<<4&4294967295|_>>>28),_=A+(g^v^T)+w[0]+3936430074&4294967295,A=g+(_<<11&4294967295|_>>>21),_=T+(A^g^v)+w[3]+3572445317&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^g)+w[6]+76029189&4294967295,v=T+(_<<23&4294967295|_>>>9),_=g+(v^T^A)+w[9]+3654602809&4294967295,g=v+(_<<4&4294967295|_>>>28),_=A+(g^v^T)+w[12]+3873151461&4294967295,A=g+(_<<11&4294967295|_>>>21),_=T+(A^g^v)+w[15]+530742520&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^g)+w[2]+3299628645&4294967295,v=T+(_<<23&4294967295|_>>>9),_=g+(T^(v|~A))+w[0]+4096336452&4294967295,g=v+(_<<6&4294967295|_>>>26),_=A+(v^(g|~T))+w[7]+1126891415&4294967295,A=g+(_<<10&4294967295|_>>>22),_=T+(g^(A|~v))+w[14]+2878612391&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~g))+w[5]+4237533241&4294967295,v=T+(_<<21&4294967295|_>>>11),_=g+(T^(v|~A))+w[12]+1700485571&4294967295,g=v+(_<<6&4294967295|_>>>26),_=A+(v^(g|~T))+w[3]+2399980690&4294967295,A=g+(_<<10&4294967295|_>>>22),_=T+(g^(A|~v))+w[10]+4293915773&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~g))+w[1]+2240044497&4294967295,v=T+(_<<21&4294967295|_>>>11),_=g+(T^(v|~A))+w[8]+1873313359&4294967295,g=v+(_<<6&4294967295|_>>>26),_=A+(v^(g|~T))+w[15]+4264355552&4294967295,A=g+(_<<10&4294967295|_>>>22),_=T+(g^(A|~v))+w[6]+2734768916&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~g))+w[13]+1309151649&4294967295,v=T+(_<<21&4294967295|_>>>11),_=g+(T^(v|~A))+w[4]+4149444226&4294967295,g=v+(_<<6&4294967295|_>>>26),_=A+(v^(g|~T))+w[11]+3174756917&4294967295,A=g+(_<<10&4294967295|_>>>22),_=T+(g^(A|~v))+w[2]+718787259&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.v=function(E,g){g===void 0&&(g=E.length);const v=g-this.blockSize,w=this.C;let T=this.h,A=0;for(;A<g;){if(T==0)for(;A<=v;)s(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(w[T++]=E.charCodeAt(A++),T==this.blockSize){s(this,w),T=0;break}}else for(;A<g;)if(w[T++]=E[A++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=g},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var v=E.length-8;v<E.length;++v)E[v]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,v=0;v<4;++v)for(let w=0;w<32;w+=8)E[g++]=this.g[v]>>>w&255;return E};function i(E,g){var v=l;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=g(E)}function a(E,g){this.h=g;const v=[];let w=!0;for(let T=E.length-1;T>=0;T--){const A=E[T]|0;w&&A==g||(v[T]=A,w=!1)}this.g=v}var l={};function u(E){return-128<=E&&E<128?i(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return C(h(-E));const g=[];let v=1;for(let w=0;E>=v;w++)g[w]=E/v|0,v*=4294967296;return new a(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return C(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=h(Math.pow(g,8));let w=m;for(let A=0;A<E.length;A+=8){var T=Math.min(8,E.length-A);const _=parseInt(E.substring(A,A+T),g);T<8?(T=h(Math.pow(g,T)),w=w.j(T).add(h(_))):(w=w.j(v),w=w.add(h(_)))}return w}var m=u(0),y=u(1),b=u(16777216);n=a.prototype,n.m=function(){if(k(this))return-C(this).m();let E=0,g=1;for(let v=0;v<this.g.length;v++){const w=this.i(v);E+=(w>=0?w:4294967296+w)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(D(this))return"0";if(k(this))return"-"+C(this).toString(E);const g=h(Math.pow(E,6));var v=this;let w="";for(;;){const T=U(v,g).g;v=x(v,T.j(g));let A=((v.g.length>0?v.g[0]:v.h)>>>0).toString(E);if(v=T,D(v))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function D(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}n.l=function(E){return E=x(this,E),k(E)?-1:D(E)?0:1};function C(E){const g=E.g.length,v=[];for(let w=0;w<g;w++)v[w]=~E.g[w];return new a(v,~E.h).add(y)}n.abs=function(){return k(this)?C(this):this},n.add=function(E){const g=Math.max(this.g.length,E.g.length),v=[];let w=0;for(let T=0;T<=g;T++){let A=w+(this.i(T)&65535)+(E.i(T)&65535),_=(A>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=_>>>16,A&=65535,_&=65535,v[T]=_<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function x(E,g){return E.add(C(g))}n.j=function(E){if(D(this)||D(E))return m;if(k(this))return k(E)?C(this).j(C(E)):C(C(this).j(E));if(k(E))return C(this.j(C(E)));if(this.l(b)<0&&E.l(b)<0)return h(this.m()*E.m());const g=this.g.length+E.g.length,v=[];for(var w=0;w<2*g;w++)v[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<E.g.length;T++){const A=this.i(w)>>>16,_=this.i(w)&65535,Ae=E.i(T)>>>16,ie=E.i(T)&65535;v[2*w+2*T]+=_*ie,N(v,2*w+2*T),v[2*w+2*T+1]+=A*ie,N(v,2*w+2*T+1),v[2*w+2*T+1]+=_*Ae,N(v,2*w+2*T+1),v[2*w+2*T+2]+=A*Ae,N(v,2*w+2*T+2)}for(E=0;E<g;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=g;E<2*g;E++)v[E]=0;return new a(v,0)};function N(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function O(E,g){this.g=E,this.h=g}function U(E,g){if(D(g))throw Error("division by zero");if(D(E))return new O(m,m);if(k(E))return g=U(C(E),g),new O(C(g.g),C(g.h));if(k(g))return g=U(E,C(g)),new O(C(g.g),g.h);if(E.g.length>30){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var v=y,w=g;w.l(E)<=0;)v=Y(v),w=Y(w);var T=F(v,1),A=F(w,1);for(w=F(w,2),v=F(v,2);!D(w);){var _=A.add(w);_.l(E)<=0&&(T=T.add(v),A=_),w=F(w,1),v=F(v,1)}return g=x(E,T.j(g)),new O(T,g)}for(T=m;E.l(g)>=0;){for(v=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(v)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=h(v),_=A.j(g);k(_)||_.l(E)>0;)v-=w,A=h(v),_=A.j(g);D(A)&&(A=y),T=T.add(A),E=x(E,_)}return new O(T,E)}n.B=function(E){return U(this,E).h},n.and=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let w=0;w<g;w++)v[w]=this.i(w)&E.i(w);return new a(v,this.h&E.h)},n.or=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let w=0;w<g;w++)v[w]=this.i(w)|E.i(w);return new a(v,this.h|E.h)},n.xor=function(E){const g=Math.max(this.g.length,E.g.length),v=[];for(let w=0;w<g;w++)v[w]=this.i(w)^E.i(w);return new a(v,this.h^E.h)};function Y(E){const g=E.g.length+1,v=[];for(let w=0;w<g;w++)v[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(v,E.h)}function F(E,g){const v=g>>5;g%=32;const w=E.g.length-v,T=[];for(let A=0;A<w;A++)T[A]=g>0?E.i(A+v)>>>g|E.i(A+v+1)<<32-g:E.i(A+v);return new a(T,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,th=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Vt=a}).apply(typeof rl<"u"?rl:typeof self<"u"?self:typeof window<"u"?window:{});var as=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var nh,sr,rh,gs,uo,sh,ih,oh;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof as=="object"&&as];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var d=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var I=o[p];if(!(I in d))break e;d=d[I]}o=o[o.length-1],p=d[o],c=c(p),c!=p&&c!=null&&e(d,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,d){return o.call.apply(o.bind,arguments)}function h(o,c,d){return h=u,h.apply(null,arguments)}function f(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,c){function d(){}d.prototype=c.prototype,o.Z=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(p,I,R){for(var V=Array(arguments.length-2),z=2;z<arguments.length;z++)V[z-2]=arguments[z];return c.prototype[I].apply(p,V)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function b(o){const c=o.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=o[p];return d}return[]}function D(o,c){for(let p=1;p<arguments.length;p++){const I=arguments[p];var d=typeof I;if(d=d!="object"?d:I?Array.isArray(I)?"array":d:"null",d=="array"||d=="object"&&typeof I.length=="number"){d=o.length||0;const R=I.length||0;o.length=d+R;for(let V=0;V<R;V++)o[d+V]=I[V]}else o.push(I)}}class k{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function C(o){a.setTimeout(()=>{throw o},0)}function x(){var o=E;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class N{constructor(){this.h=this.g=null}add(c,d){const p=O.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var O=new k(()=>new U,o=>o.reset());class U{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,F=!1,E=new N,g=()=>{const o=Promise.resolve(void 0);Y=()=>{o.then(v)}};function v(){for(var o;o=x();){try{o.h.call(o.g)}catch(d){C(d)}var c=O;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}F=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function Ae(o,c){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}m(Ae,T),Ae.prototype.init=function(o,c){const d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(d=="mouseover"?c=o.fromElement:d=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ae.Z.h.call(this)},Ae.prototype.h=function(){Ae.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ie="closure_listenable_"+(Math.random()*1e6|0),je=0;function De(o,c,d,p,I){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=I,this.key=++je,this.da=this.fa=!1}function Ke(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function _t(o,c,d){for(const p in o)c.call(d,o[p],p,o)}function Wr(o,c){for(const d in o)c.call(void 0,o[d],d,o)}function Un(o){const c={};for(const d in o)c[d]=o[d];return c}const Sa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Pa(o,c){let d,p;for(let I=1;I<arguments.length;I++){p=arguments[I];for(d in p)o[d]=p[d];for(let R=0;R<Sa.length;R++)d=Sa[R],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function Gr(o){this.src=o,this.g={},this.h=0}Gr.prototype.add=function(o,c,d,p,I){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const V=Ei(o,c,p,I);return V>-1?(c=o[V],d||(c.fa=!1)):(c=new De(c,this.src,R,!!p,I),c.fa=d,o.push(c)),c};function vi(o,c){const d=c.type;if(d in o.g){var p=o.g[d],I=Array.prototype.indexOf.call(p,c,void 0),R;(R=I>=0)&&Array.prototype.splice.call(p,I,1),R&&(Ke(c),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Ei(o,c,d,p){for(let I=0;I<o.length;++I){const R=o[I];if(!R.da&&R.listener==c&&R.capture==!!d&&R.ha==p)return I}return-1}var Ti="closure_lm_"+(Math.random()*1e6|0),wi={};function Ca(o,c,d,p,I){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Ca(o,c[R],d,p,I);return null}return d=Da(d),o&&o[ie]?o.J(c,d,l(p)?!!p.capture:!1,I):Zd(o,c,d,!1,p,I)}function Zd(o,c,d,p,I,R){if(!c)throw Error("Invalid event type");const V=l(I)?!!I.capture:!!I;let z=Ai(o);if(z||(o[Ti]=z=new Gr(o)),d=z.add(c,d,p,V,R),d.proxy)return d;if(p=ef(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)A||(I=V),I===void 0&&(I=!1),o.addEventListener(c.toString(),p,I);else if(o.attachEvent)o.attachEvent(Na(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ef(){function o(d){return c.call(o.src,o.listener,d)}const c=tf;return o}function ka(o,c,d,p,I){if(Array.isArray(c))for(var R=0;R<c.length;R++)ka(o,c[R],d,p,I);else p=l(p)?!!p.capture:!!p,d=Da(d),o&&o[ie]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],d=Ei(c,d,p,I),d>-1&&(Ke(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=Ai(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Ei(c,d,p,I)),(d=o>-1?c[o]:null)&&Ii(d))}function Ii(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[ie])vi(c.i,o);else{var d=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(d,p,o.capture):c.detachEvent?c.detachEvent(Na(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=Ai(c))?(vi(d,o),d.h==0&&(d.src=null,c[Ti]=null)):Ke(o)}}}function Na(o){return o in wi?wi[o]:wi[o]="on"+o}function tf(o,c){if(o.da)o=!0;else{c=new Ae(c,this);const d=o.listener,p=o.ha||o.src;o.fa&&Ii(o),o=d.call(p,c)}return o}function Ai(o){return o=o[Ti],o instanceof Gr?o:null}var bi="__closure_events_fn_"+(Math.random()*1e9>>>0);function Da(o){return typeof o=="function"?o:(o[bi]||(o[bi]=function(c){return o.handleEvent(c)}),o[bi])}function be(){w.call(this),this.i=new Gr(this),this.M=this,this.G=null}m(be,w),be.prototype[ie]=!0,be.prototype.removeEventListener=function(o,c,d,p){ka(this,o,c,d,p)};function ke(o,c){var d,p=o.G;if(p)for(d=[];p;p=p.G)d.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new T(c,o);else if(c instanceof T)c.target=c.target||o;else{var I=c;c=new T(p,o),Pa(c,I)}I=!0;let R,V;if(d)for(V=d.length-1;V>=0;V--)R=c.g=d[V],I=Kr(R,p,!0,c)&&I;if(R=c.g=o,I=Kr(R,p,!0,c)&&I,I=Kr(R,p,!1,c)&&I,d)for(V=0;V<d.length;V++)R=c.g=d[V],I=Kr(R,p,!1,c)&&I}be.prototype.N=function(){if(be.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const d=o.g[c];for(let p=0;p<d.length;p++)Ke(d[p]);delete o.g[c],o.h--}}this.G=null},be.prototype.J=function(o,c,d,p){return this.i.add(String(o),c,!1,d,p)},be.prototype.K=function(o,c,d,p){return this.i.add(String(o),c,!0,d,p)};function Kr(o,c,d,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let I=!0;for(let R=0;R<c.length;++R){const V=c[R];if(V&&!V.da&&V.capture==d){const z=V.listener,pe=V.ha||V.src;V.fa&&vi(o.i,V),I=z.call(pe,p)!==!1&&I}}return I&&!p.defaultPrevented}function nf(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Va(o){o.g=nf(()=>{o.g=null,o.i&&(o.i=!1,Va(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class rf extends w{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Va(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fn(o){w.call(this),this.h=o,this.g={}}m(Fn,w);var Oa=[];function La(o){_t(o.g,function(c,d){this.g.hasOwnProperty(d)&&Ii(c)},o),o.g={}}Fn.prototype.N=function(){Fn.Z.N.call(this),La(this)},Fn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ri=a.JSON.stringify,sf=a.JSON.parse,of=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Ma(){}function xa(){}var Bn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Si(){T.call(this,"d")}m(Si,T);function Pi(){T.call(this,"c")}m(Pi,T);var Ht={},Ua=null;function Qr(){return Ua=Ua||new be}Ht.Ia="serverreachability";function Fa(o){T.call(this,Ht.Ia,o)}m(Fa,T);function $n(o){const c=Qr();ke(c,new Fa(c))}Ht.STAT_EVENT="statevent";function Ba(o,c){T.call(this,Ht.STAT_EVENT,o),this.stat=c}m(Ba,T);function Ne(o){const c=Qr();ke(c,new Ba(c,o))}Ht.Ja="timingevent";function $a(o,c){T.call(this,Ht.Ja,o),this.size=c}m($a,T);function qn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function jn(){this.g=!0}jn.prototype.ua=function(){this.g=!1};function af(o,c,d,p,I,R){o.info(function(){if(o.g)if(R){var V="",z=R.split("&");for(let Z=0;Z<z.length;Z++){var pe=z[Z].split("=");if(pe.length>1){const ve=pe[0];pe=pe[1];const Ye=ve.split("_");V=Ye.length>=2&&Ye[1]=="type"?V+(ve+"="+pe+"&"):V+(ve+"=redacted&")}}}else V=null;else V=R;return"XMLHTTP REQ ("+p+") [attempt "+I+"]: "+c+`
`+d+`
`+V})}function cf(o,c,d,p,I,R,V){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+I+"]: "+c+`
`+d+`
`+R+" "+V})}function ln(o,c,d,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+uf(o,d)+(p?" "+p:"")})}function lf(o,c){o.info(function(){return"TIMEOUT: "+c})}jn.prototype.info=function(){};function uf(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var d=R[o];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var I=p[0];if(I!="noop"&&I!="stop"&&I!="close")for(let V=1;V<p.length;V++)p[V]=""}}}}return Ri(R)}catch{return c}}var Yr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},qa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ja;function Ci(){}m(Ci,Ma),Ci.prototype.g=function(){return new XMLHttpRequest},ja=new Ci;function Hn(o){return encodeURIComponent(String(o))}function hf(o){var c=1;o=o.split(":");const d=[];for(;c>0&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function vt(o,c,d,p){this.j=o,this.i=c,this.l=d,this.S=p||1,this.V=new Fn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ha}function Ha(){this.i=null,this.g="",this.h=!1}var za={},ki={};function Ni(o,c,d){o.M=1,o.A=Jr(Qe(c)),o.u=d,o.R=!0,Wa(o,null)}function Wa(o,c){o.F=Date.now(),Xr(o),o.B=Qe(o.A);var d=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),ic(d.i,"t",p),o.C=0,d=o.j.L,o.h=new Ha,o.g=Ic(o.j,d?c:null,!o.u),o.P>0&&(o.O=new rf(h(o.Y,o,o.g),o.P)),c=o.V,d=o.g,p=o.ba;var I="readystatechange";Array.isArray(I)||(I&&(Oa[0]=I.toString()),I=Oa);for(let R=0;R<I.length;R++){const V=Ca(d,I[R],p||c.handleEvent,!1,c.h||c);if(!V)break;c.g[V.key]=V}c=o.J?Un(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),$n(),af(o.i,o.v,o.B,o.l,o.S,o.u)}vt.prototype.ba=function(o){o=o.target;const c=this.O;c&&wt(o)==3?c.j():this.Y(o)},vt.prototype.Y=function(o){try{if(o==this.g)e:{const z=wt(this.g),pe=this.g.ya(),Z=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||dc(this.g)))){this.K||z!=4||pe==7||(pe==8||Z<=0?$n(3):$n(2)),Di(this);var c=this.g.ca();this.X=c;var d=df(this);if(this.o=c==200,cf(this.i,this.v,this.B,this.l,this.S,z,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,I=this.g;if((p=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(p)){var R=p;break t}}R=null}if(o=R)ln(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vi(this,o);else{this.o=!1,this.m=3,Ne(12),zt(this),zn(this);break e}}if(this.R){o=!0;let ve;for(;!this.K&&this.C<d.length;)if(ve=ff(this,d),ve==ki){z==4&&(this.m=4,Ne(14),o=!1),ln(this.i,this.l,null,"[Incomplete Response]");break}else if(ve==za){this.m=4,Ne(15),ln(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else ln(this.i,this.l,ve,null),Vi(this,ve);if(Ga(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||d.length!=0||this.h.h||(this.m=1,Ne(16),o=!1),this.o=this.o&&o,!o)ln(this.i,this.l,d,"[Invalid Chunked Response]"),zt(this),zn(this);else if(d.length>0&&!this.W){this.W=!0;var V=this.j;V.g==this&&V.aa&&!V.P&&(V.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),$i(V),V.P=!0,Ne(11))}}else ln(this.i,this.l,d,null),Vi(this,d);z==4&&zt(this),this.o&&!this.K&&(z==4?vc(this.j,this):(this.o=!1,Xr(this)))}else Sf(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),zt(this),zn(this)}}}catch{}};function df(o){if(!Ga(o))return o.g.la();const c=dc(o.g);if(c==="")return"";let d="";const p=c.length,I=wt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return zt(o),zn(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,d+=o.h.i.decode(c[R],{stream:!(I&&R==p-1)});return c.length=0,o.h.g+=d,o.C=0,o.h.g}function Ga(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function ff(o,c){var d=o.C,p=c.indexOf(`
`,d);return p==-1?ki:(d=Number(c.substring(d,p)),isNaN(d)?za:(p+=1,p+d>c.length?ki:(c=c.slice(p,p+d),o.C=p+d,c)))}vt.prototype.cancel=function(){this.K=!0,zt(this)};function Xr(o){o.T=Date.now()+o.H,Ka(o,o.H)}function Ka(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=qn(h(o.aa,o),c)}function Di(o){o.D&&(a.clearTimeout(o.D),o.D=null)}vt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(lf(this.i,this.B),this.M!=2&&($n(),Ne(17)),zt(this),this.m=2,zn(this)):Ka(this,this.T-o)};function zn(o){o.j.I==0||o.K||vc(o.j,o)}function zt(o){Di(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,La(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Vi(o,c){try{var d=o.j;if(d.I!=0&&(d.g==o||Oi(d.h,o))){if(!o.L&&Oi(d.h,o)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var I=p;if(I[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)rs(d),ts(d);else break e;Bi(d),Ne(18)}}else d.xa=I[1],0<d.xa-d.K&&I[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=qn(h(d.Va,d),6e3));Xa(d.h)<=1&&d.ta&&(d.ta=void 0)}else Gt(d,11)}else if((o.L||d.g==o)&&rs(d),!_(c))for(I=d.Ba.g.parse(c),c=0;c<I.length;c++){let Z=I[c];const ve=Z[0];if(!(ve<=d.K))if(d.K=ve,Z=Z[1],d.I==2)if(Z[0]=="c"){d.M=Z[1],d.ba=Z[2];const Ye=Z[3];Ye!=null&&(d.ka=Ye,d.j.info("VER="+d.ka));const Kt=Z[4];Kt!=null&&(d.za=Kt,d.j.info("SVER="+d.za));const It=Z[5];It!=null&&typeof It=="number"&&It>0&&(p=1.5*It,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const At=o.g;if(At){const is=At.g?At.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(is){var R=p.h;R.g||is.indexOf("spdy")==-1&&is.indexOf("quic")==-1&&is.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Li(R,R.h),R.h=null))}if(p.G){const qi=At.g?At.g.getResponseHeader("X-HTTP-Session-Id"):null;qi&&(p.wa=qi,ne(p.J,p.G,qi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var V=o;if(p.na=wc(p,p.L?p.ba:null,p.W),V.L){Ja(p.h,V);var z=V,pe=p.O;pe&&(z.H=pe),z.D&&(Di(z),Xr(z)),p.g=V}else yc(p);d.i.length>0&&ns(d)}else Z[0]!="stop"&&Z[0]!="close"||Gt(d,7);else d.I==3&&(Z[0]=="stop"||Z[0]=="close"?Z[0]=="stop"?Gt(d,7):Fi(d):Z[0]!="noop"&&d.l&&d.l.qa(Z),d.A=0)}}$n(4)}catch{}}var pf=class{constructor(o,c){this.g=o,this.map=c}};function Qa(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ya(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Xa(o){return o.h?1:o.g?o.g.size:0}function Oi(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Li(o,c){o.g?o.g.add(c):o.h=c}function Ja(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Qa.prototype.cancel=function(){if(this.i=Za(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Za(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const d of o.g.values())c=c.concat(d.G);return c}return b(o.i)}var ec=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mf(o,c){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const p=o[d].indexOf("=");let I,R=null;p>=0?(I=o[d].substring(0,p),R=o[d].substring(p+1)):I=o[d],c(I,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Et(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof Et?(this.l=o.l,Wn(this,o.j),this.o=o.o,this.g=o.g,Gn(this,o.u),this.h=o.h,Mi(this,oc(o.i)),this.m=o.m):o&&(c=String(o).match(ec))?(this.l=!1,Wn(this,c[1]||"",!0),this.o=Kn(c[2]||""),this.g=Kn(c[3]||"",!0),Gn(this,c[4]),this.h=Kn(c[5]||"",!0),Mi(this,c[6]||"",!0),this.m=Kn(c[7]||"")):(this.l=!1,this.i=new Yn(null,this.l))}Et.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Qn(c,tc,!0),":");var d=this.g;return(d||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Qn(c,tc,!0),"@"),o.push(Hn(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Qn(d,d.charAt(0)=="/"?_f:yf,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Qn(d,Ef)),o.join("")},Et.prototype.resolve=function(o){const c=Qe(this);let d=!!o.j;d?Wn(c,o.j):d=!!o.o,d?c.o=o.o:d=!!o.g,d?c.g=o.g:d=o.u!=null;var p=o.h;if(d)Gn(c,o.u);else if(d=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var I=c.h.lastIndexOf("/");I!=-1&&(p=c.h.slice(0,I+1)+p)}if(I=p,I==".."||I==".")p="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){p=I.lastIndexOf("/",0)==0,I=I.split("/");const R=[];for(let V=0;V<I.length;){const z=I[V++];z=="."?p&&V==I.length&&R.push(""):z==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&V==I.length&&R.push("")):(R.push(z),p=!0)}p=R.join("/")}else p=I}return d?c.h=p:d=o.i.toString()!=="",d?Mi(c,oc(o.i)):d=!!o.m,d&&(c.m=o.m),c};function Qe(o){return new Et(o)}function Wn(o,c,d){o.j=d?Kn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Gn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function Mi(o,c,d){c instanceof Yn?(o.i=c,Tf(o.i,o.l)):(d||(c=Qn(c,vf)),o.i=new Yn(c,o.l))}function ne(o,c,d){o.i.set(c,d)}function Jr(o){return ne(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Kn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Qn(o,c,d){return typeof o=="string"?(o=encodeURI(o).replace(c,gf),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function gf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var tc=/[#\/\?@]/g,yf=/[#\?:]/g,_f=/[#\?]/g,vf=/[#\?@]/g,Ef=/#/g;function Yn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Wt(o){o.g||(o.g=new Map,o.h=0,o.i&&mf(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=Yn.prototype,n.add=function(o,c){Wt(this),this.i=null,o=un(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this};function nc(o,c){Wt(o),c=un(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function rc(o,c){return Wt(o),c=un(o,c),o.g.has(c)}n.forEach=function(o,c){Wt(this),this.g.forEach(function(d,p){d.forEach(function(I){o.call(c,I,p,this)},this)},this)};function sc(o,c){Wt(o);let d=[];if(typeof c=="string")rc(o,c)&&(d=d.concat(o.g.get(un(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)d=d.concat(o[c]);return d}n.set=function(o,c){return Wt(this),this.i=null,o=un(this,o),rc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=sc(this,o),o.length>0?String(o[0]):c):c};function ic(o,c,d){nc(o,c),d.length>0&&(o.i=null,o.g.set(un(o,c),b(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const I=Hn(d);d=sc(this,d);for(let R=0;R<d.length;R++){let V=I;d[R]!==""&&(V+="="+Hn(d[R])),o.push(V)}}return this.i=o.join("&")};function oc(o){const c=new Yn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function un(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Tf(o,c){c&&!o.j&&(Wt(o),o.i=null,o.g.forEach(function(d,p){const I=p.toLowerCase();p!=I&&(nc(this,p),ic(this,I,d))},o)),o.j=c}function wf(o,c){const d=new jn;if(a.Image){const p=new Image;p.onload=f(Tt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=f(Tt,d,"TestLoadImage: error",!1,c,p),p.onabort=f(Tt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(Tt,d,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function If(o,c){const d=new jn,p=new AbortController,I=setTimeout(()=>{p.abort(),Tt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(I),R.ok?Tt(d,"TestPingServer: ok",!0,c):Tt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(I),Tt(d,"TestPingServer: error",!1,c)})}function Tt(o,c,d,p,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),p(d)}catch{}}function Af(){this.g=new of}function xi(o){this.i=o.Sb||null,this.h=o.ab||!1}m(xi,Ma),xi.prototype.g=function(){return new Zr(this.i,this.h)};function Zr(o,c){be.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Zr,be),n=Zr.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Jn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xn(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Jn(this)),this.g&&(this.readyState=3,Jn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ac(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function ac(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Xn(this):Jn(this),this.readyState==3&&ac(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Xn(this))},n.Na=function(o){this.g&&(this.response=o,Xn(this))},n.ga=function(){this.g&&Xn(this)};function Xn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Jn(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=c.next();return o.join(`\r
`)};function Jn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Zr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function cc(o){let c="";return _t(o,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function Ui(o,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=cc(d),typeof o=="string"?d!=null&&Hn(d):ne(o,c,d))}function ae(o){be.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ae,be);var bf=/^https?$/i,Rf=["POST","PUT"];n=ae.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ja.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){lc(this,R);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var I in p)d.set(I,p[I]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())d.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),I=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Rf,c,void 0)>=0)||p||I||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,V]of d)this.g.setRequestHeader(R,V);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){lc(this,R)}};function lc(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,uc(o),es(o)}function uc(o){o.A||(o.A=!0,ke(o,"complete"),ke(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,ke(this,"complete"),ke(this,"abort"),es(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),es(this,!0)),ae.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?hc(this):this.Xa())},n.Xa=function(){hc(this)};function hc(o){if(o.h&&typeof i<"u"){if(o.v&&wt(o)==4)setTimeout(o.Ca.bind(o),0);else if(ke(o,"readystatechange"),wt(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=R===0){let V=String(o.D).match(ec)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),p=!bf.test(V?V.toLowerCase():"")}d=p}if(d)ke(o,"complete"),ke(o,"success");else{o.o=6;try{var I=wt(o)>2?o.g.statusText:""}catch{I=""}o.l=I+" ["+o.ca()+"]",uc(o)}}finally{es(o)}}}}function es(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,c||ke(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function wt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return wt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),sf(c)}};function dc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Sf(o){const c={};o=(o.g&&wt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(_(o[p]))continue;var d=hf(o[p]);const I=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const R=c[I]||[];c[I]=R,R.push(d)}Wr(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zn(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function fc(o){this.za=0,this.i=[],this.j=new jn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Zn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Zn("baseRetryDelayMs",5e3,o),this.Za=Zn("retryDelaySeedMs",1e4,o),this.Ta=Zn("forwardChannelMaxRetries",2,o),this.va=Zn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Qa(o&&o.concurrentRequestLimit),this.Ba=new Af,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=fc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,d,p){Ne(0),this.W=o,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=wc(this,null,this.W),ns(this)};function Fi(o){if(pc(o),o.I==3){var c=o.V++,d=Qe(o.J);if(ne(d,"SID",o.M),ne(d,"RID",c),ne(d,"TYPE","terminate"),er(o,d),c=new vt(o,o.j,c),c.M=2,c.A=Jr(Qe(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=c.A,d=!0),d||(c.g=Ic(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Xr(c)}Tc(o)}function ts(o){o.g&&($i(o),o.g.cancel(),o.g=null)}function pc(o){ts(o),o.v&&(a.clearTimeout(o.v),o.v=null),rs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function ns(o){if(!Ya(o.h)&&!o.m){o.m=!0;var c=o.Ea;Y||g(),F||(Y(),F=!0),E.add(c,o),o.D=0}}function Pf(o,c){return Xa(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=qn(h(o.Ea,o,c),Ec(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const I=new vt(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Un(R),Pa(R,this.U)):R=this.U),this.u!==null||this.R||(I.J=R,R=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=gc(this,I,c),d=Qe(this.J),ne(d,"RID",o),ne(d,"CVER",22),this.G&&ne(d,"X-HTTP-Session-Id",this.G),er(this,d),R&&(this.R?c="headers="+Hn(cc(R))+"&"+c:this.u&&Ui(d,this.u,R)),Li(this.h,I),this.Ra&&ne(d,"TYPE","init"),this.S?(ne(d,"$req",c),ne(d,"SID","null"),I.U=!0,Ni(I,d,null)):Ni(I,d,c),this.I=2}}else this.I==3&&(o?mc(this,o):this.i.length==0||Ya(this.h)||mc(this))};function mc(o,c){var d;c?d=c.l:d=o.V++;const p=Qe(o.J);ne(p,"SID",o.M),ne(p,"RID",d),ne(p,"AID",o.K),er(o,p),o.u&&o.o&&Ui(p,o.u,o.o),d=new vt(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),c&&(o.i=c.G.concat(o.i)),c=gc(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Li(o.h,d),Ni(d,p,c)}function er(o,c){o.H&&_t(o.H,function(d,p){ne(c,p,d)}),o.l&&_t({},function(d,p){ne(c,p,d)})}function gc(o,c,d){d=Math.min(o.i.length,d);const p=o.l?h(o.l.Ka,o.l,o):null;e:{var I=o.i;let z=-1;for(;;){const pe=["count="+d];z==-1?d>0?(z=I[0].g,pe.push("ofs="+z)):z=0:pe.push("ofs="+z);let Z=!0;for(let ve=0;ve<d;ve++){var R=I[ve].g;const Ye=I[ve].map;if(R-=z,R<0)z=Math.max(0,I[ve].g-100),Z=!1;else try{R="req"+R+"_"||"";try{var V=Ye instanceof Map?Ye:Object.entries(Ye);for(const[Kt,It]of V){let At=It;l(It)&&(At=Ri(It)),pe.push(R+Kt+"="+encodeURIComponent(At))}}catch(Kt){throw pe.push(R+"type="+encodeURIComponent("_badmap")),Kt}}catch{p&&p(Ye)}}if(Z){V=pe.join("&");break e}}V=void 0}return o=o.i.splice(0,d),c.G=o,V}function yc(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;Y||g(),F||(Y(),F=!0),E.add(c,o),o.A=0}}function Bi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=qn(h(o.Da,o),Ec(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,_c(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=qn(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),ts(this),_c(this))};function $i(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function _c(o){o.g=new vt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=Qe(o.na);ne(c,"RID","rpc"),ne(c,"SID",o.M),ne(c,"AID",o.K),ne(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&ne(c,"TO",o.ia),ne(c,"TYPE","xmlhttp"),er(o,c),o.u&&o.o&&Ui(c,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=Jr(Qe(c)),d.u=null,d.R=!0,Wa(d,o)}n.Va=function(){this.C!=null&&(this.C=null,ts(this),Bi(this),Ne(19))};function rs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function vc(o,c){var d=null;if(o.g==c){rs(o),$i(o),o.g=null;var p=2}else if(Oi(o.h,c))d=c.G,Ja(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var I=o.D;p=Qr(),ke(p,new $a(p,d)),ns(o)}else yc(o);else if(I=c.m,I==3||I==0&&c.X>0||!(p==1&&Pf(o,c)||p==2&&Bi(o)))switch(d&&d.length>0&&(c=o.h,c.i=c.i.concat(d)),I){case 1:Gt(o,5);break;case 4:Gt(o,10);break;case 3:Gt(o,6);break;default:Gt(o,2)}}}function Ec(o,c){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*c}function Gt(o,c){if(o.j.info("Error code "+c),c==2){var d=h(o.bb,o),p=o.Ua;const I=!p;p=new Et(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Wn(p,"https"),Jr(p),I?wf(p.toString(),d):If(p.toString(),d)}else Ne(2);o.I=0,o.l&&o.l.pa(c),Tc(o),pc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function Tc(o){if(o.I=0,o.ja=[],o.l){const c=Za(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ja,c),D(o.ja,o.i),o.h.i.length=0,b(o.i),o.i.length=0),o.l.oa()}}function wc(o,c,d){var p=d instanceof Et?Qe(d):new Et(d);if(p.g!="")c&&(p.g=c+"."+p.g),Gn(p,p.u);else{var I=a.location;p=I.protocol,c=c?c+"."+I.hostname:I.hostname,I=+I.port;const R=new Et(null);p&&Wn(R,p),c&&(R.g=c),I&&Gn(R,I),d&&(R.h=d),p=R}return d=o.G,c=o.wa,d&&c&&ne(p,d,c),ne(p,"VER",o.ka),er(o,p),p}function Ic(o,c,d){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new ae(new xi({ab:d})):new ae(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ac(){}n=Ac.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ss(){}ss.prototype.g=function(o,c){return new Me(o,c)};function Me(o,c){be.call(this),this.g=new fc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new hn(this)}m(Me,be),Me.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Me.prototype.close=function(){Fi(this.g)},Me.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=Ri(o),o=d);c.i.push(new pf(c.Ya++,o)),c.I==3&&ns(c)},Me.prototype.N=function(){this.g.l=null,delete this.j,Fi(this.g),delete this.g,Me.Z.N.call(this)};function bc(o){Si.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const d in c){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}m(bc,Si);function Rc(){Pi.call(this),this.status=1}m(Rc,Pi);function hn(o){this.g=o}m(hn,Ac),hn.prototype.ra=function(){ke(this.g,"a")},hn.prototype.qa=function(o){ke(this.g,new bc(o))},hn.prototype.pa=function(o){ke(this.g,new Rc)},hn.prototype.oa=function(){ke(this.g,"b")},ss.prototype.createWebChannel=ss.prototype.g,Me.prototype.send=Me.prototype.o,Me.prototype.open=Me.prototype.m,Me.prototype.close=Me.prototype.close,oh=function(){return new ss},ih=function(){return Qr()},sh=Ht,uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Yr.NO_ERROR=0,Yr.TIMEOUT=8,Yr.HTTP_ERROR=6,gs=Yr,qa.COMPLETE="complete",rh=qa,xa.EventType=Bn,Bn.OPEN="a",Bn.CLOSE="b",Bn.ERROR="c",Bn.MESSAGE="d",be.prototype.listen=be.prototype.J,sr=xa,ae.prototype.listenOnce=ae.prototype.K,ae.prototype.getLastError=ae.prototype.Ha,ae.prototype.getLastErrorCode=ae.prototype.ya,ae.prototype.getStatus=ae.prototype.ca,ae.prototype.getResponseJson=ae.prototype.La,ae.prototype.getResponseText=ae.prototype.la,ae.prototype.send=ae.prototype.ea,ae.prototype.setWithCredentials=ae.prototype.Fa,nh=ae}).apply(typeof as<"u"?as:typeof self<"u"?self:typeof window<"u"?window:{});const sl="@firebase/firestore",il="4.9.3";class Se{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Se.UNAUTHENTICATED=new Se(null),Se.GOOGLE_CREDENTIALS=new Se("google-credentials-uid"),Se.FIRST_PARTY=new Se("first-party-uid"),Se.MOCK_USER=new Se("mock-user");let Dn="12.7.0";const rn=new Co("@firebase/firestore");function dn(){return rn.logLevel}function M(n,...e){if(rn.logLevel<=W.DEBUG){const t=e.map(jo);rn.debug(`Firestore (${Dn}): ${n}`,...t)}}function pt(n,...e){if(rn.logLevel<=W.ERROR){const t=e.map(jo);rn.error(`Firestore (${Dn}): ${n}`,...t)}}function In(n,...e){if(rn.logLevel<=W.WARN){const t=e.map(jo);rn.warn(`Firestore (${Dn}): ${n}`,...t)}}function jo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function q(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,ah(n,r,t)}function ah(n,e,t){let r=`FIRESTORE (${Dn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw pt(r),new Error(r)}function X(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||ah(e,s,r)}function H(n,e){return n}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends gt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ht{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ch{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Vy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Se.UNAUTHENTICATED)))}shutdown(){}}class Oy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ly{constructor(e){this.t=e,this.currentUser=Se.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){X(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new ht;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ht,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ht)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(X(typeof r.accessToken=="string",31837,{l:r}),new ch(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return X(e===null||typeof e=="string",2055,{h:e}),new Se(e)}}class My{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Se.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class xy{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new My(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Se.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ol{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Uy{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ue(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){X(this.o===void 0,3512);const r=i=>{i.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,M("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ol(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(X(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ol(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Fy(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Ho{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Fy(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function G(n,e){return n<e?-1:n>e?1:0}function ho(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Yi(s)===Yi(i)?G(s,i):Yi(s)?1:-1}return G(n.length,e.length)}const By=55296,$y=57343;function Yi(n){const e=n.charCodeAt(0);return e>=By&&e<=$y}function An(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const al="__name__";class Xe{constructor(e,t,r){t===void 0?t=0:t>e.length&&q(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&q(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Xe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xe?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Xe.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return G(e.length,t.length)}static compareSegments(e,t){const r=Xe.isNumericId(e),s=Xe.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Xe.extractNumericId(e).compare(Xe.extractNumericId(t)):ho(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}}class ee extends Xe{construct(e,t,r){return new ee(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ee(t)}static emptyPath(){return new ee([])}}const qy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class we extends Xe{construct(e,t,r){return new we(e,t,r)}static isValidIdentifier(e){return qy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),we.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===al}static keyField(){return new we([al])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new L(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new L(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new L(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new L(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new we(t)}static emptyPath(){return new we([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(ee.fromString(e))}static fromName(e){return new B(ee.fromString(e).popFirst(5))}static empty(){return new B(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ee.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new ee(e.slice()))}}function lh(n,e,t){if(!t)throw new L(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function jy(n,e,t,r){if(e===!0&&r===!0)throw new L(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function cl(n){if(!B.isDocumentKey(n))throw new L(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ll(n){if(B.isDocumentKey(n))throw new L(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function uh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Qs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":q(12329,{type:typeof n})}function We(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Qs(n);throw new L(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Hy(n,e){if(e<=0)throw new L(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ur(n,e){if(!uh(n))throw new L(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new L(S.INVALID_ARGUMENT,t);return!0}const ul=-62135596800,hl=1e6;class re{static now(){return re.fromMillis(Date.now())}static fromDate(e){return re.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*hl);return new re(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ul)throw new L(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hl}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:re._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ur(e,re._jsonSchema))return new re(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ul;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}re._jsonSchemaVersion="firestore/timestamp/1.0",re._jsonSchema={type:fe("string",re._jsonSchemaVersion),seconds:fe("number"),nanoseconds:fe("number")};class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new re(0,0))}static max(){return new j(new re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Er=-1;function zy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=j.fromTimestamp(r===1e9?new re(t+1,0):new re(t,r));return new Lt(s,B.empty(),e)}function Wy(n){return new Lt(n.readTime,n.key,Er)}class Lt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Lt(j.min(),B.empty(),Er)}static max(){return new Lt(j.max(),B.empty(),Er)}}function Gy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}const Ky="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Vn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==Ky)throw n;M("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const h=u;t(e[h]).next((f=>{a[h]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new P(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function Yy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function On(n){return n.name==="IndexedDbTransactionError"}class Ys{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ys.ce=-1;const zo=-1;function Xs(n){return n==null}function Vs(n){return n===0&&1/n==-1/0}function Xy(n){return typeof n=="number"&&Number.isInteger(n)&&!Vs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const hh="";function Jy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=dl(e)),e=Zy(n.get(t),e);return dl(e)}function Zy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case hh:t+="";break;default:t+=i}}return t}function dl(n){return n+hh+""}function fl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $t(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class oe{constructor(e,t){this.comparator=e,this.root=t||Te.EMPTY}insert(e,t){return new oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Te.BLACK,null,null))}remove(e){return new oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Te.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cs(this.root,e,this.comparator,!1)}getReverseIterator(){return new cs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cs(this.root,e,this.comparator,!0)}}class cs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Te{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Te.RED,this.left=s??Te.EMPTY,this.right=i??Te.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Te(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Te.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Te.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Te.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Te.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}}Te.EMPTY=null,Te.RED=!0,Te.BLACK=!1;Te.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Te(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ge{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pl(this.data.getIterator())}getIteratorFrom(e){return new pl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ge)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ge(this.comparator);return t.data=e,t}}class pl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fe{constructor(e){this.fields=e,e.sort(we.comparator)}static empty(){return new Fe([])}unionWith(e){let t=new ge(we.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Fe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return An(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class fh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new fh("Invalid base64 string: "+i):i}})(e);return new Ie(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const e_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mt(n){if(X(!!n,39018),typeof n=="string"){let e=0;const t=e_.exec(n);if(X(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:le(n.seconds),nanos:le(n.nanos)}}function le(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xt(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}const ph="server_timestamp",mh="__type__",gh="__previous_value__",yh="__local_write_time__";function Wo(n){return(n?.mapValue?.fields||{})[mh]?.stringValue===ph}function Js(n){const e=n.mapValue.fields[gh];return Wo(e)?Js(e):e}function Tr(n){const e=Mt(n.mapValue.fields[yh].timestampValue);return new re(e.seconds,e.nanos)}class t_{constructor(e,t,r,s,i,a,l,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}}const Os="(default)";class wr{constructor(e,t){this.projectId=e,this.database=t||Os}static empty(){return new wr("","")}get isDefaultDatabase(){return this.database===Os}isEqual(e){return e instanceof wr&&e.projectId===this.projectId&&e.database===this.database}}const _h="__type__",n_="__max__",ls={mapValue:{}},vh="__vector__",Ls="value";function Ut(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Wo(n)?4:s_(n)?9007199254740991:r_(n)?10:11:q(28295,{value:n})}function rt(n,e){if(n===e)return!0;const t=Ut(n);if(t!==Ut(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Tr(n).isEqual(Tr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Mt(s.timestampValue),l=Mt(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return xt(s.bytesValue).isEqual(xt(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return le(s.geoPointValue.latitude)===le(i.geoPointValue.latitude)&&le(s.geoPointValue.longitude)===le(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return le(s.integerValue)===le(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=le(s.doubleValue),l=le(i.doubleValue);return a===l?Vs(a)===Vs(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return An(n.arrayValue.values||[],e.arrayValue.values||[],rt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(fl(a)!==fl(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!rt(a[u],l[u])))return!1;return!0})(n,e);default:return q(52216,{left:n})}}function Ir(n,e){return(n.values||[]).find((t=>rt(t,e)))!==void 0}function bn(n,e){if(n===e)return 0;const t=Ut(n),r=Ut(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=le(i.integerValue||i.doubleValue),u=le(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return ml(n.timestampValue,e.timestampValue);case 4:return ml(Tr(n),Tr(e));case 5:return ho(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=xt(i),u=xt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){const f=G(l[h],u[h]);if(f!==0)return f}return G(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=G(le(i.latitude),le(a.latitude));return l!==0?l:G(le(i.longitude),le(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return gl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},h=l[Ls]?.arrayValue,f=u[Ls]?.arrayValue,m=G(h?.values?.length||0,f?.values?.length||0);return m!==0?m:gl(h,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===ls.mapValue&&a===ls.mapValue)return 0;if(i===ls.mapValue)return 1;if(a===ls.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const y=ho(u[m],f[m]);if(y!==0)return y;const b=bn(l[u[m]],h[f[m]]);if(b!==0)return b}return G(u.length,f.length)})(n.mapValue,e.mapValue);default:throw q(23264,{he:t})}}function ml(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);const t=Mt(n),r=Mt(e),s=G(t.seconds,r.seconds);return s!==0?s:G(t.nanos,r.nanos)}function gl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=bn(t[s],r[s]);if(i)return i}return G(t.length,r.length)}function Rn(n){return fo(n)}function fo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Mt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return xt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=fo(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${fo(t.fields[a])}`;return s+"}"})(n.mapValue):q(61005,{value:n})}function ys(n){switch(Ut(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Js(n);return e?16+ys(e):16;case 5:return 2*n.stringValue.length;case 6:return xt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+ys(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return $t(r.fields,((i,a)=>{s+=i.length+ys(a)})),s})(n.mapValue);default:throw q(13486,{value:n})}}function yl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function po(n){return!!n&&"integerValue"in n}function Go(n){return!!n&&"arrayValue"in n}function _l(n){return!!n&&"nullValue"in n}function vl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function _s(n){return!!n&&"mapValue"in n}function r_(n){return(n?.mapValue?.fields||{})[_h]?.stringValue===vh}function ur(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return $t(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=ur(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ur(n.arrayValue.values[t]);return e}return{...n}}function s_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===n_}class Oe{constructor(e){this.value=e}static empty(){return new Oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!_s(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ur(t)}setAll(e){let t=we.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=ur(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());_s(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];_s(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){$t(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Oe(ur(this.value))}}function Eh(n){const e=[];return $t(n.fields,((t,r)=>{const s=new we([t]);if(_s(r)){const i=Eh(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Fe(e)}class Pe{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Pe(e,0,j.min(),j.min(),j.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,s){return new Pe(e,1,t,j.min(),r,s,0)}static newNoDocument(e,t){return new Pe(e,2,t,j.min(),j.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new Pe(e,3,t,j.min(),j.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ms{constructor(e,t){this.position=e,this.inclusive=t}}function El(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=bn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Tl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!rt(n.position[t],e.position[t]))return!1;return!0}class Ar{constructor(e,t="asc"){this.field=e,this.dir=t}}function i_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Th{}class de extends Th{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new a_(e,t,r):t==="array-contains"?new u_(e,r):t==="in"?new h_(e,r):t==="not-in"?new d_(e,r):t==="array-contains-any"?new f_(e,r):new de(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new c_(e,r):new l_(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(bn(t,this.value)):t!==null&&Ut(this.value)===Ut(t)&&this.matchesComparison(bn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends Th{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ge(e,t)}matches(e){return wh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function wh(n){return n.op==="and"}function Ih(n){return o_(n)&&wh(n)}function o_(n){for(const e of n.filters)if(e instanceof Ge)return!1;return!0}function mo(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+Rn(n.value);if(Ih(n))return n.filters.map((e=>mo(e))).join(",");{const e=n.filters.map((t=>mo(t))).join(",");return`${n.op}(${e})`}}function Ah(n,e){return n instanceof de?(function(r,s){return s instanceof de&&r.op===s.op&&r.field.isEqual(s.field)&&rt(r.value,s.value)})(n,e):n instanceof Ge?(function(r,s){return s instanceof Ge&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&Ah(a,s.filters[l])),!0):!1})(n,e):void q(19439)}function bh(n){return n instanceof de?(function(t){return`${t.field.canonicalString()} ${t.op} ${Rn(t.value)}`})(n):n instanceof Ge?(function(t){return t.op.toString()+" {"+t.getFilters().map(bh).join(" ,")+"}"})(n):"Filter"}class a_ extends de{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class c_ extends de{constructor(e,t){super(e,"in",t),this.keys=Rh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class l_ extends de{constructor(e,t){super(e,"not-in",t),this.keys=Rh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Rh(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class u_ extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Go(t)&&Ir(t.arrayValue,this.value)}}class h_ extends de{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ir(this.value.arrayValue,t)}}class d_ extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ir(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ir(this.value.arrayValue,t)}}class f_ extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Go(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ir(this.value.arrayValue,r)))}}class p_{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function wl(n,e=null,t=[],r=[],s=null,i=null,a=null){return new p_(n,e,t,r,s,i,a)}function Ko(n){const e=H(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>mo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Xs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Rn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Rn(r))).join(",")),e.Te=t}return e.Te}function Qo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!i_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ah(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Tl(n.startAt,e.startAt)&&Tl(n.endAt,e.endAt)}function go(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Ln{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function m_(n,e,t,r,s,i,a,l){return new Ln(n,e,t,r,s,i,a,l)}function Yo(n){return new Ln(n)}function Il(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sh(n){return n.collectionGroup!==null}function hr(n){const e=H(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ge(we.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Ar(i,r))})),t.has(we.keyField().canonicalString())||e.Ie.push(new Ar(we.keyField(),r))}return e.Ie}function Ze(n){const e=H(n);return e.Ee||(e.Ee=g_(e,hr(n))),e.Ee}function g_(n,e){if(n.limitType==="F")return wl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Ar(s.field,i)}));const t=n.endAt?new Ms(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ms(n.startAt.position,n.startAt.inclusive):null;return wl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function yo(n,e){const t=n.filters.concat([e]);return new Ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function xs(n,e,t){return new Ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zs(n,e){return Qo(Ze(n),Ze(e))&&n.limitType===e.limitType}function Ph(n){return`${Ko(Ze(n))}|lt:${n.limitType}`}function fn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>bh(s))).join(", ")}]`),Xs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Rn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Rn(s))).join(",")),`Target(${r})`})(Ze(n))}; limitType=${n.limitType})`}function ei(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):B.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of hr(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const h=El(a,l,u);return a.inclusive?h<=0:h<0})(r.startAt,hr(r),s)||r.endAt&&!(function(a,l,u){const h=El(a,l,u);return a.inclusive?h>=0:h>0})(r.endAt,hr(r),s))})(n,e)}function y_(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ch(n){return(e,t)=>{let r=!1;for(const s of hr(n)){const i=__(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function __(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),h=l.data.field(i);return u!==null&&h!==null?bn(u,h):q(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return q(19790,{direction:n.dir})}}class on{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){$t(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return dh(this.inner)}size(){return this.innerSize}}const v_=new oe(B.comparator);function mt(){return v_}const kh=new oe(B.comparator);function ir(...n){let e=kh;for(const t of n)e=e.insert(t.key,t);return e}function Nh(n){let e=kh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Xt(){return dr()}function Dh(){return dr()}function dr(){return new on((n=>n.toString()),((n,e)=>n.isEqual(e)))}const E_=new oe(B.comparator),T_=new ge(B.comparator);function K(...n){let e=T_;for(const t of n)e=e.add(t);return e}const w_=new ge(G);function I_(){return w_}function Xo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vs(e)?"-0":e}}function Vh(n){return{integerValue:""+n}}function Oh(n,e){return Xy(e)?Vh(e):Xo(n,e)}class ti{constructor(){this._=void 0}}function A_(n,e,t){return n instanceof br?(function(s,i){const a={fields:{[mh]:{stringValue:ph},[yh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Wo(i)&&(i=Js(i)),i&&(a.fields[gh]=i),{mapValue:a}})(t,e):n instanceof Rr?Mh(n,e):n instanceof Sr?xh(n,e):(function(s,i){const a=Lh(s,i),l=Al(a)+Al(s.Ae);return po(a)&&po(s.Ae)?Vh(l):Xo(s.serializer,l)})(n,e)}function b_(n,e,t){return n instanceof Rr?Mh(n,e):n instanceof Sr?xh(n,e):t}function Lh(n,e){return n instanceof Pr?(function(r){return po(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class br extends ti{}class Rr extends ti{constructor(e){super(),this.elements=e}}function Mh(n,e){const t=Uh(e);for(const r of n.elements)t.some((s=>rt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Sr extends ti{constructor(e){super(),this.elements=e}}function xh(n,e){let t=Uh(e);for(const r of n.elements)t=t.filter((s=>!rt(s,r)));return{arrayValue:{values:t}}}class Pr extends ti{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Al(n){return le(n.integerValue||n.doubleValue)}function Uh(n){return Go(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Fh{constructor(e,t){this.field=e,this.transform=t}}function R_(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Rr&&s instanceof Rr||r instanceof Sr&&s instanceof Sr?An(r.elements,s.elements,rt):r instanceof Pr&&s instanceof Pr?rt(r.Ae,s.Ae):r instanceof br&&s instanceof br})(n.transform,e.transform)}class S_{constructor(e,t){this.version=e,this.transformResults=t}}class Le{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Le}static exists(e){return new Le(void 0,e)}static updateTime(e){return new Le(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ni{}function Bh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ri(n.key,Le.none()):new Fr(n.key,n.data,Le.none());{const t=n.data,r=Oe.empty();let s=new ge(we.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new qt(n.key,r,new Fe(s.toArray()),Le.none())}}function P_(n,e,t){n instanceof Fr?(function(s,i,a){const l=s.value.clone(),u=Rl(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof qt?(function(s,i,a){if(!vs(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=Rl(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll($h(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function fr(n,e,t,r){return n instanceof Fr?(function(i,a,l,u){if(!vs(i.precondition,a))return l;const h=i.value.clone(),f=Sl(i.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof qt?(function(i,a,l,u){if(!vs(i.precondition,a))return l;const h=Sl(i.fieldTransforms,u,a),f=a.data;return f.setAll($h(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,l){return vs(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function C_(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Lh(r.transform,s||null);i!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,i))}return t||null}function bl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&An(r,s,((i,a)=>R_(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fr extends ni{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class qt extends ni{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function $h(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Rl(n,e,t){const r=new Map;X(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,b_(a,l,t[s]))}return r}function Sl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,A_(i,a,e))}return r}class ri extends ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class k_ extends ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class N_{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&P_(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=fr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=fr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Dh();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Bh(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(j.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),K())}isEqual(e){return this.batchId===e.batchId&&An(this.mutations,e.mutations,((t,r)=>bl(t,r)))&&An(this.baseMutations,e.baseMutations,((t,r)=>bl(t,r)))}}class Jo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){X(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return E_})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Jo(e,t,r,s)}}class D_{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class V_{constructor(e,t){this.count=e,this.unchangedNames=t}}var he,Q;function O_(n){switch(n){case S.OK:return q(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return q(15467,{code:n})}}function qh(n){if(n===void 0)return pt("GRPC error has no .code"),S.UNKNOWN;switch(n){case he.OK:return S.OK;case he.CANCELLED:return S.CANCELLED;case he.UNKNOWN:return S.UNKNOWN;case he.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case he.INTERNAL:return S.INTERNAL;case he.UNAVAILABLE:return S.UNAVAILABLE;case he.UNAUTHENTICATED:return S.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case he.NOT_FOUND:return S.NOT_FOUND;case he.ALREADY_EXISTS:return S.ALREADY_EXISTS;case he.PERMISSION_DENIED:return S.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case he.ABORTED:return S.ABORTED;case he.OUT_OF_RANGE:return S.OUT_OF_RANGE;case he.UNIMPLEMENTED:return S.UNIMPLEMENTED;case he.DATA_LOSS:return S.DATA_LOSS;default:return q(39323,{code:n})}}(Q=he||(he={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";function L_(){return new TextEncoder}const M_=new Vt([4294967295,4294967295],0);function Pl(n){const e=L_().encode(n),t=new th;return t.update(e),new Uint8Array(t.digest())}function Cl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Vt([t,r],0),new Vt([s,i],0)]}class Zo{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new or(`Invalid padding: ${t}`);if(r<0)throw new or(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new or(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new or(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Vt.fromNumber(r)));return s.compare(M_)===1&&(s=new Vt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Pl(e),[r,s]=Cl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Zo(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Pl(e),[r,s]=Cl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class or extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class si{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Br.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new si(j.min(),s,new oe(G),mt(),K())}}class Br{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Br(r,t,K(),K(),K())}}class Es{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class jh{constructor(e,t){this.targetId=e,this.Ce=t}}class Hh{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class kl{constructor(){this.ve=0,this.Fe=Nl(),this.Me=Ie.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=K(),t=K(),r=K();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:q(38017,{changeType:i})}})),new Br(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Nl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,X(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class x_{constructor(e){this.Ge=e,this.ze=new Map,this.je=mt(),this.Je=us(),this.He=us(),this.Ye=new oe(G)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(go(i))if(r===0){const a=new B(i.path);this.et(t,a,Pe.newNoDocument(a,j.min()))}else X(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=xt(r).toUint8Array()}catch(u){if(u instanceof fh)return In("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Zo(a,s,i)}catch(u){return In(u instanceof or?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&go(l.target)){const u=new B(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Pe.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=K();this.He.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new si(e,t,this.Ye,this.je,r);return this.je=mt(),this.Je=us(),this.He=us(),this.Ye=new oe(G),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new kl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ge(G),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ge(G),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new kl),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function us(){return new oe(B.comparator)}function Nl(){return new oe(B.comparator)}const U_={asc:"ASCENDING",desc:"DESCENDING"},F_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},B_={and:"AND",or:"OR"};class $_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _o(n,e){return n.useProto3Json||Xs(e)?e:{value:e}}function Us(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function q_(n,e){return Us(n,e.toTimestamp())}function et(n){return X(!!n,49232),j.fromTimestamp((function(t){const r=Mt(t);return new re(r.seconds,r.nanos)})(n))}function ea(n,e){return vo(n,e).canonicalString()}function vo(n,e){const t=(function(s){return new ee(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Wh(n){const e=ee.fromString(n);return X(Xh(e),10190,{key:e.toString()}),e}function Eo(n,e){return ea(n.databaseId,e.path)}function Xi(n,e){const t=Wh(e);if(t.get(1)!==n.databaseId.projectId)throw new L(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(Kh(t))}function Gh(n,e){return ea(n.databaseId,e)}function j_(n){const e=Wh(n);return e.length===4?ee.emptyPath():Kh(e)}function To(n){return new ee(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Kh(n){return X(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Dl(n,e,t){return{name:Eo(n,e),fields:t.value.mapValue.fields}}function H_(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:q(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(h,f){return h.useProto3Json?(X(f===void 0||typeof f=="string",58123),Ie.fromBase64String(f||"")):(X(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ie.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(h){const f=h.code===void 0?S.UNKNOWN:qh(h.code);return new L(f,h.message||"")})(a);t=new Hh(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Xi(n,r.document.name),i=et(r.document.updateTime),a=r.document.createTime?et(r.document.createTime):j.min(),l=new Oe({mapValue:{fields:r.document.fields}}),u=Pe.newFoundDocument(s,i,a,l),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Es(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Xi(n,r.document),i=r.readTime?et(r.readTime):j.min(),a=Pe.newNoDocument(s,i),l=r.removedTargetIds||[];t=new Es([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Xi(n,r.document),i=r.removedTargetIds||[];t=new Es([],i,s,null)}else{if(!("filter"in e))return q(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new V_(s,i),l=r.targetId;t=new jh(l,a)}}return t}function z_(n,e){let t;if(e instanceof Fr)t={update:Dl(n,e.key,e.value)};else if(e instanceof ri)t={delete:Eo(n,e.key)};else if(e instanceof qt)t={update:Dl(n,e.key,e.data),updateMask:ev(e.fieldMask)};else{if(!(e instanceof k_))return q(16599,{Vt:e.type});t={verify:Eo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof br)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Rr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Sr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Pr)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw q(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:q_(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:q(27497)})(n,e.precondition)),t}function W_(n,e){return n&&n.length>0?(X(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?et(s.updateTime):et(i);return a.isEqual(j.min())&&(a=et(i)),new S_(a,s.transformResults||[])})(t,e)))):[]}function G_(n,e){return{documents:[Gh(n,e.path)]}}function K_(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Gh(n,s);const i=(function(h){if(h.length!==0)return Yh(Ge.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(h){if(h.length!==0)return h.map((f=>(function(y){return{field:pn(y.field),direction:X_(y.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=_o(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:s}}function Q_(n){let e=j_(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){X(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const y=Qh(m);return y instanceof Ge&&Ih(y)?y.getFilters():[y]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((y=>(function(D){return new Ar(mn(D.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(y)))})(t.orderBy));let l=null;t.limit&&(l=(function(m){let y;return y=typeof m=="object"?m.value:m,Xs(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(m){const y=!!m.before,b=m.values||[];return new Ms(b,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){const y=!m.before,b=m.values||[];return new Ms(b,y)})(t.endAt)),m_(e,s,a,i,l,"F",u,h)}function Y_(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Qh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=mn(t.unaryFilter.field);return de.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=mn(t.unaryFilter.field);return de.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=mn(t.unaryFilter.field);return de.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=mn(t.unaryFilter.field);return de.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}})(n):n.fieldFilter!==void 0?(function(t){return de.create(mn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ge.create(t.compositeFilter.filters.map((r=>Qh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return q(1026)}})(t.compositeFilter.op))})(n):q(30097,{filter:n})}function X_(n){return U_[n]}function J_(n){return F_[n]}function Z_(n){return B_[n]}function pn(n){return{fieldPath:n.canonicalString()}}function mn(n){return we.fromServerFormat(n.fieldPath)}function Yh(n){return n instanceof de?(function(t){if(t.op==="=="){if(vl(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NAN"}};if(_l(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(vl(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NAN"}};if(_l(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pn(t.field),op:J_(t.op),value:t.value}}})(n):n instanceof Ge?(function(t){const r=t.getFilters().map((s=>Yh(s)));return r.length===1?r[0]:{compositeFilter:{op:Z_(t.op),filters:r}}})(n):q(54877,{filter:n})}function ev(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Xh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Ct{constructor(e,t,r,s,i=j.min(),a=j.min(),l=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Ct(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class tv{constructor(e){this.yt=e}}function nv(n){const e=Q_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?xs(e,e.limit,"L"):e}class rv{constructor(){this.Cn=new sv}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Lt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Lt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class sv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ge(ee.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ge(ee.comparator)).toArray()}}const Vl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Jh=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(Jh,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class Sn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Sn(0)}static cr(){return new Sn(-1)}}const Ol="LruGarbageCollector",iv=1048576;function Ll([n,e],[t,r]){const s=G(n,t);return s===0?G(e,r):s}class ov{constructor(e){this.Ir=e,this.buffer=new ge(Ll),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ll(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class av{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){M(Ol,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){On(t)?M(Ol,"Ignoring IndexedDB error during garbage collection: ",t):await Vn(t)}await this.Vr(3e5)}))}}class cv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Ys.ce);const r=new ov(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Vl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,l,u,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,l=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(h=Date.now(),dn()<=W.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function lv(n,e){return new cv(n,e)}class uv{constructor(){this.changes=new on((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&fr(r.mutation,s,Fe.empty(),re.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,K()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=K()){const s=Xt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=ir();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Xt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,K())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=mt();const a=dr(),l=(function(){return dr()})();return t.forEach(((u,h)=>{const f=r.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof qt)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),fr(f.mutation,h,f.mutation.getFieldMask(),re.now())):a.set(h.key,Fe.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((h,f)=>a.set(h,f))),t.forEach(((h,f)=>l.set(h,new hv(f,a.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=dr();let s=new oe(((a,l)=>a-l)),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const h=t.get(u);if(h===null)return;let f=r.get(u)||Fe.empty();f=l.applyToLocalView(h,f),r.set(u,f);const m=(s.get(l.batchId)||K()).add(u);s=s.insert(l.batchId,m)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,f=u.value,m=Dh();f.forEach((y=>{if(!i.has(y)){const b=Bh(t.get(y),r.get(y));b!==null&&m.set(y,b),i=i.add(y)}})),a.push(this.documentOverlayCache.saveOverlays(e,h,m))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):P.resolve(Xt());let l=Er,u=i;return a.next((h=>P.forEach(h,((f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((y=>{u=u.insert(f,y)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,u,h,K()))).next((f=>({batchId:l,changes:Nh(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=ir();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=ir();return this.indexManager.getCollectionParents(e,i).next((l=>P.forEach(l,(u=>{const h=(function(m,y){return new Ln(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next((f=>{f.forEach(((m,y)=>{a=a.insert(m,y)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,h)=>{const f=h.getKey();a.get(f)===null&&(a=a.insert(f,Pe.newInvalidDocument(f)))}));let l=ir();return a.forEach(((u,h)=>{const f=i.get(u);f!==void 0&&fr(f.mutation,h,Fe.empty(),re.now()),ei(t,h)&&(l=l.insert(u,h))})),l}))}}class fv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:et(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:nv(s.bundledQuery),readTime:et(s.readTime)}})(t)),P.resolve()}}class pv{constructor(){this.overlays=new oe(B.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Xt();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Xt(),i=t.length+1,a=new B(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new oe(((h,f)=>h-f));const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=i.get(h.largestBatchId);f===null&&(f=Xt(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const l=Xt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>l.set(h,f))),!(l.size()>=s)););return P.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new D_(t,r));let i=this.qr.get(t);i===void 0&&(i=K(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class mv{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class ta{constructor(){this.Qr=new ge(Ee.$r),this.Ur=new ge(Ee.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Ee(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Ee(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new ee([])),r=new Ee(t,e),s=new Ee(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new ee([])),r=new Ee(t,e),s=new Ee(t,e+1);let i=K();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new Ee(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ee{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||G(e.Yr,t.Yr)}static Kr(e,t){return G(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class gv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ge(Ee.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new N_(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new Ee(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?zo:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ee(t,0),s=new Ee(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);i.push(l)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ge(G);return t.forEach((s=>{const i=new Ee(s,0),a=new Ee(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(l=>{r=r.add(l.Yr)}))})),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;B.isDocumentKey(i)||(i=i.child(""));const a=new Ee(new B(i),0);let l=new ge(G);return this.Zr.forEachWhile((u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(l=l.add(u.Yr)),!0)}),a),P.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){X(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,(s=>{const i=new Ee(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Ee(t,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class yv{constructor(e){this.ri=e,this.docs=(function(){return new oe(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Pe.newInvalidDocument(t))}getEntries(e,t){let r=mt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Pe.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=mt();const a=t.path,l=new B(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Gy(Wy(f),r)<=0||(s.has(f.key)||ei(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,r,s){q(9500)}ii(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new _v(this)}getSize(e){return P.resolve(this.size)}}class _v extends uv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class vv{constructor(e){this.persistence=e,this.si=new on((t=>Ko(t)),Qo),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.oi=0,this._i=new ta,this.targetCount=0,this.ai=Sn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Sn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class Zh{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ys(0),this.li=!1,this.li=!0,this.hi=new mv,this.referenceDelegate=e(this),this.Pi=new vv(this),this.indexManager=new rv,this.remoteDocumentCache=(function(s){return new yv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new tv(t),this.Ii=new fv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new gv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const s=new Ev(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return P.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Ev extends Qy{constructor(e){super(),this.currentSequenceNumber=e}}class na{constructor(e){this.persistence=e,this.Ri=new ta,this.Vi=null}static mi(e){return new na(e)}get fi(){if(this.Vi)return this.Vi;throw q(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,j.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Fs{constructor(e,t){this.persistence=e,this.pi=new on((r=>Jy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=lv(this,t)}static mi(e,t){return new Fs(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,i.removeEntry(a,j.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ys(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ra{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=K(),s=K();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ra(e,t.fromCache,r,s)}}class Tv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class wv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Kf()?8:Yy(Ce())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new Tv;return this.Ss(e,t,a).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(dn()<=W.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",fn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(dn()<=W.DEBUG&&M("QueryEngine","Query:",fn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(dn()<=W.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",fn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):P.resolve())}ys(e,t){if(Il(t))return P.resolve(null);let r=Ze(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=xs(t,null,"F"),r=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=K(...i);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const h=this.Ds(t,l);return this.Cs(t,h,a,u.readTime)?this.ys(e,xs(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,r,s){return Il(t)||s.isEqual(j.min())?P.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?P.resolve(null):(dn()<=W.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),fn(t)),this.vs(e,a,t,zy(s,Er)).next((l=>l)))}))}Ds(e,t){let r=new ge(Ch(e));return t.forEach(((s,i)=>{ei(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return dn()<=W.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",fn(t)),this.ps.getDocumentsMatchingQuery(e,t,Lt.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const sa="LocalStore",Iv=3e8;class Av{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new oe(G),this.xs=new on((i=>Ko(i)),Qo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function bv(n,e,t,r){return new Av(n,e,t,r)}async function ed(n,e){const t=H(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=K();for(const h of s){a.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}for(const h of i){l.push(h.batchId);for(const f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ls:h,removedBatchIds:a,addedBatchIds:l})))}))}))}function Rv(n,e){const t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,h,f){const m=h.batch,y=m.keys();let b=P.resolve();return y.forEach((D=>{b=b.next((()=>f.getEntry(u,D))).next((k=>{const C=h.docVersions.get(D);X(C!==null,48541),k.version.compareTo(C)<0&&(m.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))}))})),b.next((()=>l.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=K();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function td(n){const e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Sv(n,e){const t=H(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((f,m)=>{const y=s.get(m);if(!y)return;l.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(i,f.addedDocuments,m))));let b=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(Ie.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,r)),s=s.insert(m,b),(function(k,C,x){return k.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Iv?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0})(y,b,f)&&l.push(t.Pi.updateTargetData(i,b))}));let u=mt(),h=K();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(Pv(i,a,e.documentUpdates).next((f=>{u=f.ks,h=f.qs}))),!r.isEqual(j.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next((m=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return P.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,h))).next((()=>u))})).then((i=>(t.Ms=s,i)))}function Pv(n,e,t){let r=K(),s=K();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=mt();return t.forEach(((l,u)=>{const h=i.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(j.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):M(sa,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function Cv(n,e){const t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=zo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function kv(n,e){const t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,P.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new Ct(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function wo(n,e,t){const r=H(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!On(a))throw a;M(sa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Ml(n,e,t){const r=H(n);let s=j.min(),i=K();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,h,f){const m=H(u),y=m.xs.get(f);return y!==void 0?P.resolve(m.Ms.get(y)):m.Pi.getTargetData(h,f)})(r,a,Ze(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:j.min(),t?i:K()))).next((l=>(Nv(r,y_(e),l),{documents:l,Qs:i})))))}function Nv(n,e,t){let r=n.Os.get(e)||j.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class xl{constructor(){this.activeTargetIds=I_()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Dv{constructor(){this.Mo=new xl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new xl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Vv{Oo(e){}shutdown(){}}const Ul="ConnectivityMonitor";class Fl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){M(Ul,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){M(Ul,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let hs=null;function Io(){return hs===null?hs=(function(){return 268435456+Math.round(2147483648*Math.random())})():hs++,"0x"+hs.toString(16)}const Ji="RestConnection",Ov={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Lv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Os?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Io(),l=this.zo(e,t.toUriEncodedString());M(Ji,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:h}=new URL(l),f=Cn(h);return this.Jo(e,l,u,r,f).then((m=>(M(Ji,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw In(Ji,`RPC '${e}' ${a} failed with error: `,m,"url: ",l,"request:",r),m}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Dn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=Ov[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Mv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Re="WebChannelConnection";class xv extends Lv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Io();return new Promise(((l,u)=>{const h=new nh;h.setWithCredentials(!0),h.listenOnce(rh.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case gs.NO_ERROR:const m=h.getResponseJson();M(Re,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),l(m);break;case gs.TIMEOUT:M(Re,`RPC '${e}' ${a} timed out`),u(new L(S.DEADLINE_EXCEEDED,"Request time out"));break;case gs.HTTP_ERROR:const y=h.getStatus();if(M(Re,`RPC '${e}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let b=h.getResponseJson();Array.isArray(b)&&(b=b[0]);const D=b?.error;if(D&&D.status&&D.message){const k=(function(x){const N=x.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(N)>=0?N:S.UNKNOWN})(D.status);u(new L(k,D.message))}else u(new L(S.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new L(S.UNAVAILABLE,"Connection failed."));break;default:q(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{M(Re,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);M(Re,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Io(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=oh(),l=ih(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=i.join("");M(Re,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let y=!1,b=!1;const D=new Mv({Yo:C=>{b?M(Re,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(y||(M(Re,`Opening RPC '${e}' stream ${s} transport.`),m.open(),y=!0),M(Re,`RPC '${e}' stream ${s} sending:`,C),m.send(C))},Zo:()=>m.close()}),k=(C,x,N)=>{C.listen(x,(O=>{try{N(O)}catch(U){setTimeout((()=>{throw U}),0)}}))};return k(m,sr.EventType.OPEN,(()=>{b||(M(Re,`RPC '${e}' stream ${s} transport opened.`),D.o_())})),k(m,sr.EventType.CLOSE,(()=>{b||(b=!0,M(Re,`RPC '${e}' stream ${s} transport closed`),D.a_(),this.E_(m))})),k(m,sr.EventType.ERROR,(C=>{b||(b=!0,In(Re,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),D.a_(new L(S.UNAVAILABLE,"The operation could not be completed")))})),k(m,sr.EventType.MESSAGE,(C=>{if(!b){const x=C.data[0];X(!!x,16349);const N=x,O=N?.error||N[0]?.error;if(O){M(Re,`RPC '${e}' stream ${s} received error:`,O);const U=O.status;let Y=(function(g){const v=he[g];if(v!==void 0)return qh(v)})(U),F=O.message;Y===void 0&&(Y=S.INTERNAL,F="Unknown error status: "+U+" with message "+O.message),b=!0,D.a_(new L(Y,F)),m.close()}else M(Re,`RPC '${e}' stream ${s} received:`,x),D.u_(x)}})),k(l,sh.STAT_EVENT,(C=>{C.stat===uo.PROXY?M(Re,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===uo.NOPROXY&&M(Re,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{D.__()}),0),D}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Zi(){return typeof document<"u"?document:null}function ii(n){return new $_(n,!0)}class nd{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&M("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Bl="PersistentStream";class rd{constructor(e,t,r,s,i,a,l,u){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new nd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(pt(t.toString()),pt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new L(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(Bl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(M(Bl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Uv extends rd{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=H_(this.serializer,e),r=(function(i){if(!("targetChange"in i))return j.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?et(a.readTime):j.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=To(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=go(u)?{documents:G_(i,u)}:{query:K_(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=zh(i,a.resumeToken);const h=_o(i,a.expectedCount);h!==null&&(l.expectedCount=h)}else if(a.snapshotVersion.compareTo(j.min())>0){l.readTime=Us(i,a.snapshotVersion.toTimestamp());const h=_o(i,a.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const r=Y_(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=To(this.serializer),t.removeTarget=e,this.q_(t)}}class Fv extends rd{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return X(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,X(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){X(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=W_(e.writeResults,e.commitTime),r=et(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=To(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>z_(this.serializer,r)))};this.q_(t)}}class Bv{}class $v extends Bv{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new L(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,vo(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new L(S.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,vo(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new L(S.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class qv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(pt(t),this.aa=!1):M("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const sn="RemoteStore";class jv{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{an(this)&&(M(sn,"Restarting streams for network reachability change."),await(async function(u){const h=H(u);h.Ea.add(4),await $r(h),h.Ra.set("Unknown"),h.Ea.delete(4),await oi(h)})(this))}))})),this.Ra=new qv(r,s)}}async function oi(n){if(an(n))for(const e of n.da)await e(!0)}async function $r(n){for(const e of n.da)await e(!1)}function sd(n,e){const t=H(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ca(t)?aa(t):Mn(t).O_()&&oa(t,e))}function ia(n,e){const t=H(n),r=Mn(t);t.Ia.delete(e),r.O_()&&id(t,e),t.Ia.size===0&&(r.O_()?r.L_():an(t)&&t.Ra.set("Unknown"))}function oa(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Mn(n).Y_(e)}function id(n,e){n.Va.Ue(e),Mn(n).Z_(e)}function aa(n){n.Va=new x_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Mn(n).start(),n.Ra.ua()}function ca(n){return an(n)&&!Mn(n).x_()&&n.Ia.size>0}function an(n){return H(n).Ea.size===0}function od(n){n.Va=void 0}async function Hv(n){n.Ra.set("Online")}async function zv(n){n.Ia.forEach(((e,t)=>{oa(n,e)}))}async function Wv(n,e){od(n),ca(n)?(n.Ra.ha(e),aa(n)):n.Ra.set("Unknown")}async function Gv(n,e,t){if(n.Ra.set("Online"),e instanceof Hh&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){M(sn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Bs(n,r)}else if(e instanceof Es?n.Va.Ze(e):e instanceof jh?n.Va.st(e):n.Va.tt(e),!t.isEqual(j.min()))try{const r=await td(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,h)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Ie.EMPTY_BYTE_STRING,f.snapshotVersion)),id(i,u);const m=new Ct(f.target,u,h,f.sequenceNumber);oa(i,m)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){M(sn,"Failed to raise snapshot:",r),await Bs(n,r)}}async function Bs(n,e,t){if(!On(e))throw e;n.Ea.add(1),await $r(n),n.Ra.set("Offline"),t||(t=()=>td(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(sn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await oi(n)}))}function ad(n,e){return e().catch((t=>Bs(n,t,e)))}async function ai(n){const e=H(n),t=Ft(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:zo;for(;Kv(e);)try{const s=await Cv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Qv(e,s)}catch(s){await Bs(e,s)}cd(e)&&ld(e)}function Kv(n){return an(n)&&n.Ta.length<10}function Qv(n,e){n.Ta.push(e);const t=Ft(n);t.O_()&&t.X_&&t.ea(e.mutations)}function cd(n){return an(n)&&!Ft(n).x_()&&n.Ta.length>0}function ld(n){Ft(n).start()}async function Yv(n){Ft(n).ra()}async function Xv(n){const e=Ft(n);for(const t of n.Ta)e.ea(t.mutations)}async function Jv(n,e,t){const r=n.Ta.shift(),s=Jo.from(r,e,t);await ad(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await ai(n)}async function Zv(n,e){e&&Ft(n).X_&&await(async function(r,s){if((function(a){return O_(a)&&a!==S.ABORTED})(s.code)){const i=r.Ta.shift();Ft(r).B_(),await ad(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await ai(r)}})(n,e),cd(n)&&ld(n)}async function $l(n,e){const t=H(n);t.asyncQueue.verifyOperationInProgress(),M(sn,"RemoteStore received new credentials");const r=an(t);t.Ea.add(3),await $r(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await oi(t)}async function eE(n,e){const t=H(n);e?(t.Ea.delete(2),await oi(t)):e||(t.Ea.add(2),await $r(t),t.Ra.set("Unknown"))}function Mn(n){return n.ma||(n.ma=(function(t,r,s){const i=H(t);return i.sa(),new Uv(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:Hv.bind(null,n),t_:zv.bind(null,n),r_:Wv.bind(null,n),H_:Gv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ca(n)?aa(n):n.Ra.set("Unknown")):(await n.ma.stop(),od(n))}))),n.ma}function Ft(n){return n.fa||(n.fa=(function(t,r,s){const i=H(t);return i.sa(),new Fv(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Yv.bind(null,n),r_:Zv.bind(null,n),ta:Xv.bind(null,n),na:Jv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await ai(n)):(await n.fa.stop(),n.Ta.length>0&&(M(sn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class la{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new la(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ua(n,e){if(pt("AsyncQueue",`${e}: ${n}`),On(n))return new L(S.UNAVAILABLE,`${e}: ${n}`);throw n}class En{static emptySet(e){return new En(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=ir(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof En)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new En;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class ql{constructor(){this.ga=new oe(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):q(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Pn{constructor(e,t,r,s,i,a,l,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new Pn(e,t,En.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class tE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class nE{constructor(){this.queries=jl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=H(t),i=s.queries;s.queries=jl(),i.forEach(((a,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new L(S.ABORTED,"Firestore shutting down"))}}function jl(){return new on((n=>Ph(n)),Zs)}async function ud(n,e){const t=H(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new tE,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=ua(a,`Initialization of query '${fn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&ha(t)}async function hd(n,e){const t=H(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function rE(n,e){const t=H(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&ha(t)}function sE(n,e,t){const r=H(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function ha(n){n.Ca.forEach((e=>{e.next()}))}var Ao,Hl;(Hl=Ao||(Ao={})).Ma="default",Hl.Cache="cache";class dd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Pn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Pn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ao.Cache}}class fd{constructor(e){this.key=e}}class pd{constructor(e){this.key=e}}class iE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=Ch(e),this.tu=new En(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new ql,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const y=s.get(f),b=ei(this.query,m)?m:null,D=!!y&&this.mutatedKeys.has(y.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let C=!1;y&&b?y.data.isEqual(b.data)?D!==k&&(r.track({type:3,doc:b}),C=!0):this.su(y,b)||(r.track({type:2,doc:b}),C=!0,(u&&this.eu(b,u)>0||h&&this.eu(b,h)<0)&&(l=!0)):!y&&b?(r.track({type:0,doc:b}),C=!0):y&&!b&&(r.track({type:1,doc:y}),C=!0,(u||h)&&(l=!0)),C&&(b?(a=a.add(b),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(b,D){const k=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{Rt:C})}};return k(b)-k(D)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,h=u!==this.Za;return this.Za=u,a.length!==0||h?{snapshot:new Pn(this.query,e.tu,i,a,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ql,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=K(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new pd(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new fd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=K();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Pn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const da="SyncEngine";class oE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class aE{constructor(e){this.key=e,this.hu=!1}}class cE{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new on((l=>Ph(l)),Zs),this.Iu=new Map,this.Eu=new Set,this.du=new oe(B.comparator),this.Au=new Map,this.Ru=new ta,this.Vu={},this.mu=new Map,this.fu=Sn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function lE(n,e,t=!0){const r=Ed(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await md(r,e,t,!0),s}async function uE(n,e){const t=Ed(n);await md(t,e,!0,!1)}async function md(n,e,t,r){const s=await kv(n.localStore,Ze(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await hE(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&sd(n.remoteStore,s),l}async function hE(n,e,t,r,s){n.pu=(m,y,b)=>(async function(k,C,x,N){let O=C.view.ru(x);O.Cs&&(O=await Ml(k.localStore,C.query,!1).then((({documents:E})=>C.view.ru(E,O))));const U=N&&N.targetChanges.get(C.targetId),Y=N&&N.targetMismatches.get(C.targetId)!=null,F=C.view.applyChanges(O,k.isPrimaryClient,U,Y);return Wl(k,C.targetId,F.au),F.snapshot})(n,m,y,b);const i=await Ml(n.localStore,e,!0),a=new iE(e,i.Qs),l=a.ru(i.documents),u=Br.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(l,n.isPrimaryClient,u);Wl(n,t,h.au);const f=new oE(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function dE(n,e,t){const r=H(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Zs(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await wo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ia(r.remoteStore,s.targetId),bo(r,s.targetId)})).catch(Vn)):(bo(r,s.targetId),await wo(r.localStore,s.targetId,!0))}async function fE(n,e){const t=H(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ia(t.remoteStore,r.targetId))}async function pE(n,e,t){const r=TE(n);try{const s=await(function(a,l){const u=H(a),h=re.now(),f=l.reduce(((b,D)=>b.add(D.key)),K());let m,y;return u.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let D=mt(),k=K();return u.Ns.getEntries(b,f).next((C=>{D=C,D.forEach(((x,N)=>{N.isValidDocument()||(k=k.add(x))}))})).next((()=>u.localDocuments.getOverlayedDocuments(b,D))).next((C=>{m=C;const x=[];for(const N of l){const O=C_(N,m.get(N.key).overlayedDocument);O!=null&&x.push(new qt(N.key,O,Eh(O.value.mapValue),Le.exists(!0)))}return u.mutationQueue.addMutationBatch(b,h,x,l)})).next((C=>{y=C;const x=C.applyToLocalDocumentSet(m,k);return u.documentOverlayCache.saveOverlays(b,C.batchId,x)}))})).then((()=>({batchId:y.batchId,changes:Nh(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let h=a.Vu[a.currentUser.toKey()];h||(h=new oe(G)),h=h.insert(l,u),a.Vu[a.currentUser.toKey()]=h})(r,s.batchId,t),await qr(r,s.changes),await ai(r.remoteStore)}catch(s){const i=ua(s,"Failed to persist write");t.reject(i)}}async function gd(n,e){const t=H(n);try{const r=await Sv(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(X(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?X(a.hu,14607):s.removedDocuments.size>0&&(X(a.hu,42227),a.hu=!1))})),await qr(t,r,e)}catch(r){await Vn(r)}}function zl(n,e,t){const r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=H(a);u.onlineState=l;let h=!1;u.queries.forEach(((f,m)=>{for(const y of m.Sa)y.va(l)&&(h=!0)})),h&&ha(u)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function mE(n,e,t){const r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new oe(B.comparator);a=a.insert(i,Pe.newNoDocument(i,j.min()));const l=K().add(i),u=new si(j.min(),new Map,new oe(G),a,l);await gd(r,u),r.du=r.du.remove(i),r.Au.delete(e),fa(r)}else await wo(r.localStore,e,!1).then((()=>bo(r,e,t))).catch(Vn)}async function gE(n,e){const t=H(n),r=e.batch.batchId;try{const s=await Rv(t.localStore,e);_d(t,r,null),yd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await qr(t,s)}catch(s){await Vn(s)}}async function yE(n,e,t){const r=H(n);try{const s=await(function(a,l){const u=H(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return u.mutationQueue.lookupMutationBatch(h,l).next((m=>(X(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>u.localDocuments.getDocuments(h,f)))}))})(r.localStore,e);_d(r,e,t),yd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await qr(r,s)}catch(s){await Vn(s)}}function yd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function _d(n,e,t){const r=H(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function bo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||vd(n,r)}))}function vd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ia(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),fa(n))}function Wl(n,e,t){for(const r of t)r instanceof fd?(n.Ru.addReference(r.key,e),_E(n,r)):r instanceof pd?(M(da,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||vd(n,r.key)):q(19791,{wu:r})}function _E(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(M(da,"New document in limbo: "+t),n.Eu.add(r),fa(n))}function fa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(ee.fromString(e)),r=n.fu.next();n.Au.set(r,new aE(t)),n.du=n.du.insert(t,r),sd(n.remoteStore,new Ct(Ze(Yo(t.path)),r,"TargetPurposeLimboResolution",Ys.ce))}}async function qr(n,e,t){const r=H(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){s.push(h);const f=ra.As(u.targetId,h);i.push(f)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(u,h){const f=H(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(h,(y=>P.forEach(y.Es,(b=>f.persistence.referenceDelegate.addReference(m,y.targetId,b))).next((()=>P.forEach(y.ds,(b=>f.persistence.referenceDelegate.removeReference(m,y.targetId,b)))))))))}catch(m){if(!On(m))throw m;M(sa,"Failed to update sequence numbers: "+m)}for(const m of h){const y=m.targetId;if(!m.fromCache){const b=f.Ms.get(y),D=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(D);f.Ms=f.Ms.insert(y,k)}}})(r.localStore,i))}async function vE(n,e){const t=H(n);if(!t.currentUser.isEqual(e)){M(da,"User change. New user:",e.toKey());const r=await ed(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new L(S.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await qr(t,r.Ls)}}function EE(n,e){const t=H(n),r=t.Au.get(e);if(r&&r.hu)return K().add(r.key);{let s=K();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Ed(n){const e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=EE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=mE.bind(null,e),e.Pu.H_=rE.bind(null,e.eventManager),e.Pu.yu=sE.bind(null,e.eventManager),e}function TE(n){const e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=gE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yE.bind(null,e),e}class $s{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ii(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return bv(this.persistence,new wv,e.initialUser,this.serializer)}Cu(e){return new Zh(na.mi,this.serializer)}Du(e){return new Dv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}$s.provider={build:()=>new $s};class wE extends $s{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){X(this.persistence.referenceDelegate instanceof Fs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new av(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Zh((r=>Fs.mi(r,t)),this.serializer)}}class Ro{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>zl(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=vE.bind(null,this.syncEngine),await eE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new nE})()}createDatastore(e){const t=ii(e.databaseInfo.databaseId),r=(function(i){return new xv(i)})(e.databaseInfo);return(function(i,a,l,u){return new $v(i,a,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new jv(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>zl(this.syncEngine,t,0)),(function(){return Fl.v()?new Fl:new Vv})())}createSyncEngine(e,t){return(function(s,i,a,l,u,h,f){const m=new cE(s,i,a,l,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=H(t);M(sn,"RemoteStore shutting down."),r.Ea.add(5),await $r(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ro.provider={build:()=>new Ro};class Td{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):pt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Bt="FirestoreClient";class IE{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Se.UNAUTHENTICATED,this.clientId=Ho.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{M(Bt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(M(Bt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ua(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function eo(n,e){n.asyncQueue.verifyOperationInProgress(),M(Bt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ed(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Gl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await AE(n);M(Bt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>$l(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>$l(e.remoteStore,s))),n._onlineComponents=e}async function AE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(Bt,"Using user provided OfflineComponentProvider");try{await eo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;In("Error using user provided cache. Falling back to memory cache: "+t),await eo(n,new $s)}}else M(Bt,"Using default OfflineComponentProvider"),await eo(n,new wE(void 0));return n._offlineComponents}async function wd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(Bt,"Using user provided OnlineComponentProvider"),await Gl(n,n._uninitializedComponentsProvider._online)):(M(Bt,"Using default OnlineComponentProvider"),await Gl(n,new Ro))),n._onlineComponents}function bE(n){return wd(n).then((e=>e.syncEngine))}async function Id(n){const e=await wd(n),t=e.eventManager;return t.onListen=lE.bind(null,e.syncEngine),t.onUnlisten=dE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=uE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=fE.bind(null,e.syncEngine),t}function RE(n,e,t={}){const r=new ht;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,h){const f=new Td({next:y=>{f.Nu(),a.enqueueAndForget((()=>hd(i,m)));const b=y.docs.has(l);!b&&y.fromCache?h.reject(new L(S.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&y.fromCache&&u&&u.source==="server"?h.reject(new L(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new dd(Yo(l.path),f,{includeMetadataChanges:!0,qa:!0});return ud(i,m)})(await Id(n),n.asyncQueue,e,t,r))),r.promise}function SE(n,e,t={}){const r=new ht;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,h){const f=new Td({next:y=>{f.Nu(),a.enqueueAndForget((()=>hd(i,m))),y.fromCache&&u.source==="server"?h.reject(new L(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new dd(l,f,{includeMetadataChanges:!0,qa:!0});return ud(i,m)})(await Id(n),n.asyncQueue,e,t,r))),r.promise}function Ad(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Kl=new Map;const bd="firestore.googleapis.com",Ql=!0;class Yl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bd,this.ssl=Ql}else this.host=e.host,this.ssl=e.ssl??Ql;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Jh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<iv)throw new L(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ad(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ci{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Vy;switch(r.type){case"firstParty":return new xy(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Kl.get(t);r&&(M("ComponentProvider","Removing Datastore"),Kl.delete(t),r.terminate())})(this),Promise.resolve()}}function PE(n,e,t,r={}){n=We(n,ci);const s=Cn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(pu(`https://${l}`),mu("Firestore",!0)),i.host!==bd&&i.host!==l&&In("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!Zt(u,a)&&(n._setSettings(u),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Se.MOCK_USER;else{h=Ff(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new L(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Se(m)}n._authCredentials=new Oy(new ch(h,f))}}class jt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jt(this.firestore,e,this._query)}}class ue{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ue(this.firestore,e,this._key)}toJSON(){return{type:ue._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ur(t,ue._jsonSchema))return new ue(e,r||null,new B(ee.fromString(t.referencePath)))}}ue._jsonSchemaVersion="firestore/documentReference/1.0",ue._jsonSchema={type:fe("string",ue._jsonSchemaVersion),referencePath:fe("string")};class Ot extends jt{constructor(e,t,r){super(e,t,Yo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new B(e))}withConverter(e){return new Ot(this.firestore,e,this._path)}}function xn(n,e,...t){if(n=ce(n),lh("collection","path",e),n instanceof ci){const r=ee.fromString(e,...t);return ll(r),new Ot(n,null,r)}{if(!(n instanceof ue||n instanceof Ot))throw new L(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ee.fromString(e,...t));return ll(r),new Ot(n.firestore,null,r)}}function me(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Ho.newId()),lh("doc","path",e),n instanceof ci){const r=ee.fromString(e,...t);return cl(r),new ue(n,null,new B(r))}{if(!(n instanceof ue||n instanceof Ot))throw new L(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ee.fromString(e,...t));return cl(r),new ue(n.firestore,n instanceof Ot?n.converter:null,new B(r))}}const Xl="AsyncQueue";class Jl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new nd(this,"async_queue_retry"),this._c=()=>{const r=Zi();r&&M(Xl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Zi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Zi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ht;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!On(e))throw e;M(Xl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,pt("INTERNAL UNHANDLED ERROR: ",Zl(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=la.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&q(47125,{Pc:Zl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Zl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class cn extends ci{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Jl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Jl(e),this._firestoreClient=void 0,await e}}}function CE(n,e){const t=typeof n=="object"?n:vu(),r=typeof n=="string"?n:Os,s=No(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=xf("firestore");i&&PE(s,...i)}return s}function li(n){if(n._terminated)throw new L(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||kE(n),n._firestoreClient}function kE(n){const e=n._freezeSettings(),t=(function(s,i,a,l){return new t_(s,i,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ad(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new IE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class $e{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $e(Ie.fromBase64String(e))}catch(t){throw new L(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $e(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$e._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ur(e,$e._jsonSchema))return $e.fromBase64String(e.bytes)}}$e._jsonSchemaVersion="firestore/bytes/1.0",$e._jsonSchema={type:fe("string",$e._jsonSchemaVersion),bytes:fe("string")};class jr{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new we(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hr{constructor(e){this._methodName=e}}class tt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:tt._jsonSchemaVersion}}static fromJSON(e){if(Ur(e,tt._jsonSchema))return new tt(e.latitude,e.longitude)}}tt._jsonSchemaVersion="firestore/geoPoint/1.0",tt._jsonSchema={type:fe("string",tt._jsonSchemaVersion),latitude:fe("number"),longitude:fe("number")};class nt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ur(e,nt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new nt(e.vectorValues);throw new L(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}nt._jsonSchemaVersion="firestore/vectorValue/1.0",nt._jsonSchema={type:fe("string",nt._jsonSchemaVersion),vectorValues:fe("object")};const NE=/^__.*__$/;class DE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new qt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fr(e,this.data,t,this.fieldTransforms)}}class Rd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new qt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Sd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ac:n})}}class pa{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new pa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return qs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Sd(this.Ac)&&NE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class VE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ii(e)}Cc(e,t,r,s=!1){return new pa({Ac:e,methodName:t,Dc:r,path:we.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ui(n){const e=n._freezeSettings(),t=ii(n._databaseId);return new VE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Pd(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);ya("Data must be an object, but it was:",a,r);const l=Nd(r,a);let u,h;if(i.merge)u=new Fe(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const y=So(e,m,t);if(!a.contains(y))throw new L(S.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Vd(f,y)||f.push(y)}u=new Fe(f),h=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,h=a.fieldTransforms;return new DE(new Oe(l),u,h)}class hi extends Hr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hi}}class ma extends Hr{_toFieldTransform(e){return new Fh(e.path,new br)}isEqual(e){return e instanceof ma}}class ga extends Hr{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Pr(e.serializer,Oh(e.serializer,this.Fc));return new Fh(e.path,t)}isEqual(e){return e instanceof ga&&this.Fc===e.Fc}}function Cd(n,e,t,r){const s=n.Cc(1,e,t);ya("Data must be an object, but it was:",s,r);const i=[],a=Oe.empty();$t(r,((u,h)=>{const f=_a(e,u,t);h=ce(h);const m=s.yc(f);if(h instanceof hi)i.push(f);else{const y=zr(h,m);y!=null&&(i.push(f),a.set(f,y))}}));const l=new Fe(i);return new Rd(a,l,s.fieldTransforms)}function kd(n,e,t,r,s,i){const a=n.Cc(1,e,t),l=[So(e,r,t)],u=[s];if(i.length%2!=0)throw new L(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)l.push(So(e,i[y])),u.push(i[y+1]);const h=[],f=Oe.empty();for(let y=l.length-1;y>=0;--y)if(!Vd(h,l[y])){const b=l[y];let D=u[y];D=ce(D);const k=a.yc(b);if(D instanceof hi)h.push(b);else{const C=zr(D,k);C!=null&&(h.push(b),f.set(b,C))}}const m=new Fe(h);return new Rd(f,m,a.fieldTransforms)}function OE(n,e,t,r=!1){return zr(t,n.Cc(r?4:3,e))}function zr(n,e){if(Dd(n=ce(n)))return ya("Unsupported field value:",e,n),Nd(n,e);if(n instanceof Hr)return(function(r,s){if(!Sd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=zr(l,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Oh(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=re.fromDate(r);return{timestampValue:Us(s.serializer,i)}}if(r instanceof re){const i=new re(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Us(s.serializer,i)}}if(r instanceof tt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $e)return{bytesValue:zh(s.serializer,r._byteString)};if(r instanceof ue){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ea(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof nt)return(function(a,l){return{mapValue:{fields:{[_h]:{stringValue:vh},[Ls]:{arrayValue:{values:a.toArray().map((h=>{if(typeof h!="number")throw l.Sc("VectorValues must only contain numeric values.");return Xo(l.serializer,h)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Qs(r)}`)})(n,e)}function Nd(n,e){const t={};return dh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$t(n,((r,s)=>{const i=zr(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Dd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof re||n instanceof tt||n instanceof $e||n instanceof ue||n instanceof Hr||n instanceof nt)}function ya(n,e,t){if(!Dd(t)||!uh(t)){const r=Qs(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function So(n,e,t){if((e=ce(e))instanceof jr)return e._internalPath;if(typeof e=="string")return _a(n,e);throw qs("Field path arguments must be of type string or ",n,!1,void 0,t)}const LE=new RegExp("[~\\*/\\[\\]]");function _a(n,e,t){if(e.search(LE)>=0)throw qs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new jr(...e.split("."))._internalPath}catch{throw qs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function qs(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new L(S.INVALID_ARGUMENT,l+n+u)}function Vd(n,e){return n.some((t=>t.isEqual(e)))}class Od{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ME(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(di("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ME extends Od{data(){return super.data()}}function di(n,e){return typeof e=="string"?_a(n,e):e instanceof jr?e._internalPath:e._delegate._internalPath}function xE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class va{}class Ea extends va{}function fi(n,e,...t){let r=[];e instanceof va&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof Ta)).length,l=i.filter((u=>u instanceof pi)).length;if(a>1||a>0&&l>0)throw new L(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class pi extends Ea{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new pi(e,t,r)}_apply(e){const t=this._parse(e);return xd(e._query,t),new jt(e.firestore,e.converter,yo(e._query,t))}_parse(e){const t=ui(e.firestore);return(function(i,a,l,u,h,f,m){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new L(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){tu(m,f);const D=[];for(const k of m)D.push(eu(u,i,k));y={arrayValue:{values:D}}}else y=eu(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||tu(m,f),y=OE(l,a,m,f==="in"||f==="not-in");return de.create(h,f,y)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ld(n,e,t){const r=e,s=di("where",n);return pi._create(s,r,t)}class Ta extends va{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ta(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:Ge.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)xd(a,u),a=yo(a,u)})(e._query,t),new jt(e.firestore,e.converter,yo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class wa extends Ea{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new wa(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new L(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new L(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ar(i,a)})(e._query,this._field,this._direction);return new jt(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new Ln(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function mi(n,e="asc"){const t=e,r=di("orderBy",n);return wa._create(r,t)}class Ia extends Ea{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ia(e,t,r)}_apply(e){return new jt(e.firestore,e.converter,xs(e._query,this._limit,this._limitType))}}function Md(n){return Hy("limit",n),Ia._create("limit",n,"F")}function eu(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new L(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sh(e)&&t.indexOf("/")!==-1)throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ee.fromString(t));if(!B.isDocumentKey(r))throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return yl(n,new B(r))}if(t instanceof ue)return yl(n,t._key);throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qs(t)}.`)}function tu(n,e){if(!Array.isArray(n)||n.length===0)throw new L(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xd(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new L(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class UE{convertValue(e,t="none"){switch(Ut(e)){case 0:return null;case 1:return e.booleanValue;case 2:return le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return $t(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Ls].arrayValue?.values?.map((r=>le(r.doubleValue)));return new nt(t)}convertGeoPoint(e){return new tt(le(e.latitude),le(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Js(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Tr(e));default:return null}}convertTimestamp(e){const t=Mt(e);return new re(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ee.fromString(e);X(Xh(r),9688,{name:e});const s=new wr(r.get(1),r.get(3)),i=new B(r.popFirst(5));return s.isEqual(t)||pt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Ud(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ar{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Jt extends Od{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ts(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(di("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Jt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Jt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Jt._jsonSchema={type:fe("string",Jt._jsonSchemaVersion),bundleSource:fe("string","DocumentSnapshot"),bundleName:fe("string"),bundle:fe("string")};class Ts extends Jt{data(e={}){return super.data(e)}}class Tn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ar(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ts(this._firestore,this._userDataWriter,r.key,r,new ar(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new Ts(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ar(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new Ts(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ar(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,f=-1;return l.type!==0&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:FE(l.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Tn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ho.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function FE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:n})}}function Aa(n){n=We(n,ue);const e=We(n.firestore,cn);return RE(li(e),n._key).then((t=>BE(e,n,t)))}Tn._jsonSchemaVersion="firestore/querySnapshot/1.0",Tn._jsonSchema={type:fe("string",Tn._jsonSchemaVersion),bundleSource:fe("string","QuerySnapshot"),bundleName:fe("string"),bundle:fe("string")};class Fd extends UE{constructor(e){super(),this.firestore=e}convertBytes(e){return new $e(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}}function gi(n){n=We(n,jt);const e=We(n.firestore,cn),t=li(e),r=new Fd(e);return xE(n._query),SE(t,n._query).then((s=>new Tn(e,r,n,s)))}function ba(n,e,t){n=We(n,ue);const r=We(n.firestore,cn),s=Ud(n.converter,e,t);return _i(r,[Pd(ui(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Le.none())])}function yi(n,e,t,...r){n=We(n,ue);const s=We(n.firestore,cn),i=ui(s);let a;return a=typeof(e=ce(e))=="string"||e instanceof jr?kd(i,"updateDoc",n._key,e,t,r):Cd(i,"updateDoc",n._key,e),_i(s,[a.toMutation(n._key,Le.exists(!0))])}function Bd(n){return _i(We(n.firestore,cn),[new ri(n._key,Le.none())])}function _i(n,e){return(function(r,s){const i=new ht;return r.asyncQueue.enqueueAndForget((async()=>pE(await bE(r),s,i))),i.promise})(li(n),e)}function BE(n,e,t){const r=t.docs.get(e._key),s=new Fd(n);return new Jt(n,s,e._key,r,new ar(t.hasPendingWrites,t.fromCache),e.converter)}class $E{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ui(e)}set(e,t,r){this._verifyNotCommitted();const s=to(e,this._firestore),i=Ud(s.converter,t,r),a=Pd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Le.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=to(e,this._firestore);let a;return a=typeof(t=ce(t))=="string"||t instanceof jr?kd(this._dataReader,"WriteBatch.update",i._key,t,r,s):Cd(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Le.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=to(e,this._firestore);return this._mutations=this._mutations.concat(new ri(t._key,Le.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function to(n,e){if((n=ce(n)).firestore!==e)throw new L(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function J(){return new ma("serverTimestamp")}function tr(n){return new ga("increment",n)}function qE(n){return li(n=We(n,cn)),new $E(n,(e=>_i(n,e)))}(function(e,t=!0){(function(s){Dn=s})(kn),wn(new en("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new cn(new Ly(r.getProvider("auth-internal")),new Uy(a,r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new L(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wr(h.options.projectId,f)})(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),Dt(sl,il,e),Dt(sl,il,"esm2020")})();const jE={apiKey:"AIzaSyDJurXmliChoLZ5tdiXsH-kTaiyfcEtsgM",authDomain:"ethos-dev-ec0d6.firebaseapp.com",projectId:"ethos-dev-ec0d6",storageBucket:"ethos-dev-ec0d6.firebasestorage.app",messagingSenderId:"154735949292",appId:"1:154735949292:web:2641d40b6563c39f9efcc9"},$d=_u(jE),st=Cy($d),ye=CE($d);function HE(n){return _g(st,n)}async function qd(n=!0){await Bo(st,n?Ws:Mr);const e=new at;return Ug(st,e)}async function zE(n){const e=String(n||"").trim().toLowerCase();return e?mg(st,e):[]}async function WE(n,e,t=!0){return await Bo(st,t?Ws:Mr),fg(st,n,e)}async function GE(n,e,t=!0){return await Bo(st,t?Ws:Mr),dg(st,n,e)}async function KE(n){return hg(st,n)}async function QE(){return vg(st)}async function Cr(n){const e=me(ye,"users",n),t=await Aa(e);return t.exists()?t.data():null}async function YE(n,e){const t=me(ye,"users",n),r={uid:n,email:e?.email??null,role:e?.role??"user",weekStartsOn:"monday",displayName:e?.displayName??"",dob:e?.dob??null,timeZone:e?.timeZone??e?.preferences?.timeZone??"Asia/Kolkata",preferences:{...e?.preferences||{}},createdAt:J(),updatedAt:J()};return await ba(t,r,{merge:!0}),r}async function XE(n,e,t){const r={};let s=!1;t?.uid||(r.uid=n,s=!0),t?.role||(r.role="user",s=!0),t?.weekStartsOn||(r.weekStartsOn="monday",s=!0),!t?.email&&e&&(r.email=e,s=!0);const i=t?.preferences?.timeZone;if(!t?.timeZone&&i&&(r.timeZone=i,s=!0),!t?.timeZone&&!i&&(r.timeZone="Asia/Kolkata",s=!0),!s)return!1;const a=me(ye,"users",n);return await ba(a,{...r,updatedAt:J()},{merge:!0}),!0}async function jd(n){const e=xn(ye,"users",n,"tracks"),t=fi(e,Ld("isActive","==",!0),mi("sortOrder","asc"));return(await gi(t)).docs.map(s=>({...s.data(),id:s.id}))}async function JE(n,e){const t=xn(ye,"users",n,"tracks"),r=me(t),s={...e,isActive:e?.isActive??!0,isPrivate:e?.isPrivate??!1,sortOrder:e?.sortOrder??Date.now(),createdAt:J(),updatedAt:J()};return await ba(r,s),r.id}async function ZE(n,e,t){const r=me(ye,"users",n,"tracks",e);await yi(r,{...t,updatedAt:J()})}async function eT(n,e){const t=me(ye,"users",n,"tracks",e);await Bd(t)}async function Hd(n,e){const t=me(ye,"users",n,"days",e),r=await Aa(t);return r.exists()?r.data():null}async function tT(n,e){const t=xn(ye,"users",n,"days"),r=fi(t,mi("dayKey","desc"),Md(e));return(await gi(r)).docs.map(i=>i.data())}async function nu(n,e,t,r=50){const s=xn(ye,"users",n,"days",e,"entries"),i=fi(s,Ld("trackId","==",t),mi("createdAtMs","desc"),Md(r));return(await gi(i)).docs.map(l=>({id:l.id,...l.data()}))}const no={themeMode:"system",accent1:"#7c3aed",accent2:"#14b8a6"};function zd(n){const e=n||{};return{themeMode:e.themeMode||no.themeMode,accent1:e.accent1||no.accent1,accent2:e.accent2||no.accent2}}function Wd(n){const e=zd(n?.preferences);document.documentElement.dataset.theme=e.themeMode,document.documentElement.style.setProperty("--accent-1",e.accent1),document.documentElement.style.setProperty("--accent-2",e.accent2)}function kr(){const n=window.location.hash||"#/auth",[e,t]=n.split("?"),r=new URLSearchParams(t||"");return{path:e,query:r,raw:n}}function te(n){window.location.hash=n}function nT(n){window.addEventListener("hashchange",n)}function Gd(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h1>Ethos</h1>
      <p class="muted">A calm place to stay aligned.</p>

      <label class="check">
        <input id="persist" type="checkbox" checked />
        <span>Keep me signed in</span>
      </label>

      <div class="stack">
        <button id="googleBtn" class="btn primary">Continue with Google</button>
        <button id="emailBtn" class="btn">Continue with Email</button>
      </div>
    </div>
  `;const e=n.querySelector("#persist"),t=localStorage.getItem("ethos_keepSignedIn");t!==null&&(e.checked=t==="true"),e.addEventListener("change",()=>{localStorage.setItem("ethos_keepSignedIn",String(e.checked))}),n.querySelector("#emailBtn").addEventListener("click",()=>{te("#/auth/email")}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await qd(e.checked)}catch(r){alert(r?.message||"Google sign-in failed")}})}function rT(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h2>Continue with Email</h2>
      <p class="muted">Enter your email to continue.</p>

      <div class="stack">
        <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" />
        <button id="next" class="btn primary">Next </button>
        <a class="link" href="#/auth"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
      <div id="googleHint" class="stack" style="margin-top:12px; display:none;">
        <button id="googleBtn" class="btn">Continue with Google instead</button>
      </div>
    </div>
  `;const e=n.querySelector("#email"),t=n.querySelector("#msg"),r=n.querySelector("#googleHint");function s(a){t.textContent=a||""}async function i(){const a=String(e.value||"").trim().toLowerCase();if(s(""),r.style.display="none",!a){s("Please enter an email.");return}try{const l=await zE(a);if(!l||l.length===0){te(`#/auth/create-password?email=${encodeURIComponent(a)}`);return}const u=l.includes("google.com"),h=l.includes("password");if(u&&!h){s("This email is linked to Google sign-in."),r.style.display="block";return}if(h){te(`#/auth/password?email=${encodeURIComponent(a)}`);return}s("This email uses a different sign-in method. Try Google sign-in."),r.style.display="block"}catch(l){s(l?.message||"Could not check sign-in method.")}}n.querySelector("#next").addEventListener("click",i),e.addEventListener("keydown",a=>{a.key==="Enter"&&i()}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await qd()}catch(a){s(a?.message||"Google sign-in failed")}})}function sT(){const n=document.getElementById("app"),{query:e}=kr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Welcome back</h2>
      <p class="muted">${t?`Signing in as ${t}`:"Enter your password to continue."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
        
        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="login" class="btn primary">Sign in</button>

        <button id="forgot" class="btn ghost">Forgot password?</button>
        <a class="link" href="#/auth/email"> Use a different email</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#persist");function u(f){i.textContent=f||""}t||u("Missing email. Go back and enter your email again.");async function h(){if(localStorage.setItem("ethos_keepSignedIn",String(l.checked)),u(""),!t)return;const f=String(a.value||"");if(!f){u("Please enter your password.");return}try{await WE(t,f,l.checked)}catch(m){u(m?.message||"Sign-in failed.")}}n.querySelector("#login").addEventListener("click",h),a.addEventListener("keydown",f=>{f.key==="Enter"&&h()}),n.querySelector("#forgot").addEventListener("click",async()=>{if(u(""),!!t)try{await KE(t),u("Password reset email sent.")}catch(f){u(f?.message||"Could not send reset email.")}})}function iT(){const n=document.getElementById("app"),{query:e}=kr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Create your account</h2>
      <p class="muted">${t?`For ${t}`:"Missing email. Go back and enter your email again."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Create password" autocomplete="new-password" />
        <input id="confirm" class="input" type="password" placeholder="Confirm password" autocomplete="new-password" />

        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="create" class="btn primary">Create account</button>
        <a class="link" href="#/auth/email"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#confirm"),u=n.querySelector("#persist");function h(m){i.textContent=m||""}async function f(){if(localStorage.setItem("ethos_keepSignedIn",String(u.checked)),h(""),!t)return;const m=String(a.value||""),y=String(l.value||"");if(!m||m.length<6){h("Password should be at least 6 characters.");return}if(m!==y){h("Passwords do not match.");return}try{await GE(t,m,u.checked)}catch(b){const D=b?.code||"";if(D==="auth/email-already-in-use"||D==="auth/account-exists-with-different-credential"){h("This email is already linked to a different sign-in method. Try Google sign-in."),navigate("#/auth/email");return}h(b?.message||"Account creation failed.")}}n.querySelector("#create").addEventListener("click",f),l.addEventListener("keydown",m=>{m.key==="Enter"&&f()})}function oT(){if(typeof Intl<"u"&&typeof Intl.supportedValuesOf=="function")try{return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney","Asia/Singapore","Asia/Tokyo"]}function Kd({user:n}){const e=document.getElementById("app"),t=oT(),r=Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Kolkata";e.innerHTML=`
    <div class="center">
      <h2>Set up your profile</h2>
      <p class="muted">This helps Ethos keep your days aligned to your timezone.</p>

      <div class="stack">
        <label class="label">Display name</label>
        <input id="name" class="input" type="text" placeholder="What should we call you?" />

        <label class="label">Date of birth</label>
        <input id="dob" class="input" type="date" />

        <label class="label">Timezone</label>
        <select id="tz" class="input">
          ${t.map(h=>`<option value="${h}" ${h===r?"selected":""}>${h}</option>`).join("")}
        </select>

        <button id="save" class="btn primary">Save</button>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const s=e.querySelector("#msg"),i=e.querySelector("#name"),a=e.querySelector("#dob"),l=e.querySelector("#tz");function u(h){s.textContent=h||""}e.querySelector("#save").addEventListener("click",async()=>{u("");const h=String(i.value||"").trim(),f=String(a.value||"").trim(),m=String(l.value||"").trim();if(!m){u("Please select a timezone.");return}try{await YE(n.uid,{email:n.email||"",displayName:h||"",dob:f||"",timeZone:m,weekStartsOn:"monday",role:"user"}),te("#/home")}catch(y){u(y?.message||"Could not save profile.")}})}function aT(n){return{trophy:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 21h8M12 17v4M7 4h10v3a5 5 0 0 1-10 0V4Z"/><path d="M17 7h3a4 4 0 0 1-4 4M7 7H4a4 4 0 0 0 4 4"/></svg>',check:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20 6 9 17l-5-5"/></svg>',home:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V10.5Z"/></svg>',history:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 4v6h6"/><path d="M12 7v6l4 2"/></svg>',gear:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.5-2.3.7a8 8 0 0 0-5-2.9L12 0h-4l-.9 2.1a8 8 0 0 0-5 2.9l-2.3-.7-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 6l-2 1.2 2 3.5 2.3-.7a8 8 0 0 0 5 2.9L8 24h4l.9-2.1a8 8 0 0 0 5-2.9l2.3.7 2-3.5-2-1.2Z"/></svg>'}[n]||""}function cT({active:n}){return`
      <nav class="tabs">
        ${[{id:"leaderboard",label:"Leaderboard",href:"#/leaderboard",icon:"trophy"},{id:"today",label:"Today",href:"#/today",icon:"check"},{id:"home",label:"Home",href:"#/home",icon:"home",center:!0},{id:"history",label:"History",href:"#/history",icon:"history"},{id:"settings",label:"Settings",href:"#/settings",icon:"gear"}].map(t=>`
          <a class="tab ${t.center?"tab-center":""} ${n===t.id?"active":""}" href="${t.href}" aria-label="${t.label}">
            <span class="tab-ico">${aT(t.icon)}</span>
            <span class="tab-txt">${t.label}</span>
          </a>
        `).join("")}
      </nav>
    `}function _e({title:n,activeTab:e,content:t}){return`
    <div class="app">
      <header class="header">
        <div class="header-title">${n||"Ethos"}</div>
      </header>

      <main class="content">
        ${t||""}
      </main>

      ${cT({active:e})}
    </div>
  `}function ws(){const n=document.getElementById("app");n.innerHTML=_e({title:"Home",activeTab:"home",content:`
      <section class="card">
        <div class="card-title">How are you doing today?</div>
        <div class="muted">A gentle glance. No pressure.</div>
      </section>

      <section class="card">
        <div class="card-title">Pinned targets (stub)</div>
        <div class="muted">Example: 8,000 / 15,000 steps</div>
        <div class="muted">Example: 1.5L / 3L water</div>
        <div class="muted">Example: 3 / 6 sessions this week</div>
      </section>
    `})}function Qd(n){return lT(new Date,n)}function lT(n,e){const t=uT(n,e);return`${t.year}-${js(t.month)}-${js(t.day)}`}function Yd(n){const[e,t,r]=n.split("-").map(Number),s=new Date(Date.UTC(e,t-1,r)),i=hT(s),a=`${e}-${js(t)}`;return{weekKey:i,monthKey:a}}function uT(n,e){const r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(n).reduce((s,i)=>(i.type!=="literal"&&(s[i.type]=i.value),s),{});return{year:Number(r.year),month:Number(r.month),day:Number(r.day)}}function hT(n){const e=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=Math.ceil(((e-r)/864e5+1)/7);return`${e.getUTCFullYear()}-W${js(s)}`}function js(n){return String(n).padStart(2,"0")}function gn(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function dT(n){return!n||!n.length?"":`
    <div class="bullets">
      ${n.map(e=>`<div class="bullet">${e}</div>`).join("")}
    </div>
  `}function fT(n,e){return n?.tracks?.[e]||null}function pT(n){return n==="weekly"?"This week":n==="monthly"?"This month":n==="yearly"?"This year":"Today"}function ru(n){if(typeof n!="string")return n;const e=n.match(/^(\d{4}-\d{2}-\d{2}):(.+)$/);return e?e[2]:n}function mT(n){const e=Array.isArray(n?.config?.options)?n.config.options:[],t={};for(const r of e)t[r.id]=r.label;return t}function gT(n,e,t,r){const s={};for(const i of n)s[i.id]=null;for(const i of e){const a=i?.period?.weekKey,l=i?.period?.monthKey;for(const u of n){if(u.cadence==="daily"||u.cadence==="weekly"&&a!==t||u.cadence==="monthly"&&l!==r)continue;const h=i?.tracks?.[u.id];if(h){if(s[u.id]||(s[u.id]={}),u.type==="COUNTER_INCREMENT"){s[u.id].sum=Number(s[u.id].sum||0)+Number(h.sum||0),s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0);continue}if(u.type==="NUMBER_REPLACE"){s[u.id].value===void 0&&(s[u.id].value=h.value);continue}if(u.type==="BOOLEAN"){s[u.id].done=!!s[u.id].done||!!h.done,s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0);continue}s[u.id].count=Number(s[u.id].count||0)+Number(h.count||0),s[u.id].preview===void 0&&h.preview&&(s[u.id].preview=h.preview),s[u.id].lastValue===void 0&&h.lastValue&&(s[u.id].lastValue=h.lastValue)}}}return s}function yT(n,e,t,r){const s=n.cadence||"daily",i=pT(s),a=Number(n?.target?.value||0),l=s==="daily"?e:t,u=n.type==="DROPDOWN_EVENT"?mT(n):null;let h="",f="",m="";if(n.type==="COUNTER_INCREMENT"){const b=Number(l?.sum||0);h=a?`${b} / ${a}`:`${b}`,f=a?`${i}  Target ${a}`:i}if(n.type==="BOOLEAN"){const b=!!l?.done;h=b?"":"",f=b?"Done":"Not yet"}if(n.type==="NUMBER_REPLACE"){const b=l?.value;h=b===0||b?`${b} ${n.unit||""}`.trim():"",f=i}if(n.type==="TEXT_APPEND"){const D=(r?.textEntriesByTrack?.[n.id]||[]).slice().map(x=>(x.text||"").trim()).filter(Boolean),k=D.length;h=k?`${k}`:"0",f=k===1?"1 entry":`${k} entries`;const C=D[0];C&&(m=`
        <div class="mini muted" style="margin-top:10px;">
          ${gn(C)}
        </div>
      `)}if(n.type==="DROPDOWN_EVENT"){const b=Number(l?.count||0);h=a?`${b} / ${a}`:`${b}`,f=b?s==="daily"?"Selected":"Events":"No selection yet";let D=[];s==="daily"?D=(Array.isArray(e?.lastValue)?e.lastValue:[]).map(C=>ru(C)).map(C=>u?.[C]||C).filter(Boolean):D=(r?.periodEventsByTrack?.[n.id]||[]).map(k=>ru(k)).map(k=>u?.[k]||k).filter(Boolean),D.length&&(m=`<div style="margin-top:10px;">${dT(D.slice(0,3).map(gn))}</div>`,f=s==="daily"?D[0]:`Events: ${D.length}`)}const y=n.type==="COUNTER_INCREMENT"?`${i}${a?`  Target ${a}`:""}`:n.type==="DROPDOWN_EVENT"?`${i}${a?`  Target ${a}`:""}`:i;return`
    <div class="card">
      <div class="row" style="justify-content:space-between;gap:12px;align-items:flex-start;">
        <div style="min-width:0;">
          <div class="card-title">${gn(n.name)}</div>
          <div class="mini muted">${y}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-weight:700;">${gn(h)}</div>
          ${f?`<div class="mini muted">${gn(f)}</div>`:""}
        </div>
      </div>
      ${m||""}
    </div>
  `}async function _T({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=_e({title:"Today",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});try{const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=Qd(r),{weekKey:i,monthKey:a}=Yd(s),l=await jd(n.uid),u=await Hd(n.uid,s),h=await tT(n.uid,31),f=gT(l,h,i,a),m={};for(const k of l)k.type==="TEXT_APPEND"&&(m[k.id]=await nu(n.uid,s,k.id,20));const y={};for(const k of l){if(k.type!=="DROPDOWN_EVENT"||k.cadence==="daily")continue;const C=[];for(const x of h){if(k.cadence==="weekly"&&x?.period?.weekKey!==i||k.cadence==="monthly"&&x?.period?.monthKey!==a)continue;const N=x?.tracks?.[k.id],O=Number(N?.count||0);if(!O)continue;const U=await nu(n.uid,x.dayKey,k.id,Math.min(30,O));for(const Y of U){const F=Y?.optionIds?.[0];F&&C.push(F)}}y[k.id]=C}const b={textEntriesByTrack:m,periodEventsByTrack:y},D=l.length?l.map(k=>yT(k,fT(u,k.id),f[k.id],b)).join(""):'<div class="card"><div class="muted">No active tracks yet. Add some in Settings  Manage Tracks.</div></div>';t.innerHTML=_e({title:"Today",activeTab:"today",content:`
        <div class="content">
          <div class="mini muted" style="margin:6px 0 14px;">${s}  ${r}</div>
          ${D}
        </div>

        <button class="fab" id="goLog" title="Log for today"></button>
      `}),t.querySelector("#goLog").addEventListener("click",()=>{te("#/today/log")})}catch(r){console.error("Today page load failed:",r),t.innerHTML=_e({title:"Today",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Today</h2>
          <p class="muted" style="white-space:pre-wrap;">${gn(r?.message||String(r))}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}function xe(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}async function vT({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=_e({title:"Log",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=Qd(r),{weekKey:i,monthKey:a}=Yd(s);try{const l=await jd(n.uid),u=await Hd(n.uid,s),h=l.map(f=>{const m=u?.tracks?.[f.id]||null;if(f.type==="TEXT_APPEND"){const y=m?.count||0;return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Entries today: ${y}</div>
            <textarea class="input" rows="2"
              data-track="${f.id}" data-type="TEXT_APPEND"
              placeholder="Write a quick note"></textarea>
          </div>
        `}if(f.type==="NUMBER_REPLACE"){const y=m?.value===0||m?.value?m.value:"";return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Current: ${xe(y)} ${xe(f.unit||"")}</div>
            <input class="input"
              inputmode="decimal"
              type="text"
              data-track="${f.id}" data-type="NUMBER_REPLACE"
              placeholder="Enter value"
              value="" />
          </div>
        `}if(f.type==="DROPDOWN_EVENT"){const y=m?.count||0,D=(Array.isArray(f.config?.options)?f.config.options:[]).map(k=>`<option value="${xe(k.id)}">${xe(k.label)}</option>`).join("");return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Count today: ${y}</div>
            <select class="select" data-track="${f.id}" data-type="DROPDOWN_EVENT">
              <option value="">Select</option>
              ${D}
            </select>
          </div>
        `}if(f.type==="COUNTER_INCREMENT"){const y=Number(f.config?.incrementStep||1),b=m?.sum||0;return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today: ${xe(b)} ${xe(f.unit||"")}</div>

            <div class="row" style="align-items:center;gap:10px;">
              <button class="btn" type="button" data-counter-dec="${f.id}"></button>

              <input class="input"
                style="width:90px;text-align:center;"
                inputmode="numeric"
                type="text"
                data-track="${f.id}" data-type="COUNTER_INCREMENT"
                data-step="${y}"
                placeholder="${y}"
                value="" />

              <button class="btn" type="button" data-counter-inc="${f.id}">+</button>

              <div class="mini muted">(${y} ${xe(f.unit||"")})</div>
            </div>
          </div>
        `}if(f.type==="BOOLEAN"){if((f.config?.booleanMode||"done_only")==="done_only"){const b=m?.done?"checked":"";return`
            <div class="card">
              <div class="card-title">${xe(f.name)}</div>
              <label class="toggle">
                <input type="checkbox" data-track="${f.id}" data-type="BOOLEAN_DONE" ${b}/>
                Done today
              </label>
            </div>
          `}return`
          <div class="card">
            <div class="card-title">${xe(f.name)}</div>
            <div class="mini muted">Today count: ${m?.count||0}</div>
            <input class="input" type="number" min="0" step="1"
              data-track="${f.id}" data-type="BOOLEAN_COUNT"
              placeholder="Add count (e.g. 1)" />
          </div>
        `}return""}).join("");t.innerHTML=_e({title:"Log",activeTab:"today",content:`
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
              <div class="mini muted">${s}  ${r}</div>
              <div style="font-weight:700;font-size:18px;">Log entries</div>
            </div>
            <button class="btn" id="back" type="button">Back</button>
          </div>

          ${h}

          <div class="row" style="justify-content:flex-end;gap:10px;margin-top:10px;">
            <button class="btn primary" id="submit" type="button">Submit</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;margin-top:8px;"></div>
        </div>
      `}),t.querySelector("#back").addEventListener("click",()=>te("#/today")),t.querySelectorAll("[data-counter-inc]").forEach(f=>{f.addEventListener("click",()=>{const m=f.dataset.counterInc,y=t.querySelector(`input[data-track="${m}"][data-type="COUNTER_INCREMENT"]`);if(!y)return;const b=Number(y.dataset.step||1),D=Number(String(y.value||"").trim()||0);y.value=String(D+b)})}),t.querySelectorAll("[data-counter-dec]").forEach(f=>{f.addEventListener("click",()=>{const m=f.dataset.counterDec,y=t.querySelector(`input[data-track="${m}"][data-type="COUNTER_INCREMENT"]`);if(!y)return;const b=Number(y.dataset.step||1),D=Number(String(y.value||"").trim()||0);y.value=String(Math.max(0,D-b))})}),t.querySelectorAll('select[data-type="DROPDOWN_EVENT"]').forEach(f=>{f.addEventListener("change",()=>{})}),t.querySelector("#submit").addEventListener("click",async()=>{const f=t.querySelector("#status");f.textContent="Saving";const m=qE(ye),y=me(ye,"users",n.uid,"days",s);m.set(y,{dayKey:s,timeZone:r,period:{weekKey:i,monthKey:a},updatedAt:J()},{merge:!0});const b=xn(ye,"users",n.uid,"days",s,"entries"),D=Array.from(t.querySelectorAll("[data-track][data-type]"));let k=0;for(const C of D){const x=C.dataset.track,N=C.dataset.type;if(N==="TEXT_APPEND"){const O=C.value.trim();if(!O)continue;const U=me(b);m.set(U,{trackId:x,type:"TEXT_APPEND",text:O,createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"TEXT_APPEND",count:tr(1),preview:O.slice(0,80),lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}if(N==="NUMBER_REPLACE"){const O=C.value.trim();if(O==="")continue;const U=Number(O);if(Number.isNaN(U))continue;const Y=me(b);m.set(Y,{trackId:x,type:"NUMBER_REPLACE",value:U,createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"NUMBER_REPLACE",value:U,lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}if(N==="COUNTER_INCREMENT"){const O=String(C.value||"").trim();if(O==="")continue;const U=Number(O);if(!U||Number.isNaN(U))continue;const Y=me(b);m.set(Y,{trackId:x,type:"COUNTER_INCREMENT",deltaValue:U,createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"COUNTER_INCREMENT",count:tr(1),sum:tr(U),lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}if(N==="DROPDOWN_EVENT"){const O=C.value;if(!O)continue;const U=me(b);m.set(U,{trackId:x,type:"DROPDOWN_EVENT",optionIds:[O],createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"DROPDOWN_EVENT",count:tr(1),lastValue:[O],lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}if(N==="BOOLEAN_DONE"){const O=!!C.checked,U=me(b);m.set(U,{trackId:x,type:"BOOLEAN",value:O,createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"BOOLEAN",done:O,count:O?1:0,lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}if(N==="BOOLEAN_COUNT"){const O=C.value.trim();if(O==="")continue;const U=Number(O);if(!U||Number.isNaN(U))continue;const Y=me(b);m.set(Y,{trackId:x,type:"BOOLEAN",deltaCount:U,createdAt:J(),createdAtMs:Date.now()}),m.set(y,{tracks:{[x]:{type:"BOOLEAN",count:tr(U),done:!0,lastAt:J()}},updatedAt:J()},{merge:!0}),k++;continue}}if(!k){f.textContent="Nothing to save.",setTimeout(()=>f.textContent="",1200);return}try{await m.commit(),f.textContent="Saved.",te("#/today")}catch(C){console.error("Log submit failed:",C),f.textContent=`Save failed: ${C?.message||C}`,alert(`Save failed:
${C?.message||C}`)}})}catch(l){console.error("Today log page load failed:",l),t.innerHTML=_e({title:"Log",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Log</h2>
          <p class="muted" style="white-space:pre-wrap;">${l?.message||String(l)}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}function ET(){const n=document.getElementById("app");n.innerHTML=_e({title:"History",activeTab:"history",content:`
      <section class="card">
        <div class="card-title">Reflection (stub)</div>
        <div class="muted">Calendar/list view comes next.</div>
      </section>
    `})}function TT(){const n=document.getElementById("app");n.innerHTML=_e({title:"Settings",activeTab:"settings",content:`
      <section class="card">
        <div class="card-title">Settings</div>

        <div class="list">
          <button class="list-item" id="goProfile" type="button">
            <div>
              <div class="li-title">Profile</div>
              <div class="muted">Name, DOB, timezone</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTheme" type="button">
            <div>
              <div class="li-title">Theme</div>
              <div class="muted">Mode + accent colors</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTracks" type="button">
            <div>
              <div class="li-title">Manage Tracks</div>
              <div class="muted">Add, edit, reorder, activate/deactivate</div>
            </div>
            <div class="chev"></div>
          </button>
        </div>
      </section>

      <section class="card">
        <div class="card-title">Account</div>
        <button id="logout" class="btn" type="button">Logout</button>
      </section>
    `}),n.querySelector("#goProfile").addEventListener("click",()=>te("#/settings/profile")),n.querySelector("#goTheme").addEventListener("click",()=>te("#/settings/theme")),n.querySelector("#goTracks").addEventListener("click",()=>te("#/settings/tracks")),n.querySelector("#logout").addEventListener("click",async()=>{await QE(),te("#/auth")})}function wT(){const n=document.getElementById("app");n.innerHTML=_e({title:"Leaderboard",activeTab:"leaderboard",content:`
      <section class="card">
        <div class="card-title">Leaderboard (stub)</div>
        <div class="muted">Well wire this after data model is locked.</div>
      </section>
    `})}function IT(){try{if(typeof Intl.supportedValuesOf=="function")return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney"]}async function AT({user:n}){const e=document.getElementById("app");e.innerHTML=_e({title:"Profile",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Cr(n.uid),r=IT();e.innerHTML=_e({title:"Profile",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Profile</div>
            <div class="muted">Personal details for your Ethos space</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Display name</div>
            <input class="input" id="displayName" value="${t?.displayName||""}" placeholder="Your name" />
          </label>

          <label class="field">
            <div class="label">DOB (optional)</div>
            <input class="input" id="dob" type="date" value="${t?.dob||""}" />
          </label>

          <label class="field">
            <div class="label">Time zone</div>
            <input class="input" id="timeZone" list="tzList" value="${t?.timeZone||"Asia/Kolkata"}" />
            <datalist id="tzList">
              ${r.slice(0,500).map(s=>`<option value="${s}"></option>`).join("")}
            </datalist>
            <div class="mini muted">Tip: start typing Asia/ and pick from suggestions.</div>
          </label>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>te("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#displayName").value.trim(),a=e.querySelector("#dob").value||null,l=e.querySelector("#timeZone").value.trim()||"Asia/Kolkata";try{const u=me(ye,"users",n.uid);await yi(u,{displayName:i,dob:a,timeZone:l,updatedAt:J()}),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Profile save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Profile save failed:
${u?.message||u}`)}})}async function bT(n){const e=xn(ye,"users",n,"tracks"),t=fi(e,mi("sortOrder","asc"));return(await gi(t)).docs.map(s=>({...s.data(),id:s.id}))}async function su(n,e,t){const r=me(ye,"users",n,"tracks",e);await yi(r,{...t,updatedAt:J()})}async function RT(n,e){const t=me(ye,"users",n,"tracks",e);await Bd(t)}async function ST({user:n}){const e=document.getElementById("app");e.innerHTML=_e({title:"Manage Tracks",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let t=[],r=[],s=[];await i(),h(),f();async function i(){t=await bT(n.uid),r=a(t.filter(N=>N.isActive!==!1)),s=a(t.filter(N=>N.isActive===!1))}function a(N){return N.slice().sort((O,U)=>(Number(O.sortOrder)||0)-(Number(U.sortOrder)||0))}function l(N){const O=N.cadence||"",U=N.unit?`  ${N.unit}`:"";return`${O}${U}`.trim()}function u(N){return N?.isPrivate?'<span class="pill">Private</span>':""}function h(){e.innerHTML=_e({title:"Manage Tracks",activeTab:"settings",content:`
        <section class="card">
          <div class="card-title">Active</div>
          <div class="muted">Hold the handle, then drag to reorder.</div>
          ${r.length?`<div class="list" id="activeList">${r.map(m).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No active tracks yet.</div>'}
        </section>

        <section class="card">
          <div class="card-title">Inactive</div>
          <div class="muted">Hidden from Today. Re-enable anytime.</div>
          ${s.length?`<div class="list" id="inactiveList">${s.map(y).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No inactive tracks.</div>'}
        </section>

        <!-- FAB + menu -->
        <button class="fab" id="fabTracks" title="Add track">
          <span class="fab-plus">+</span>
        </button>

        <div class="fab-menu hidden" id="fabMenu">
          <button class="fab-item" id="fabCustom">
            <span class="fab-ico"></span>
            <span>Create custom</span>
          </button>
          <button class="fab-item" id="fabTemplates">
            <span class="fab-ico"></span>
            <span>Templates</span>
          </button>
        </div>

        <div class="fab-backdrop hidden" id="fabBackdrop"></div>
      `})}function f(){e.querySelectorAll("[data-edit]").forEach(N=>{N.addEventListener("click",()=>{const O=N.getAttribute("data-edit");te(`#/settings/tracks/edit?trackId=${encodeURIComponent(O)}`)})}),e.querySelectorAll("[data-toggle]").forEach(N=>{N.addEventListener("click",async()=>{const O=N.getAttribute("data-toggle"),U=N.getAttribute("data-next")==="true";N.disabled=!0;try{await su(n.uid,O,{isActive:U}),await i(),h(),f()}catch(Y){console.error("Toggle failed:",Y),alert(Y?.message||"Could not update track."),N.disabled=!1}})}),e.querySelectorAll("[data-del]").forEach(N=>{N.addEventListener("click",async()=>{const O=N.getAttribute("data-del"),U=s.find(F=>F.id===O);if(!(!U||!confirm(`Delete "${U.name}"? This cannot be undone.`))){s=s.filter(F=>F.id!==O),h(),f();try{await RT(n.uid,O),await i(),h(),f()}catch(F){console.error("Delete failed:",F),alert(F?.message||"Could not delete track."),await i(),h(),f()}}})}),D(),b()}function m(N){return`
      <div class="track-row" data-id="${N.id}">
        <div class="drag-handle" data-handle="1" title="Hold & drag"></div>

        <div class="track-main">
          <div class="track-title">
            ${x(N.name)}
            ${u(N)}
          </div>
          <div class="track-meta muted">${x(l(N))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${N.id}" title="Edit">
            ${k()}
          </button>

          <!-- Toggle switch: ON -->
          <button class="switch on" data-toggle="${N.id}" data-next="false" title="Disable"></button>
        </div>
      </div>
    `}function y(N){return`
      <div class="track-row track-row-inactive" data-id="${N.id}">
        <div class="drag-handle drag-handle-disabled" title="Inactive"></div>

        <div class="track-main">
          <div class="track-title">
            ${x(N.name)}
            ${u(N)}
          </div>
          <div class="track-meta muted">${x(l(N))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${N.id}" title="Edit">
            ${k()}
          </button>

          <button class="icon-btn danger" data-del="${N.id}" title="Delete">
            ${C()}
          </button>

          <!-- Toggle switch: OFF -->
          <button class="switch" data-toggle="${N.id}" data-next="true" title="Enable"></button>
        </div>
      </div>
    `}function b(){const N=e.querySelector("#fabTracks"),O=e.querySelector("#fabMenu"),U=e.querySelector("#fabBackdrop");if(!N||!O||!U)return;const Y=()=>{O.classList.remove("hidden"),U.classList.remove("hidden"),N.classList.add("fab-open")},F=()=>{O.classList.add("hidden"),U.classList.add("hidden"),N.classList.remove("fab-open")};N.addEventListener("click",()=>{!O.classList.contains("hidden")?F():Y()}),U.addEventListener("click",F);const E=e.querySelector("#fabCustom"),g=e.querySelector("#fabTemplates");E?.addEventListener("click",()=>{F(),te("#/settings/tracks/new")}),g?.addEventListener("click",()=>{F(),te("#/settings/tracks/templates")})}function D(){const N=e.querySelector("#activeList");if(!N)return;let O=!1,U=!1,Y=null,F=null,E=null,g=0,v=0;const w=ie=>{U&&ie.preventDefault()};N.querySelectorAll(".drag-handle").forEach(ie=>{ie.addEventListener("pointerdown",je=>{if(O=!0,U=!1,F=ie.closest(".track-row"),!F)return;ie.setPointerCapture?.(je.pointerId),g=je.clientY;const De=F.getBoundingClientRect();v=g-De.top,Y=setTimeout(()=>{O&&T()},180)}),ie.addEventListener("pointermove",je=>{O&&U&&(je.preventDefault(),A(je.clientY))}),ie.addEventListener("pointerup",async()=>{O=!1,clearTimeout(Y),U&&(_(),await Ae()),U=!1,F=null}),ie.addEventListener("pointercancel",()=>{O=!1,clearTimeout(Y),U&&_(),U=!1,F=null})});function T(){U=!0,E=document.createElement("div"),E.className="drag-placeholder",E.style.height=`${F.getBoundingClientRect().height}px`,F.parentNode.insertBefore(E,F);const ie=F.getBoundingClientRect();F.classList.add("dragging"),F.style.width=`${ie.width}px`,F.style.position="fixed",F.style.left=`${ie.left}px`,F.style.zIndex="9999",document.addEventListener("touchmove",w,{passive:!1}),A(g)}function A(ie){const je=ie-v;F.style.top=`${je}px`;const De=[...N.querySelectorAll(".track-row:not(.dragging)")],Ke=ie;let _t=null;for(const Wr of De){const Un=Wr.getBoundingClientRect();if(Ke<Un.top+Un.height/2){_t=Wr;break}}_t?N.insertBefore(E,_t):N.appendChild(E)}function _(){F.classList.remove("dragging"),F.style.position="",F.style.top="",F.style.left="",F.style.width="",F.style.zIndex="",N.insertBefore(F,E),E.remove(),E=null,document.removeEventListener("touchmove",w)}async function Ae(){r=[...N.querySelectorAll(".track-row")].map(De=>De.getAttribute("data-id")).filter(Boolean).map(De=>r.find(Ke=>Ke.id===De)).filter(Boolean);const je=Date.now();try{await Promise.all(r.map((De,Ke)=>su(n.uid,De.id,{sortOrder:je+Ke*10}))),await i(),h(),f()}catch(De){console.error(De),alert(De?.message||"Could not save order.")}}}function k(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 20h9"></path>
        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
      </svg>
    `}function C(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18"></path>
        <path d="M8 6V4h8v2"></path>
        <path d="M19 6l-1 14H6L5 6"></path>
        <path d="M10 11v6"></path>
        <path d="M14 11v6"></path>
      </svg>
    `}function x(N){return String(N||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}}function pr(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ra(){return Math.random().toString(36).slice(2,8)}const PT={COUNTER_INCREMENT:"Counter",BOOLEAN:"Checklist",NUMBER_REPLACE:"Metric",TEXT_APPEND:"Notes",DROPDOWN_EVENT:"Choice"},CT=["","COUNTER_INCREMENT","BOOLEAN","NUMBER_REPLACE","TEXT_APPEND","DROPDOWN_EVENT"];function kT(n){const e={unit:"",target:null,config:{}};return n==="COUNTER_INCREMENT"?{...e,target:{mode:"value",value:0},config:{incrementStep:1}}:n==="BOOLEAN"?{...e,target:null,config:{booleanMode:"done_only"}}:n==="NUMBER_REPLACE"?{...e,target:null,config:{precision:2}}:n==="TEXT_APPEND"?{...e,target:null,config:{}}:n==="DROPDOWN_EVENT"?{...e,target:{mode:"count",value:0},config:{options:[]}}:e}function Po(n,e){const t={name:n.name??"",cadence:n.cadence??"daily",type:e,isActive:n.isActive??!0,sortOrder:n.sortOrder??Date.now(),isPrivate:!!n.isPrivate};if(!e)return{...t,unit:"",target:null,config:{}};const r=kT(e),s={};if(e==="COUNTER_INCREMENT"&&(s.unit=n.unit||"",s.target={mode:n.target?.mode||"value",value:Number(n.target?.value||0)},s.config={incrementStep:Number(n.config?.incrementStep||r.config.incrementStep||1)}),e==="BOOLEAN"&&(s.unit="",s.target=null,s.config={booleanMode:"done_only"}),e==="NUMBER_REPLACE"&&(s.unit=n.unit||"",s.target=null,s.config={precision:2}),e==="TEXT_APPEND"&&(s.unit="",s.target=null,s.config={}),e==="DROPDOWN_EVENT"){s.unit="",s.target={mode:"count",value:Number(n.target?.value||0)};const i=Array.isArray(n.config?.options)?n.config.options:[];s.config={options:i.map(a=>({id:a.id||Ra(),label:a.label||""}))}}return{...t,...r,...s}}function NT(n){const e=n.type;if(!e||e==="BOOLEAN"||e==="TEXT_APPEND")return"";if(e==="COUNTER_INCREMENT")return`
      <div class="card" style="margin-top:12px;">
        <div class="card-title">Counter settings</div>

        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="min-width:220px;">
            <div class="label">Unit</div>
            <input class="input" id="unit" value="${pr(n.unit||"")}" placeholder="ml / steps / times" />
          </label>

          <label class="field" style="min-width:220px;">
            <div class="label">Increment step</div>
            <input class="input" id="incrementStep" type="number" min="0" step="1"
              value="${Number(n.config?.incrementStep||1)}" placeholder="1" />
            <div class="mini muted">Example: 250 for water in ml, or 1 for times.</div>
          </label>
        </div>

        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="min-width:220px;">
            <div class="label">Target mode</div>
            <select class="select" id="targetMode">
              <option value="value" ${n.target?.mode==="value"?"selected":""}>value</option>
              <option value="count" ${n.target?.mode==="count"?"selected":""}>count</option>
            </select>
            <div class="mini muted">Use count for times, value for amount.</div>
          </label>

          <label class="field" style="min-width:220px;">
            <div class="label">Target value (optional)</div>
            <input class="input" id="targetValue" type="number" min="0" step="1"
              value="${Number(n.target?.value||0)}" />
            <div class="mini muted">0 means no target.</div>
          </label>
        </div>
      </div>
    `;if(e==="NUMBER_REPLACE")return`
      <div class="card" style="margin-top:12px;">
        <div class="card-title">Metric settings</div>
        <div class="mini muted">Latest value persists until changed.</div>

        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="min-width:220px;">
            <div class="label">Unit (optional)</div>
            <input class="input" id="unit" value="${pr(n.unit||"")}" placeholder="kg / cm / bpm" />
          </label>
        </div>

        <div class="mini muted" style="margin-top:8px;">Precision is fixed to 2 decimals for now.</div>
      </div>
    `;if(e==="DROPDOWN_EVENT"){const t=Array.isArray(n.config?.options)?n.config.options:[],r=t.length?t.map((s,i)=>`
          <div class="row" style="justify-content:space-between;align-items:center;gap:10px;padding:10px;border:1px solid var(--border);border-radius:12px;">
            <div style="flex:1;min-width:0;">
              <div style="font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${pr(s.label||"")}</div>
              <div class="mini muted">Option ${i+1}</div>
            </div>
            <div class="row" style="gap:6px;">
              <button class="btn" type="button" data-opt-up="${s.id}" ${i===0?"disabled":""}></button>
              <button class="btn" type="button" data-opt-down="${s.id}" ${i===t.length-1?"disabled":""}></button>
              <button class="btn danger" type="button" data-opt-del="${s.id}">Remove</button>
            </div>
          </div>
        `).join(""):'<div class="mini muted" style="margin-top:8px;">No options yet.</div>';return`
      <div class="card" style="margin-top:12px;">
        <div class="card-title">Choice settings</div>
        <div class="mini muted">Pick one option (e.g., workout type).</div>

        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="min-width:220px;">
            <div class="label">Target count (optional)</div>
            <input class="input" id="targetValue" type="number" min="0" step="1"
              value="${Number(n.target?.value||0)}" />
            <div class="mini muted">0 means no target.</div>
          </label>
        </div>

        <div class="row" style="gap:10px;flex-wrap:wrap;margin-top:10px;">
          <label class="field" style="flex:1;min-width:220px;">
            <div class="label">Add option</div>
            <input class="input" id="optLabel" placeholder="e.g., Chest / Legs / Full body" />
          </label>
          <button class="btn primary" id="optAdd" type="button" style="align-self:flex-end;height:44px;">Add</button>
        </div>

        <div class="stack" style="margin-top:10px;display:flex;flex-direction:column;gap:8px;">
          ${r}
        </div>
      </div>
    `}return""}function DT({mode:n,draft:e}){return _e({title:n==="edit"?"Edit Track":"New Track",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">${n==="edit"?"Edit track":"Create a track"}</div>
            <div class="muted">Keep it simple. You can refine later.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Name</div>
            <input class="input" id="name" value="${pr(e.name||"")}" placeholder="Water / Steps / Journal" />
          </label>

          <div class="row" style="gap:12px;flex-wrap:wrap;align-items:flex-end;margin-top:10px;">
            <label class="field" style="min-width:220px;">
              <div class="label">Cadence</div>
              <select class="select" id="cadence">
                ${[{v:"daily",l:"Daily"},{v:"weekly",l:"Weekly"},{v:"monthly",l:"Monthly"},{v:"yearly",l:"Yearly"}].map(({v:t,l:r})=>`<option value="${t}" ${e.cadence===t?"selected":""}>${r}</option>`).join("")}
              </select>
            </label>

            <div class="field" style="flex:1;min-width:260px;">
              <div class="row" style="justify-content:space-between;align-items:center;gap:10px;">
                <div class="mini muted">Private (wont appear on leaderboard)</div>
                <button class="switch ${e.isPrivate?"on":""}" id="privacySwitch" type="button"></button>
              </div>
            </div>

            <label class="field" style="min-width:220px;">
              <div class="label">Type</div>
              <select class="select" id="type">
                ${CT.map(t=>t?`<option value="${t}" ${e.type===t?"selected":""}>${pr(PT[t]||t)}</option>`:`<option value="" ${e.type?"":"selected"}>Select</option>`).join("")}
              </select>
            </label>
          </div>

          <div id="typeFields">
            ${NT(e)}
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;margin-top:12px;">
            ${n==="edit"?'<button class="btn danger" id="del" type="button">Delete</button>':""}
            <button class="btn primary" id="save" type="button">Save</button>
          </div>
        </div>
      </section>
    `})}function VT(n){const e=(n.name||"").trim();if(!e)throw new Error("Name is required.");const t=n.cadence||"daily",r=n.type;if(!r)throw new Error("Select a type.");const s=Po(n,r),i={name:e,cadence:t,type:r,isPrivate:!!s.isPrivate};if(r==="COUNTER_INCREMENT"){const a=(s.unit||"").trim();if(!a)throw new Error("Unit is required for Counter.");i.unit=a,i.target={mode:s.target?.mode||"value",value:Number(s.target?.value||0)},i.config={incrementStep:Math.max(0,Number(s.config?.incrementStep||1))}}if(r==="BOOLEAN"&&(i.unit="",i.target=null,i.config={booleanMode:"done_only"}),r==="NUMBER_REPLACE"&&(i.unit=(s.unit||"").trim(),i.target=null,i.config={precision:2}),r==="TEXT_APPEND"&&(i.unit="",i.target=null,i.config={}),r==="DROPDOWN_EVENT"){i.unit="",i.target={mode:"count",value:Number(s.target?.value||0)};const l=(Array.isArray(s.config?.options)?s.config.options:[]).map(u=>({id:u.id||Ra(),label:(u.label||"").trim()})).filter(u=>u.label.length);if(!l.length)throw new Error("Add at least one option.");i.config={options:l}}return i}async function iu({user:n,mode:e}){const t=document.getElementById("app"),{query:r}=kr(),s=r.get("trackId");if(e==="edit"&&!s){te("#/settings/tracks");return}t.innerHTML=_e({title:"Track",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let i=null;if(e==="edit"){const u=me(ye,"users",n.uid,"tracks",s),h=await Aa(u);if(!h.exists()){te("#/settings/tracks");return}i={id:h.id,...h.data()}}let a=i?Po({name:i.name||"",cadence:i.cadence||"daily",type:i.type||"",unit:i.unit,target:i.target??null,config:i.config??{},isActive:i.isActive??!0,sortOrder:i.sortOrder??Date.now(),isPrivate:!!i.isPrivate},i.type||""):{name:"",cadence:"daily",type:"",isPrivate:!1,isActive:!0,sortOrder:Date.now(),unit:"",target:null,config:{}};function l(){t.innerHTML=DT({mode:e,draft:a}),t.querySelector("#back").addEventListener("click",()=>te("#/settings/tracks")),t.querySelector("#name").addEventListener("input",h=>{a.name=h.target.value}),t.querySelector("#cadence").addEventListener("change",h=>{a.cadence=h.target.value}),t.querySelector("#privacySwitch").addEventListener("click",()=>{a.isPrivate=!a.isPrivate,l()}),t.querySelector("#type").addEventListener("change",h=>{a=Po(a,h.target.value),l()});const u=a.type;u==="COUNTER_INCREMENT"&&(t.querySelector("#unit").addEventListener("input",h=>a.unit=h.target.value),t.querySelector("#incrementStep").addEventListener("input",h=>{a.config={...a.config||{},incrementStep:Number(h.target.value||1)}}),t.querySelector("#targetMode").addEventListener("change",h=>{a.target={...a.target||{},mode:h.target.value}}),t.querySelector("#targetValue").addEventListener("input",h=>{a.target={...a.target||{},value:Number(h.target.value||0)}})),u==="NUMBER_REPLACE"&&t.querySelector("#unit").addEventListener("input",h=>a.unit=h.target.value),u==="DROPDOWN_EVENT"&&(t.querySelector("#targetValue").addEventListener("input",h=>{a.target={...a.target||{},mode:"count",value:Number(h.target.value||0)}}),t.querySelector("#optAdd").addEventListener("click",()=>{const h=t.querySelector("#optLabel"),f=(h.value||"").trim();if(!f)return;const m=Array.isArray(a.config?.options)?a.config.options:[];a.config={...a.config||{},options:[...m,{id:Ra(),label:f}]},h.value="",l()}),t.querySelector("#optLabel").addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),t.querySelector("#optAdd").click())}),t.querySelectorAll("[data-opt-up]").forEach(h=>{h.addEventListener("click",()=>{const f=h.dataset.optUp,m=Array.isArray(a.config?.options)?[...a.config.options]:[],y=m.findIndex(b=>b.id===f);y<=0||([m[y-1],m[y]]=[m[y],m[y-1]],a.config={...a.config||{},options:m},l())})}),t.querySelectorAll("[data-opt-down]").forEach(h=>{h.addEventListener("click",()=>{const f=h.dataset.optDown,m=Array.isArray(a.config?.options)?[...a.config.options]:[],y=m.findIndex(b=>b.id===f);y===-1||y>=m.length-1||([m[y+1],m[y]]=[m[y],m[y+1]],a.config={...a.config||{},options:m},l())})}),t.querySelectorAll("[data-opt-del]").forEach(h=>{h.addEventListener("click",()=>{const f=h.dataset.optDel,m=Array.isArray(a.config?.options)?a.config.options:[];a.config={...a.config||{},options:m.filter(y=>y.id!==f)},l()})})),t.querySelector("#save").addEventListener("click",async()=>{try{const h=VT(a);e==="edit"?await ZE(n.uid,s,h):await JE(n.uid,{...h,isActive:!0,sortOrder:Date.now()}),te("#/settings/tracks")}catch(h){alert(h?.message||String(h))}}),t.querySelector("#del")?.addEventListener("click",async()=>{confirm("Delete this track? This wont delete past entries.")&&(await eT(n.uid,s),te("#/settings/tracks"))})}l()}async function OT({user:n}){const e=document.getElementById("app");e.innerHTML=_e({title:"Theme",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Cr(n.uid),r=zd(t?.preferences);e.innerHTML=_e({title:"Theme",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Theme</div>
            <div class="muted">Set the vibe. Keep it calm.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Mode</div>
            <select class="select" id="themeMode">
              <option value="system" ${r.themeMode==="system"?"selected":""}>System</option>
              <option value="light" ${r.themeMode==="light"?"selected":""}>Light</option>
              <option value="dark" ${r.themeMode==="dark"?"selected":""}>Dark</option>
            </select>
          </label>

          <div class="row" style="gap:14px;flex-wrap:wrap;align-items:center;">
            <label class="field" style="min-width:200px;">
              <div class="label">Accent 1</div>
              <input class="input" id="accent1" type="color" value="${r.accent1}" />
            </label>

            <label class="field" style="min-width:200px;">
              <div class="label">Accent 2</div>
              <input class="input" id="accent2" type="color" value="${r.accent2}" />
            </label>
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>te("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#themeMode").value,a=e.querySelector("#accent1").value,l=e.querySelector("#accent2").value;try{const u=me(ye,"users",n.uid);await yi(u,{preferences:{themeMode:i,accent1:a,accent2:l},updatedAt:J()});const h=await Cr(n.uid);Wd(h),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Theme save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Theme save failed:
${u?.message||u}`)}})}function LT(){const n=document.getElementById("app");n.innerHTML=_e({title:"Templates",activeTab:"settings",content:`
      <div class="center">
        <div class="card" style="text-align:center;padding:22px;">
          <div style="font-size:42px; margin-bottom:10px;"></div>
          <div style="font-weight:700; font-size:18px;">Coming soon</div>
          <div class="muted" style="margin-top:6px;">
            Track templates will live here  one tap to add.
          </div>
        </div>
      </div>
    `})}let se=null,Be=null,mr=null,Xd=!1,gr=null;function ou(n){return n.startsWith("#/auth")}function MT(n){return["#/profile-setup","#/home","#/today","#/today/log","#/history","#/settings","#/leaderboard","#/settings/profile","#/settings/theme","#/settings/tracks","#/settings/tracks/edit","#/settings/tracks/new","#/settings/tracks/templates"].includes(n.split("?")[0])}async function xT(){if(!se){Be=null,mr=null;return}mr!==se.uid&&(mr=se.uid,Be=await Cr(se.uid))}function au(n){switch(n.split("?")[0]){case"#/auth":return Gd;case"#/auth/email":return rT;case"#/auth/password":return sT;case"#/auth/create-password":return iT;case"#/profile-setup":return()=>Kd({user:se});case"#/home":return ws;case"#/today":return()=>_T({user:se,profile:Be});case"#/today/log":return()=>vT({user:se,profile:Be});case"#/history":return ET;case"#/leaderboard":return wT;case"#/settings":return()=>TT();case"#/settings/profile":return()=>AT({user:se});case"#/settings/theme":return()=>OT({user:se});case"#/settings/tracks":return()=>ST({user:se});case"#/settings/tracks/edit":return()=>iu({user:se,mode:"edit"});case"#/settings/tracks/new":return()=>iu({user:se,mode:"new"});case"#/settings/tracks/templates":return()=>LT();default:return null}}function UT(n){console.error("App render fatal:",n);const e=document.getElementById("app");e.innerHTML=`
    <div class="center">
      <div class="card">
        <div class="card-title">Something broke</div>
        <p class="muted" style="white-space:pre-wrap;">${n?.message||String(n)}</p>
        <button class="btn" onclick="location.reload()">Reload</button>
      </div>
    </div>
  `}async function Jd(){try{if(!Xd){document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';return}const{path:n}=kr();if(!n){te("#/auth");return}if(!se){ou(n)||te("#/auth");const{path:e}=kr();(au(e)||Gd)();return}if(await xT(),!Be&&n!=="#/profile-setup"){te("#/profile-setup"),Kd({user:se});return}if(se&&Be&&gr!==se.uid)try{const e=await XE(se.uid,se.email,Be);gr=se.uid,e&&(Be=await Cr(se.uid))}catch(e){console.error("Profile normalization failed:",e),gr=se.uid}try{Wd(Be)}catch(e){console.warn("Theme apply failed (continuing):",e)}if(Be&&ou(n)){te("#/home"),ws();return}if(MT(n)){(au(n)||ws)();return}te("#/home"),ws()}catch(n){UT(n)}}nT(Jd);HE(async n=>{se=n||null,Xd=!0,se?mr!==se.uid&&(Be=null,gr=null):(Be=null,mr=null,gr=null),await Jd()});document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';
