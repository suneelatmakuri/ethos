(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const bf=()=>{};var wc={};const su=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Rf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},iu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,f=i>>2,m=(i&3)<<4|l>>4;let v=(l&15)<<2|d>>6,R=d&63;u||(R=64,a||(v=64)),r.push(t[f],t[m],t[v],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(su(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Rf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const m=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||m==null)throw new Sf;const v=i<<2|l>>4;if(r.push(v),d!==64){const R=l<<4&240|d>>2;if(r.push(R),m!==64){const V=d<<6&192|m;r.push(V)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Sf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Pf=function(n){const e=su(n);return iu.encodeByteArray(e,!0)},Es=function(n){return Pf(n).replace(/\./g,"")},ou=function(n){try{return iu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Cf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const kf=()=>Cf().__FIREBASE_DEFAULTS__,Nf=()=>{if(typeof process>"u"||typeof wc>"u")return;const n=wc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Df=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ou(n[1]);return e&&JSON.parse(e)},$s=()=>{try{return bf()||kf()||Nf()||Df()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},au=n=>$s()?.emulatorHosts?.[n],Vf=n=>{const e=au(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},cu=()=>$s()?.config,lu=n=>$s()?.[`_${n}`];class Of{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Pn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function uu(n){return(await fetch(n,{credentials:"include"})).ok}function Lf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Es(JSON.stringify(t)),Es(JSON.stringify(a)),""].join(".")}const or={};function Mf(){const n={prod:[],emulator:[]};for(const e of Object.keys(or))or[e]?n.emulator.push(e):n.prod.push(e);return n}function xf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ac=!1;function hu(n,e){if(typeof window>"u"||typeof document>"u"||!Pn(window.location.host)||or[n]===e||or[n]||Ac)return;or[n]=e;function t(v){return`__firebase__banner__${v}`}const r="__firebase__banner",i=Mf().prod.length>0;function a(){const v=document.getElementById(r);v&&v.remove()}function l(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ac=!0,a()},v}function f(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function m(){const v=xf(r),R=t("text"),V=document.getElementById(R)||document.createElement("span"),N=t("learnmore"),k=document.getElementById(N)||document.createElement("a"),C=t("preprendIcon"),x=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const O=v.element;l(O),f(k,N);const q=d();u(x,C),O.append(x,V,k,q),document.body.appendChild(O)}i?(V.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ce())}function Ff(){const n=$s()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Bf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function $f(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jf(){const n=Ce();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Hf(){return!Ff()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function zf(){try{return typeof indexedDB=="object"}catch{return!1}}function Wf(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const Gf="FirebaseError";class pt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Gf,Object.setPrototypeOf(this,pt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pr.prototype.create)}}class Pr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Kf(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new pt(s,l,r)}}function Kf(n,e){return n.replace(Qf,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Qf=/\{\$([^}]+)}/g;function Yf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zt(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(bc(i)&&bc(a)){if(!Zt(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function bc(n){return n!==null&&typeof n=="object"}function Cr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function er(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function tr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Xf(n,e){const t=new Jf(n,e);return t.subscribe.bind(t)}class Jf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Zf(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Bi),s.error===void 0&&(s.error=Bi),s.complete===void 0&&(s.complete=Bi);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Zf(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Bi(){}function ce(n){return n&&n._delegate?n._delegate:n}class en{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Qt="[DEFAULT]";class ep{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Of;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(np(e))try{this.getOrInitializeService({instanceIdentifier:Qt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Qt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Qt){return this.instances.has(e)}getOptions(e=Qt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:tp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Qt){return this.component?this.component.multipleInstances?e:Qt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tp(n){return n===Qt?void 0:n}function np(n){return n.instantiationMode==="EAGER"}class rp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ep(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var W;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(W||(W={}));const sp={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},ip=W.INFO,op={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},ap=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=op[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bo{constructor(e){this.name=e,this._logLevel=ip,this._logHandler=ap,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}}const cp=(n,e)=>e.some(t=>n instanceof t);let Rc,Sc;function lp(){return Rc||(Rc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function up(){return Sc||(Sc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const du=new WeakMap,eo=new WeakMap,fu=new WeakMap,$i=new WeakMap,Ro=new WeakMap;function hp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Pt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&du.set(t,n)}).catch(()=>{}),Ro.set(e,n),e}function dp(n){if(eo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});eo.set(n,e)}let to={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return eo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||fu.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Pt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function fp(n){to=n(to)}function pp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(qi(this),e,...t);return fu.set(r,e.sort?e.sort():[e]),Pt(r)}:up().includes(n)?function(...e){return n.apply(qi(this),e),Pt(du.get(this))}:function(...e){return Pt(n.apply(qi(this),e))}}function mp(n){return typeof n=="function"?pp(n):(n instanceof IDBTransaction&&dp(n),cp(n,lp())?new Proxy(n,to):n)}function Pt(n){if(n instanceof IDBRequest)return hp(n);if($i.has(n))return $i.get(n);const e=mp(n);return e!==n&&($i.set(n,e),Ro.set(e,n)),e}const qi=n=>Ro.get(n);function gp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=Pt(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Pt(a.result),u.oldVersion,u.newVersion,Pt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const _p=["get","getKey","getAll","getAllKeys","count"],yp=["put","add","delete","clear"],ji=new Map;function Pc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ji.get(e))return ji.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=yp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||_p.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&u.done]))[0]};return ji.set(e,i),i}fp(n=>({...n,get:(e,t,r)=>Pc(e,t)||n.get(e,t,r),has:(e,t)=>!!Pc(e,t)||n.has(e,t)}));class vp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ep(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Ep(n){return n.getComponent()?.type==="VERSION"}const no="@firebase/app",Cc="0.14.6";const ut=new bo("@firebase/app"),Tp="@firebase/app-compat",Ip="@firebase/analytics-compat",wp="@firebase/analytics",Ap="@firebase/app-check-compat",bp="@firebase/app-check",Rp="@firebase/auth",Sp="@firebase/auth-compat",Pp="@firebase/database",Cp="@firebase/data-connect",kp="@firebase/database-compat",Np="@firebase/functions",Dp="@firebase/functions-compat",Vp="@firebase/installations",Op="@firebase/installations-compat",Lp="@firebase/messaging",Mp="@firebase/messaging-compat",xp="@firebase/performance",Up="@firebase/performance-compat",Fp="@firebase/remote-config",Bp="@firebase/remote-config-compat",$p="@firebase/storage",qp="@firebase/storage-compat",jp="@firebase/firestore",Hp="@firebase/ai",zp="@firebase/firestore-compat",Wp="firebase",Gp="12.6.0";const ro="[DEFAULT]",Kp={[no]:"fire-core",[Tp]:"fire-core-compat",[wp]:"fire-analytics",[Ip]:"fire-analytics-compat",[bp]:"fire-app-check",[Ap]:"fire-app-check-compat",[Rp]:"fire-auth",[Sp]:"fire-auth-compat",[Pp]:"fire-rtdb",[Cp]:"fire-data-connect",[kp]:"fire-rtdb-compat",[Np]:"fire-fn",[Dp]:"fire-fn-compat",[Vp]:"fire-iid",[Op]:"fire-iid-compat",[Lp]:"fire-fcm",[Mp]:"fire-fcm-compat",[xp]:"fire-perf",[Up]:"fire-perf-compat",[Fp]:"fire-rc",[Bp]:"fire-rc-compat",[$p]:"fire-gcs",[qp]:"fire-gcs-compat",[jp]:"fire-fst",[zp]:"fire-fst-compat",[Hp]:"fire-vertex","fire-js":"fire-js",[Wp]:"fire-js-all"};const Ts=new Map,Qp=new Map,so=new Map;function kc(n,e){try{n.container.addComponent(e)}catch(t){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Tn(n){const e=n.name;if(so.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;so.set(e,n);for(const t of Ts.values())kc(t,n);for(const t of Qp.values())kc(t,n);return!0}function So(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function xe(n){return n==null?!1:n.settings!==void 0}const Yp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ct=new Pr("app","Firebase",Yp);class Xp{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new en("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ct.create("app-deleted",{appName:this._name})}}const Cn=Gp;function pu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ro,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ct.create("bad-app-name",{appName:String(s)});if(t||(t=cu()),!t)throw Ct.create("no-options");const i=Ts.get(s);if(i){if(Zt(t,i.options)&&Zt(r,i.config))return i;throw Ct.create("duplicate-app",{appName:s})}const a=new rp(s);for(const u of so.values())a.addComponent(u);const l=new Xp(t,r,a);return Ts.set(s,l),l}function mu(n=ro){const e=Ts.get(n);if(!e&&n===ro&&cu())return pu();if(!e)throw Ct.create("no-app",{appName:n});return e}function kt(n,e,t){let r=Kp[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ut.warn(a.join(" "));return}Tn(new en(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Jp="firebase-heartbeat-database",Zp=1,pr="firebase-heartbeat-store";let Hi=null;function gu(){return Hi||(Hi=gp(Jp,Zp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(pr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ct.create("idb-open",{originalErrorMessage:n.message})})),Hi}async function em(n){try{const t=(await gu()).transaction(pr),r=await t.objectStore(pr).get(_u(n));return await t.done,r}catch(e){if(e instanceof pt)ut.warn(e.message);else{const t=Ct.create("idb-get",{originalErrorMessage:e?.message});ut.warn(t.message)}}}async function Nc(n,e){try{const r=(await gu()).transaction(pr,"readwrite");await r.objectStore(pr).put(e,_u(n)),await r.done}catch(t){if(t instanceof pt)ut.warn(t.message);else{const r=Ct.create("idb-set",{originalErrorMessage:t?.message});ut.warn(r.message)}}}function _u(n){return`${n.name}!${n.options.appId}`}const tm=1024,nm=30;class rm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new im(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>nm){const s=om(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ut.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Dc(),{heartbeatsToSend:t,unsentEntries:r}=sm(this._heartbeatsCache.heartbeats),s=Es(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ut.warn(e),""}}}function Dc(){return new Date().toISOString().substring(0,10)}function sm(n,e=tm){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Vc(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class im{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zf()?Wf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await em(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Vc(n){return Es(JSON.stringify({version:2,heartbeats:n})).length}function om(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function am(n){Tn(new en("platform-logger",e=>new vp(e),"PRIVATE")),Tn(new en("heartbeat",e=>new rm(e),"PRIVATE")),kt(no,Cc,n),kt(no,Cc,"esm2020"),kt("fire-js","")}am("");function yu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const cm=yu,vu=new Pr("auth","Firebase",yu());const Is=new bo("@firebase/auth");function lm(n,...e){Is.logLevel<=W.WARN&&Is.warn(`Auth (${Cn}): ${n}`,...e)}function ls(n,...e){Is.logLevel<=W.ERROR&&Is.error(`Auth (${Cn}): ${n}`,...e)}function qe(n,...e){throw Co(n,...e)}function He(n,...e){return Co(n,...e)}function Po(n,e,t){const r={...cm(),[e]:t};return new Pr("auth","Firebase",r).create(e,{appName:n.name})}function ct(n){return Po(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function um(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&qe(n,"argument-error"),Po(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Co(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return vu.create(n,...e)}function B(n,e,...t){if(!n)throw Co(e,...t)}function ot(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ls(e),new Error(e)}function ht(n,e){n||ot(e)}function ws(){return typeof self<"u"&&self.location?.href||""}function Eu(){return Oc()==="http:"||Oc()==="https:"}function Oc(){return typeof self<"u"&&self.location?.protocol||null}function hm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Eu()||$f()||"connection"in navigator)?navigator.onLine:!0}function dm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class kr{constructor(e,t){this.shortDelay=e,this.longDelay=t,ht(t>e,"Short delay should be less than long delay!"),this.isMobile=Uf()||qf()}get(){return hm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ko(n,e){ht(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Tu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ot("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ot("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ot("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const fm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const pm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],mm=new kr(3e4,6e4);function rt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function st(n,e,t,r,s={}){return Iu(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Cr({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...i};return Bf()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Pn(n.emulatorConfig.host)&&(d.credentials="include"),Tu.fetch()(await wu(n,n.config.apiHost,t,l),d)})}async function Iu(n,e,t){n._canInitEmulator=!1;const r={...fm,...e};try{const s=new _m(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw rs(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw rs(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw rs(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw rs(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Po(n,f,d);qe(n,f)}}catch(s){if(s instanceof pt)throw s;qe(n,"network-request-failed",{message:String(s)})}}async function Nr(n,e,t,r,s={}){const i=await st(n,e,t,r,s);return"mfaPendingCredential"in i&&qe(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function wu(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?ko(n.config,s):`${n.config.apiScheme}://${s}`;return pm.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function gm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _m{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(He(this.auth,"network-request-failed")),mm.get())})}}function rs(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=He(n,e,r);return s.customData._tokenResponse=t,s}function Lc(n){return n!==void 0&&n.enterprise!==void 0}class ym{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return gm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function vm(n,e){return st(n,"GET","/v2/recaptchaConfig",rt(n,e))}async function Em(n,e){return st(n,"POST","/v1/accounts:delete",e)}async function As(n,e){return st(n,"POST","/v1/accounts:lookup",e)}function ar(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Tm(n,e=!1){const t=ce(n),r=await t.getIdToken(e),s=No(r);B(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:ar(zi(s.auth_time)),issuedAtTime:ar(zi(s.iat)),expirationTime:ar(zi(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function zi(n){return Number(n)*1e3}function No(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ls("JWT malformed, contained fewer than 3 sections"),null;try{const s=ou(t);return s?JSON.parse(s):(ls("Failed to decode base64 JWT payload"),null)}catch(s){return ls("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Mc(n){const e=No(n);return B(e,"internal-error"),B(typeof e.exp<"u","internal-error"),B(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function mr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof pt&&Im(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Im({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class wm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class io{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ar(this.lastLoginAt),this.creationTime=ar(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bs(n){const e=n.auth,t=await n.getIdToken(),r=await mr(n,As(e,{idToken:t}));B(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?Au(s.providerUserInfo):[],a=bm(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new io(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function Am(n){const e=ce(n);await bs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Au(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Rm(n,e){const t=await Iu(n,{},async()=>{const r=Cr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await wu(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&Pn(n.emulatorConfig.host)&&(u.credentials="include"),Tu.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Sm(n,e){return st(n,"POST","/v2/accounts:revokeToken",rt(n,e))}class gn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){B(e.idToken,"internal-error"),B(typeof e.idToken<"u","internal-error"),B(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){B(e.length!==0,"internal-error");const t=Mc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(B(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Rm(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new gn;return r&&(B(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(B(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(B(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gn,this.toJSON())}_performRefresh(){return ot("not implemented")}}function wt(n,e){B(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class je{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new wm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new io(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await mr(this,this.stsTokenManager.getToken(this.auth,e));return B(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Tm(this,e)}reload(){return Am(this)}_assign(e){this!==e&&(B(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new je({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await bs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xe(this.auth.app))return Promise.reject(ct(this.auth));const e=await this.getIdToken();return await mr(this,Em(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:v,isAnonymous:R,providerData:V,stsTokenManager:N}=t;B(m&&N,e,"internal-error");const k=gn.fromJSON(this.name,N);B(typeof m=="string",e,"internal-error"),wt(r,e.name),wt(s,e.name),B(typeof v=="boolean",e,"internal-error"),B(typeof R=="boolean",e,"internal-error"),wt(i,e.name),wt(a,e.name),wt(l,e.name),wt(u,e.name),wt(d,e.name),wt(f,e.name);const C=new je({uid:m,auth:e,email:s,emailVerified:v,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:k,createdAt:d,lastLoginAt:f});return V&&Array.isArray(V)&&(C.providerData=V.map(x=>({...x}))),u&&(C._redirectEventId=u),C}static async _fromIdTokenResponse(e,t,r=!1){const s=new gn;s.updateFromServerResponse(t);const i=new je({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await bs(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];B(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Au(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new gn;l.updateFromIdToken(r);const u=new je({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new io(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,d),u}}const xc=new Map;function at(n){ht(n instanceof Function,"Expected a class definition");let e=xc.get(n);return e?(ht(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xc.set(n,e),e)}class bu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bu.type="NONE";const Uc=bu;function us(n,e,t){return`firebase:${n}:${e}:${t}`}class _n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=us(this.userKey,s.apiKey,i),this.fullPersistenceKey=us("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await As(this.auth,{idToken:e}).catch(()=>{});return t?je._fromGetAccountInfoResponse(this.auth,t,e):null}return je._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new _n(at(Uc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||at(Uc);const a=us(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const f=await d._get(a);if(f){let m;if(typeof f=="string"){const v=await As(e,{idToken:f}).catch(()=>{});if(!v)break;m=await je._fromGetAccountInfoResponse(e,v,f)}else m=je._fromJSON(e,f);d!==i&&(l=m),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new _n(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new _n(i,e,r))}}function Fc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ru(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Nu(e))return"Blackberry";if(Du(e))return"Webos";if(Su(e))return"Safari";if((e.includes("chrome/")||Pu(e))&&!e.includes("edge/"))return"Chrome";if(ku(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Ru(n=Ce()){return/firefox\//i.test(n)}function Su(n=Ce()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pu(n=Ce()){return/crios\//i.test(n)}function Cu(n=Ce()){return/iemobile/i.test(n)}function ku(n=Ce()){return/android/i.test(n)}function Nu(n=Ce()){return/blackberry/i.test(n)}function Du(n=Ce()){return/webos/i.test(n)}function Do(n=Ce()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Pm(n=Ce()){return Do(n)&&!!window.navigator?.standalone}function Cm(){return jf()&&document.documentMode===10}function Vu(n=Ce()){return Do(n)||ku(n)||Du(n)||Nu(n)||/windows phone/i.test(n)||Cu(n)}function Ou(n,e=[]){let t;switch(n){case"Browser":t=Fc(Ce());break;case"Worker":t=`${Fc(Ce())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Cn}/${r}`}class km{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Nm(n,e={}){return st(n,"GET","/v2/passwordPolicy",rt(n,e))}const Dm=6;class Vm{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Dm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Om{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bc(this),this.idTokenSubscription=new Bc(this),this.beforeStateQueue=new km(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=at(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await _n.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await As(this,{idToken:e}),r=await je._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(xe(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=dm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(xe(this.app))return Promise.reject(ct(this));const t=e?ce(e):null;return t&&B(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&B(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return xe(this.app)?Promise.reject(ct(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return xe(this.app)?Promise.reject(ct(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(at(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Nm(this),t=new Vm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Pr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Sm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&at(e)||this._popupRedirectResolver;B(t,this,"argument-error"),this.redirectPersistenceManager=await _n.create(this,[at(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(B(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ou(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(xe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&lm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function mt(n){return ce(n)}class Bc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Xf(t=>this.observer=t)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let qs={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Lm(n){qs=n}function Lu(n){return qs.loadJS(n)}function Mm(){return qs.recaptchaEnterpriseScript}function xm(){return qs.gapiScript}function Um(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Fm{constructor(){this.enterprise=new Bm}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Bm{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const $m="recaptcha-enterprise",Mu="NO_RECAPTCHA";class qm{constructor(e){this.type=$m,this.auth=mt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{vm(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new ym(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function s(i,a,l){const u=window.grecaptcha;Lc(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Mu)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Fm().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!t&&Lc(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=Mm();u.length!==0&&(u+=l),Lu(u).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function $c(n,e,t,r=!1,s=!1){const i=new qm(n);let a;if(s)a=Mu;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Rs(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await $c(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await $c(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(i)})}function jm(n,e){const t=So(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Zt(i,e??{}))return s;qe(s,"already-initialized")}return t.initialize({options:e})}function Hm(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(at);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function zm(n,e,t){const r=mt(n);B(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=xu(e),{host:a,port:l}=Wm(e),u=l===null?"":`:${l}`,d={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){B(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),B(Zt(d,r.config.emulator)&&Zt(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Pn(a)?(uu(`${i}//${a}${u}`),hu("Auth",!0)):Gm()}function xu(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Wm(n){const e=xu(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:qc(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:qc(a)}}}function qc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Gm(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Vo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ot("not implemented")}_getIdTokenResponse(e){return ot("not implemented")}_linkToIdToken(e,t){return ot("not implemented")}_getReauthenticationResolver(e){return ot("not implemented")}}async function Km(n,e){return st(n,"POST","/v1/accounts:signUp",e)}async function Qm(n,e){return Nr(n,"POST","/v1/accounts:signInWithPassword",rt(n,e))}async function Ym(n,e){return st(n,"POST","/v1/accounts:sendOobCode",rt(n,e))}async function Xm(n,e){return Ym(n,e)}async function Jm(n,e){return Nr(n,"POST","/v1/accounts:signInWithEmailLink",rt(n,e))}async function Zm(n,e){return Nr(n,"POST","/v1/accounts:signInWithEmailLink",rt(n,e))}class gr extends Vo{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new gr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new gr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rs(e,t,"signInWithPassword",Qm);case"emailLink":return Jm(e,{email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Rs(e,r,"signUpPassword",Km);case"emailLink":return Zm(e,{idToken:t,email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function yn(n,e){return Nr(n,"POST","/v1/accounts:signInWithIdp",rt(n,e))}const eg="http://localhost";class tn extends Vo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new tn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new tn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return yn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,yn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,yn(e,t)}buildRequest(){const e={requestUri:eg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Cr(t)}return e}}function tg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ng(n){const e=er(tr(n)).link,t=e?er(tr(e)).deep_link_id:null,r=er(tr(n)).deep_link_id;return(r?er(tr(r)).link:null)||r||t||e||n}class Oo{constructor(e){const t=er(tr(e)),r=t.apiKey??null,s=t.oobCode??null,i=tg(t.mode??null);B(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=ng(e);try{return new Oo(t)}catch{return null}}}class kn{constructor(){this.providerId=kn.PROVIDER_ID}static credential(e,t){return gr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Oo.parseLink(t);return B(r,"argument-error"),gr._fromEmailAndCode(e,r.code,r.tenantId)}}kn.PROVIDER_ID="password";kn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";kn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Lo{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Dr extends Lo{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class At extends Dr{constructor(){super("facebook.com")}static credential(e){return tn._fromParams({providerId:At.PROVIDER_ID,signInMethod:At.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return At.credentialFromTaggedObject(e)}static credentialFromError(e){return At.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return At.credential(e.oauthAccessToken)}catch{return null}}}At.FACEBOOK_SIGN_IN_METHOD="facebook.com";At.PROVIDER_ID="facebook.com";class it extends Dr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return tn._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return it.credential(t,r)}catch{return null}}}it.GOOGLE_SIGN_IN_METHOD="google.com";it.PROVIDER_ID="google.com";class bt extends Dr{constructor(){super("github.com")}static credential(e){return tn._fromParams({providerId:bt.PROVIDER_ID,signInMethod:bt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bt.credentialFromTaggedObject(e)}static credentialFromError(e){return bt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bt.credential(e.oauthAccessToken)}catch{return null}}}bt.GITHUB_SIGN_IN_METHOD="github.com";bt.PROVIDER_ID="github.com";class Rt extends Dr{constructor(){super("twitter.com")}static credential(e,t){return tn._fromParams({providerId:Rt.PROVIDER_ID,signInMethod:Rt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rt.credentialFromTaggedObject(e)}static credentialFromError(e){return Rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Rt.credential(t,r)}catch{return null}}}Rt.TWITTER_SIGN_IN_METHOD="twitter.com";Rt.PROVIDER_ID="twitter.com";async function rg(n,e){return Nr(n,"POST","/v1/accounts:signUp",rt(n,e))}class nn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await je._fromIdTokenResponse(e,r,s),a=jc(r);return new nn({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=jc(r);return new nn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function jc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Ss extends pt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ss.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ss(e,t,r,s)}}function Uu(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Ss._fromErrorAndOperation(n,i,e,r):i})}async function sg(n,e,t=!1){const r=await mr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return nn._forOperation(n,"link",r)}async function ig(n,e,t=!1){const{auth:r}=n;if(xe(r.app))return Promise.reject(ct(r));const s="reauthenticate";try{const i=await mr(n,Uu(r,s,e,n),t);B(i.idToken,r,"internal-error");const a=No(i.idToken);B(a,r,"internal-error");const{sub:l}=a;return B(n.uid===l,r,"user-mismatch"),nn._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&qe(r,"user-mismatch"),i}}async function Fu(n,e,t=!1){if(xe(n.app))return Promise.reject(ct(n));const r="signIn",s=await Uu(n,r,e),i=await nn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function og(n,e){return Fu(mt(n),e)}async function Bu(n){const e=mt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ag(n,e,t){const r=mt(n);await Rs(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Xm)}async function cg(n,e,t){if(xe(n.app))return Promise.reject(ct(n));const r=mt(n),a=await Rs(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rg).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Bu(n),u}),l=await nn._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function lg(n,e,t){return xe(n.app)?Promise.reject(ct(n)):og(ce(n),kn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Bu(n),r})}async function ug(n,e){return st(n,"POST","/v1/accounts:createAuthUri",rt(n,e))}async function hg(n,e){const t=Eu()?ws():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await ug(ce(n),r);return s||[]}function Mo(n,e){return ce(n).setPersistence(e)}function dg(n,e,t,r){return ce(n).onIdTokenChanged(e,t,r)}function fg(n,e,t){return ce(n).beforeAuthStateChanged(e,t)}function pg(n,e,t,r){return ce(n).onAuthStateChanged(e,t,r)}function mg(n){return ce(n).signOut()}const Ps="__sak";class $u{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ps,"1"),this.storage.removeItem(Ps),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const gg=1e3,_g=10;class qu extends $u{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);Cm()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,_g):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},gg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}qu.type="LOCAL";const js=qu;class ju extends $u{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ju.type="SESSION";const Vr=ju;function yg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Hs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Hs(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),u=await yg(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hs.receivers=[];function xo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class vg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=xo("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(m){const v=m;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(v.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Ye(){return window}function Eg(n){Ye().location.href=n}function Hu(){return typeof Ye().WorkerGlobalScope<"u"&&typeof Ye().importScripts=="function"}async function Tg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ig(){return navigator?.serviceWorker?.controller||null}function wg(){return Hu()?self:null}const zu="firebaseLocalStorageDb",Ag=1,Cs="firebaseLocalStorage",Wu="fbase_key";class Or{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zs(n,e){return n.transaction([Cs],e?"readwrite":"readonly").objectStore(Cs)}function bg(){const n=indexedDB.deleteDatabase(zu);return new Or(n).toPromise()}function oo(){const n=indexedDB.open(zu,Ag);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Cs,{keyPath:Wu})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Cs)?e(r):(r.close(),await bg(),e(await oo()))})})}async function Hc(n,e,t){const r=zs(n,!0).put({[Wu]:e,value:t});return new Or(r).toPromise()}async function Rg(n,e){const t=zs(n,!1).get(e),r=await new Or(t).toPromise();return r===void 0?null:r.value}function zc(n,e){const t=zs(n,!0).delete(e);return new Or(t).toPromise()}const Sg=800,Pg=3;class Gu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await oo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Pg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Hu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hs._getInstance(wg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Tg(),!this.activeServiceWorker)return;this.sender=new vg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ig()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await oo();return await Hc(e,Ps,"1"),await zc(e,Ps),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Hc(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Rg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>zc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=zs(s,!1).getAll();return new Or(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Sg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Gu.type="LOCAL";const Cg=Gu;new kr(3e4,6e4);function Ku(n,e){return e?at(e):(B(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Uo extends Vo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return yn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return yn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return yn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function kg(n){return Fu(n.auth,new Uo(n),n.bypassAuthState)}function Ng(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),ig(t,new Uo(n),n.bypassAuthState)}async function Dg(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),sg(t,new Uo(n),n.bypassAuthState)}class Qu{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kg;case"linkViaPopup":case"linkViaRedirect":return Dg;case"reauthViaPopup":case"reauthViaRedirect":return Ng;default:qe(this.auth,"internal-error")}}resolve(e){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Vg=new kr(2e3,1e4);async function Og(n,e,t){if(xe(n.app))return Promise.reject(He(n,"operation-not-supported-in-this-environment"));const r=mt(n);um(n,e,Lo);const s=Ku(r,t);return new Yt(r,"signInViaPopup",e,s).executeNotNull()}class Yt extends Qu{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Yt.currentPopupAction&&Yt.currentPopupAction.cancel(),Yt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return B(e,this.auth,"internal-error"),e}async onExecution(){ht(this.filter.length===1,"Popup operations only handle one event");const e=xo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yt.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Vg.get())};e()}}Yt.currentPopupAction=null;const Lg="pendingRedirect",hs=new Map;class Mg extends Qu{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=hs.get(this.auth._key());if(!e){try{const r=await xg(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}hs.set(this.auth._key(),e)}return this.bypassAuthState||hs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function xg(n,e){const t=Bg(e),r=Fg(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function Ug(n,e){hs.set(n._key(),e)}function Fg(n){return at(n._redirectPersistence)}function Bg(n){return us(Lg,n.config.apiKey,n.name)}async function $g(n,e,t=!1){if(xe(n.app))return Promise.reject(ct(n));const r=mt(n),s=Ku(r,e),a=await new Mg(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const qg=600*1e3;class jg{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Hg(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Yu(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(He(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=qg&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wc(e))}saveEventToCache(e){this.cachedEventUids.add(Wc(e)),this.lastProcessedEventTime=Date.now()}}function Wc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Yu({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Hg(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yu(n);default:return!1}}async function zg(n,e={}){return st(n,"GET","/v1/projects",e)}const Wg=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Gg=/^https?/;async function Kg(n){if(n.config.emulator)return;const{authorizedDomains:e}=await zg(n);for(const t of e)try{if(Qg(t))return}catch{}qe(n,"unauthorized-domain")}function Qg(n){const e=ws(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Gg.test(t))return!1;if(Wg.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Yg=new kr(3e4,6e4);function Gc(){const n=Ye().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Xg(n){return new Promise((e,t)=>{function r(){Gc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Gc(),t(He(n,"network-request-failed"))},timeout:Yg.get()})}if(Ye().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ye().gapi?.load)r();else{const s=Um("iframefcb");return Ye()[s]=()=>{gapi.load?r():t(He(n,"network-request-failed"))},Lu(`${xm()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw ds=null,e})}let ds=null;function Jg(n){return ds=ds||Xg(n),ds}const Zg=new kr(5e3,15e3),e_="__/auth/iframe",t_="emulator/auth/iframe",n_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},r_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function s_(n){const e=n.config;B(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ko(e,t_):`https://${n.config.authDomain}/${e_}`,r={apiKey:e.apiKey,appName:n.name,v:Cn},s=r_.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Cr(r).slice(1)}`}async function i_(n){const e=await Jg(n),t=Ye().gapi;return B(t,n,"internal-error"),e.open({where:document.body,url:s_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:n_,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=He(n,"network-request-failed"),l=Ye().setTimeout(()=>{i(a)},Zg.get());function u(){Ye().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const o_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},a_=500,c_=600,l_="_blank",u_="http://localhost";class Kc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function h_(n,e,t,r=a_,s=c_){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...o_,width:r.toString(),height:s.toString(),top:i,left:a},d=Ce().toLowerCase();t&&(l=Pu(d)?l_:t),Ru(d)&&(e=e||u_,u.scrollbars="yes");const f=Object.entries(u).reduce((v,[R,V])=>`${v}${R}=${V},`,"");if(Pm(d)&&l!=="_self")return d_(e||"",l),new Kc(null);const m=window.open(e||"",l,f);B(m,n,"popup-blocked");try{m.focus()}catch{}return new Kc(m)}function d_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const f_="__/auth/handler",p_="emulator/auth/handler",m_=encodeURIComponent("fac");async function Qc(n,e,t,r,s,i){B(n.config.authDomain,n,"auth-domain-config-required"),B(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Cn,eventId:s};if(e instanceof Lo){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Yf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,m]of Object.entries({}))a[f]=m}if(e instanceof Dr){const f=e.getScopes().filter(m=>m!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),d=u?`#${m_}=${encodeURIComponent(u)}`:"";return`${g_(n)}?${Cr(l).slice(1)}${d}`}function g_({config:n}){return n.emulator?ko(n,p_):`https://${n.authDomain}/${f_}`}const Wi="webStorageSupport";class __{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Vr,this._completeRedirectFn=$g,this._overrideRedirectResult=Ug}async _openPopup(e,t,r,s){ht(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Qc(e,t,r,ws(),s);return h_(e,i,xo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Qc(e,t,r,ws(),s);return Eg(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ht(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await i_(e),r=new jg(e);return t.register("authEvent",s=>(B(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Wi,{type:Wi},s=>{const i=s?.[0]?.[Wi];i!==void 0&&t(!!i),qe(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Kg(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vu()||Su()||Do()}}const y_=__;var Yc="@firebase/auth",Xc="1.12.0";class v_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function E_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function T_(n){Tn(new en("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;B(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ou(n)},d=new Om(r,s,i,u);return Hm(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Tn(new en("auth-internal",e=>{const t=mt(e.getProvider("auth").getImmediate());return(r=>new v_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),kt(Yc,Xc,E_(n)),kt(Yc,Xc,"esm2020")}const I_=300,w_=lu("authIdTokenMaxAge")||I_;let Jc=null;const A_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>w_)return;const s=t?.token;Jc!==s&&(Jc=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function b_(n=mu()){const e=So(n,"auth");if(e.isInitialized())return e.getImmediate();const t=jm(n,{popupRedirectResolver:y_,persistence:[Cg,js,Vr]}),r=lu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=A_(i.toString());fg(t,a,()=>a(t.currentUser)),dg(t,l=>a(l))}}const s=au("auth");return s&&zm(t,`http://${s}`),t}function R_(){return document.getElementsByTagName("head")?.[0]??document}Lm({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=He("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",R_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});T_("Browser");var S_="firebase",P_="12.7.0";kt(S_,P_,"app");var Zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Nt,Xu;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.F=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.D=function(I,E,A){for(var _=Array(arguments.length-2),X=2;X<arguments.length;X++)_[X-2]=arguments[X];return g.prototype[E].apply(I,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,g,y){y||(y=0);const I=Array(16);if(typeof g=="string")for(var E=0;E<16;++E)I[E]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(E=0;E<16;++E)I[E]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],E=T.g[2];let A=T.g[3],_;_=g+(A^y&(E^A))+I[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[1]+3905402710&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[2]+606105819&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[3]+3250441966&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[5]+1200080426&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[6]+2821735955&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[7]+4249261313&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[9]+2336552879&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[10]+4294925233&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[11]+2304563134&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(A^y&(E^A))+I[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=A+(E^g&(y^E))+I[13]+4254626195&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(y^A&(g^y))+I[14]+2792965006&4294967295,E=A+(_<<17&4294967295|_>>>15),_=y+(g^E&(A^g))+I[15]+1236535329&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(E^A&(y^E))+I[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[6]+3225465664&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[11]+643717713&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[0]+3921069994&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[10]+38016083&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[15]+3634488961&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[4]+3889429448&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[14]+3275163606&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[3]+4107603335&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[8]+1163531501&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(y^E))+I[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=A+(y^E&(g^y))+I[2]+4243563512&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(A^g))+I[7]+1735328473&4294967295,E=A+(_<<14&4294967295|_>>>18),_=y+(A^g&(E^A))+I[12]+2368359562&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(y^E^A)+I[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[8]+2272392833&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[11]+1839030562&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[14]+4259657740&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[4]+1272893353&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[7]+4139469664&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[10]+3200236656&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[0]+3936430074&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[3]+3572445317&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[6]+76029189&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^A)+I[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=A+(g^y^E)+I[12]+3873151461&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^y)+I[15]+530742520&4294967295,E=A+(_<<16&4294967295|_>>>16),_=y+(E^A^g)+I[2]+3299628645&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(E^(y|~A))+I[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[7]+1126891415&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[14]+2878612391&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[5]+4237533241&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[3]+2399980690&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[10]+4293915773&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[1]+2240044497&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[15]+4264355552&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[6]+2734768916&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[13]+1309151649&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~A))+I[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=A+(y^(g|~E))+I[11]+3174756917&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~y))+I[2]+718787259&4294967295,E=A+(_<<15&4294967295|_>>>17),_=y+(A^(E|~g))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+A&4294967295}r.prototype.v=function(T,g){g===void 0&&(g=T.length);const y=g-this.blockSize,I=this.C;let E=this.h,A=0;for(;A<g;){if(E==0)for(;A<=y;)s(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<g;)if(I[E++]=T.charCodeAt(A++),E==this.blockSize){s(this,I),E=0;break}}else for(;A<g;)if(I[E++]=T[A++],E==this.blockSize){s(this,I),E=0;break}}this.h=E,this.o+=g},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;g=this.o*8;for(var y=T.length-8;y<T.length;++y)T[y]=g&255,g/=256;for(this.v(T),T=Array(16),g=0,y=0;y<4;++y)for(let I=0;I<32;I+=8)T[g++]=this.g[y]>>>I&255;return T};function i(T,g){var y=l;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function a(T,g){this.h=g;const y=[];let I=!0;for(let E=T.length-1;E>=0;E--){const A=T[E]|0;I&&A==g||(y[E]=A,I=!1)}this.g=y}var l={};function u(T){return-128<=T&&T<128?i(T,function(g){return new a([g|0],g<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return m;if(T<0)return k(d(-T));const g=[];let y=1;for(let I=0;T>=y;I++)g[I]=T/y|0,y*=4294967296;return new a(g,0)}function f(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return k(f(T.substring(1),g));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(g,8));let I=m;for(let A=0;A<T.length;A+=8){var E=Math.min(8,T.length-A);const _=parseInt(T.substring(A,A+E),g);E<8?(E=d(Math.pow(g,E)),I=I.j(E).add(d(_))):(I=I.j(y),I=I.add(d(_)))}return I}var m=u(0),v=u(1),R=u(16777216);n=a.prototype,n.m=function(){if(N(this))return-k(this).m();let T=0,g=1;for(let y=0;y<this.g.length;y++){const I=this.i(y);T+=(I>=0?I:4294967296+I)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(V(this))return"0";if(N(this))return"-"+k(this).toString(T);const g=d(Math.pow(T,6));var y=this;let I="";for(;;){const E=q(y,g).g;y=C(y,E.j(g));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(T);if(y=E,V(y))return A+I;for(;A.length<6;)A="0"+A;I=A+I}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function V(T){if(T.h!=0)return!1;for(let g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function N(T){return T.h==-1}n.l=function(T){return T=C(this,T),N(T)?-1:V(T)?0:1};function k(T){const g=T.g.length,y=[];for(let I=0;I<g;I++)y[I]=~T.g[I];return new a(y,~T.h).add(v)}n.abs=function(){return N(this)?k(this):this},n.add=function(T){const g=Math.max(this.g.length,T.g.length),y=[];let I=0;for(let E=0;E<=g;E++){let A=I+(this.i(E)&65535)+(T.i(E)&65535),_=(A>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);I=_>>>16,A&=65535,_&=65535,y[E]=_<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function C(T,g){return T.add(k(g))}n.j=function(T){if(V(this)||V(T))return m;if(N(this))return N(T)?k(this).j(k(T)):k(k(this).j(T));if(N(T))return k(this.j(k(T)));if(this.l(R)<0&&T.l(R)<0)return d(this.m()*T.m());const g=this.g.length+T.g.length,y=[];for(var I=0;I<2*g;I++)y[I]=0;for(I=0;I<this.g.length;I++)for(let E=0;E<T.g.length;E++){const A=this.i(I)>>>16,_=this.i(I)&65535,X=T.i(E)>>>16,Te=T.i(E)&65535;y[2*I+2*E]+=_*Te,x(y,2*I+2*E),y[2*I+2*E+1]+=A*Te,x(y,2*I+2*E+1),y[2*I+2*E+1]+=_*X,x(y,2*I+2*E+1),y[2*I+2*E+2]+=A*X,x(y,2*I+2*E+2)}for(T=0;T<g;T++)y[T]=y[2*T+1]<<16|y[2*T];for(T=g;T<2*g;T++)y[T]=0;return new a(y,0)};function x(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function O(T,g){this.g=T,this.h=g}function q(T,g){if(V(g))throw Error("division by zero");if(V(T))return new O(m,m);if(N(T))return g=q(k(T),g),new O(k(g.g),k(g.h));if(N(g))return g=q(T,k(g)),new O(k(g.g),g.h);if(T.g.length>30){if(N(T)||N(g))throw Error("slowDivide_ only works with positive integers.");for(var y=v,I=g;I.l(T)<=0;)y=U(y),I=U(I);var E=Y(y,1),A=Y(I,1);for(I=Y(I,2),y=Y(y,2);!V(I);){var _=A.add(I);_.l(T)<=0&&(E=E.add(y),A=_),I=Y(I,1),y=Y(y,1)}return g=C(T,E.j(g)),new O(E,g)}for(E=m;T.l(g)>=0;){for(y=Math.max(1,Math.floor(T.m()/g.m())),I=Math.ceil(Math.log(y)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),A=d(y),_=A.j(g);N(_)||_.l(T)>0;)y-=I,A=d(y),_=A.j(g);V(A)&&(A=v),E=E.add(A),T=C(T,_)}return new O(E,T)}n.B=function(T){return q(this,T).h},n.and=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)&T.i(I);return new a(y,this.h&T.h)},n.or=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)|T.i(I);return new a(y,this.h|T.h)},n.xor=function(T){const g=Math.max(this.g.length,T.g.length),y=[];for(let I=0;I<g;I++)y[I]=this.i(I)^T.i(I);return new a(y,this.h^T.h)};function U(T){const g=T.g.length+1,y=[];for(let I=0;I<g;I++)y[I]=T.i(I)<<1|T.i(I-1)>>>31;return new a(y,T.h)}function Y(T,g){const y=g>>5;g%=32;const I=T.g.length-y,E=[];for(let A=0;A<I;A++)E[A]=g>0?T.i(A+y)>>>g|T.i(A+y+1)<<32-g:T.i(A+y);return new a(E,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Xu=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Nt=a}).apply(typeof Zc<"u"?Zc:typeof self<"u"?self:typeof window<"u"?window:{});var ss=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ju,nr,Zu,fs,ao,eh,th,nh;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ss=="object"&&ss];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var h=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var w=o[p];if(!(w in h))break e;h=h[w]}o=o[o.length-1],p=h[o],c=c(p),c!=p&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&h.push([p,c[p]]);return h}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=u,d.apply(null,arguments)}function f(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function m(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,w,b){for(var D=Array(arguments.length-2),z=2;z<arguments.length;z++)D[z-2]=arguments[z];return c.prototype[w].apply(p,D)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){const c=o.length;if(c>0){const h=Array(c);for(let p=0;p<c;p++)h[p]=o[p];return h}return[]}function V(o,c){for(let p=1;p<arguments.length;p++){const w=arguments[p];var h=typeof w;if(h=h!="object"?h:w?Array.isArray(w)?"array":h:"null",h=="array"||h=="object"&&typeof w.length=="number"){h=o.length||0;const b=w.length||0;o.length=h+b;for(let D=0;D<b;D++)o[h+D]=w[D]}else o.push(w)}}class N{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function k(o){a.setTimeout(()=>{throw o},0)}function C(){var o=T;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class x{constructor(){this.h=this.g=null}add(c,h){const p=O.get();p.set(c,h),this.h?this.h.next=p:this.g=p,this.h=p}}var O=new N(()=>new q,o=>o.reset());class q{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let U,Y=!1,T=new x,g=()=>{const o=Promise.resolve(void 0);U=()=>{o.then(y)}};function y(){for(var o;o=C();){try{o.h.call(o.g)}catch(h){k(h)}var c=O;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}Y=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function X(o,c){E.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}m(X,E),X.prototype.init=function(o,c){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&X.Z.h.call(this)},X.prototype.h=function(){X.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Te="closure_listenable_"+(Math.random()*1e6|0),De=0;function qt(o,c,h,p,w){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!p,this.ha=w,this.key=++De,this.da=this.fa=!1}function gt(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function jt(o,c,h){for(const p in o)c.call(h,o[p],p,o)}function jr(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function Ia(o){const c={};for(const h in o)c[h]=o[h];return c}const wa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Aa(o,c){let h,p;for(let w=1;w<arguments.length;w++){p=arguments[w];for(h in p)o[h]=p[h];for(let b=0;b<wa.length;b++)h=wa[b],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function Hr(o){this.src=o,this.g={},this.h=0}Hr.prototype.add=function(o,c,h,p,w){const b=o.toString();o=this.g[b],o||(o=this.g[b]=[],this.h++);const D=_i(o,c,p,w);return D>-1?(c=o[D],h||(c.fa=!1)):(c=new qt(c,this.src,b,!!p,w),c.fa=h,o.push(c)),c};function gi(o,c){const h=c.type;if(h in o.g){var p=o.g[h],w=Array.prototype.indexOf.call(p,c,void 0),b;(b=w>=0)&&Array.prototype.splice.call(p,w,1),b&&(gt(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function _i(o,c,h,p){for(let w=0;w<o.length;++w){const b=o[w];if(!b.da&&b.listener==c&&b.capture==!!h&&b.ha==p)return w}return-1}var yi="closure_lm_"+(Math.random()*1e6|0),vi={};function ba(o,c,h,p,w){if(Array.isArray(c)){for(let b=0;b<c.length;b++)ba(o,c[b],h,p,w);return null}return h=Pa(h),o&&o[Te]?o.J(c,h,l(p)?!!p.capture:!1,w):Qd(o,c,h,!1,p,w)}function Qd(o,c,h,p,w,b){if(!c)throw Error("Invalid event type");const D=l(w)?!!w.capture:!!w;let z=Ti(o);if(z||(o[yi]=z=new Hr(o)),h=z.add(c,h,p,D,b),h.proxy)return h;if(p=Yd(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)A||(w=D),w===void 0&&(w=!1),o.addEventListener(c.toString(),p,w);else if(o.attachEvent)o.attachEvent(Sa(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Yd(){function o(h){return c.call(o.src,o.listener,h)}const c=Xd;return o}function Ra(o,c,h,p,w){if(Array.isArray(c))for(var b=0;b<c.length;b++)Ra(o,c[b],h,p,w);else p=l(p)?!!p.capture:!!p,h=Pa(h),o&&o[Te]?(o=o.i,b=String(c).toString(),b in o.g&&(c=o.g[b],h=_i(c,h,p,w),h>-1&&(gt(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[b],o.h--)))):o&&(o=Ti(o))&&(c=o.g[c.toString()],o=-1,c&&(o=_i(c,h,p,w)),(h=o>-1?c[o]:null)&&Ei(h))}function Ei(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Te])gi(c.i,o);else{var h=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(h,p,o.capture):c.detachEvent?c.detachEvent(Sa(h),p):c.addListener&&c.removeListener&&c.removeListener(p),(h=Ti(c))?(gi(h,o),h.h==0&&(h.src=null,c[yi]=null)):gt(o)}}}function Sa(o){return o in vi?vi[o]:vi[o]="on"+o}function Xd(o,c){if(o.da)o=!0;else{c=new X(c,this);const h=o.listener,p=o.ha||o.src;o.fa&&Ei(o),o=h.call(p,c)}return o}function Ti(o){return o=o[yi],o instanceof Hr?o:null}var Ii="__closure_events_fn_"+(Math.random()*1e9>>>0);function Pa(o){return typeof o=="function"?o:(o[Ii]||(o[Ii]=function(c){return o.handleEvent(c)}),o[Ii])}function be(){I.call(this),this.i=new Hr(this),this.M=this,this.G=null}m(be,I),be.prototype[Te]=!0,be.prototype.removeEventListener=function(o,c,h,p){Ra(this,o,c,h,p)};function ke(o,c){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new E(c,o);else if(c instanceof E)c.target=c.target||o;else{var w=c;c=new E(p,o),Aa(c,w)}w=!0;let b,D;if(h)for(D=h.length-1;D>=0;D--)b=c.g=h[D],w=zr(b,p,!0,c)&&w;if(b=c.g=o,w=zr(b,p,!0,c)&&w,w=zr(b,p,!1,c)&&w,h)for(D=0;D<h.length;D++)b=c.g=h[D],w=zr(b,p,!1,c)&&w}be.prototype.N=function(){if(be.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let p=0;p<h.length;p++)gt(h[p]);delete o.g[c],o.h--}}this.G=null},be.prototype.J=function(o,c,h,p){return this.i.add(String(o),c,!1,h,p)},be.prototype.K=function(o,c,h,p){return this.i.add(String(o),c,!0,h,p)};function zr(o,c,h,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let b=0;b<c.length;++b){const D=c[b];if(D&&!D.da&&D.capture==h){const z=D.listener,pe=D.ha||D.src;D.fa&&gi(o.i,D),w=z.call(pe,p)!==!1&&w}}return w&&!p.defaultPrevented}function Jd(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Ca(o){o.g=Jd(()=>{o.g=null,o.i&&(o.i=!1,Ca(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class Zd extends I{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ca(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xn(o){I.call(this),this.h=o,this.g={}}m(xn,I);var ka=[];function Na(o){jt(o.g,function(c,h){this.g.hasOwnProperty(h)&&Ei(c)},o),o.g={}}xn.prototype.N=function(){xn.Z.N.call(this),Na(this)},xn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wi=a.JSON.stringify,ef=a.JSON.parse,tf=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Da(){}function Va(){}var Un={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ai(){E.call(this,"d")}m(Ai,E);function bi(){E.call(this,"c")}m(bi,E);var Ht={},Oa=null;function Wr(){return Oa=Oa||new be}Ht.Ia="serverreachability";function La(o){E.call(this,Ht.Ia,o)}m(La,E);function Fn(o){const c=Wr();ke(c,new La(c))}Ht.STAT_EVENT="statevent";function Ma(o,c){E.call(this,Ht.STAT_EVENT,o),this.stat=c}m(Ma,E);function Ne(o){const c=Wr();ke(c,new Ma(c,o))}Ht.Ja="timingevent";function xa(o,c){E.call(this,Ht.Ja,o),this.size=c}m(xa,E);function Bn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function $n(){this.g=!0}$n.prototype.ua=function(){this.g=!1};function nf(o,c,h,p,w,b){o.info(function(){if(o.g)if(b){var D="",z=b.split("&");for(let ee=0;ee<z.length;ee++){var pe=z[ee].split("=");if(pe.length>1){const ve=pe[0];pe=pe[1];const Ke=ve.split("_");D=Ke.length>=2&&Ke[1]=="type"?D+(ve+"="+pe+"&"):D+(ve+"=redacted&")}}}else D=null;else D=b;return"XMLHTTP REQ ("+p+") [attempt "+w+"]: "+c+`
`+h+`
`+D})}function rf(o,c,h,p,w,b,D){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+w+"]: "+c+`
`+h+`
`+b+" "+D})}function ln(o,c,h,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+of(o,h)+(p?" "+p:"")})}function sf(o,c){o.info(function(){return"TIMEOUT: "+c})}$n.prototype.info=function(){};function of(o,c){if(!o.g)return c;if(!c)return null;try{const b=JSON.parse(c);if(b){for(o=0;o<b.length;o++)if(Array.isArray(b[o])){var h=b[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var w=p[0];if(w!="noop"&&w!="stop"&&w!="close")for(let D=1;D<p.length;D++)p[D]=""}}}}return wi(b)}catch{return c}}var Gr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ua={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Fa;function Ri(){}m(Ri,Da),Ri.prototype.g=function(){return new XMLHttpRequest},Fa=new Ri;function qn(o){return encodeURIComponent(String(o))}function af(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function _t(o,c,h,p){this.j=o,this.i=c,this.l=h,this.S=p||1,this.V=new xn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ba}function Ba(){this.i=null,this.g="",this.h=!1}var $a={},Si={};function Pi(o,c,h){o.M=1,o.A=Qr(Ge(c)),o.u=h,o.R=!0,qa(o,null)}function qa(o,c){o.F=Date.now(),Kr(o),o.B=Ge(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),tc(h.i,"t",p),o.C=0,h=o.j.L,o.h=new Ba,o.g=vc(o.j,h?c:null,!o.u),o.P>0&&(o.O=new Zd(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,p=o.ba;var w="readystatechange";Array.isArray(w)||(w&&(ka[0]=w.toString()),w=ka);for(let b=0;b<w.length;b++){const D=ba(h,w[b],p||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=o.J?Ia(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Fn(),nf(o.i,o.v,o.B,o.l,o.S,o.u)}_t.prototype.ba=function(o){o=o.target;const c=this.O;c&&Et(o)==3?c.j():this.Y(o)},_t.prototype.Y=function(o){try{if(o==this.g)e:{const z=Et(this.g),pe=this.g.ya(),ee=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||cc(this.g)))){this.K||z!=4||pe==7||(pe==8||ee<=0?Fn(3):Fn(2)),Ci(this);var c=this.g.ca();this.X=c;var h=cf(this);if(this.o=c==200,rf(this.i,this.v,this.B,this.l,this.S,z,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,w=this.g;if((p=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(p)){var b=p;break t}}b=null}if(o=b)ln(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ki(this,o);else{this.o=!1,this.m=3,Ne(12),zt(this),jn(this);break e}}if(this.R){o=!0;let ve;for(;!this.K&&this.C<h.length;)if(ve=lf(this,h),ve==Si){z==4&&(this.m=4,Ne(14),o=!1),ln(this.i,this.l,null,"[Incomplete Response]");break}else if(ve==$a){this.m=4,Ne(15),ln(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else ln(this.i,this.l,ve,null),ki(this,ve);if(ja(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||h.length!=0||this.h.h||(this.m=1,Ne(16),o=!1),this.o=this.o&&o,!o)ln(this.i,this.l,h,"[Invalid Chunked Response]"),zt(this),jn(this);else if(h.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Ui(D),D.P=!0,Ne(11))}}else ln(this.i,this.l,h,null),ki(this,h);z==4&&zt(this),this.o&&!this.K&&(z==4?mc(this.j,this):(this.o=!1,Kr(this)))}else wf(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),zt(this),jn(this)}}}catch{}};function cf(o){if(!ja(o))return o.g.la();const c=cc(o.g);if(c==="")return"";let h="";const p=c.length,w=Et(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return zt(o),jn(o),"";o.h.i=new a.TextDecoder}for(let b=0;b<p;b++)o.h.h=!0,h+=o.h.i.decode(c[b],{stream:!(w&&b==p-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function ja(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function lf(o,c){var h=o.C,p=c.indexOf(`
`,h);return p==-1?Si:(h=Number(c.substring(h,p)),isNaN(h)?$a:(p+=1,p+h>c.length?Si:(c=c.slice(p,p+h),o.C=p+h,c)))}_t.prototype.cancel=function(){this.K=!0,zt(this)};function Kr(o){o.T=Date.now()+o.H,Ha(o,o.H)}function Ha(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Bn(d(o.aa,o),c)}function Ci(o){o.D&&(a.clearTimeout(o.D),o.D=null)}_t.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(sf(this.i,this.B),this.M!=2&&(Fn(),Ne(17)),zt(this),this.m=2,jn(this)):Ha(this,this.T-o)};function jn(o){o.j.I==0||o.K||mc(o.j,o)}function zt(o){Ci(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,Na(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function ki(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Ni(h.h,o))){if(!o.L&&Ni(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var w=p;if(w[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)es(h),Jr(h);else break e;xi(h),Ne(18)}}else h.xa=w[1],0<h.xa-h.K&&w[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Bn(d(h.Va,h),6e3));Ga(h.h)<=1&&h.ta&&(h.ta=void 0)}else Gt(h,11)}else if((o.L||h.g==o)&&es(h),!_(c))for(w=h.Ba.g.parse(c),c=0;c<w.length;c++){let ee=w[c];const ve=ee[0];if(!(ve<=h.K))if(h.K=ve,ee=ee[1],h.I==2)if(ee[0]=="c"){h.M=ee[1],h.ba=ee[2];const Ke=ee[3];Ke!=null&&(h.ka=Ke,h.j.info("VER="+h.ka));const Kt=ee[4];Kt!=null&&(h.za=Kt,h.j.info("SVER="+h.za));const Tt=ee[5];Tt!=null&&typeof Tt=="number"&&Tt>0&&(p=1.5*Tt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const It=o.g;if(It){const ns=It.g?It.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ns){var b=p.h;b.g||ns.indexOf("spdy")==-1&&ns.indexOf("quic")==-1&&ns.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Di(b,b.h),b.h=null))}if(p.G){const Fi=It.g?It.g.getResponseHeader("X-HTTP-Session-Id"):null;Fi&&(p.wa=Fi,re(p.J,p.G,Fi))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var D=o;if(p.na=yc(p,p.L?p.ba:null,p.W),D.L){Ka(p.h,D);var z=D,pe=p.O;pe&&(z.H=pe),z.D&&(Ci(z),Kr(z)),p.g=D}else fc(p);h.i.length>0&&Zr(h)}else ee[0]!="stop"&&ee[0]!="close"||Gt(h,7);else h.I==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?Gt(h,7):Mi(h):ee[0]!="noop"&&h.l&&h.l.qa(ee),h.A=0)}}Fn(4)}catch{}}var uf=class{constructor(o,c){this.g=o,this.map=c}};function za(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Wa(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Ga(o){return o.h?1:o.g?o.g.size:0}function Ni(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Di(o,c){o.g?o.g.add(c):o.h=c}function Ka(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}za.prototype.cancel=function(){if(this.i=Qa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Qa(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return R(o.i)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hf(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let w,b=null;p>=0?(w=o[h].substring(0,p),b=o[h].substring(p+1)):w=o[h],c(w,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function yt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof yt?(this.l=o.l,Hn(this,o.j),this.o=o.o,this.g=o.g,zn(this,o.u),this.h=o.h,Vi(this,nc(o.i)),this.m=o.m):o&&(c=String(o).match(Ya))?(this.l=!1,Hn(this,c[1]||"",!0),this.o=Wn(c[2]||""),this.g=Wn(c[3]||"",!0),zn(this,c[4]),this.h=Wn(c[5]||"",!0),Vi(this,c[6]||"",!0),this.m=Wn(c[7]||"")):(this.l=!1,this.i=new Kn(null,this.l))}yt.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Gn(c,Xa,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Gn(c,Xa,!0),"@"),o.push(qn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Gn(h,h.charAt(0)=="/"?pf:ff,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Gn(h,gf)),o.join("")},yt.prototype.resolve=function(o){const c=Ge(this);let h=!!o.j;h?Hn(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var p=o.h;if(h)zn(c,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var w=c.h.lastIndexOf("/");w!=-1&&(p=c.h.slice(0,w+1)+p)}if(w=p,w==".."||w==".")p="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){p=w.lastIndexOf("/",0)==0,w=w.split("/");const b=[];for(let D=0;D<w.length;){const z=w[D++];z=="."?p&&D==w.length&&b.push(""):z==".."?((b.length>1||b.length==1&&b[0]!="")&&b.pop(),p&&D==w.length&&b.push("")):(b.push(z),p=!0)}p=b.join("/")}else p=w}return h?c.h=p:h=o.i.toString()!=="",h?Vi(c,nc(o.i)):h=!!o.m,h&&(c.m=o.m),c};function Ge(o){return new yt(o)}function Hn(o,c,h){o.j=h?Wn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function zn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function Vi(o,c,h){c instanceof Kn?(o.i=c,_f(o.i,o.l)):(h||(c=Gn(c,mf)),o.i=new Kn(c,o.l))}function re(o,c,h){o.i.set(c,h)}function Qr(o){return re(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Wn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Gn(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,df),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function df(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Xa=/[#\/\?@]/g,ff=/[#\?:]/g,pf=/[#\?]/g,mf=/[#\?@]/g,gf=/#/g;function Kn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Wt(o){o.g||(o.g=new Map,o.h=0,o.i&&hf(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=Kn.prototype,n.add=function(o,c){Wt(this),this.i=null,o=un(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Ja(o,c){Wt(o),c=un(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Za(o,c){return Wt(o),c=un(o,c),o.g.has(c)}n.forEach=function(o,c){Wt(this),this.g.forEach(function(h,p){h.forEach(function(w){o.call(c,w,p,this)},this)},this)};function ec(o,c){Wt(o);let h=[];if(typeof c=="string")Za(o,c)&&(h=h.concat(o.g.get(un(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}n.set=function(o,c){return Wt(this),this.i=null,o=un(this,o),Za(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=ec(this,o),o.length>0?String(o[0]):c):c};function tc(o,c,h){Ja(o,c),h.length>0&&(o.i=null,o.g.set(un(o,c),R(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var h=c[p];const w=qn(h);h=ec(this,h);for(let b=0;b<h.length;b++){let D=w;h[b]!==""&&(D+="="+qn(h[b])),o.push(D)}}return this.i=o.join("&")};function nc(o){const c=new Kn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function un(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function _f(o,c){c&&!o.j&&(Wt(o),o.i=null,o.g.forEach(function(h,p){const w=p.toLowerCase();p!=w&&(Ja(this,p),tc(this,w,h))},o)),o.j=c}function yf(o,c){const h=new $n;if(a.Image){const p=new Image;p.onload=f(vt,h,"TestLoadImage: loaded",!0,c,p),p.onerror=f(vt,h,"TestLoadImage: error",!1,c,p),p.onabort=f(vt,h,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(vt,h,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function vf(o,c){const h=new $n,p=new AbortController,w=setTimeout(()=>{p.abort(),vt(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(b=>{clearTimeout(w),b.ok?vt(h,"TestPingServer: ok",!0,c):vt(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),vt(h,"TestPingServer: error",!1,c)})}function vt(o,c,h,p,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),p(h)}catch{}}function Ef(){this.g=new tf}function Oi(o){this.i=o.Sb||null,this.h=o.ab||!1}m(Oi,Da),Oi.prototype.g=function(){return new Yr(this.i,this.h)};function Yr(o,c){be.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Yr,be),n=Yr.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Yn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Qn(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Yn(this)),this.g&&(this.readyState=3,Yn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;rc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function rc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Qn(this):Yn(this),this.readyState==3&&rc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Qn(this))},n.Na=function(o){this.g&&(this.response=o,Qn(this))},n.ga=function(){this.g&&Qn(this)};function Qn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Yn(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Yn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Yr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function sc(o){let c="";return jt(o,function(h,p){c+=p,c+=":",c+=h,c+=`\r
`}),c}function Li(o,c,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=sc(h),typeof o=="string"?h!=null&&qn(h):re(o,c,h))}function ae(o){be.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ae,be);var Tf=/^https?$/i,If=["POST","PUT"];n=ae.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Fa.g(),this.g.onreadystatechange=v(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(b){ic(this,b);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var w in p)h.set(w,p[w]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const b of p.keys())h.set(b,p.get(b));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(b=>b.toLowerCase()=="content-type"),w=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(If,c,void 0)>=0)||p||w||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[b,D]of h)this.g.setRequestHeader(b,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(b){ic(this,b)}};function ic(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,oc(o),Xr(o)}function oc(o){o.A||(o.A=!0,ke(o,"complete"),ke(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,ke(this,"complete"),ke(this,"abort"),Xr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xr(this,!0)),ae.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ac(this):this.Xa())},n.Xa=function(){ac(this)};function ac(o){if(o.h&&typeof i<"u"){if(o.v&&Et(o)==4)setTimeout(o.Ca.bind(o),0);else if(ke(o,"readystatechange"),Et(o)==4){o.h=!1;try{const b=o.ca();e:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var p;if(p=b===0){let D=String(o.D).match(Ya)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),p=!Tf.test(D?D.toLowerCase():"")}h=p}if(h)ke(o,"complete"),ke(o,"success");else{o.o=6;try{var w=Et(o)>2?o.g.statusText:""}catch{w=""}o.l=w+" ["+o.ca()+"]",oc(o)}}finally{Xr(o)}}}}function Xr(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||ke(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Et(o){return o.g?o.g.readyState:0}n.ca=function(){try{return Et(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),ef(c)}};function cc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function wf(o){const c={};o=(o.g&&Et(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(_(o[p]))continue;var h=af(o[p]);const w=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const b=c[w]||[];c[w]=b,b.push(h)}jr(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xn(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function lc(o){this.za=0,this.i=[],this.j=new $n,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xn("baseRetryDelayMs",5e3,o),this.Za=Xn("retryDelaySeedMs",1e4,o),this.Ta=Xn("forwardChannelMaxRetries",2,o),this.va=Xn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new za(o&&o.concurrentRequestLimit),this.Ba=new Ef,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=lc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,h,p){Ne(0),this.W=o,this.H=c||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=yc(this,null,this.W),Zr(this)};function Mi(o){if(uc(o),o.I==3){var c=o.V++,h=Ge(o.J);if(re(h,"SID",o.M),re(h,"RID",c),re(h,"TYPE","terminate"),Jn(o,h),c=new _t(o,o.j,c),c.M=2,c.A=Qr(Ge(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=vc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Kr(c)}_c(o)}function Jr(o){o.g&&(Ui(o),o.g.cancel(),o.g=null)}function uc(o){Jr(o),o.v&&(a.clearTimeout(o.v),o.v=null),es(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function Zr(o){if(!Wa(o.h)&&!o.m){o.m=!0;var c=o.Ea;U||g(),Y||(U(),Y=!0),T.add(c,o),o.D=0}}function Af(o,c){return Ga(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Bn(d(o.Ea,o,c),gc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const w=new _t(this,this.j,o);let b=this.o;if(this.U&&(b?(b=Ia(b),Aa(b,this.U)):b=this.U),this.u!==null||this.R||(w.J=b,b=null),this.S)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=dc(this,w,c),h=Ge(this.J),re(h,"RID",o),re(h,"CVER",22),this.G&&re(h,"X-HTTP-Session-Id",this.G),Jn(this,h),b&&(this.R?c="headers="+qn(sc(b))+"&"+c:this.u&&Li(h,this.u,b)),Di(this.h,w),this.Ra&&re(h,"TYPE","init"),this.S?(re(h,"$req",c),re(h,"SID","null"),w.U=!0,Pi(w,h,null)):Pi(w,h,c),this.I=2}}else this.I==3&&(o?hc(this,o):this.i.length==0||Wa(this.h)||hc(this))};function hc(o,c){var h;c?h=c.l:h=o.V++;const p=Ge(o.J);re(p,"SID",o.M),re(p,"RID",h),re(p,"AID",o.K),Jn(o,p),o.u&&o.o&&Li(p,o.u,o.o),h=new _t(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=dc(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Di(o.h,h),Pi(h,p,c)}function Jn(o,c){o.H&&jt(o.H,function(h,p){re(c,p,h)}),o.l&&jt({},function(h,p){re(c,p,h)})}function dc(o,c,h){h=Math.min(o.i.length,h);const p=o.l?d(o.l.Ka,o.l,o):null;e:{var w=o.i;let z=-1;for(;;){const pe=["count="+h];z==-1?h>0?(z=w[0].g,pe.push("ofs="+z)):z=0:pe.push("ofs="+z);let ee=!0;for(let ve=0;ve<h;ve++){var b=w[ve].g;const Ke=w[ve].map;if(b-=z,b<0)z=Math.max(0,w[ve].g-100),ee=!1;else try{b="req"+b+"_"||"";try{var D=Ke instanceof Map?Ke:Object.entries(Ke);for(const[Kt,Tt]of D){let It=Tt;l(Tt)&&(It=wi(Tt)),pe.push(b+Kt+"="+encodeURIComponent(It))}}catch(Kt){throw pe.push(b+"type="+encodeURIComponent("_badmap")),Kt}}catch{p&&p(Ke)}}if(ee){D=pe.join("&");break e}}D=void 0}return o=o.i.splice(0,h),c.G=o,D}function fc(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;U||g(),Y||(U(),Y=!0),T.add(c,o),o.A=0}}function xi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Bn(d(o.Da,o),gc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,pc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Bn(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),Jr(this),pc(this))};function Ui(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function pc(o){o.g=new _t(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=Ge(o.na);re(c,"RID","rpc"),re(c,"SID",o.M),re(c,"AID",o.K),re(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&re(c,"TO",o.ia),re(c,"TYPE","xmlhttp"),Jn(o,c),o.u&&o.o&&Li(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Qr(Ge(c)),h.u=null,h.R=!0,qa(h,o)}n.Va=function(){this.C!=null&&(this.C=null,Jr(this),xi(this),Ne(19))};function es(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function mc(o,c){var h=null;if(o.g==c){es(o),Ui(o),o.g=null;var p=2}else if(Ni(o.h,c))h=c.G,Ka(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var w=o.D;p=Wr(),ke(p,new xa(p,h)),Zr(o)}else fc(o);else if(w=c.m,w==3||w==0&&c.X>0||!(p==1&&Af(o,c)||p==2&&xi(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),w){case 1:Gt(o,5);break;case 4:Gt(o,10);break;case 3:Gt(o,6);break;default:Gt(o,2)}}}function gc(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function Gt(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),p=o.Ua;const w=!p;p=new yt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Hn(p,"https"),Qr(p),w?yf(p.toString(),h):vf(p.toString(),h)}else Ne(2);o.I=0,o.l&&o.l.pa(c),_c(o),uc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function _c(o){if(o.I=0,o.ja=[],o.l){const c=Qa(o.h);(c.length!=0||o.i.length!=0)&&(V(o.ja,c),V(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function yc(o,c,h){var p=h instanceof yt?Ge(h):new yt(h);if(p.g!="")c&&(p.g=c+"."+p.g),zn(p,p.u);else{var w=a.location;p=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const b=new yt(null);p&&Hn(b,p),c&&(b.g=c),w&&zn(b,w),h&&(b.h=h),p=b}return h=o.G,c=o.wa,h&&c&&re(p,h,c),re(p,"VER",o.ka),Jn(o,p),p}function vc(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new ae(new Oi({ab:h})):new ae(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ec(){}n=Ec.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ts(){}ts.prototype.g=function(o,c){return new Me(o,c)};function Me(o,c){be.call(this),this.g=new lc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new hn(this)}m(Me,be),Me.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Me.prototype.close=function(){Mi(this.g)},Me.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=wi(o),o=h);c.i.push(new uf(c.Ya++,o)),c.I==3&&Zr(c)},Me.prototype.N=function(){this.g.l=null,delete this.j,Mi(this.g),delete this.g,Me.Z.N.call(this)};function Tc(o){Ai.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}m(Tc,Ai);function Ic(){bi.call(this),this.status=1}m(Ic,bi);function hn(o){this.g=o}m(hn,Ec),hn.prototype.ra=function(){ke(this.g,"a")},hn.prototype.qa=function(o){ke(this.g,new Tc(o))},hn.prototype.pa=function(o){ke(this.g,new Ic)},hn.prototype.oa=function(){ke(this.g,"b")},ts.prototype.createWebChannel=ts.prototype.g,Me.prototype.send=Me.prototype.o,Me.prototype.open=Me.prototype.m,Me.prototype.close=Me.prototype.close,nh=function(){return new ts},th=function(){return Wr()},eh=Ht,ao={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Gr.NO_ERROR=0,Gr.TIMEOUT=8,Gr.HTTP_ERROR=6,fs=Gr,Ua.COMPLETE="complete",Zu=Ua,Va.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",be.prototype.listen=be.prototype.J,nr=Va,ae.prototype.listenOnce=ae.prototype.K,ae.prototype.getLastError=ae.prototype.Ha,ae.prototype.getLastErrorCode=ae.prototype.ya,ae.prototype.getStatus=ae.prototype.ca,ae.prototype.getResponseJson=ae.prototype.La,ae.prototype.getResponseText=ae.prototype.la,ae.prototype.send=ae.prototype.ea,ae.prototype.setWithCredentials=ae.prototype.Fa,Ju=ae}).apply(typeof ss<"u"?ss:typeof self<"u"?self:typeof window<"u"?window:{});const el="@firebase/firestore",tl="4.9.3";class Se{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Se.UNAUTHENTICATED=new Se(null),Se.GOOGLE_CREDENTIALS=new Se("google-credentials-uid"),Se.FIRST_PARTY=new Se("first-party-uid"),Se.MOCK_USER=new Se("mock-user");let Nn="12.7.0";const rn=new bo("@firebase/firestore");function dn(){return rn.logLevel}function M(n,...e){if(rn.logLevel<=W.DEBUG){const t=e.map(Fo);rn.debug(`Firestore (${Nn}): ${n}`,...t)}}function dt(n,...e){if(rn.logLevel<=W.ERROR){const t=e.map(Fo);rn.error(`Firestore (${Nn}): ${n}`,...t)}}function In(n,...e){if(rn.logLevel<=W.WARN){const t=e.map(Fo);rn.warn(`Firestore (${Nn}): ${n}`,...t)}}function Fo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,rh(n,r,t)}function rh(n,e,t){let r=`FIRESTORE (${Nn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw dt(r),new Error(r)}function J(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||rh(e,s,r)}function H(n,e){return n}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends pt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class sh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Se.UNAUTHENTICATED)))}shutdown(){}}class k_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class N_{constructor(e){this.t=e,this.currentUser=Se.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){J(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new lt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new lt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new lt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(J(typeof r.accessToken=="string",31837,{l:r}),new sh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return J(e===null||typeof e=="string",2055,{h:e}),new Se(e)}}class D_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Se.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class V_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new D_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Se.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class nl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class O_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,xe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){J(this.o===void 0,3512);const r=i=>{i.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,M("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new nl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(J(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new nl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function L_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Bo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=L_(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function G(n,e){return n<e?-1:n>e?1:0}function co(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Gi(s)===Gi(i)?G(s,i):Gi(s)?1:-1}return G(n.length,e.length)}const M_=55296,x_=57343;function Gi(n){const e=n.charCodeAt(0);return e>=M_&&e<=x_}function wn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const rl="__name__";class Qe{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Qe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qe?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Qe.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return G(e.length,t.length)}static compareSegments(e,t){const r=Qe.isNumericId(e),s=Qe.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Qe.extractNumericId(e).compare(Qe.extractNumericId(t)):co(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Nt.fromString(e.substring(4,e.length-2))}}class te extends Qe{construct(e,t,r){return new te(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new te(t)}static emptyPath(){return new te([])}}const U_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class we extends Qe{construct(e,t,r){return new we(e,t,r)}static isValidIdentifier(e){return U_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),we.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rl}static keyField(){return new we([rl])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new L(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new L(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new L(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new L(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new we(t)}static emptyPath(){return new we([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(te.fromString(e))}static fromName(e){return new F(te.fromString(e).popFirst(5))}static empty(){return new F(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new te(e.slice()))}}function ih(n,e,t){if(!t)throw new L(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function F_(n,e,t,r){if(e===!0&&r===!0)throw new L(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sl(n){if(!F.isDocumentKey(n))throw new L(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function il(n){if(F.isDocumentKey(n))throw new L(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function oh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ws(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function ze(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ws(n);throw new L(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function B_(n,e){if(e<=0)throw new L(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function Lr(n,e){if(!oh(n))throw new L(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new L(S.INVALID_ARGUMENT,t);return!0}const ol=-62135596800,al=1e6;class se{static now(){return se.fromMillis(Date.now())}static fromDate(e){return se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*al);return new se(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ol)throw new L(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/al}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:se._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Lr(e,se._jsonSchema))return new se(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ol;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:fe("string",se._jsonSchemaVersion),seconds:fe("number"),nanoseconds:fe("number")};class j{static fromTimestamp(e){return new j(e)}static min(){return new j(new se(0,0))}static max(){return new j(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const _r=-1;function $_(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=j.fromTimestamp(r===1e9?new se(t+1,0):new se(t,r));return new Vt(s,F.empty(),e)}function q_(n){return new Vt(n.readTime,n.key,_r)}class Vt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Vt(j.min(),F.empty(),_r)}static max(){return new Vt(j.max(),F.empty(),_r)}}function j_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}const H_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class z_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Dn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==H_)throw n;M("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next((f=>{a[d]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new P(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function W_(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Vn(n){return n.name==="IndexedDbTransactionError"}class Gs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Gs.ce=-1;const $o=-1;function Ks(n){return n==null}function ks(n){return n===0&&1/n==-1/0}function G_(n){return typeof n=="number"&&Number.isInteger(n)&&!ks(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const ah="";function K_(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=cl(e)),e=Q_(n.get(t),e);return cl(e)}function Q_(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case ah:t+="";break;default:t+=i}}return t}function cl(n){return n+ah+""}function ll(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ft(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ch(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class oe{constructor(e,t){this.comparator=e,this.root=t||Ie.EMPTY}insert(e,t){return new oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ie.BLACK,null,null))}remove(e){return new oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ie.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new is(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new is(this.root,e,this.comparator,!1)}getReverseIterator(){return new is(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new is(this.root,e,this.comparator,!0)}}class is{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ie{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Ie.RED,this.left=s??Ie.EMPTY,this.right=i??Ie.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Ie(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ie.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ie.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ie.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ie.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Ie.EMPTY=null,Ie.RED=!0,Ie.BLACK=!1;Ie.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Ie(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ge{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ul(this.data.getIterator())}getIteratorFrom(e){return new ul(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ge)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ge(this.comparator);return t.data=e,t}}class ul{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ue{constructor(e){this.fields=e,e.sort(we.comparator)}static empty(){return new Ue([])}unionWith(e){let t=new ge(we.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ue(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class lh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new lh("Invalid base64 string: "+i):i}})(e);return new Ae(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ae.EMPTY_BYTE_STRING=new Ae("");const Y_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ot(n){if(J(!!n,39018),typeof n=="string"){let e=0;const t=Y_.exec(n);if(J(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:le(n.seconds),nanos:le(n.nanos)}}function le(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Lt(n){return typeof n=="string"?Ae.fromBase64String(n):Ae.fromUint8Array(n)}const uh="server_timestamp",hh="__type__",dh="__previous_value__",fh="__local_write_time__";function qo(n){return(n?.mapValue?.fields||{})[hh]?.stringValue===uh}function Qs(n){const e=n.mapValue.fields[dh];return qo(e)?Qs(e):e}function yr(n){const e=Ot(n.mapValue.fields[fh].timestampValue);return new se(e.seconds,e.nanos)}class X_{constructor(e,t,r,s,i,a,l,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f}}const Ns="(default)";class vr{constructor(e,t){this.projectId=e,this.database=t||Ns}static empty(){return new vr("","")}get isDefaultDatabase(){return this.database===Ns}isEqual(e){return e instanceof vr&&e.projectId===this.projectId&&e.database===this.database}}const ph="__type__",J_="__max__",os={mapValue:{}},mh="__vector__",Ds="value";function Mt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qo(n)?4:ey(n)?9007199254740991:Z_(n)?10:11:$(28295,{value:n})}function tt(n,e){if(n===e)return!0;const t=Mt(n);if(t!==Mt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yr(n).isEqual(yr(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Ot(s.timestampValue),l=Ot(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return Lt(s.bytesValue).isEqual(Lt(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return le(s.geoPointValue.latitude)===le(i.geoPointValue.latitude)&&le(s.geoPointValue.longitude)===le(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return le(s.integerValue)===le(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=le(s.doubleValue),l=le(i.doubleValue);return a===l?ks(a)===ks(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return wn(n.arrayValue.values||[],e.arrayValue.values||[],tt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ll(a)!==ll(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!tt(a[u],l[u])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function Er(n,e){return(n.values||[]).find((t=>tt(t,e)))!==void 0}function An(n,e){if(n===e)return 0;const t=Mt(n),r=Mt(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=le(i.integerValue||i.doubleValue),u=le(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return hl(n.timestampValue,e.timestampValue);case 4:return hl(yr(n),yr(e));case 5:return co(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=Lt(i),u=Lt(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=G(l[d],u[d]);if(f!==0)return f}return G(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=G(le(i.latitude),le(a.latitude));return l!==0?l:G(le(i.longitude),le(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return dl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},d=l[Ds]?.arrayValue,f=u[Ds]?.arrayValue,m=G(d?.values?.length||0,f?.values?.length||0);return m!==0?m:dl(d,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===os.mapValue&&a===os.mapValue)return 0;if(i===os.mapValue)return 1;if(a===os.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){const v=co(u[m],f[m]);if(v!==0)return v;const R=An(l[u[m]],d[f[m]]);if(R!==0)return R}return G(u.length,f.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function hl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);const t=Ot(n),r=Ot(e),s=G(t.seconds,r.seconds);return s!==0?s:G(t.nanos,r.nanos)}function dl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=An(t[s],r[s]);if(i)return i}return G(t.length,r.length)}function bn(n){return lo(n)}function lo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ot(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Lt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=lo(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${lo(t.fields[a])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function ps(n){switch(Mt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Qs(n);return e?16+ps(e):16;case 5:return 2*n.stringValue.length;case 6:return Lt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+ps(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Ft(r.fields,((i,a)=>{s+=i.length+ps(a)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function fl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function uo(n){return!!n&&"integerValue"in n}function jo(n){return!!n&&"arrayValue"in n}function pl(n){return!!n&&"nullValue"in n}function ml(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ms(n){return!!n&&"mapValue"in n}function Z_(n){return(n?.mapValue?.fields||{})[ph]?.stringValue===mh}function cr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Ft(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=cr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=cr(n.arrayValue.values[t]);return e}return{...n}}function ey(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===J_}class Oe{constructor(e){this.value=e}static empty(){return new Oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ms(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cr(t)}setAll(e){let t=we.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=cr(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ms(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ms(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ft(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Oe(cr(this.value))}}function gh(n){const e=[];return Ft(n.fields,((t,r)=>{const s=new we([t]);if(ms(r)){const i=gh(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new Ue(e)}class Pe{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Pe(e,0,j.min(),j.min(),j.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,s){return new Pe(e,1,t,j.min(),r,s,0)}static newNoDocument(e,t){return new Pe(e,2,t,j.min(),j.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new Pe(e,3,t,j.min(),j.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vs{constructor(e,t){this.position=e,this.inclusive=t}}function gl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=F.comparator(F.fromName(a.referenceValue),t.key):r=An(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function _l(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!tt(n.position[t],e.position[t]))return!1;return!0}class Tr{constructor(e,t="asc"){this.field=e,this.dir=t}}function ty(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class _h{}class de extends _h{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ry(e,t,r):t==="array-contains"?new oy(e,r):t==="in"?new ay(e,r):t==="not-in"?new cy(e,r):t==="array-contains-any"?new ly(e,r):new de(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new sy(e,r):new iy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(An(t,this.value)):t!==null&&Mt(this.value)===Mt(t)&&this.matchesComparison(An(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class We extends _h{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new We(e,t)}matches(e){return yh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function yh(n){return n.op==="and"}function vh(n){return ny(n)&&yh(n)}function ny(n){for(const e of n.filters)if(e instanceof We)return!1;return!0}function ho(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+bn(n.value);if(vh(n))return n.filters.map((e=>ho(e))).join(",");{const e=n.filters.map((t=>ho(t))).join(",");return`${n.op}(${e})`}}function Eh(n,e){return n instanceof de?(function(r,s){return s instanceof de&&r.op===s.op&&r.field.isEqual(s.field)&&tt(r.value,s.value)})(n,e):n instanceof We?(function(r,s){return s instanceof We&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&Eh(a,s.filters[l])),!0):!1})(n,e):void $(19439)}function Th(n){return n instanceof de?(function(t){return`${t.field.canonicalString()} ${t.op} ${bn(t.value)}`})(n):n instanceof We?(function(t){return t.op.toString()+" {"+t.getFilters().map(Th).join(" ,")+"}"})(n):"Filter"}class ry extends de{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class sy extends de{constructor(e,t){super(e,"in",t),this.keys=Ih("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class iy extends de{constructor(e,t){super(e,"not-in",t),this.keys=Ih("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ih(n,e){return(e.arrayValue?.values||[]).map((t=>F.fromName(t.referenceValue)))}class oy extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jo(t)&&Er(t.arrayValue,this.value)}}class ay extends de{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Er(this.value.arrayValue,t)}}class cy extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Er(this.value.arrayValue,t)}}class ly extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Er(this.value.arrayValue,r)))}}class uy{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function yl(n,e=null,t=[],r=[],s=null,i=null,a=null){return new uy(n,e,t,r,s,i,a)}function Ho(n){const e=H(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ho(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),Ks(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>bn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>bn(r))).join(",")),e.Te=t}return e.Te}function zo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ty(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Eh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!_l(n.startAt,e.startAt)&&_l(n.endAt,e.endAt)}function fo(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class On{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function hy(n,e,t,r,s,i,a,l){return new On(n,e,t,r,s,i,a,l)}function Wo(n){return new On(n)}function vl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function wh(n){return n.collectionGroup!==null}function lr(n){const e=H(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ge(we.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Tr(i,r))})),t.has(we.keyField().canonicalString())||e.Ie.push(new Tr(we.keyField(),r))}return e.Ie}function Xe(n){const e=H(n);return e.Ee||(e.Ee=dy(e,lr(n))),e.Ee}function dy(n,e){if(n.limitType==="F")return yl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Tr(s.field,i)}));const t=n.endAt?new Vs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vs(n.startAt.position,n.startAt.inclusive):null;return yl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function po(n,e){const t=n.filters.concat([e]);return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Os(n,e,t){return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ys(n,e){return zo(Xe(n),Xe(e))&&n.limitType===e.limitType}function Ah(n){return`${Ho(Xe(n))}|lt:${n.limitType}`}function fn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Th(s))).join(", ")}]`),Ks(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>bn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>bn(s))).join(",")),`Target(${r})`})(Xe(n))}; limitType=${n.limitType})`}function Xs(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):F.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of lr(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const d=gl(a,l,u);return a.inclusive?d<=0:d<0})(r.startAt,lr(r),s)||r.endAt&&!(function(a,l,u){const d=gl(a,l,u);return a.inclusive?d>=0:d>0})(r.endAt,lr(r),s))})(n,e)}function fy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bh(n){return(e,t)=>{let r=!1;for(const s of lr(n)){const i=py(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function py(n,e,t){const r=n.field.isKeyField()?F.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?An(u,d):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class on{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ft(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return ch(this.inner)}size(){return this.innerSize}}const my=new oe(F.comparator);function ft(){return my}const Rh=new oe(F.comparator);function rr(...n){let e=Rh;for(const t of n)e=e.insert(t.key,t);return e}function Sh(n){let e=Rh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Xt(){return ur()}function Ph(){return ur()}function ur(){return new on((n=>n.toString()),((n,e)=>n.isEqual(e)))}const gy=new oe(F.comparator),_y=new ge(F.comparator);function K(...n){let e=_y;for(const t of n)e=e.add(t);return e}const yy=new ge(G);function vy(){return yy}function Go(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ks(e)?"-0":e}}function Ch(n){return{integerValue:""+n}}function kh(n,e){return G_(e)?Ch(e):Go(n,e)}class Js{constructor(){this._=void 0}}function Ey(n,e,t){return n instanceof Ir?(function(s,i){const a={fields:{[hh]:{stringValue:uh},[fh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&qo(i)&&(i=Qs(i)),i&&(a.fields[dh]=i),{mapValue:a}})(t,e):n instanceof wr?Dh(n,e):n instanceof Ar?Vh(n,e):(function(s,i){const a=Nh(s,i),l=El(a)+El(s.Ae);return uo(a)&&uo(s.Ae)?Ch(l):Go(s.serializer,l)})(n,e)}function Ty(n,e,t){return n instanceof wr?Dh(n,e):n instanceof Ar?Vh(n,e):t}function Nh(n,e){return n instanceof br?(function(r){return uo(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class Ir extends Js{}class wr extends Js{constructor(e){super(),this.elements=e}}function Dh(n,e){const t=Oh(e);for(const r of n.elements)t.some((s=>tt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Ar extends Js{constructor(e){super(),this.elements=e}}function Vh(n,e){let t=Oh(e);for(const r of n.elements)t=t.filter((s=>!tt(s,r)));return{arrayValue:{values:t}}}class br extends Js{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function El(n){return le(n.integerValue||n.doubleValue)}function Oh(n){return jo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Lh{constructor(e,t){this.field=e,this.transform=t}}function Iy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof wr&&s instanceof wr||r instanceof Ar&&s instanceof Ar?wn(r.elements,s.elements,tt):r instanceof br&&s instanceof br?tt(r.Ae,s.Ae):r instanceof Ir&&s instanceof Ir})(n.transform,e.transform)}class wy{constructor(e,t){this.version=e,this.transformResults=t}}class Le{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Le}static exists(e){return new Le(void 0,e)}static updateTime(e){return new Le(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Zs{}function Mh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ei(n.key,Le.none()):new Mr(n.key,n.data,Le.none());{const t=n.data,r=Oe.empty();let s=new ge(we.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Bt(n.key,r,new Ue(s.toArray()),Le.none())}}function Ay(n,e,t){n instanceof Mr?(function(s,i,a){const l=s.value.clone(),u=Il(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Bt?(function(s,i,a){if(!gs(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=Il(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(xh(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function hr(n,e,t,r){return n instanceof Mr?(function(i,a,l,u){if(!gs(i.precondition,a))return l;const d=i.value.clone(),f=wl(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Bt?(function(i,a,l,u){if(!gs(i.precondition,a))return l;const d=wl(i.fieldTransforms,u,a),f=a.data;return f.setAll(xh(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(i,a,l){return gs(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function by(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Nh(r.transform,s||null);i!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,i))}return t||null}function Tl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&wn(r,s,((i,a)=>Iy(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Mr extends Zs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Bt extends Zs{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function xh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Il(n,e,t){const r=new Map;J(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,Ty(a,l,t[s]))}return r}function wl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Ey(i,a,e))}return r}class ei extends Zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ry extends Zs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Sy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Ay(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=hr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=hr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ph();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Mh(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(j.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),K())}isEqual(e){return this.batchId===e.batchId&&wn(this.mutations,e.mutations,((t,r)=>Tl(t,r)))&&wn(this.baseMutations,e.baseMutations,((t,r)=>Tl(t,r)))}}class Ko{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){J(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return gy})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Ko(e,t,r,s)}}class Py{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Cy{constructor(e,t){this.count=e,this.unchangedNames=t}}var he,Q;function ky(n){switch(n){case S.OK:return $(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Uh(n){if(n===void 0)return dt("GRPC error has no .code"),S.UNKNOWN;switch(n){case he.OK:return S.OK;case he.CANCELLED:return S.CANCELLED;case he.UNKNOWN:return S.UNKNOWN;case he.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case he.INTERNAL:return S.INTERNAL;case he.UNAVAILABLE:return S.UNAVAILABLE;case he.UNAUTHENTICATED:return S.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case he.NOT_FOUND:return S.NOT_FOUND;case he.ALREADY_EXISTS:return S.ALREADY_EXISTS;case he.PERMISSION_DENIED:return S.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case he.ABORTED:return S.ABORTED;case he.OUT_OF_RANGE:return S.OUT_OF_RANGE;case he.UNIMPLEMENTED:return S.UNIMPLEMENTED;case he.DATA_LOSS:return S.DATA_LOSS;default:return $(39323,{code:n})}}(Q=he||(he={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";function Ny(){return new TextEncoder}const Dy=new Nt([4294967295,4294967295],0);function Al(n){const e=Ny().encode(n),t=new Xu;return t.update(e),new Uint8Array(t.digest())}function bl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Nt([t,r],0),new Nt([s,i],0)]}class Qo{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new sr(`Invalid padding: ${t}`);if(r<0)throw new sr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new sr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new sr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Nt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Nt.fromNumber(r)));return s.compare(Dy)===1&&(s=new Nt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Al(e),[r,s]=bl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Qo(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Al(e),[r,s]=bl(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class sr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ti{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,xr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ti(j.min(),s,new oe(G),ft(),K())}}class xr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new xr(r,t,K(),K(),K())}}class _s{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Fh{constructor(e,t){this.targetId=e,this.Ce=t}}class Bh{constructor(e,t,r=Ae.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Rl{constructor(){this.ve=0,this.Fe=Sl(),this.Me=Ae.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=K(),t=K(),r=K();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:i})}})),new xr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Sl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,J(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Vy{constructor(e){this.Ge=e,this.ze=new Map,this.je=ft(),this.Je=as(),this.He=as(),this.Ye=new oe(G)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(fo(i))if(r===0){const a=new F(i.path);this.et(t,a,Pe.newNoDocument(a,j.min()))}else J(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=Lt(r).toUint8Array()}catch(u){if(u instanceof lh)return In("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Qo(a,s,i)}catch(u){return In(u instanceof sr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&fo(l.target)){const u=new F(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,Pe.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=K();this.He.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new ti(e,t,this.Ye,this.je,r);return this.je=ft(),this.Je=as(),this.He=as(),this.Ye=new oe(G),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Rl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ge(G),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ge(G),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Rl),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function as(){return new oe(F.comparator)}function Sl(){return new oe(F.comparator)}const Oy={asc:"ASCENDING",desc:"DESCENDING"},Ly={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},My={and:"AND",or:"OR"};class xy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function mo(n,e){return n.useProto3Json||Ks(e)?e:{value:e}}function Ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $h(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Uy(n,e){return Ls(n,e.toTimestamp())}function Je(n){return J(!!n,49232),j.fromTimestamp((function(t){const r=Ot(t);return new se(r.seconds,r.nanos)})(n))}function Yo(n,e){return go(n,e).canonicalString()}function go(n,e){const t=(function(s){return new te(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function qh(n){const e=te.fromString(n);return J(Gh(e),10190,{key:e.toString()}),e}function _o(n,e){return Yo(n.databaseId,e.path)}function Ki(n,e){const t=qh(e);if(t.get(1)!==n.databaseId.projectId)throw new L(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(Hh(t))}function jh(n,e){return Yo(n.databaseId,e)}function Fy(n){const e=qh(n);return e.length===4?te.emptyPath():Hh(e)}function yo(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Hh(n){return J(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pl(n,e,t){return{name:_o(n,e),fields:t.value.mapValue.fields}}function By(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:$(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(J(f===void 0||typeof f=="string",58123),Ae.fromBase64String(f||"")):(J(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ae.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const f=d.code===void 0?S.UNKNOWN:Uh(d.code);return new L(f,d.message||"")})(a);t=new Bh(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ki(n,r.document.name),i=Je(r.document.updateTime),a=r.document.createTime?Je(r.document.createTime):j.min(),l=new Oe({mapValue:{fields:r.document.fields}}),u=Pe.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];t=new _s(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ki(n,r.document),i=r.readTime?Je(r.readTime):j.min(),a=Pe.newNoDocument(s,i),l=r.removedTargetIds||[];t=new _s([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ki(n,r.document),i=r.removedTargetIds||[];t=new _s([],i,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new Cy(s,i),l=r.targetId;t=new Fh(l,a)}}return t}function $y(n,e){let t;if(e instanceof Mr)t={update:Pl(n,e.key,e.value)};else if(e instanceof ei)t={delete:_o(n,e.key)};else if(e instanceof Bt)t={update:Pl(n,e.key,e.data),updateMask:Yy(e.fieldMask)};else{if(!(e instanceof Ry))return $(16599,{Vt:e.type});t={verify:_o(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof Ir)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof wr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ar)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof br)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw $(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:Uy(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$(27497)})(n,e.precondition)),t}function qy(n,e){return n&&n.length>0?(J(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?Je(s.updateTime):Je(i);return a.isEqual(j.min())&&(a=Je(i)),new wy(a,s.transformResults||[])})(t,e)))):[]}function jy(n,e){return{documents:[jh(n,e.path)]}}function Hy(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jh(n,s);const i=(function(d){if(d.length!==0)return Wh(We.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(v){return{field:pn(v.field),direction:Gy(v.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=mo(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function zy(n){let e=Fy(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){J(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(m){const v=zh(m);return v instanceof We&&vh(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(m){return m.map((v=>(function(V){return new Tr(mn(V.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(V.direction))})(v)))})(t.orderBy));let l=null;t.limit&&(l=(function(m){let v;return v=typeof m=="object"?m.value:m,Ks(v)?null:v})(t.limit));let u=null;t.startAt&&(u=(function(m){const v=!!m.before,R=m.values||[];return new Vs(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const v=!m.before,R=m.values||[];return new Vs(R,v)})(t.endAt)),hy(e,s,a,i,l,"F",u,d)}function Wy(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=mn(t.unaryFilter.field);return de.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=mn(t.unaryFilter.field);return de.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=mn(t.unaryFilter.field);return de.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=mn(t.unaryFilter.field);return de.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return de.create(mn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return We.create(t.compositeFilter.filters.map((r=>zh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function Gy(n){return Oy[n]}function Ky(n){return Ly[n]}function Qy(n){return My[n]}function pn(n){return{fieldPath:n.canonicalString()}}function mn(n){return we.fromServerFormat(n.fieldPath)}function Wh(n){return n instanceof de?(function(t){if(t.op==="=="){if(ml(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NAN"}};if(pl(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ml(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NAN"}};if(pl(t.value))return{unaryFilter:{field:pn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pn(t.field),op:Ky(t.op),value:t.value}}})(n):n instanceof We?(function(t){const r=t.getFilters().map((s=>Wh(s)));return r.length===1?r[0]:{compositeFilter:{op:Qy(t.op),filters:r}}})(n):$(54877,{filter:n})}function Yy(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Gh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class St{constructor(e,t,r,s,i=j.min(),a=j.min(),l=Ae.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new St(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new St(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Xy{constructor(e){this.yt=e}}function Jy(n){const e=zy({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Os(e,e.limit,"L"):e}class Zy{constructor(){this.Cn=new ev}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Vt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Vt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class ev{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ge(te.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ge(te.comparator)).toArray()}}const Cl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kh=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(Kh,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class Rn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Rn(0)}static cr(){return new Rn(-1)}}const kl="LruGarbageCollector",tv=1048576;function Nl([n,e],[t,r]){const s=G(n,t);return s===0?G(e,r):s}class nv{constructor(e){this.Ir=e,this.buffer=new ge(Nl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Nl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){M(kl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Vn(t)?M(kl,"Ignoring IndexedDB error during garbage collection: ",t):await Dn(t)}await this.Vr(3e5)}))}}class sv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Gs.ce);const r=new nv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Cl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Cl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,l,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(e,s)))).next((m=>(r=m,l=Date.now(),this.removeTargets(e,r,t)))).next((m=>(i=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(d=Date.now(),dn()<=W.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m}))))}}function iv(n,e){return new sv(n,e)}class ov{constructor(){this.changes=new on((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class av{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class cv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&hr(r.mutation,s,Ue.empty(),se.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,K()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=K()){const s=Xt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=rr();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Xt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,K())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=ft();const a=ur(),l=(function(){return ur()})();return t.forEach(((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Bt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),hr(f.mutation,d,f.mutation.getFieldMask(),se.now())):a.set(d.key,Ue.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((d,f)=>a.set(d,f))),t.forEach(((d,f)=>l.set(d,new av(f,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=ur();let s=new oe(((a,l)=>a-l)),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let f=r.get(u)||Ue.empty();f=l.applyToLocalView(d,f),r.set(u,f);const m=(s.get(l.batchId)||K()).add(u);s=s.insert(l.batchId,m)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,m=Ph();f.forEach((v=>{if(!i.has(v)){const R=Mh(t.get(v),r.get(v));R!==null&&m.set(v,R),i=i.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):wh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):P.resolve(Xt());let l=_r,u=i;return a.next((d=>P.forEach(d,((f,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next((v=>{u=u.insert(f,v)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,u,d,K()))).next((f=>({batchId:l,changes:Sh(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next((r=>{let s=rr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=rr();return this.indexManager.getCollectionParents(e,i).next((l=>P.forEach(l,(u=>{const d=(function(m,v){return new On(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((f=>{f.forEach(((m,v)=>{a=a.insert(m,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Pe.newInvalidDocument(f)))}));let l=rr();return a.forEach(((u,d)=>{const f=i.get(u);f!==void 0&&hr(f.mutation,d,Ue.empty(),se.now()),Xs(t,d)&&(l=l.insert(u,d))})),l}))}}class lv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Je(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Jy(s.bundledQuery),readTime:Je(s.readTime)}})(t)),P.resolve()}}class uv{constructor(){this.overlays=new oe(F.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Xt();return P.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Xt(),i=t.length+1,a=new F(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new oe(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Xt(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Xt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,f)=>l.set(d,f))),!(l.size()>=s)););return P.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Py(t,r));let i=this.qr.get(t);i===void 0&&(i=K(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class hv{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class Xo{constructor(){this.Qr=new ge(Ee.$r),this.Ur=new ge(Ee.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Ee(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Ee(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new F(new te([])),r=new Ee(t,e),s=new Ee(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new F(new te([])),r=new Ee(t,e),s=new Ee(t,e+1);let i=K();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new Ee(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ee{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return F.comparator(e.key,t.key)||G(e.Yr,t.Yr)}static Kr(e,t){return G(e.Yr,t.Yr)||F.comparator(e.key,t.key)}}class dv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ge(Ee.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Sy(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new Ee(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?$o:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ee(t,0),s=new Ee(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);i.push(l)})),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ge(G);return t.forEach((s=>{const i=new Ee(s,0),a=new Ee(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(l=>{r=r.add(l.Yr)}))})),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;F.isDocumentKey(i)||(i=i.child(""));const a=new Ee(new F(i),0);let l=new ge(G);return this.Zr.forEachWhile((u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Yr)),!0)}),a),P.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){J(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,(s=>{const i=new Ee(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Ee(t,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class fv{constructor(e){this.ri=e,this.docs=(function(){return new oe(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Pe.newInvalidDocument(t))}getEntries(e,t){let r=ft();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Pe.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ft();const a=t.path,l=new F(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||j_(q_(f),r)<=0||(s.has(f.key)||Xs(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new pv(this)}getSize(e){return P.resolve(this.size)}}class pv extends ov{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class mv{constructor(e){this.persistence=e,this.si=new on((t=>Ho(t)),zo),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.oi=0,this._i=new Xo,this.targetCount=0,this.ai=Rn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Rn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),P.waitFor(i).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class Qh{constructor(e,t){this.ui={},this.overlays={},this.ci=new Gs(0),this.li=!1,this.li=!0,this.hi=new hv,this.referenceDelegate=e(this),this.Pi=new mv(this),this.indexManager=new Zy,this.remoteDocumentCache=(function(s){return new fv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Xy(t),this.Ii=new lv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new dv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const s=new gv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return P.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class gv extends z_{constructor(e){super(),this.currentSequenceNumber=e}}class Jo{constructor(e){this.persistence=e,this.Ri=new Xo,this.Vi=null}static mi(e){return new Jo(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(r=>{const s=F.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,j.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ms{constructor(e,t){this.persistence=e,this.pi=new on((r=>K_(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=iv(this,t)}static mi(e,t){return new Ms(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,i.removeEntry(a,j.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ps(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Zo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=K(),s=K();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Zo(e,t.fromCache,r,s)}}class _v{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class yv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Hf()?8:W_(Ce())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new _v;return this.Ss(e,t,a).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(dn()<=W.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",fn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(dn()<=W.DEBUG&&M("QueryEngine","Query:",fn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(dn()<=W.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",fn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xe(t))):P.resolve())}ys(e,t){if(vl(t))return P.resolve(null);let r=Xe(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Os(t,null,"F"),r=Xe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=K(...i);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const d=this.Ds(t,l);return this.Cs(t,d,a,u.readTime)?this.ys(e,Os(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ws(e,t,r,s){return vl(t)||s.isEqual(j.min())?P.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?P.resolve(null):(dn()<=W.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),fn(t)),this.vs(e,a,t,$_(s,_r)).next((l=>l)))}))}Ds(e,t){let r=new ge(bh(e));return t.forEach(((s,i)=>{Xs(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return dn()<=W.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",fn(t)),this.ps.getDocumentsMatchingQuery(e,t,Vt.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const ea="LocalStore",vv=3e8;class Ev{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new oe(G),this.xs=new on((i=>Ho(i)),zo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Tv(n,e,t,r){return new Ev(n,e,t,r)}async function Yh(n,e){const t=H(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=K();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function Iv(n,e){const t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,f){const m=d.batch,v=m.keys();let R=P.resolve();return v.forEach((V=>{R=R.next((()=>f.getEntry(u,V))).next((N=>{const k=d.docVersions.get(V);J(k!==null,48541),N.version.compareTo(k)<0&&(m.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))}))})),R.next((()=>l.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=K();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Xh(n){const e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function wv(n,e){const t=H(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((f,m)=>{const v=s.get(m);if(!v)return;l.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(i,f.addedDocuments,m))));let R=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?R=R.withResumeToken(Ae.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,r)),s=s.insert(m,R),(function(N,k,C){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=vv?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(v,R,f)&&l.push(t.Pi.updateTargetData(i,R))}));let u=ft(),d=K();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(Av(i,a,e.documentUpdates).next((f=>{u=f.ks,d=f.qs}))),!r.isEqual(j.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next((m=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return P.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,d))).next((()=>u))})).then((i=>(t.Ms=s,i)))}function Av(n,e,t){let r=K(),s=K();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=ft();return t.forEach(((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(j.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):M(ea,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function bv(n,e){const t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=$o),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Rv(n,e){const t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,P.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new St(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function vo(n,e,t){const r=H(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Vn(a))throw a;M(ea,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Dl(n,e,t){const r=H(n);let s=j.min(),i=K();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,f){const m=H(u),v=m.xs.get(f);return v!==void 0?P.resolve(m.Ms.get(v)):m.Pi.getTargetData(d,f)})(r,a,Xe(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:j.min(),t?i:K()))).next((l=>(Sv(r,fy(e),l),{documents:l,Qs:i})))))}function Sv(n,e,t){let r=n.Os.get(e)||j.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class Vl{constructor(){this.activeTargetIds=vy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pv{constructor(){this.Mo=new Vl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Vl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cv{Oo(e){}shutdown(){}}const Ol="ConnectivityMonitor";class Ll{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){M(Ol,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){M(Ol,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let cs=null;function Eo(){return cs===null?cs=(function(){return 268435456+Math.round(2147483648*Math.random())})():cs++,"0x"+cs.toString(16)}const Qi="RestConnection",kv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Nv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Ns?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Eo(),l=this.zo(e,t.toUriEncodedString());M(Qi,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:d}=new URL(l),f=Pn(d);return this.Jo(e,l,u,r,f).then((m=>(M(Qi,`Received RPC '${e}' ${a}: `,m),m)),(m=>{throw In(Qi,`RPC '${e}' ${a} failed with error: `,m,"url: ",l,"request:",r),m}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Nn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=kv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Dv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Re="WebChannelConnection";class Vv extends Nv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Eo();return new Promise(((l,u)=>{const d=new Ju;d.setWithCredentials(!0),d.listenOnce(Zu.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case fs.NO_ERROR:const m=d.getResponseJson();M(Re,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),l(m);break;case fs.TIMEOUT:M(Re,`RPC '${e}' ${a} timed out`),u(new L(S.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const v=d.getStatus();if(M(Re,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const V=R?.error;if(V&&V.status&&V.message){const N=(function(C){const x=C.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(x)>=0?x:S.UNKNOWN})(V.status);u(new L(N,V.message))}else u(new L(S.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new L(S.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{M(Re,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);M(Re,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Eo(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=nh(),l=th(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=i.join("");M(Re,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let v=!1,R=!1;const V=new Dv({Yo:k=>{R?M(Re,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(v||(M(Re,`Opening RPC '${e}' stream ${s} transport.`),m.open(),v=!0),M(Re,`RPC '${e}' stream ${s} sending:`,k),m.send(k))},Zo:()=>m.close()}),N=(k,C,x)=>{k.listen(C,(O=>{try{x(O)}catch(q){setTimeout((()=>{throw q}),0)}}))};return N(m,nr.EventType.OPEN,(()=>{R||(M(Re,`RPC '${e}' stream ${s} transport opened.`),V.o_())})),N(m,nr.EventType.CLOSE,(()=>{R||(R=!0,M(Re,`RPC '${e}' stream ${s} transport closed`),V.a_(),this.E_(m))})),N(m,nr.EventType.ERROR,(k=>{R||(R=!0,In(Re,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),V.a_(new L(S.UNAVAILABLE,"The operation could not be completed")))})),N(m,nr.EventType.MESSAGE,(k=>{if(!R){const C=k.data[0];J(!!C,16349);const x=C,O=x?.error||x[0]?.error;if(O){M(Re,`RPC '${e}' stream ${s} received error:`,O);const q=O.status;let U=(function(g){const y=he[g];if(y!==void 0)return Uh(y)})(q),Y=O.message;U===void 0&&(U=S.INTERNAL,Y="Unknown error status: "+q+" with message "+O.message),R=!0,V.a_(new L(U,Y)),m.close()}else M(Re,`RPC '${e}' stream ${s} received:`,C),V.u_(C)}})),N(l,eh.STAT_EVENT,(k=>{k.stat===ao.PROXY?M(Re,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===ao.NOPROXY&&M(Re,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{V.__()}),0),V}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Yi(){return typeof document<"u"?document:null}function ni(n){return new xy(n,!0)}class Jh{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&M("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ml="PersistentStream";class Zh{constructor(e,t,r,s,i,a,l,u){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Jh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(dt(t.toString()),dt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new L(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(Ml,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(M(Ml,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ov extends Zh{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=By(this.serializer,e),r=(function(i){if(!("targetChange"in i))return j.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?Je(a.readTime):j.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=yo(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=fo(u)?{documents:jy(i,u)}:{query:Hy(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=$h(i,a.resumeToken);const d=mo(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(j.min())>0){l.readTime=Ls(i,a.snapshotVersion.toTimestamp());const d=mo(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=Wy(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=yo(this.serializer),t.removeTarget=e,this.q_(t)}}class Lv extends Zh{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return J(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,J(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){J(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=qy(e.writeResults,e.commitTime),r=Je(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=yo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>$y(this.serializer,r)))};this.q_(t)}}class Mv{}class xv extends Mv{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new L(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,go(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new L(S.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,go(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new L(S.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Uv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(dt(t),this.aa=!1):M("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const sn="RemoteStore";class Fv{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{an(this)&&(M(sn,"Restarting streams for network reachability change."),await(async function(u){const d=H(u);d.Ea.add(4),await Ur(d),d.Ra.set("Unknown"),d.Ea.delete(4),await ri(d)})(this))}))})),this.Ra=new Uv(r,s)}}async function ri(n){if(an(n))for(const e of n.da)await e(!0)}async function Ur(n){for(const e of n.da)await e(!1)}function ed(n,e){const t=H(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),sa(t)?ra(t):Ln(t).O_()&&na(t,e))}function ta(n,e){const t=H(n),r=Ln(t);t.Ia.delete(e),r.O_()&&td(t,e),t.Ia.size===0&&(r.O_()?r.L_():an(t)&&t.Ra.set("Unknown"))}function na(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ln(n).Y_(e)}function td(n,e){n.Va.Ue(e),Ln(n).Z_(e)}function ra(n){n.Va=new Vy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Ln(n).start(),n.Ra.ua()}function sa(n){return an(n)&&!Ln(n).x_()&&n.Ia.size>0}function an(n){return H(n).Ea.size===0}function nd(n){n.Va=void 0}async function Bv(n){n.Ra.set("Online")}async function $v(n){n.Ia.forEach(((e,t)=>{na(n,e)}))}async function qv(n,e){nd(n),sa(n)?(n.Ra.ha(e),ra(n)):n.Ra.set("Unknown")}async function jv(n,e,t){if(n.Ra.set("Online"),e instanceof Bh&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){M(sn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await xs(n,r)}else if(e instanceof _s?n.Va.Ze(e):e instanceof Fh?n.Va.st(e):n.Va.tt(e),!t.isEqual(j.min()))try{const r=await Xh(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Ae.EMPTY_BYTE_STRING,f.snapshotVersion)),td(i,u);const m=new St(f.target,u,d,f.sequenceNumber);na(i,m)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){M(sn,"Failed to raise snapshot:",r),await xs(n,r)}}async function xs(n,e,t){if(!Vn(e))throw e;n.Ea.add(1),await Ur(n),n.Ra.set("Offline"),t||(t=()=>Xh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(sn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ri(n)}))}function rd(n,e){return e().catch((t=>xs(n,t,e)))}async function si(n){const e=H(n),t=xt(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:$o;for(;Hv(e);)try{const s=await bv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,zv(e,s)}catch(s){await xs(e,s)}sd(e)&&id(e)}function Hv(n){return an(n)&&n.Ta.length<10}function zv(n,e){n.Ta.push(e);const t=xt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function sd(n){return an(n)&&!xt(n).x_()&&n.Ta.length>0}function id(n){xt(n).start()}async function Wv(n){xt(n).ra()}async function Gv(n){const e=xt(n);for(const t of n.Ta)e.ea(t.mutations)}async function Kv(n,e,t){const r=n.Ta.shift(),s=Ko.from(r,e,t);await rd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await si(n)}async function Qv(n,e){e&&xt(n).X_&&await(async function(r,s){if((function(a){return ky(a)&&a!==S.ABORTED})(s.code)){const i=r.Ta.shift();xt(r).B_(),await rd(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await si(r)}})(n,e),sd(n)&&id(n)}async function xl(n,e){const t=H(n);t.asyncQueue.verifyOperationInProgress(),M(sn,"RemoteStore received new credentials");const r=an(t);t.Ea.add(3),await Ur(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ri(t)}async function Yv(n,e){const t=H(n);e?(t.Ea.delete(2),await ri(t)):e||(t.Ea.add(2),await Ur(t),t.Ra.set("Unknown"))}function Ln(n){return n.ma||(n.ma=(function(t,r,s){const i=H(t);return i.sa(),new Ov(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:Bv.bind(null,n),t_:$v.bind(null,n),r_:qv.bind(null,n),H_:jv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),sa(n)?ra(n):n.Ra.set("Unknown")):(await n.ma.stop(),nd(n))}))),n.ma}function xt(n){return n.fa||(n.fa=(function(t,r,s){const i=H(t);return i.sa(),new Lv(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Wv.bind(null,n),r_:Qv.bind(null,n),ta:Gv.bind(null,n),na:Kv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await si(n)):(await n.fa.stop(),n.Ta.length>0&&(M(sn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class ia{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new ia(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function oa(n,e){if(dt("AsyncQueue",`${e}: ${n}`),Vn(n))return new L(S.UNAVAILABLE,`${e}: ${n}`);throw n}class vn{static emptySet(e){return new vn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=rr(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new vn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Ul{constructor(){this.ga=new oe(F.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Sn{constructor(e,t,r,s,i,a,l,u,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new Sn(e,t,vn.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ys(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Xv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Jv{constructor(){this.queries=Fl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=H(t),i=s.queries;s.queries=Fl(),i.forEach(((a,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new L(S.ABORTED,"Firestore shutting down"))}}function Fl(){return new on((n=>Ah(n)),Ys)}async function od(n,e){const t=H(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new Xv,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=oa(a,`Initialization of query '${fn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&aa(t)}async function ad(n,e){const t=H(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Zv(n,e){const t=H(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&aa(t)}function eE(n,e,t){const r=H(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function aa(n){n.Ca.forEach((e=>{e.next()}))}var To,Bl;(Bl=To||(To={})).Ma="default",Bl.Cache="cache";class cd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Sn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Sn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==To.Cache}}class ld{constructor(e){this.key=e}}class ud{constructor(e){this.key=e}}class tE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=bh(e),this.tu=new vn(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Ul,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,m)=>{const v=s.get(f),R=Xs(this.query,m)?m:null,V=!!v&&this.mutatedKeys.has(v.key),N=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let k=!1;v&&R?v.data.isEqual(R.data)?V!==N&&(r.track({type:3,doc:R}),k=!0):this.su(v,R)||(r.track({type:2,doc:R}),k=!0,(u&&this.eu(R,u)>0||d&&this.eu(R,d)<0)&&(l=!0)):!v&&R?(r.track({type:0,doc:R}),k=!0):v&&!R&&(r.track({type:1,doc:v}),k=!0,(u||d)&&(l=!0)),k&&(R?(a=a.add(R),i=N?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,m)=>(function(R,V){const N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:k})}};return N(R)-N(V)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new Sn(this.query,e.tu,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ul,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=K(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new ud(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new ld(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=K();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Sn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ca="SyncEngine";class nE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class rE{constructor(e){this.key=e,this.hu=!1}}class sE{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new on((l=>Ah(l)),Ys),this.Iu=new Map,this.Eu=new Set,this.du=new oe(F.comparator),this.Au=new Map,this.Ru=new Xo,this.Vu={},this.mu=new Map,this.fu=Rn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function iE(n,e,t=!0){const r=gd(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await hd(r,e,t,!0),s}async function oE(n,e){const t=gd(n);await hd(t,e,!0,!1)}async function hd(n,e,t,r){const s=await Rv(n.localStore,Xe(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await aE(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&ed(n.remoteStore,s),l}async function aE(n,e,t,r,s){n.pu=(m,v,R)=>(async function(N,k,C,x){let O=k.view.ru(C);O.Cs&&(O=await Dl(N.localStore,k.query,!1).then((({documents:T})=>k.view.ru(T,O))));const q=x&&x.targetChanges.get(k.targetId),U=x&&x.targetMismatches.get(k.targetId)!=null,Y=k.view.applyChanges(O,N.isPrimaryClient,q,U);return ql(N,k.targetId,Y.au),Y.snapshot})(n,m,v,R);const i=await Dl(n.localStore,e,!0),a=new tE(e,i.Qs),l=a.ru(i.documents),u=xr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,u);ql(n,t,d.au);const f=new nE(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function cE(n,e,t){const r=H(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!Ys(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await vo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ta(r.remoteStore,s.targetId),Io(r,s.targetId)})).catch(Dn)):(Io(r,s.targetId),await vo(r.localStore,s.targetId,!0))}async function lE(n,e){const t=H(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ta(t.remoteStore,r.targetId))}async function uE(n,e,t){const r=_E(n);try{const s=await(function(a,l){const u=H(a),d=se.now(),f=l.reduce(((R,V)=>R.add(V.key)),K());let m,v;return u.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let V=ft(),N=K();return u.Ns.getEntries(R,f).next((k=>{V=k,V.forEach(((C,x)=>{x.isValidDocument()||(N=N.add(C))}))})).next((()=>u.localDocuments.getOverlayedDocuments(R,V))).next((k=>{m=k;const C=[];for(const x of l){const O=by(x,m.get(x.key).overlayedDocument);O!=null&&C.push(new Bt(x.key,O,gh(O.value.mapValue),Le.exists(!0)))}return u.mutationQueue.addMutationBatch(R,d,C,l)})).next((k=>{v=k;const C=k.applyToLocalDocumentSet(m,N);return u.documentOverlayCache.saveOverlays(R,k.batchId,C)}))})).then((()=>({batchId:v.batchId,changes:Sh(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new oe(G)),d=d.insert(l,u),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Fr(r,s.changes),await si(r.remoteStore)}catch(s){const i=oa(s,"Failed to persist write");t.reject(i)}}async function dd(n,e){const t=H(n);try{const r=await wv(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(J(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?J(a.hu,14607):s.removedDocuments.size>0&&(J(a.hu,42227),a.hu=!1))})),await Fr(t,r,e)}catch(r){await Dn(r)}}function $l(n,e,t){const r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=H(a);u.onlineState=l;let d=!1;u.queries.forEach(((f,m)=>{for(const v of m.Sa)v.va(l)&&(d=!0)})),d&&aa(u)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function hE(n,e,t){const r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new oe(F.comparator);a=a.insert(i,Pe.newNoDocument(i,j.min()));const l=K().add(i),u=new ti(j.min(),new Map,new oe(G),a,l);await dd(r,u),r.du=r.du.remove(i),r.Au.delete(e),la(r)}else await vo(r.localStore,e,!1).then((()=>Io(r,e,t))).catch(Dn)}async function dE(n,e){const t=H(n),r=e.batch.batchId;try{const s=await Iv(t.localStore,e);pd(t,r,null),fd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Fr(t,s)}catch(s){await Dn(s)}}async function fE(n,e,t){const r=H(n);try{const s=await(function(a,l){const u=H(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next((m=>(J(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(d,m)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>u.localDocuments.getDocuments(d,f)))}))})(r.localStore,e);pd(r,e,t),fd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Fr(r,s)}catch(s){await Dn(s)}}function fd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function pd(n,e,t){const r=H(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Io(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||md(n,r)}))}function md(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ta(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),la(n))}function ql(n,e,t){for(const r of t)r instanceof ld?(n.Ru.addReference(r.key,e),pE(n,r)):r instanceof ud?(M(ca,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||md(n,r.key)):$(19791,{wu:r})}function pE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(M(ca,"New document in limbo: "+t),n.Eu.add(r),la(n))}function la(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new F(te.fromString(e)),r=n.fu.next();n.Au.set(r,new rE(t)),n.du=n.du.insert(t,r),ed(n.remoteStore,new St(Xe(Wo(t.path)),r,"TargetPurposeLimboResolution",Gs.ce))}}async function Fr(n,e,t){const r=H(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Zo.As(u.targetId,d);i.push(f)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(u,d){const f=H(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>P.forEach(d,(v=>P.forEach(v.Es,(R=>f.persistence.referenceDelegate.addReference(m,v.targetId,R))).next((()=>P.forEach(v.ds,(R=>f.persistence.referenceDelegate.removeReference(m,v.targetId,R)))))))))}catch(m){if(!Vn(m))throw m;M(ea,"Failed to update sequence numbers: "+m)}for(const m of d){const v=m.targetId;if(!m.fromCache){const R=f.Ms.get(v),V=R.snapshotVersion,N=R.withLastLimboFreeSnapshotVersion(V);f.Ms=f.Ms.insert(v,N)}}})(r.localStore,i))}async function mE(n,e){const t=H(n);if(!t.currentUser.isEqual(e)){M(ca,"User change. New user:",e.toKey());const r=await Yh(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new L(S.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Fr(t,r.Ls)}}function gE(n,e){const t=H(n),r=t.Au.get(e);if(r&&r.hu)return K().add(r.key);{let s=K();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function gd(n){const e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=dd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hE.bind(null,e),e.Pu.H_=Zv.bind(null,e.eventManager),e.Pu.yu=eE.bind(null,e.eventManager),e}function _E(n){const e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=dE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=fE.bind(null,e),e}class Us{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ni(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Tv(this.persistence,new yv,e.initialUser,this.serializer)}Cu(e){return new Qh(Jo.mi,this.serializer)}Du(e){return new Pv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Us.provider={build:()=>new Us};class yE extends Us{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){J(this.persistence.referenceDelegate instanceof Ms,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new rv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Qh((r=>Ms.mi(r,t)),this.serializer)}}class wo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$l(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=mE.bind(null,this.syncEngine),await Yv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Jv})()}createDatastore(e){const t=ni(e.databaseInfo.databaseId),r=(function(i){return new Vv(i)})(e.databaseInfo);return(function(i,a,l,u){return new xv(i,a,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new Fv(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>$l(this.syncEngine,t,0)),(function(){return Ll.v()?new Ll:new Cv})())}createSyncEngine(e,t){return(function(s,i,a,l,u,d,f){const m=new sE(s,i,a,l,u,d);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=H(t);M(sn,"RemoteStore shutting down."),r.Ea.add(5),await Ur(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}wo.provider={build:()=>new wo};class _d{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):dt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Ut="FirestoreClient";class vE{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Se.UNAUTHENTICATED,this.clientId=Bo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{M(Ut,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(M(Ut,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=oa(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Xi(n,e){n.asyncQueue.verifyOperationInProgress(),M(Ut,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Yh(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function jl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await EE(n);M(Ut,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>xl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>xl(e.remoteStore,s))),n._onlineComponents=e}async function EE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(Ut,"Using user provided OfflineComponentProvider");try{await Xi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;In("Error using user provided cache. Falling back to memory cache: "+t),await Xi(n,new Us)}}else M(Ut,"Using default OfflineComponentProvider"),await Xi(n,new yE(void 0));return n._offlineComponents}async function yd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(Ut,"Using user provided OnlineComponentProvider"),await jl(n,n._uninitializedComponentsProvider._online)):(M(Ut,"Using default OnlineComponentProvider"),await jl(n,new wo))),n._onlineComponents}function TE(n){return yd(n).then((e=>e.syncEngine))}async function vd(n){const e=await yd(n),t=e.eventManager;return t.onListen=iE.bind(null,e.syncEngine),t.onUnlisten=cE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=oE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=lE.bind(null,e.syncEngine),t}function IE(n,e,t={}){const r=new lt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new _d({next:v=>{f.Nu(),a.enqueueAndForget((()=>ad(i,m)));const R=v.docs.has(l);!R&&v.fromCache?d.reject(new L(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&v.fromCache&&u&&u.source==="server"?d.reject(new L(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new cd(Wo(l.path),f,{includeMetadataChanges:!0,qa:!0});return od(i,m)})(await vd(n),n.asyncQueue,e,t,r))),r.promise}function wE(n,e,t={}){const r=new lt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new _d({next:v=>{f.Nu(),a.enqueueAndForget((()=>ad(i,m))),v.fromCache&&u.source==="server"?d.reject(new L(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),m=new cd(l,f,{includeMetadataChanges:!0,qa:!0});return od(i,m)})(await vd(n),n.asyncQueue,e,t,r))),r.promise}function Ed(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Hl=new Map;const Td="firestore.googleapis.com",zl=!0;class Wl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Td,this.ssl=zl}else this.host=e.host,this.ssl=e.ssl??zl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Kh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<tv)throw new L(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}F_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ed(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ii{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new C_;switch(r.type){case"firstParty":return new V_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Hl.get(t);r&&(M("ComponentProvider","Removing Datastore"),Hl.delete(t),r.terminate())})(this),Promise.resolve()}}function AE(n,e,t,r={}){n=ze(n,ii);const s=Pn(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(uu(`https://${l}`),hu("Firestore",!0)),i.host!==Td&&i.host!==l&&In("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!Zt(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=Se.MOCK_USER;else{d=Lf(r.mockUserToken,n._app?.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new L(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Se(m)}n._authCredentials=new k_(new sh(d,f))}}class $t{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new $t(this.firestore,e,this._query)}}class ue{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ue(this.firestore,e,this._key)}toJSON(){return{type:ue._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Lr(t,ue._jsonSchema))return new ue(e,r||null,new F(te.fromString(t.referencePath)))}}ue._jsonSchemaVersion="firestore/documentReference/1.0",ue._jsonSchema={type:fe("string",ue._jsonSchemaVersion),referencePath:fe("string")};class Dt extends $t{constructor(e,t,r){super(e,t,Wo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new F(e))}withConverter(e){return new Dt(this.firestore,e,this._path)}}function Mn(n,e,...t){if(n=ce(n),ih("collection","path",e),n instanceof ii){const r=te.fromString(e,...t);return il(r),new Dt(n,null,r)}{if(!(n instanceof ue||n instanceof Dt))throw new L(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(te.fromString(e,...t));return il(r),new Dt(n.firestore,null,r)}}function me(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Bo.newId()),ih("doc","path",e),n instanceof ii){const r=te.fromString(e,...t);return sl(r),new ue(n,null,new F(r))}{if(!(n instanceof ue||n instanceof Dt))throw new L(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(te.fromString(e,...t));return sl(r),new ue(n.firestore,n instanceof Dt?n.converter:null,new F(r))}}const Gl="AsyncQueue";class Kl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Jh(this,"async_queue_retry"),this._c=()=>{const r=Yi();r&&M(Gl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Yi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Yi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new lt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Vn(e))throw e;M(Gl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,dt("INTERNAL UNHANDLED ERROR: ",Ql(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ia.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Ql(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ql(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class cn extends ii{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Kl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Kl(e),this._firestoreClient=void 0,await e}}}function bE(n,e){const t=typeof n=="object"?n:mu(),r=typeof n=="string"?n:Ns,s=So(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Vf("firestore");i&&AE(s,...i)}return s}function oi(n){if(n._terminated)throw new L(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||RE(n),n._firestoreClient}function RE(n){const e=n._freezeSettings(),t=(function(s,i,a,l){return new X_(s,i,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ed(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new vE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class $e{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $e(Ae.fromBase64String(e))}catch(t){throw new L(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $e(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$e._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Lr(e,$e._jsonSchema))return $e.fromBase64String(e.bytes)}}$e._jsonSchemaVersion="firestore/bytes/1.0",$e._jsonSchema={type:fe("string",$e._jsonSchemaVersion),bytes:fe("string")};class Br{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new we(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class $r{constructor(e){this._methodName=e}}class Ze{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ze._jsonSchemaVersion}}static fromJSON(e){if(Lr(e,Ze._jsonSchema))return new Ze(e.latitude,e.longitude)}}Ze._jsonSchemaVersion="firestore/geoPoint/1.0",Ze._jsonSchema={type:fe("string",Ze._jsonSchemaVersion),latitude:fe("number"),longitude:fe("number")};class et{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:et._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Lr(e,et._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new et(e.vectorValues);throw new L(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}et._jsonSchemaVersion="firestore/vectorValue/1.0",et._jsonSchema={type:fe("string",et._jsonSchemaVersion),vectorValues:fe("object")};const SE=/^__.*__$/;class PE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mr(e,this.data,t,this.fieldTransforms)}}class Id{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class ua{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new ua({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Fs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(wd(this.Ac)&&SE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class CE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ni(e)}Cc(e,t,r,s=!1){return new ua({Ac:e,methodName:t,Dc:r,path:we.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ai(n){const e=n._freezeSettings(),t=ni(n._databaseId);return new CE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ad(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);fa("Data must be an object, but it was:",a,r);const l=Sd(r,a);let u,d;if(i.merge)u=new Ue(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const m of i.mergeFields){const v=Ao(e,m,t);if(!a.contains(v))throw new L(S.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Cd(f,v)||f.push(v)}u=new Ue(f),d=a.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,d=a.fieldTransforms;return new PE(new Oe(l),u,d)}class ci extends $r{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ci}}class ha extends $r{_toFieldTransform(e){return new Lh(e.path,new Ir)}isEqual(e){return e instanceof ha}}class da extends $r{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new br(e.serializer,kh(e.serializer,this.Fc));return new Lh(e.path,t)}isEqual(e){return e instanceof da&&this.Fc===e.Fc}}function bd(n,e,t,r){const s=n.Cc(1,e,t);fa("Data must be an object, but it was:",s,r);const i=[],a=Oe.empty();Ft(r,((u,d)=>{const f=pa(e,u,t);d=ce(d);const m=s.yc(f);if(d instanceof ci)i.push(f);else{const v=qr(d,m);v!=null&&(i.push(f),a.set(f,v))}}));const l=new Ue(i);return new Id(a,l,s.fieldTransforms)}function Rd(n,e,t,r,s,i){const a=n.Cc(1,e,t),l=[Ao(e,r,t)],u=[s];if(i.length%2!=0)throw new L(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)l.push(Ao(e,i[v])),u.push(i[v+1]);const d=[],f=Oe.empty();for(let v=l.length-1;v>=0;--v)if(!Cd(d,l[v])){const R=l[v];let V=u[v];V=ce(V);const N=a.yc(R);if(V instanceof ci)d.push(R);else{const k=qr(V,N);k!=null&&(d.push(R),f.set(R,k))}}const m=new Ue(d);return new Id(f,m,a.fieldTransforms)}function kE(n,e,t,r=!1){return qr(t,n.Cc(r?4:3,e))}function qr(n,e){if(Pd(n=ce(n)))return fa("Unsupported field value:",e,n),Sd(n,e);if(n instanceof $r)return(function(r,s){if(!wd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=qr(l,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return kh(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=se.fromDate(r);return{timestampValue:Ls(s.serializer,i)}}if(r instanceof se){const i=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ls(s.serializer,i)}}if(r instanceof Ze)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $e)return{bytesValue:$h(s.serializer,r._byteString)};if(r instanceof ue){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Yo(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof et)return(function(a,l){return{mapValue:{fields:{[ph]:{stringValue:mh},[Ds]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Go(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Ws(r)}`)})(n,e)}function Sd(n,e){const t={};return ch(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ft(n,((r,s)=>{const i=qr(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Pd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof Ze||n instanceof $e||n instanceof ue||n instanceof $r||n instanceof et)}function fa(n,e,t){if(!Pd(t)||!oh(t)){const r=Ws(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Ao(n,e,t){if((e=ce(e))instanceof Br)return e._internalPath;if(typeof e=="string")return pa(n,e);throw Fs("Field path arguments must be of type string or ",n,!1,void 0,t)}const NE=new RegExp("[~\\*/\\[\\]]");function pa(n,e,t){if(e.search(NE)>=0)throw Fs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Br(...e.split("."))._internalPath}catch{throw Fs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Fs(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new L(S.INVALID_ARGUMENT,l+n+u)}function Cd(n,e){return n.some((t=>t.isEqual(e)))}class kd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(li("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class DE extends kd{data(){return super.data()}}function li(n,e){return typeof e=="string"?pa(n,e):e instanceof Br?e._internalPath:e._delegate._internalPath}function VE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ma{}class ga extends ma{}function ui(n,e,...t){let r=[];e instanceof ma&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof _a)).length,l=i.filter((u=>u instanceof hi)).length;if(a>1||a>0&&l>0)throw new L(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class hi extends ga{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new hi(e,t,r)}_apply(e){const t=this._parse(e);return Vd(e._query,t),new $t(e.firestore,e.converter,po(e._query,t))}_parse(e){const t=ai(e.firestore);return(function(i,a,l,u,d,f,m){let v;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new L(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Xl(m,f);const V=[];for(const N of m)V.push(Yl(u,i,N));v={arrayValue:{values:V}}}else v=Yl(u,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Xl(m,f),v=kE(l,a,m,f==="in"||f==="not-in");return de.create(d,f,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Nd(n,e,t){const r=e,s=li("where",n);return hi._create(s,r,t)}class _a extends ma{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new _a(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:We.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Vd(a,u),a=po(a,u)})(e._query,t),new $t(e.firestore,e.converter,po(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ya extends ga{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ya(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new L(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new L(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Tr(i,a)})(e._query,this._field,this._direction);return new $t(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new On(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function di(n,e="asc"){const t=e,r=li("orderBy",n);return ya._create(r,t)}class va extends ga{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new va(e,t,r)}_apply(e){return new $t(e.firestore,e.converter,Os(e._query,this._limit,this._limitType))}}function Dd(n){return B_("limit",n),va._create("limit",n,"F")}function Yl(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new L(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wh(e)&&t.indexOf("/")!==-1)throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(te.fromString(t));if(!F.isDocumentKey(r))throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fl(n,new F(r))}if(t instanceof ue)return fl(n,t._key);throw new L(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ws(t)}.`)}function Xl(n,e){if(!Array.isArray(n)||n.length===0)throw new L(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Vd(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new L(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class OE{convertValue(e,t="none"){switch(Mt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Lt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ft(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[Ds].arrayValue?.values?.map((r=>le(r.doubleValue)));return new et(t)}convertGeoPoint(e){return new Ze(le(e.latitude),le(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Qs(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yr(e));default:return null}}convertTimestamp(e){const t=Ot(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=te.fromString(e);J(Gh(r),9688,{name:e});const s=new vr(r.get(1),r.get(3)),i=new F(r.popFirst(5));return s.isEqual(t)||dt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Od(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ir{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Jt extends kd{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ys(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(li("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Jt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Jt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Jt._jsonSchema={type:fe("string",Jt._jsonSchemaVersion),bundleSource:fe("string","DocumentSnapshot"),bundleName:fe("string"),bundle:fe("string")};class ys extends Jt{data(e={}){return super.data(e)}}class En{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ir(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new ys(this._firestore,this._userDataWriter,r.key,r,new ir(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new ys(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ir(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new ys(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ir(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:LE(l.type),doc:u,oldIndex:d,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=En._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Bo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function LE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}function Ea(n){n=ze(n,ue);const e=ze(n.firestore,cn);return IE(oi(e),n._key).then((t=>ME(e,n,t)))}En._jsonSchemaVersion="firestore/querySnapshot/1.0",En._jsonSchema={type:fe("string",En._jsonSchemaVersion),bundleSource:fe("string","QuerySnapshot"),bundleName:fe("string"),bundle:fe("string")};class Ld extends OE{constructor(e){super(),this.firestore=e}convertBytes(e){return new $e(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}}function fi(n){n=ze(n,$t);const e=ze(n.firestore,cn),t=oi(e),r=new Ld(e);return VE(n._query),wE(t,n._query).then((s=>new En(e,r,n,s)))}function Ta(n,e,t){n=ze(n,ue);const r=ze(n.firestore,cn),s=Od(n.converter,e,t);return mi(r,[Ad(ai(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Le.none())])}function pi(n,e,t,...r){n=ze(n,ue);const s=ze(n.firestore,cn),i=ai(s);let a;return a=typeof(e=ce(e))=="string"||e instanceof Br?Rd(i,"updateDoc",n._key,e,t,r):bd(i,"updateDoc",n._key,e),mi(s,[a.toMutation(n._key,Le.exists(!0))])}function Md(n){return mi(ze(n.firestore,cn),[new ei(n._key,Le.none())])}function mi(n,e){return(function(r,s){const i=new lt;return r.asyncQueue.enqueueAndForget((async()=>uE(await TE(r),s,i))),i.promise})(oi(n),e)}function ME(n,e,t){const r=t.docs.get(e._key),s=new Ld(n);return new Jt(n,s,e._key,r,new ir(t.hasPendingWrites,t.fromCache),e.converter)}class xE{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ai(e)}set(e,t,r){this._verifyNotCommitted();const s=Ji(e,this._firestore),i=Od(s.converter,t,r),a=Ad(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,Le.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ji(e,this._firestore);let a;return a=typeof(t=ce(t))=="string"||t instanceof Br?Rd(this._dataReader,"WriteBatch.update",i._key,t,r,s):bd(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,Le.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ji(e,this._firestore);return this._mutations=this._mutations.concat(new ei(t._key,Le.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ji(n,e){if((n=ce(n)).firestore!==e)throw new L(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Z(){return new ha("serverTimestamp")}function Zn(n){return new da("increment",n)}function UE(n){return oi(n=ze(n,cn)),new xE(n,(e=>mi(n,e)))}(function(e,t=!0){(function(s){Nn=s})(Cn),Tn(new en("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new cn(new N_(r.getProvider("auth-internal")),new O_(a,r.getProvider("app-check-internal")),(function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new L(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vr(d.options.projectId,f)})(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),kt(el,tl,e),kt(el,tl,"esm2020")})();const FE={apiKey:"AIzaSyDJurXmliChoLZ5tdiXsH-kTaiyfcEtsgM",authDomain:"ethos-dev-ec0d6.firebaseapp.com",projectId:"ethos-dev-ec0d6",storageBucket:"ethos-dev-ec0d6.firebasestorage.app",messagingSenderId:"154735949292",appId:"1:154735949292:web:2641d40b6563c39f9efcc9"},xd=pu(FE),nt=b_(xd),_e=bE(xd);function BE(n){return pg(nt,n)}async function Ud(n=!0){await Mo(nt,n?js:Vr);const e=new it;return Og(nt,e)}async function $E(n){const e=String(n||"").trim().toLowerCase();return e?hg(nt,e):[]}async function qE(n,e,t=!0){return await Mo(nt,t?js:Vr),lg(nt,n,e)}async function jE(n,e,t=!0){return await Mo(nt,t?js:Vr),cg(nt,n,e)}async function HE(n){return ag(nt,n)}async function zE(){return mg(nt)}async function Rr(n){const e=me(_e,"users",n),t=await Ea(e);return t.exists()?t.data():null}async function WE(n,e){const t=me(_e,"users",n),r={uid:n,email:e?.email??null,role:e?.role??"user",weekStartsOn:"monday",displayName:e?.displayName??"",dob:e?.dob??null,timeZone:e?.timeZone??e?.preferences?.timeZone??"Asia/Kolkata",preferences:{...e?.preferences||{}},createdAt:Z(),updatedAt:Z()};return await Ta(t,r,{merge:!0}),r}async function GE(n,e,t){const r={};let s=!1;t?.uid||(r.uid=n,s=!0),t?.role||(r.role="user",s=!0),t?.weekStartsOn||(r.weekStartsOn="monday",s=!0),!t?.email&&e&&(r.email=e,s=!0);const i=t?.preferences?.timeZone;if(!t?.timeZone&&i&&(r.timeZone=i,s=!0),!t?.timeZone&&!i&&(r.timeZone="Asia/Kolkata",s=!0),!s)return!1;const a=me(_e,"users",n);return await Ta(a,{...r,updatedAt:Z()},{merge:!0}),!0}async function Fd(n){const e=Mn(_e,"users",n,"tracks"),t=ui(e,Nd("isActive","==",!0),di("sortOrder","asc"));return(await fi(t)).docs.map(s=>({...s.data(),id:s.id}))}async function KE(n,e){const t=Mn(_e,"users",n,"tracks"),r=me(t),s={...e,isActive:e?.isActive??!0,sortOrder:e?.sortOrder??Date.now(),createdAt:Z(),updatedAt:Z()};return await Ta(r,s),r.id}async function QE(n,e,t){const r=me(_e,"users",n,"tracks",e);await pi(r,{...t,updatedAt:Z()})}async function YE(n,e){const t=me(_e,"users",n,"tracks",e);await Md(t)}async function Bd(n,e){const t=me(_e,"users",n,"days",e),r=await Ea(t);return r.exists()?r.data():null}async function XE(n,e){const t=Mn(_e,"users",n,"days"),r=ui(t,di("dayKey","desc"),Dd(e));return(await fi(r)).docs.map(i=>i.data())}async function Jl(n,e,t,r=50){const s=Mn(_e,"users",n,"days",e,"entries"),i=ui(s,Nd("trackId","==",t),di("createdAtMs","desc"),Dd(r));return(await fi(i)).docs.map(l=>({id:l.id,...l.data()}))}const Zi={themeMode:"system",accent1:"#7c3aed",accent2:"#14b8a6"};function $d(n){const e=n||{};return{themeMode:e.themeMode||Zi.themeMode,accent1:e.accent1||Zi.accent1,accent2:e.accent2||Zi.accent2}}function qd(n){const e=$d(n?.preferences);document.documentElement.dataset.theme=e.themeMode,document.documentElement.style.setProperty("--accent-1",e.accent1),document.documentElement.style.setProperty("--accent-2",e.accent2)}function Sr(){const n=window.location.hash||"#/auth",[e,t]=n.split("?"),r=new URLSearchParams(t||"");return{path:e,query:r,raw:n}}function ne(n){window.location.hash=n}function JE(n){window.addEventListener("hashchange",n)}function jd(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h1>Ethos</h1>
      <p class="muted">A calm place to stay aligned.</p>

      <label class="check">
        <input id="persist" type="checkbox" checked />
        <span>Keep me signed in</span>
      </label>

      <div class="stack">
        <button id="googleBtn" class="btn primary">Continue with Google</button>
        <button id="emailBtn" class="btn">Continue with Email</button>
      </div>
    </div>
  `;const e=n.querySelector("#persist"),t=localStorage.getItem("ethos_keepSignedIn");t!==null&&(e.checked=t==="true"),e.addEventListener("change",()=>{localStorage.setItem("ethos_keepSignedIn",String(e.checked))}),n.querySelector("#emailBtn").addEventListener("click",()=>{ne("#/auth/email")}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await Ud(e.checked)}catch(r){alert(r?.message||"Google sign-in failed")}})}function ZE(){const n=document.getElementById("app");n.innerHTML=`
    <div class="center">
      <h2>Continue with Email</h2>
      <p class="muted">Enter your email to continue.</p>

      <div class="stack">
        <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" />
        <button id="next" class="btn primary">Next </button>
        <a class="link" href="#/auth"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
      <div id="googleHint" class="stack" style="margin-top:12px; display:none;">
        <button id="googleBtn" class="btn">Continue with Google instead</button>
      </div>
    </div>
  `;const e=n.querySelector("#email"),t=n.querySelector("#msg"),r=n.querySelector("#googleHint");function s(a){t.textContent=a||""}async function i(){const a=String(e.value||"").trim().toLowerCase();if(s(""),r.style.display="none",!a){s("Please enter an email.");return}try{const l=await $E(a);if(!l||l.length===0){ne(`#/auth/create-password?email=${encodeURIComponent(a)}`);return}const u=l.includes("google.com"),d=l.includes("password");if(u&&!d){s("This email is linked to Google sign-in."),r.style.display="block";return}if(d){ne(`#/auth/password?email=${encodeURIComponent(a)}`);return}s("This email uses a different sign-in method. Try Google sign-in."),r.style.display="block"}catch(l){s(l?.message||"Could not check sign-in method.")}}n.querySelector("#next").addEventListener("click",i),e.addEventListener("keydown",a=>{a.key==="Enter"&&i()}),n.querySelector("#googleBtn").addEventListener("click",async()=>{try{await Ud()}catch(a){s(a?.message||"Google sign-in failed")}})}function eT(){const n=document.getElementById("app"),{query:e}=Sr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Welcome back</h2>
      <p class="muted">${t?`Signing in as ${t}`:"Enter your password to continue."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
        
        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="login" class="btn primary">Sign in</button>

        <button id="forgot" class="btn ghost">Forgot password?</button>
        <a class="link" href="#/auth/email"> Use a different email</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#persist");function u(f){i.textContent=f||""}t||u("Missing email. Go back and enter your email again.");async function d(){if(localStorage.setItem("ethos_keepSignedIn",String(l.checked)),u(""),!t)return;const f=String(a.value||"");if(!f){u("Please enter your password.");return}try{await qE(t,f,l.checked)}catch(m){u(m?.message||"Sign-in failed.")}}n.querySelector("#login").addEventListener("click",d),a.addEventListener("keydown",f=>{f.key==="Enter"&&d()}),n.querySelector("#forgot").addEventListener("click",async()=>{if(u(""),!!t)try{await HE(t),u("Password reset email sent.")}catch(f){u(f?.message||"Could not send reset email.")}})}function tT(){const n=document.getElementById("app"),{query:e}=Sr(),t=String(e.get("email")||"").trim().toLowerCase(),r=localStorage.getItem("ethos_keepSignedIn"),s=r===null?!0:r==="true";n.innerHTML=`
    <div class="center">
      <h2>Create your account</h2>
      <p class="muted">${t?`For ${t}`:"Missing email. Go back and enter your email again."}</p>

      <div class="stack">
        <input id="password" class="input" type="password" placeholder="Create password" autocomplete="new-password" />
        <input id="confirm" class="input" type="password" placeholder="Confirm password" autocomplete="new-password" />

        <label class="check">
          <input id="persist" type="checkbox" ${s?"checked":""} />
          <span>Keep me signed in</span>
        </label>

        <button id="create" class="btn primary">Create account</button>
        <a class="link" href="#/auth/email"> Back</a>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const i=n.querySelector("#msg"),a=n.querySelector("#password"),l=n.querySelector("#confirm"),u=n.querySelector("#persist");function d(m){i.textContent=m||""}async function f(){if(localStorage.setItem("ethos_keepSignedIn",String(u.checked)),d(""),!t)return;const m=String(a.value||""),v=String(l.value||"");if(!m||m.length<6){d("Password should be at least 6 characters.");return}if(m!==v){d("Passwords do not match.");return}try{await jE(t,m,u.checked)}catch(R){const V=R?.code||"";if(V==="auth/email-already-in-use"||V==="auth/account-exists-with-different-credential"){d("This email is already linked to a different sign-in method. Try Google sign-in."),navigate("#/auth/email");return}d(R?.message||"Account creation failed.")}}n.querySelector("#create").addEventListener("click",f),l.addEventListener("keydown",m=>{m.key==="Enter"&&f()})}function nT(){if(typeof Intl<"u"&&typeof Intl.supportedValuesOf=="function")try{return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney","Asia/Singapore","Asia/Tokyo"]}function Hd({user:n}){const e=document.getElementById("app"),t=nT(),r=Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Kolkata";e.innerHTML=`
    <div class="center">
      <h2>Set up your profile</h2>
      <p class="muted">This helps Ethos keep your days aligned to your timezone.</p>

      <div class="stack">
        <label class="label">Display name</label>
        <input id="name" class="input" type="text" placeholder="What should we call you?" />

        <label class="label">Date of birth</label>
        <input id="dob" class="input" type="date" />

        <label class="label">Timezone</label>
        <select id="tz" class="input">
          ${t.map(d=>`<option value="${d}" ${d===r?"selected":""}>${d}</option>`).join("")}
        </select>

        <button id="save" class="btn primary">Save</button>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </div>
  `;const s=e.querySelector("#msg"),i=e.querySelector("#name"),a=e.querySelector("#dob"),l=e.querySelector("#tz");function u(d){s.textContent=d||""}e.querySelector("#save").addEventListener("click",async()=>{u("");const d=String(i.value||"").trim(),f=String(a.value||"").trim(),m=String(l.value||"").trim();if(!m){u("Please select a timezone.");return}try{await WE(n.uid,{email:n.email||"",displayName:d||"",dob:f||"",timeZone:m,weekStartsOn:"monday",role:"user"}),ne("#/home")}catch(v){u(v?.message||"Could not save profile.")}})}function rT(n){return{trophy:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 21h8M12 17v4M7 4h10v3a5 5 0 0 1-10 0V4Z"/><path d="M17 7h3a4 4 0 0 1-4 4M7 7H4a4 4 0 0 0 4 4"/></svg>',check:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20 6 9 17l-5-5"/></svg>',home:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V10.5Z"/></svg>',history:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 4v6h6"/><path d="M12 7v6l4 2"/></svg>',gear:'<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.5-2.3.7a8 8 0 0 0-5-2.9L12 0h-4l-.9 2.1a8 8 0 0 0-5 2.9l-2.3-.7-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 6l-2 1.2 2 3.5 2.3-.7a8 8 0 0 0 5 2.9L8 24h4l.9-2.1a8 8 0 0 0 5-2.9l2.3.7 2-3.5-2-1.2Z"/></svg>'}[n]||""}function sT({active:n}){return`
      <nav class="tabs">
        ${[{id:"leaderboard",label:"Leaderboard",href:"#/leaderboard",icon:"trophy"},{id:"today",label:"Today",href:"#/today",icon:"check"},{id:"home",label:"Home",href:"#/home",icon:"home",center:!0},{id:"history",label:"History",href:"#/history",icon:"history"},{id:"settings",label:"Settings",href:"#/settings",icon:"gear"}].map(t=>`
          <a class="tab ${t.center?"tab-center":""} ${n===t.id?"active":""}" href="${t.href}" aria-label="${t.label}">
            <span class="tab-ico">${rT(t.icon)}</span>
            <span class="tab-txt">${t.label}</span>
          </a>
        `).join("")}
      </nav>
    `}function ye({title:n,activeTab:e,content:t}){return`
    <div class="app">
      <header class="header">
        <div class="header-title">${n||"Ethos"}</div>
      </header>

      <main class="content">
        ${t||""}
      </main>

      ${sT({active:e})}
    </div>
  `}function vs(){const n=document.getElementById("app");n.innerHTML=ye({title:"Home",activeTab:"home",content:`
      <section class="card">
        <div class="card-title">How are you doing today?</div>
        <div class="muted">A gentle glance. No pressure.</div>
      </section>

      <section class="card">
        <div class="card-title">Pinned targets (stub)</div>
        <div class="muted">Example: 8,000 / 15,000 steps</div>
        <div class="muted">Example: 1.5L / 3L water</div>
        <div class="muted">Example: 3 / 6 sessions this week</div>
      </section>
    `})}function zd(n){return iT(new Date,n)}function iT(n,e){const t=oT(n,e);return`${t.year}-${Bs(t.month)}-${Bs(t.day)}`}function Wd(n){const[e,t,r]=n.split("-").map(Number),s=new Date(Date.UTC(e,t-1,r)),i=aT(s),a=`${e}-${Bs(t)}`;return{weekKey:i,monthKey:a}}function oT(n,e){const r=new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(n).reduce((s,i)=>(i.type!=="literal"&&(s[i.type]=i.value),s),{});return{year:Number(r.year),month:Number(r.month),day:Number(r.day)}}function aT(n){const e=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=Math.ceil(((e-r)/864e5+1)/7);return`${e.getUTCFullYear()}-W${Bs(s)}`}function Bs(n){return String(n).padStart(2,"0")}function Zl(n){return!n||!n.length?"":`
      <div class="bullets">
        ${n.map(e=>`<div class="bullet">${e}</div>`).join("")}
      </div>
    `}function cT(n,e){return n?.tracks?.[e]||null}function lT(n,e,t){n?.target?.mode;const r=Number(n?.target?.value||0),i=(n.cadence||"daily")==="daily"?e:t;if(!i)return r?`0 / ${r}`:"";if(n.type==="COUNTER_INCREMENT"){const l=Number(i.sum||0);return r?`${l} / ${r}`:`${l}`}if(n.type==="NUMBER_REPLACE"){const l=i.value;return l===0||l?`${l} ${n.unit||""}`.trim():""}const a=Number(i.count||0);return r?`${a} / ${r}`:`${a}`}function uT(n,e,t,r){const s={};for(const i of n)s[i.id]=null;for(const i of e){const a=i?.period?.weekKey,l=i?.period?.monthKey;for(const u of n){if(u.cadence==="weekly"&&a!==t||u.cadence==="monthly"&&l!==r||u.cadence==="daily")continue;const d=i?.tracks?.[u.id];d&&(s[u.id]||(s[u.id]={}),u.type==="COUNTER_INCREMENT"?(s[u.id].sum=Number(s[u.id].sum||0)+Number(d.sum||0),s[u.id].count=Number(s[u.id].count||0)+Number(d.count||0)):u.type==="NUMBER_REPLACE"?s[u.id].value===void 0&&(s[u.id].value=d.value):(s[u.id].count=Number(s[u.id].count||0)+Number(d.count||0),s[u.id].preview===void 0&&d.preview&&(s[u.id].preview=d.preview),s[u.id].lastValue===void 0&&d.lastValue&&(s[u.id].lastValue=d.lastValue),s[u.id].done===void 0&&d.done!==void 0&&(s[u.id].done=d.done)))}}return s}function hT(n,e,t,r){const s=n.cadence==="daily"?"Today":n.cadence==="weekly"?"This week":"This month",i=lT(n,e,t),a=Number(n?.target?.value||0),l=(()=>{if(!a)return!1;const f=n.cadence==="daily"?e:t;return f?n.type==="COUNTER_INCREMENT"?Number(f.sum||0)>=a:n.type==="NUMBER_REPLACE"?!1:Number(f.count||0)>=a:!1})();let u="",d="";if(n.type==="TEXT_APPEND"){const v=(r?.textEntriesByTrack?.[n.id]||[]).slice().reverse().map(R=>(R.text||"").trim()).filter(Boolean);d=v.length?`${v.length} entries`:"No notes yet",u=Zl(v.map(R=>R))}if(n.type==="DROPDOWN_EVENT"){const f=r?.periodEventsByTrack?.[n.id]||[];d=f.length?`Events: ${f.length}`:"No selection yet",u=Zl(f)}return n.type==="BOOLEAN"&&n.config?.booleanMode==="done_only"&&(d=e?.done?"Done":"Not yet",u=""),d||(n.type==="NUMBER_REPLACE"?d=e?.value===0||e?.value?`${e.value} ${n.unit||""}`.trim():"":(d=l?"Done":"Not yet",a||(d=""),n.type==="COUNTER_INCREMENT"&&(d=""))),`
      <div class="card">
        <div class="row" style="justify-content:space-between;gap:12px;align-items:flex-start;">
          <div style="min-width:0;">
            <div class="card-title">${n.name}</div>
            <div class="mini muted">${s}${a?`  Target ${a}`:""}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:700;">${i}</div>
            ${d?`<div class="mini muted">${d}</div>`:""}
          </div>
        </div>
  
        ${u?`<div style="margin-top:10px;">${u}</div>`:""}
      </div>
    `}async function dT({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ye({title:"Today",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});try{const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=zd(r),{weekKey:i,monthKey:a}=Wd(s),l=await Fd(n.uid),u=await Bd(n.uid,s),d=await XE(n.uid,31),f=uT(l,d,i,a),m={};for(const N of l)N.type==="TEXT_APPEND"&&(m[N.id]=await Jl(n.uid,s,N.id,20));const v={};for(const N of l){if(N.type!=="DROPDOWN_EVENT"||N.cadence==="daily")continue;const k=[];for(const C of d){if(N.cadence==="weekly"&&C?.period?.weekKey!==i||N.cadence==="monthly"&&C?.period?.monthKey!==a)continue;const x=C?.tracks?.[N.id],O=Number(x?.count||0);if(!O)continue;(await Jl(n.uid,C.dayKey,N.id,Math.min(30,O))).slice().reverse().forEach(U=>{const Y=U?.optionIds?.[0];Y&&k.push(`${C.dayKey}: ${Y}`)})}v[N.id]=k}const R={textEntriesByTrack:m,periodEventsByTrack:v},V=l.length?l.map(N=>hT(N,cT(u,N.id),f[N.id],R)).join(""):'<div class="card"><div class="muted">No active tracks yet. Add some in Settings  Manage Tracks.</div></div>';t.innerHTML=ye({title:"Today",activeTab:"today",content:`
          <div class="content">
            <div class="mini muted" style="margin:6px 0 14px;">${s}  ${r}</div>
            ${V}
          </div>
  
          <button class="fab" id="goLog" title="Log for today"></button>
        `}),t.querySelector("#goLog").addEventListener("click",()=>{ne("#/today/log")})}catch(r){console.error("Today page load failed:",r),t.innerHTML=ye({title:"Today",activeTab:"today",content:`
          <div class="center">
            <h2 style="margin:0 0 10px;">Couldnt load Today</h2>
            <p class="muted" style="white-space:pre-wrap;">${r?.message||String(r)}</p>
            <button class="btn" onclick="location.reload()">Reload</button>
          </div>
        `})}}function Fe(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}async function fT({user:n,profile:e}){const t=document.getElementById("app");t.innerHTML=ye({title:"Log",activeTab:"today",content:'<div class="center"><p class="muted">Loading</p></div>'});const r=e?.timeZone||e?.preferences?.timeZone||"Asia/Kolkata",s=zd(r),{weekKey:i,monthKey:a}=Wd(s);try{const l=await Fd(n.uid),u=await Bd(n.uid,s),d=l.map(f=>{const m=u?.tracks?.[f.id]||null;if(f.type==="NUMBER_REPLACE"){const v=m?.value===0||m?.value?m.value:"";return`
          <div class="card">
            <div class="card-title">${Fe(f.name)}</div>
            <div class="mini muted">Current: ${v===""?"":Fe(v)} ${Fe(f.unit||"")}</div>
            <input class="input" type="number" step="${f.config?.precision?1/Math.pow(10,f.config.precision):"any"}"
              data-track="${f.id}" data-type="NUMBER_REPLACE" placeholder="Enter value" />
          </div>
        `}if(f.type==="TEXT_APPEND")return`
          <div class="card">
            <div class="card-title">${Fe(f.name)}</div>
            <div class="mini muted">${m?.count?`Entries today: ${m.count}`:"No entries yet"}</div>
            <textarea class="textarea" data-track="${f.id}" data-type="TEXT_APPEND" placeholder="Write a quick note..."></textarea>
          </div>
        `;if(f.type==="DROPDOWN_EVENT"){const v=(f.config?.options||[]).map(R=>`<option value="${Fe(R.id)}">${Fe(R.label)}</option>`).join("");return`
          <div class="card">
            <div class="card-title">${Fe(f.name)}</div>
            <div class="mini muted">${m?.count?`Count today: ${m.count}`:"No events yet"}</div>
            <select class="select" data-track="${f.id}" data-type="DROPDOWN_EVENT">
              <option value="">Select</option>
              ${v}
            </select>
          </div>
        `}if(f.type==="COUNTER_INCREMENT"){const v=f.config?.incrementStep||1,R=m?.sum||0;return`
          <div class="card">
            <div class="card-title">${Fe(f.name)}</div>
            <div class="mini muted">Today: ${Fe(R)} ${Fe(f.unit||"")}</div>
            <input class="input" type="number" min="0" step="${v}"
              data-track="${f.id}" data-type="COUNTER_INCREMENT"
              placeholder="Add amount (e.g. ${v})" />
          </div>
        `}if(f.type==="BOOLEAN"){if((f.config?.booleanMode||"done_only")==="done_only"){const R=m?.done?"checked":"";return`
            <div class="card">
              <div class="card-title">${Fe(f.name)}</div>
              <label class="toggle">
                <input type="checkbox" data-track="${f.id}" data-type="BOOLEAN_DONE" ${R}/>
                Done today
              </label>
            </div>
          `}return`
          <div class="card">
            <div class="card-title">${Fe(f.name)}</div>
            <div class="mini muted">Today count: ${m?.count||0}</div>
            <input class="input" type="number" min="0" step="1"
              data-track="${f.id}" data-type="BOOLEAN_COUNT"
              placeholder="Add count (e.g. 1)" />
          </div>
        `}return""}).join("");t.innerHTML=ye({title:"Log",activeTab:"today",content:`
        <div class="content">
          <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px;">
            <div>
              <div class="mini muted">${s}  ${r}</div>
              <div style="font-weight:700;font-size:18px;">Log entries</div>
            </div>
            <button class="btn" id="back" type="button">Back</button>
          </div>

          ${d}

          <div class="row" style="justify-content:flex-end;gap:10px;margin-top:10px;">
            <button class="btn primary" id="submit" type="button">Submit</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;margin-top:8px;"></div>
        </div>
      `}),t.querySelector("#back").addEventListener("click",()=>ne("#/today")),t.querySelector("#submit").addEventListener("click",async()=>{const f=t.querySelector("#status");f.textContent="Saving";const m=UE(_e),v=me(_e,"users",n.uid,"days",s);m.set(v,{dayKey:s,timeZone:r,period:{weekKey:i,monthKey:a},updatedAt:Z()},{merge:!0});const R=Mn(_e,"users",n.uid,"days",s,"entries"),V=Array.from(t.querySelectorAll("[data-track][data-type]"));let N=0;for(const k of V){const C=k.dataset.track,x=k.dataset.type;if(x==="TEXT_APPEND"){const O=k.value.trim();if(!O)continue;const q=me(R);m.set(q,{trackId:C,type:"TEXT_APPEND",text:O,createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"TEXT_APPEND",count:Zn(1),preview:O.slice(0,80),lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}if(x==="NUMBER_REPLACE"){const O=k.value.trim();if(O==="")continue;const q=Number(O);if(Number.isNaN(q))continue;const U=me(R);m.set(U,{trackId:C,type:"NUMBER_REPLACE",value:q,createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"NUMBER_REPLACE",value:q,lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}if(x==="COUNTER_INCREMENT"){const O=k.value.trim();if(O==="")continue;const q=Number(O);if(!q||Number.isNaN(q))continue;const U=me(R);m.set(U,{trackId:C,type:"COUNTER_INCREMENT",deltaValue:q,createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"COUNTER_INCREMENT",count:Zn(1),sum:Zn(q),lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}if(x==="DROPDOWN_EVENT"){const O=k.value;if(!O)continue;const q=me(R);m.set(q,{trackId:C,type:"DROPDOWN_EVENT",optionIds:[O],createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"DROPDOWN_EVENT",count:Zn(1),lastValue:[O],lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}if(x==="BOOLEAN_DONE"){const O=!!k.checked,q=me(R);m.set(q,{trackId:C,type:"BOOLEAN",value:O,createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"BOOLEAN",done:O,count:O?1:0,lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}if(x==="BOOLEAN_COUNT"){const O=k.value.trim();if(O==="")continue;const q=Number(O);if(!q||Number.isNaN(q))continue;const U=me(R);m.set(U,{trackId:C,type:"BOOLEAN",deltaCount:q,createdAt:Z(),createdAtMs:Date.now()}),m.set(v,{tracks:{[C]:{type:"BOOLEAN",count:Zn(q),done:!0,lastAt:Z()}},updatedAt:Z()},{merge:!0}),N++;continue}}if(!N){f.textContent="Nothing to save.",setTimeout(()=>f.textContent="",1200);return}try{await m.commit(),f.textContent="Saved.",ne("#/today")}catch(k){console.error("Log submit failed:",k),f.textContent=`Save failed: ${k?.message||k}`,alert(`Save failed:
${k?.message||k}`)}})}catch(l){console.error("Today log page load failed:",l),t.innerHTML=ye({title:"Log",activeTab:"today",content:`
        <div class="center">
          <h2 style="margin:0 0 10px;">Couldnt load Log</h2>
          <p class="muted" style="white-space:pre-wrap;">${l?.message||String(l)}</p>
          <button class="btn" onclick="location.reload()">Reload</button>
        </div>
      `})}}function pT(){const n=document.getElementById("app");n.innerHTML=ye({title:"History",activeTab:"history",content:`
      <section class="card">
        <div class="card-title">Reflection (stub)</div>
        <div class="muted">Calendar/list view comes next.</div>
      </section>
    `})}function mT(){const n=document.getElementById("app");n.innerHTML=ye({title:"Settings",activeTab:"settings",content:`
      <section class="card">
        <div class="card-title">Settings</div>

        <div class="list">
          <button class="list-item" id="goProfile" type="button">
            <div>
              <div class="li-title">Profile</div>
              <div class="muted">Name, DOB, timezone</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTheme" type="button">
            <div>
              <div class="li-title">Theme</div>
              <div class="muted">Mode + accent colors</div>
            </div>
            <div class="chev"></div>
          </button>

          <button class="list-item" id="goTracks" type="button">
            <div>
              <div class="li-title">Manage Tracks</div>
              <div class="muted">Add, edit, reorder, activate/deactivate</div>
            </div>
            <div class="chev"></div>
          </button>
        </div>
      </section>

      <section class="card">
        <div class="card-title">Account</div>
        <button id="logout" class="btn" type="button">Logout</button>
      </section>
    `}),n.querySelector("#goProfile").addEventListener("click",()=>ne("#/settings/profile")),n.querySelector("#goTheme").addEventListener("click",()=>ne("#/settings/theme")),n.querySelector("#goTracks").addEventListener("click",()=>ne("#/settings/tracks")),n.querySelector("#logout").addEventListener("click",async()=>{await zE(),ne("#/auth")})}function gT(){const n=document.getElementById("app");n.innerHTML=ye({title:"Leaderboard",activeTab:"leaderboard",content:`
      <section class="card">
        <div class="card-title">Leaderboard (stub)</div>
        <div class="muted">Well wire this after data model is locked.</div>
      </section>
    `})}function _T(){try{if(typeof Intl.supportedValuesOf=="function")return Intl.supportedValuesOf("timeZone")}catch{}return["Asia/Kolkata","Asia/Dubai","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney"]}async function yT({user:n}){const e=document.getElementById("app");e.innerHTML=ye({title:"Profile",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Rr(n.uid),r=_T();e.innerHTML=ye({title:"Profile",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Profile</div>
            <div class="muted">Personal details for your Ethos space</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Display name</div>
            <input class="input" id="displayName" value="${t?.displayName||""}" placeholder="Your name" />
          </label>

          <label class="field">
            <div class="label">DOB (optional)</div>
            <input class="input" id="dob" type="date" value="${t?.dob||""}" />
          </label>

          <label class="field">
            <div class="label">Time zone</div>
            <input class="input" id="timeZone" list="tzList" value="${t?.timeZone||"Asia/Kolkata"}" />
            <datalist id="tzList">
              ${r.slice(0,500).map(s=>`<option value="${s}"></option>`).join("")}
            </datalist>
            <div class="mini muted">Tip: start typing Asia/ and pick from suggestions.</div>
          </label>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>ne("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#displayName").value.trim(),a=e.querySelector("#dob").value||null,l=e.querySelector("#timeZone").value.trim()||"Asia/Kolkata";try{const u=me(_e,"users",n.uid);await pi(u,{displayName:i,dob:a,timeZone:l,updatedAt:Z()}),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Profile save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Profile save failed:
${u?.message||u}`)}})}async function vT(n){const e=Mn(_e,"users",n,"tracks"),t=ui(e,di("sortOrder","asc"));return(await fi(t)).docs.map(s=>({...s.data(),id:s.id}))}async function eu(n,e,t){const r=me(_e,"users",n,"tracks",e);await pi(r,{...t,updatedAt:Z()})}async function ET(n,e){const t=me(_e,"users",n,"tracks",e);await Md(t)}async function TT({user:n}){const e=document.getElementById("app");e.innerHTML=ye({title:"Manage Tracks",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let t=[],r=[],s=[];await i(),u(),d();async function i(){t=await vT(n.uid),r=a(t.filter(C=>C.isActive!==!1)),s=a(t.filter(C=>C.isActive===!1))}function a(C){return C.slice().sort((x,O)=>(Number(x.sortOrder)||0)-(Number(O.sortOrder)||0))}function l(C){const x=C.cadence||"",O=C.unit?`  ${C.unit}`:"";return`${x}${O}`.trim()}function u(){e.innerHTML=ye({title:"Manage Tracks",activeTab:"settings",content:`
        <section class="card">
          <div class="card-title">Active</div>
          <div class="muted">Hold the handle, then drag to reorder.</div>
          ${r.length?`<div class="list" id="activeList">${r.map(f).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No active tracks yet.</div>'}
        </section>

        <section class="card">
          <div class="card-title">Inactive</div>
          <div class="muted">Hidden from Today. Re-enable anytime.</div>
          ${s.length?`<div class="list" id="inactiveList">${s.map(m).join("")}</div>`:'<div class="muted" style="margin-top:10px;">No inactive tracks.</div>'}
        </section>

        <!-- FAB + menu -->
        <button class="fab" id="fabTracks" title="Add track">
          <span class="fab-plus">+</span>
        </button>

        <div class="fab-menu hidden" id="fabMenu">
          <button class="fab-item" id="fabCustom">
            <span class="fab-ico"></span>
            <span>Create custom</span>
          </button>
          <button class="fab-item" id="fabTemplates">
            <span class="fab-ico"></span>
            <span>Templates</span>
          </button>
        </div>

        <div class="fab-backdrop hidden" id="fabBackdrop"></div>
      `})}function d(){e.querySelectorAll("[data-edit]").forEach(C=>{C.addEventListener("click",()=>{const x=C.getAttribute("data-edit");ne(`#/settings/tracks/edit?trackId=${encodeURIComponent(x)}`)})}),e.querySelectorAll("[data-toggle]").forEach(C=>{C.addEventListener("click",async()=>{const x=C.getAttribute("data-toggle"),O=C.getAttribute("data-next")==="true";C.disabled=!0;try{await eu(n.uid,x,{isActive:O}),await i(),u(),d()}catch(q){console.error("Toggle failed:",q),alert(q?.message||"Could not update track."),C.disabled=!1}})}),e.querySelectorAll("[data-del]").forEach(C=>{C.addEventListener("click",async()=>{const x=C.getAttribute("data-del"),O=s.find(U=>U.id===x);if(!(!O||!confirm(`Delete "${O.name}"? This cannot be undone.`))){s=s.filter(U=>U.id!==x),u(),d();try{await ET(n.uid,x),await i(),u(),d()}catch(U){console.error("Delete failed:",U),alert(U?.message||"Could not delete track."),await i(),u(),d()}}})}),R(),v()}function f(C){return`
      <div class="track-row" data-id="${C.id}">
        <div class="drag-handle" data-handle="1" title="Hold & drag"></div>

        <div class="track-main">
          <div class="track-title">${k(C.name)}</div>
          <div class="track-meta muted">${k(l(C))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${C.id}" title="Edit">
            ${V()}
          </button>

          <!-- Toggle switch: ON -->
          <button class="switch on" data-toggle="${C.id}" data-next="false" title="Disable"></button>
        </div>
      </div>
    `}function m(C){return`
      <div class="track-row track-row-inactive" data-id="${C.id}">
        <div class="drag-handle drag-handle-disabled" title="Inactive"></div>

        <div class="track-main">
          <div class="track-title">${k(C.name)}</div>
          <div class="track-meta muted">${k(l(C))}</div>
        </div>

        <div class="track-actions">
          <button class="icon-btn" data-edit="${C.id}" title="Edit">
            ${V()}
          </button>

          <button class="icon-btn danger" data-del="${C.id}" title="Delete">
            ${N()}
          </button>

          <!-- Toggle switch: OFF -->
          <button class="switch" data-toggle="${C.id}" data-next="true" title="Enable"></button>
        </div>
      </div>
    `}function v(){const C=e.querySelector("#fabTracks"),x=e.querySelector("#fabMenu"),O=e.querySelector("#fabBackdrop");if(!C||!x||!O)return;const q=()=>{x.classList.remove("hidden"),O.classList.remove("hidden"),C.classList.add("fab-open")},U=()=>{x.classList.add("hidden"),O.classList.add("hidden"),C.classList.remove("fab-open")};C.addEventListener("click",()=>{!x.classList.contains("hidden")?U():q()}),O.addEventListener("click",U);const Y=e.querySelector("#fabCustom"),T=e.querySelector("#fabTemplates");Y?.addEventListener("click",()=>{U(),ne("#/settings/tracks/new")}),T?.addEventListener("click",()=>{U(),ne("#/settings/tracks/templates")})}function R(){const C=e.querySelector("#activeList");if(!C)return;let x=!1,O=!1,q=null,U=null,Y=null,T=0,g=0;const y=X=>{O&&X.preventDefault()};C.querySelectorAll(".drag-handle").forEach(X=>{X.addEventListener("pointerdown",Te=>{if(x=!0,O=!1,U=X.closest(".track-row"),!U)return;X.setPointerCapture?.(Te.pointerId),T=Te.clientY;const De=U.getBoundingClientRect();g=T-De.top,q=setTimeout(()=>{x&&I()},180)}),X.addEventListener("pointermove",Te=>{x&&O&&(Te.preventDefault(),E(Te.clientY))}),X.addEventListener("pointerup",async()=>{x=!1,clearTimeout(q),O&&(A(),await _()),O=!1,U=null}),X.addEventListener("pointercancel",()=>{x=!1,clearTimeout(q),O&&A(),O=!1,U=null})});function I(){O=!0,Y=document.createElement("div"),Y.className="drag-placeholder",Y.style.height=`${U.getBoundingClientRect().height}px`,U.parentNode.insertBefore(Y,U);const X=U.getBoundingClientRect();U.classList.add("dragging"),U.style.width=`${X.width}px`,U.style.position="fixed",U.style.left=`${X.left}px`,U.style.zIndex="9999",document.addEventListener("touchmove",y,{passive:!1}),E(T)}function E(X){const Te=X-g;U.style.top=`${Te}px`;const De=[...C.querySelectorAll(".track-row:not(.dragging)")],qt=X;let gt=null;for(const jt of De){const jr=jt.getBoundingClientRect();if(qt<jr.top+jr.height/2){gt=jt;break}}gt?C.insertBefore(Y,gt):C.appendChild(Y)}function A(){U.classList.remove("dragging"),U.style.position="",U.style.top="",U.style.left="",U.style.width="",U.style.zIndex="",C.insertBefore(U,Y),Y.remove(),Y=null,document.removeEventListener("touchmove",y)}async function _(){r=[...C.querySelectorAll(".track-row")].map(De=>De.getAttribute("data-id")).filter(Boolean).map(De=>r.find(qt=>qt.id===De)).filter(Boolean);const Te=Date.now();try{await Promise.all(r.map((De,qt)=>eu(n.uid,De.id,{sortOrder:Te+qt*10}))),await i(),u(),d()}catch(De){console.error(De),alert(De?.message||"Could not save order.")}}}function V(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 20h9"></path>
        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
      </svg>
    `}function N(){return`
      <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18"></path>
        <path d="M8 6V4h8v2"></path>
        <path d="M19 6l-1 14H6L5 6"></path>
        <path d="M10 11v6"></path>
        <path d="M14 11v6"></path>
      </svg>
    `}function k(C){return String(C||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}}function IT(n){const{path:e}=Sr(),t=e.indexOf("?");return t===-1?null:new URLSearchParams(e.slice(t+1)).get(n)}async function tu({user:n,mode:e}){const t=document.getElementById("app"),r=IT("trackId");if(e==="edit"&&!r){ne("#/settings/tracks");return}t.innerHTML=ye({title:"Track",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});let s=null;if(e==="edit"){const i=me(_e,"users",n.uid,"tracks",r),a=await Ea(i);if(!a.exists()){ne("#/settings/tracks");return}s={id:a.id,...a.data()}}else s={name:"",type:"COUNTER_INCREMENT",cadence:"daily",unit:"",isActive:!0,sortOrder:Date.now(),target:{mode:"value",value:0},config:{incrementStep:1}};t.innerHTML=ye({title:e==="edit"?"Edit Track":"New Track",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">${e==="edit"?"Edit track":"Create a track"}</div>
            <div class="muted">Keep it simple. You can refine later.</div>
          </div>
          <button class="btn" id="back">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Name</div>
            <input class="input" id="name" value="${s.name||""}" placeholder="Water / Steps / Journal" />
          </label>

          <div class="row" style="gap:12px;flex-wrap:wrap;">
            <label class="field" style="min-width:220px;">
              <div class="label">Type</div>
              <select class="select" id="type">
                ${["COUNTER_INCREMENT","BOOLEAN","NUMBER_REPLACE","TEXT_APPEND","DROPDOWN_EVENT"].map(i=>`<option value="${i}" ${s.type===i?"selected":""}>${i}</option>`).join("")}
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Cadence</div>
              <select class="select" id="cadence">
                ${["daily","weekly","monthly"].map(i=>`<option value="${i}" ${s.cadence===i?"selected":""}>${i}</option>`).join("")}
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Unit</div>
              <input class="input" id="unit" value="${s.unit||""}" placeholder="ml / steps / kg / times" />
            </label>
          </div>

          <div class="row" style="gap:12px;flex-wrap:wrap;">
            <label class="field" style="min-width:220px;">
              <div class="label">Target mode</div>
              <select class="select" id="targetMode">
                <option value="value" ${s.target?.mode==="value"?"selected":""}>value</option>
                <option value="count" ${s.target?.mode==="count"?"selected":""}>count</option>
              </select>
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Target value</div>
              <input class="input" id="targetValue" type="number" value="${Number(s.target?.value||0)}" />
            </label>

            <label class="field" style="min-width:220px;">
              <div class="label">Active</div>
              <select class="select" id="isActive">
                <option value="true" ${s.isActive?"selected":""}>true</option>
                <option value="false" ${s.isActive?"":"selected"}>false</option>
              </select>
            </label>
          </div>

          <section class="card" style="margin:12px 0;">
            <div class="card-title">Type config (MVP)</div>
            <div class="muted">Well make this dynamic per type in the next pass.</div>

            <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px;">
              <label class="field" style="min-width:220px;">
                <div class="label">incrementStep (COUNTER_INCREMENT)</div>
                <input class="input" id="incrementStep" type="number"
                  value="${Number(s.config?.incrementStep||1)}" />
              </label>

              <label class="field" style="min-width:220px;">
                <div class="label">booleanMode (BOOLEAN)</div>
                <select class="select" id="booleanMode">
                  <option value="done_only" ${(s.config?.booleanMode||"done_only")==="done_only"?"selected":""}>done_only</option>
                  <option value="count" ${(s.config?.booleanMode||"")==="count"?"selected":""}>count</option>
                </select>
              </label>

              <label class="field" style="min-width:220px;">
                <div class="label">precision (NUMBER_REPLACE)</div>
                <input class="input" id="precision" type="number" step="0.1"
                  value="${Number(s.config?.precision??1)}" />
              </label>
            </div>
          </section>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            ${e==="edit"?'<button class="btn danger" id="del">Delete</button>':""}
            <button class="btn primary" id="save">Save</button>
          </div>
        </div>
      </section>
    `}),t.querySelector("#back").addEventListener("click",()=>ne("#/settings/tracks")),t.querySelector("#save").addEventListener("click",async()=>{const i=t.querySelector("#name").value.trim();if(!i)return alert("Name is required.");const a=t.querySelector("#type").value,l=t.querySelector("#cadence").value,u=t.querySelector("#unit").value.trim(),d=t.querySelector("#targetMode").value,f=Number(t.querySelector("#targetValue").value||0),m=t.querySelector("#isActive").value==="true",v=Number(t.querySelector("#incrementStep").value||1),R=t.querySelector("#booleanMode").value,V=Number(t.querySelector("#precision").value||1),N={name:i,type:a,cadence:l,unit:u,isActive:m,target:{mode:d,value:f},config:{...s.config||{},incrementStep:v,booleanMode:R,precision:V}};e==="edit"?await QE(n.uid,r,N):await KE(n.uid,N),alert("Saved."),ne("#/settings/tracks")}),t.querySelector("#del")?.addEventListener("click",async()=>{confirm("Delete this track? This wont delete past entries.")&&(await YE(n.uid,r),ne("#/settings/tracks"))})}async function wT({user:n}){const e=document.getElementById("app");e.innerHTML=ye({title:"Theme",activeTab:"settings",content:'<div class="center"><p class="muted">Loading</p></div>'});const t=await Rr(n.uid),r=$d(t?.preferences);e.innerHTML=ye({title:"Theme",activeTab:"settings",content:`
      <section class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div>
            <div class="card-title">Theme</div>
            <div class="muted">Set the vibe. Keep it calm.</div>
          </div>
          <button class="btn" id="back" type="button">Back</button>
        </div>

        <div class="form" style="margin-top:12px;">
          <label class="field">
            <div class="label">Mode</div>
            <select class="select" id="themeMode">
              <option value="system" ${r.themeMode==="system"?"selected":""}>System</option>
              <option value="light" ${r.themeMode==="light"?"selected":""}>Light</option>
              <option value="dark" ${r.themeMode==="dark"?"selected":""}>Dark</option>
            </select>
          </label>

          <div class="row" style="gap:14px;flex-wrap:wrap;align-items:center;">
            <label class="field" style="min-width:200px;">
              <div class="label">Accent 1</div>
              <input class="input" id="accent1" type="color" value="${r.accent1}" />
            </label>

            <label class="field" style="min-width:200px;">
              <div class="label">Accent 2</div>
              <input class="input" id="accent2" type="color" value="${r.accent2}" />
            </label>
          </div>

          <div class="row" style="justify-content:flex-end;gap:8px;">
            <button class="btn primary" id="save" type="button">Save</button>
          </div>

          <div class="mini muted" id="status" style="min-height:18px;"></div>
        </div>
      </section>
    `}),e.querySelector("#back").addEventListener("click",()=>ne("#/settings")),e.querySelector("#save").addEventListener("click",async()=>{const s=e.querySelector("#status");s.textContent="Saving";const i=e.querySelector("#themeMode").value,a=e.querySelector("#accent1").value,l=e.querySelector("#accent2").value;try{const u=me(_e,"users",n.uid);await pi(u,{preferences:{themeMode:i,accent1:a,accent2:l},updatedAt:Z()});const d=await Rr(n.uid);qd(d),s.textContent="Saved.",setTimeout(()=>s.textContent="",1200)}catch(u){console.error("Theme save failed:",u),s.textContent=`Save failed: ${u?.message||u}`,alert(`Theme save failed:
${u?.message||u}`)}})}function AT(){const n=document.getElementById("app");n.innerHTML=ye({title:"Templates",activeTab:"settings",content:`
      <div class="center">
        <div class="card" style="text-align:center;padding:22px;">
          <div style="font-size:42px; margin-bottom:10px;"></div>
          <div style="font-weight:700; font-size:18px;">Coming soon</div>
          <div class="muted" style="margin-top:6px;">
            Track templates will live here  one tap to add.
          </div>
        </div>
      </div>
    `})}let ie=null,Be=null,dr=null,Gd=!1,fr=null;function nu(n){return n.startsWith("#/auth")}function bT(n){return["#/profile-setup","#/home","#/today","#/today/log","#/history","#/settings","#/leaderboard","#/settings/profile","#/settings/theme","#/settings/tracks","#/settings/tracks/edit","#/settings/tracks/new","#/settings/tracks/templates"].includes(n.split("?")[0])}async function RT(){if(!ie){Be=null,dr=null;return}dr!==ie.uid&&(dr=ie.uid,Be=await Rr(ie.uid))}function ru(n){switch(n.split("?")[0]){case"#/auth":return jd;case"#/auth/email":return ZE;case"#/auth/password":return eT;case"#/auth/create-password":return tT;case"#/profile-setup":return()=>Hd({user:ie});case"#/home":return vs;case"#/today":return()=>dT({user:ie,profile:Be});case"#/today/log":return()=>fT({user:ie,profile:Be});case"#/history":return pT;case"#/leaderboard":return gT;case"#/settings":return()=>mT();case"#/settings/profile":return()=>yT({user:ie});case"#/settings/theme":return()=>wT({user:ie});case"#/settings/tracks":return()=>TT({user:ie});case"#/settings/tracks/edit":return()=>tu({user:ie,mode:"edit"});case"#/settings/tracks/new":return()=>tu({user:ie,mode:"new"});case"#/settings/tracks/templates":return()=>AT();default:return null}}function ST(n){console.error("App render fatal:",n);const e=document.getElementById("app");e.innerHTML=`
    <div class="center">
      <div class="card">
        <div class="card-title">Something broke</div>
        <p class="muted" style="white-space:pre-wrap;">${n?.message||String(n)}</p>
        <button class="btn" onclick="location.reload()">Reload</button>
      </div>
    </div>
  `}async function Kd(){try{if(!Gd){document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';return}const{path:n}=Sr();if(!n){ne("#/auth");return}if(!ie){nu(n)||ne("#/auth");const{path:e}=Sr();(ru(e)||jd)();return}if(await RT(),!Be&&n!=="#/profile-setup"){ne("#/profile-setup"),Hd({user:ie});return}if(ie&&Be&&fr!==ie.uid)try{const e=await GE(ie.uid,ie.email,Be);fr=ie.uid,e&&(Be=await Rr(ie.uid))}catch(e){console.error("Profile normalization failed:",e),fr=ie.uid}try{qd(Be)}catch(e){console.warn("Theme apply failed (continuing):",e)}if(Be&&nu(n)){ne("#/home"),vs();return}if(bT(n)){(ru(n)||vs)();return}ne("#/home"),vs()}catch(n){ST(n)}}JE(Kd);BE(async n=>{ie=n||null,Gd=!0,ie?dr!==ie.uid&&(Be=null,fr=null):(Be=null,dr=null,fr=null),await Kd()});document.getElementById("app").innerHTML='<div class="center"><p class="muted">Loading</p></div>';
